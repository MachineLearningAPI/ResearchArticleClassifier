arXiv:1311.4600v2 [math.NT] 20 Nov 2013

SMALL GAPS BETWEEN PRIMES
JAMES MAYNARD

Abstract. We introduce a refinement of the GPY sieve method for studying prime k-tuples
and small gaps between primes. This refinement avoids previous limitations of the method,
and allows us to show that for each k, the prime k-tuples conjecture holds for a positive
proportion of admissible k-tuples. In particular, lim inf n (pn+m − pn ) < ∞ for any integer
m. We also show that lim inf(pn+1 − pn ) ≤ 600, and, if we assume the Elliott-Halberstam
conjecture, that lim inf n (pn+1 − pn ) ≤ 12 and lim inf n (pn+2 − pn ) ≤ 600.

1. Introduction
We say that a set H = {h1 , . . . , hk } of distinct non-negative integers is ‘admissible’ if
for every prime p there is an integer a p such that a p h (mod p) for all h ∈ H. We are
interested in the following conjecture.
Conjecture (Prime k-tuples conjecture). Let H = {h1 , . . . , hk } be admissible. Then there
are infinitely many integers n, such that all of n + h1 , . . . , n + hk are prime.
When k > 1 no case of the prime k-tuples conjecture is currently known. Work on
approximations to the prime k-tuples conjecture has been very successful in showing the
existence of small gaps between primes, however. In their celebrated paper [5], Goldston,
Pintz and Yıldırım introduced a new method for counting tuples of primes, and this allowed
them to show that
pn+1 − pn
= 0.
(1.1)
lim inf
n
log pn
The recent breakthrough of Zhang [9] managed to extend this work to prove
lim inf (pn+1 − pn ) ≤ 70 000 000,

(1.2)

n

thereby establishing for the first time the existence of infinitely many bounded gaps between primes. Moreover, it follows from Zhang’s theorem the that number of admissible
2-tuples contained in [1, x]2 which satisfy the prime 2-tuples conjecture is ≫ x2 for large
x. Thus in this sense a positive proportion of admissible 2-tuples satisfy the prime 2-tuples
conjecture. The recent polymath project [7] has succeeded in reducing the bound (1.2) to
4680, by optimizing Zhang’s arguments and introducing several new refinements.
The above results have used the ‘GPY method’ to study prime tuples and small gaps
between primes, and this method relies heavily on the distribution of primes in arithmetic
progressions. Given θ > 0, we say the primes have ‘level of distribution θ’1 if, for any
A > 0, we have
π(x)
x
(1.3)
max π(x; q, a) −
≪A
.
(a,q)=1
ϕ(q)
(log x)A
θ
q≤x

1We note that different authors have given slightly different names or definitions to this concept. For the
purposes of this paper, (1.3) will be our definition of the primes having level of distribution θ.
1

2

JAMES MAYNARD

The Bombieri-Vinogradov theorem establishes that the primes have level of distribution θ
for any θ < 1/2, and Elliott and Halberstam [1] conjectured that this could be extended to
any θ < 1. Friedlander and Granville [2] have shown that (1.3) cannot hold with xθ replaced
with x/(log x)B for any fixed B, and so the Elliott-Halberstam conjecture is essentially the
strongest possible result of this type.
The original work of Goldston, Pintz and Yıldırım showed the existence of bounded
gaps between primes if (1.3) holds for some θ > 1/2. Moreover, under the ElliottHalberstam conjecture one had lim inf n (pn+1 − pn ) ≤ 16. The key breakthrough of Zhang’s
work was in establishing a suitably weakened form of (1.3) holds for some θ > 1/2.
If one looks for bounded length intervals containing two or more primes, then the GPY
method fails to prove such strong results. Unconditionally we are only able to improve
upon the trivial bound from the prime number theorem by a constant factor [4], and even
assuming the Elliott-Halberstam conjecture, the best available result [5] is
pn+2 − pn
(1.4)
lim inf
= 0.
n
log pn
The aim of this paper is to introduce a refinement of the GPY method which removes the
barrier of θ = 1/2 to establishing bounded gaps between primes, and allows us to show
the existence of arbitrarily many primes in bounded length intervals. This answers the
second and third questions posed in [5] on extensions of the GPY method (the first having
been answered by Zhang’s result). Our new method also has the benefit that it produces
numerically superior results to previous approaches.
Theorem 1.1. Let m ∈ N. We have
lim inf (pn+m − pn ) ≪ m3 e4m .
n

Terence Tao (private communication) has independently proven Theorem 1.1 (with a
slightly weaker bound) at much the same time. He uses a similar method; the steps are
more-or-less the same but the calculations are done differently. We will indicate some of
the differences in our proofs as we go along.
We see that the bound in Theorem 1.1 is quite far from the conjectural bound of approximately m log m predicted by the prime m-tuples conjecture.
Our proof naturally generalizes (but with a weaker upper bound) to many subsequences
of the primes which have a level of distribution θ > 0. In particular, we can show corresponding results where the primes are contained in short intervals [N, N + N 7/12+ǫ ] for any
ǫ > 0 or in an arithmetic progression modulo q ≪ (log N)A .
Theorem 1.2. Let m ∈ N. Let r ∈ N be sufficiently large depending on m, and let A =
{a1 , a2 , . . . , ar } be a set of r distinct integers. Then we have
#{{h1 , . . . , hm } ⊆ A : for infinitely many n all of n + h1 , . . . , n + hm are prime}
≫m 1.
#{{h1 , . . . , hm } ⊆ A}
Thus a positive proportion of admissible m-tuples satisfy the prime m-tuples conjecture
for every m, in an appropriate sense.
Theorem 1.3. We have
lim inf (pn+1 − pn ) ≤ 600.
n

We emphasize that the above result does not incorporate any of the technology used by
Zhang to establish the existence of bounded gaps between primes. The proof is essentially
elementary, relying only on the Bombieri-Vinogradov theorem. Naturally, if we assume
that the primes have a higher level of distribution, then we can obtain stronger results.

SMALL GAPS BETWEEN PRIMES

3

Theorem 1.4. Assume that the primes have level of distribution θ for every θ < 1. Then
lim inf (pn+1 − pn ) ≤ 12,
n

lim inf (pn+2 − pn ) ≤ 600.
n

Although the constant 12 of Theorem 1.4 appears to be optimal with our method in its
current form, the constant 600 appearing in Theorem 1.3 and Theorem 1.4 is certainly not
optimal. By performing further numerical calculations our method could produce a better
bound, and also most of the ideas of Zhang’s work (and the refinements produced by the
polymath project) should be able to be combined with this method to reduce the constant
further.
2. An improved GPY sieve method
We first give an explanation of the key idea behind our new approach. The basic idea of
the GPY method is, for a fixed admissible set H = {h1 , . . . , hk }, to consider the sum
k

(2.1)

χP (n + hi ) − ρ wn .

S (N, ρ) =
N≤n<2N i=1

where χP is the characteristic function of the primes, ρ > 0 and wn are non-negative
weights. If we can show that S (N, ρ) > 0 then at least one term in the sum over n must
have a positive contribution. By the non-negativity of wn , this means that there must be
some integer n ∈ [N, 2N] such that at least ⌊ρ + 1⌋ of the n + hi are prime. (Here ⌊x⌋ denotes
the largest integer less than or equal to x.) Thus if S (N, ρ) > 0 for all large N, there are
infinitely many integers n for which at least ⌊ρ + 1⌋ of the n + hi are prime (and so there are
infinitely many bounded length intervals containing ⌊ρ + 1⌋ primes).
The weights wn are typically chosen to mimic Selberg sieve weights. Estimating (2.1)
can be interpreted as a ‘k-dimensional’ sieve problem. The standard Selberg k-dimensional
weights (which can be shown to be essentially optimal in other contexts) are
(2.2)

2

λd ,

wn =
d|

λd = µ(d)(log R/d)k .

k
i=1 (n+hi )

d<R

With this choice we find that we just fail to prove the existence of bounded gaps between
primes if we assume the Elliott-Halberstam conjecture. The key new idea in the paper of
Goldston, Pintz and Yıldırım [5] was to consider more general sieve weights of the form
(2.3)

λd = µ(d)F(log R/d),

for a suitable smooth function F. Goldston, Pintz and Yıldırım chose F(x) = xk+l for
suitable l ∈ N, which has been shown to be essentially optimal when k is large. This allows
us to gain a factor of approximately 2 for large k over the previous choice of sieve weights.
As a result we just fail to prove bounded gaps using the fact that the primes have exponent
of distribution θ for any θ < 1/2, but succeed in doing so if we assume they have level of
distribution θ > 1/2.
The new ingredient in our method is to consider a more general form of the sieve
weights
(2.4)

2

λd1 ,...,dk .

wn =
di |n+hi ∀i

Using such weights with λd1 ,...,dk is the key feature of our method. It allows us to improve
on the previous choice of sieve weights by an arbitrarily large factor, provided that k is

4

JAMES MAYNARD

sufficiently large. It is the extra flexibility gained by allowing the weights to depend on the
divisors of each factor individually which gives this improvement.
The idea to use such weights is not entirely new. Selberg [8, Page 245] suggested the
possible use of similar weights in his work on approximations to the twin prime problem,
and Goldston and Yıldırım [6] considered similar weights in earlier work on the GPY
method, but with the support restricted to di < R1/k for all i.
We comment that our choice of λd1 ,...,dk will look like
k

(2.5)

λd1 ,...,dk ≈

µ(di ) f (d1 , . . . , dk ),
i=1

for a suitable smooth function f . For our precise choice of λd1 ,...,dk (given in Proposition
4.1) we find it convenient to give a slightly different form of λd1 ,...,dk , but weights of the
form (2.5) should produce essentially the same results.

3. Notation
We shall view k as a fixed integer, and H = {h1 , . . . , hk } as a fixed admissible set. In
particular, any constants implied by the asymptotic notation o, O or ≪ may depend on
k and H. We will let N denote a large integer, and all asymptotic notation should be
interpreted as referring to the limit N → ∞.
All sums, products and suprema will be assumed to be taken over variables lying in the
natural numbers N = {1, 2, . . . } unless specified otherwise. The exception to this is when
sums or products are over a variable p, which instead will be assumed to lie in the prime
numbers P = {2, 3, . . . , }.
Throughout the paper, ϕ will denote the Euler totient function, τr (n) the number of ways
of writing n as a product of r natural numbers and µ the Moebius function. We will let ǫ
be a fixed positive real number, and we may assume without further comment that ǫ is
sufficiently small at various stages of our argument. We let pn denote the nth prime, and
#A denote the number of elements of a finite set A. We use ⌊x⌋ to denote the largest integer
n ≤ x, and ⌈x⌉ the smallest integer n ≥ x. We let (a, b) be the greatest common divisor
of integers a and b. Finally, [a, b] will denote the closed interval on the real line with
endpoints a and b, except for in Section 5 where it will denote the least common multiple
of integers a and b instead.

4. Outline of the proof
We will find it convenient to choose our weights wn to be zero unless n lies in a fixed
residue class v0 (mod W), where W = p≤D0 p. This is a technical modification which
removes some minor complications in dealing with the effect of small prime factors. The
precise choice of D0 is unimportant, but it will suffice to choose
(4.1)

D0 = log log log N,

so certainly W ≪ (log log N)2 by the prime number theorem. By the Chinese remainder
theorem we can choose v0 such that v0 +hi is coprime to W for each i since H is admissible.
When n ≡ v0 (mod W), we choose our weights wn of the form (2.4). We now wish to

SMALL GAPS BETWEEN PRIMES

5

estimate the sums





S1 =

(4.2)

N≤n<2N
di |n+hi ∀i
n≡v0 (mod W)

(4.3)

k

S2 =
i=1
N≤n<2N
n≡v0 (mod W)

2

λd1 ,...,dk  ,



χP (n + hi ) 

di |n+hi ∀i

We evaluate these sums using the following proposition.

2

λd1 ,...,dk  .

Proposition 4.1. Let the primes have exponent of distribution θ > 0, and let R = N θ/2−δ for
some small fixed δ > 0. Let λd1 ,...,dk be defined in terms of a fixed piecewise differentiable
function F by
k

λd1 ,...,dk =

µ(

µ(di )di
r1 ,...,rk
di |ri ∀i
(ri ,W)=1∀i

i=1

k
2
i=1 ri )
k
i=1

ϕ(ri )

F

log rk
log r1
,
,...,
log R
log R

whenever ( ki=1 di , W) = 1, and let λd1 ,...,dk = 0 otherwise. Moreover, let F be supported on
Rk = {(x1 , . . . , xk ) ∈ [0, 1]k : ki=1 xi ≤ 1}. Then we have

provided Ik (F)

S1 =

(1 + o(1))ϕ(W)k N(log R)k
Ik (F),
W k+1

S2 =

(1 + o(1))ϕ(W)k N(log R)k+1
W k+1 log N

0 and Jk(m) (F)

0 for each m, where

0
1

1

0

2

1

···

=

j=1

F(t1 , . . . , tk )2 dt1 . . . dtk ,

···
0

Jk(m) (F)

Jk(m) (F),

1

1

Ik (F) =

k

F(t1 , . . . , tk )dtm
0

dt1 . . . dtm−1 dtm+1 . . . dtk .

0

We recall that if S 2 is large compared to S 1 then using the GPY method we can show
that there are infinitely many integers n such that several of the n + hi are prime. The
following proposition makes this precise.
Proposition 4.2. Let the primes have level of distribution θ > 0. Let δ > 0 and H =
{h1 , . . . , hk } be an admissible set. Let Ik (F) and Jk(m) (F) be given as in Proposition 4.1, and
let Sk denote the set of piecewise differentiable functions F : [0, 1]k → R supported on
Rk = {(x1 , . . . , xk ) ∈ [0, 1]k : ki=1 xi ≤ 1} with Ik (F) 0 and Jk(m) (F) 0 for each m. Let
Mk = sup
F∈Sk

Jk(m) (F)
,
Ik (F)

k
m=1

rk =

θMk
.
2

Then there are infinitely many integers n such that at least rk of the n + hi (1 ≤ i ≤ k) are
prime. In particular, lim inf n (pn+rk −1 − pn ) ≤ max1≤i, j≤k (hi − h j ).
Proof of Proposition 4.2. We let S = S 2 − ρS 1 , and recall that from Section 2 that if we
can show S > 0 for all large N, then there are infinitely many integers n such that at least
two of the n + hi are prime.

6

JAMES MAYNARD

We put R = N θ/2−ǫ for a small ǫ > 0. By the definition of Mk , we can choose F0 ∈ Sk
such that km=1 Jk(m) (F0 ) > (Mk − ǫ)Ik (F0 ). Using Proposition 4.1, we can then choose
λd1 ,...,dk such that
S =

ϕ(W)k N(log R)k log R
log N
W k+1
k

k

Jk(m) (F0 ) − ρIk (F0 ) + o(1)
j=1

k

ϕ(W) N(log R) Ik (F0 ) θ
− ǫ Mk − ǫ − ρ + o(1) .
2
W k+1
If ρ = θMk /2 − δ then, by choosing ǫ sufficiently small, we see that S > 0 for all large N.
Thus there are infinitely many integers n for which at least ⌊ρ + 1⌋ of the n + hi are prime.
Since ⌊ρ + 1⌋ = ⌈θMk /2⌉ if δ is sufficiently small, we obtain Proposition 4.2.
(4.4)

≥

Thus, if the primes have a fixed level of distribution θ, to show the existence of many of
the n + hi being prime for infinitely many n ∈ N we only require a suitable lower bound for
Mk . The following proposition establishes such a bound for different values of k.
Proposition 4.3. Let k ∈ N, and Mk be as given by Proposition 4.2. Then
(1) We have M5 > 2.
(2) We have M105 > 4.
(3) If k is sufficiently large, we have Mk > log k − 2 log log k − 2.
We now prove Theorems 1.1, 1.2, 1.3 and 1.4 from Propositions 4.2 and 4.3.
First we consider Theorem 1.3. We take k = 105. By Proposition 4.3, we have M105 > 2.
By the Bombieri-Vinogradov theorem, the primes have level of distribution θ = 1/2 − ǫ
for any ǫ > 0. Thus, if we take ǫ sufficiently small, we have θM105 /2 > 1. Therefore, by
Proposition 4.2, we have lim inf(pn+1 − pn ) ≤ max1≤i, j≤105 (hi − h j ) for any admissible set
H = {h1 , . . . , h105 }. By computations performed by Thomas Engelsma (unpublished), we
can choose2 H such that 0 ≤ h1 < . . . < h105 and h105 − h1 = 600. This gives Theorem 1.3.
If we assume the Elliott-Halberstam conjecture then the primes have level of distribution
θ = 1 − ǫ. First we take k = 105, and see that θM105 /2 > 2 for ǫ sufficiently small (since
M105 > 4). Therefore, by Proposition 4.2, lim inf n (pn+2 − pn ) ≤ max1≤i, j≤105 (hi − h j ). Thus,
choosing the same admissible set H as above, we see lim inf n (pn+2 − pn ) ≤ 600 under the
Elliott-Halberstam conjecture.
Next we take k = 5 and H = {0, 2, 6, 8, 12}, with θ = 1 − ǫ again. By Proposition 4.3
we have M5 > 2, and so θM5 /2 > 1 for ǫ sufficiently small. Thus, by Proposition 4.2,
lim inf n (pn+1 − pn ) ≤ 12 under the Elliott-Halberstam conjecture. This completes the proof
of Theorem 1.4.
Finally, we consider the case when k is large. For the rest of this section, any constants
implied by asymptotic notation will be independent of k. By the Bombieri-Vinogradov
theorem, we can take θ = 1/2 − ǫ. Thus, by Proposition 4.3 we have for k sufficiently large
(4.5)

1 ǫ
θMk
log k − 2 log log k − 2 .
≥
−
2
4 2

2Explicitly, we can take H = {0, 10, 12, 24, 28, 30, 34, 42, 48, 52, 54, 64, 70, 72, 78, 82, 90, 94, 100, 112,
114, 118, 120, 124, 132, 138, 148, 154, 168, 174, 178, 180, 184, 190, 192, 202, 204, 208, 220, 222, 232, 234,
250, 252, 258, 262, 264, 268, 280, 288, 294, 300, 310, 322, 324, 328, 330, 334, 342, 352, 358, 360, 364, 372,
378, 384, 390, 394, 400, 402, 408, 412, 418, 420, 430, 432, 442, 444, 450, 454, 462, 468, 472, 478, 484, 490,
492, 498, 504, 510, 528, 532, 534, 538, 544, 558, 562, 570, 574, 580, 582, 588, 594, 598, 600}. This set was
obtained from the website http://math.mit.edu/˜primegaps/ maintained by Andrew Sutherland.

SMALL GAPS BETWEEN PRIMES

7

We choose ǫ = 1/k, and see that θMk /2 > m if k ≥ Cm2 e4m for some absolute constant C
(independent of m and k). Thus, for any admissible set H = {h1 , . . . , hk } with k ≥ Cm2 e4m ,
at least m + 1 of the n + hi must be prime for infinitely many integers n. We can choose
our set H to be {pπ(k)+1 , . . . , pπ(k)+k }. This is admissible, since no element is a multiple
of a prime less than k (and there are k elements, so it cannot cover all residue classes
modulo any prime greater than k.) This set has diameter pk+π(k) − pπ(k)+1 ≪ k log k. Thus
lim inf n (pn+m − pn ) ≪ k log k ≪ m3 e4m if we take k = ⌈Cm2 e4m ⌉. This gives Theorem 1.1.
We can now establish Theorem 1.2 by a simple counting argument. Given m, we let
k = ⌈Cm2 e4m ⌉ as above. Therefore if {h1 , . . . , hk } is admissible then there exists a subset
{h′1 , . . . , h′m } ⊆ {h1 , . . . , hk } with the property that there are infinitely many integers n for
which all of the n + h′i are prime (1 ≤ i ≤ m).
We let A2 denote the set formed by starting with the given set A = {a1 , . . . , ar } and
for each prime p ≤ k in turn removing all elements of the residue class modulo p which
contains the fewest integers. We see that #A2 ≥ r p≤k (1 − 1/p) ≫m r. Moreover, any
subset of A2 of size k must be admissible, since it cannot cover all residue classes modulo
p for any prime p ≤ k. We let s = #A2 , and since r is taken sufficiently large in terms of
m, we may assume that s > k.
We see there are ks sets H ⊆ A2 of size k. Each of these is admissible, and so contains
at least one subset {h′1 , . . . , h′m } ⊆ A2 which satisfies the prime m-tuples conjecture. Any
s−m
admissible set B ⊆ A2 of size m is contained in k−m
sets H ⊆ A2 of size k. Thus there
are at least

s
k

s−m −1
k−m

≫m sm ≫m rm admissible sets B ⊆ A2 of size m which satisfy the

prime m-tuples conjecture. Since there are mr ≤ rm sets {h1 , . . . , hm } ⊆ A, Theorem 1.2
holds.
We are left to establish Propositions 4.1 and 4.3.
5. Selberg sieve manipulations
In this section we perform initial manipulations towards establishing Proposition 4.1.
These arguments are multidimensional generalizations of the sieve arguments of [3]. In
particular, our approach is based on the elementary combinatorial ideas of Selberg. The
aim is to introduce a change of variables to rewrite our sums S 1 and S 2 in a simpler form.
Throughout the rest of the paper we assume that the primes have a fixed level of distribution θ, and R = N θ/2−ǫ . We restrict the support of λd1 ,...,dk to tuples for which the product
d = ki=1 di is less than R and also satisfies (d, W) = 1 and µ(d)2 = 1. We note that the
condition µ(d)2 = 1 implies that (di , d j ) = 1 for all i j.
Lemma 5.1. Let

k

λd1 ,...,dk

µ(ri )ϕ(ri )

yr1 ,...,rk =

d1 ,...,dk
ri |di ∀i

i=1

k
i=1

di

.

Let ymax = supr1 ,...,rk |yr1 ,...,rk |. Then
S1 =

N
W

y2r1 ,...,rk
r1 ,...,rk

k
i=1

ϕ(ri )

+O

y2max N(log R)k
.
WD0

Proof. We expand out the square, and swap the order of summation to give
(5.1)

λd1 ,...,dk

S1 =
N≤n<2N
di |n+hi ∀i
n≡v0 (mod W)

2

λd1 ,...,dk λe1 ,...,ek

=
d1 ,...,dk
e1 ,...,ek

1.
N≤n<2N
n≡v0 (mod W)
[di ,ei ]|n+hi ∀i

8

JAMES MAYNARD

We recall that here, and throughout this section, we are using [a, b] to denote the least
common multiple of a and b.
By the Chinese remainder theorem, the inner sum can be written as a sum over a single
residue class modulo q = W ki=1 [di , ei ] provided that the integers W, [d1 , e1 ], . . . , [dk , ek ]
are pairwise coprime. In this case the inner sum is N/q + O(1). If the integers are not
pairwise coprime then the inner sum is empty. This gives
′
′ λd1 ,...,dk λe1 ,...,ek
N
+O
S1 =
(5.2)
|λd1 ,...,dk λe1 ,...,ek | ,
k
W d ,...,d
i=1 [di , ei ]
d ,...,d
1

1

k

k

e1 ,...,ek

e1 ,...,ek

where ′ is used to denote the restriction that we require W, [d1 , e1 ], . . . , [dk , ek ] to be
pairwise coprime. To ease notation we will put λmax = supd1 ,...,dk |λd1 ,...,dk |. We now see that
since λd1 ,...,dk is non-zero only when ki=1 di < R, the error term contributes
≪ λ2max

(5.3)

τk (d)

2

≪ λ2max R2 (log R)2k ,

d<R

which will be negligible.
In the main sum we wish to remove the dependencies between the di and the e j variables.
We use the identity
1
1
ϕ(ui )
=
(5.4)
[di , ei ] di ei u |d ,e
i

i

i

to rewrite the main term as
N
W

(5.5)

k
u1 ,...,uk i=1

λd1 ,...,dk λe1 ,...,ek

′

ϕ(ui )

d1 ,...,dk
e1 ,...,ek
ui |di ,ei ∀i

k
i=1

(

di )(

k
i=1 ei )

.

We recall that λd1 ,...,dk is supported on integers d1 , . . . , dk with (di , W) = 1 for each i and
(di , d j ) = 1 for all i j. Thus we may drop the requirement that W is coprime to each of
the [di , ei ] from the summation, since these terms have no contribution. Similarly, we may
drop the requirement that the di variables are all pairwise coprime, and the requirement
that the ei variables are all pairwise coprime. Thus the only remaining restriction coming
from the pairwise coprimality of W, [d1 , e1 ], . . . , [dk , ek ] is that (di , e j ) = 1 for all i j.
We can remove the requirement that (di , e j ) = 1 by multiplying our expression by
j. This transforms the main term to
si, j |di ,e j µ(si, j ). We do this for all i, j with i
(5.6)

N
W

k
u1 ,...,uk i=1

λd1 ,...,dk λe1 ,...,ek

µ(si, j )

ϕ(ui )
s1,2 ,...,sk,k−1 1≤i, j≤k
i j

d1 ,...,dk
e1 ,...,ek
ui |di ,ei ∀i
si, j |di ,e j ∀i j

k
i=1

(

di )(

k
i=1 ei )

.

We can restrict the si, j to be coprime to ui and u j because terms with si, j not coprime to
ui or u j make no contribution to our sum. This is because λd1 ,...,dk = 0 unless (di , d j ) = 1.
Similarly we can further restrict our sum so that si, j is coprime to si,a and sb, j for all a j
and b i. We denote the summation over s1,2 , . . . , sk,k−1 with these restrictions by ∗ .
We now introduce a change of variables to make the estimation of the sum more straightforward. We let
k

(5.7)

λd1 ,...,dk

µ(ri )ϕ(ri )

yr1 ,...,rk =
i=1

d1 ,...,dk
ri |di ∀i

k
i=1

di

.

SMALL GAPS BETWEEN PRIMES
k
i=1

This change is invertible. For d1 , . . . , dk with

k
i=1

r1 ,...,rk
di |ri ∀i

di square-free we find that

k

yr1 ,...,rk
ϕ(ri )

e1 ,...,ek
ri |ei ∀i

r1 ,...,rk i=1
di |ri ∀i

k
i=1 ei r1 ,...,rk i=1
di |ri ∀i
ri |ei ∀i

e1 ,...,ek

k
i=1 ei

k

λe1 ,...,ek

=

(5.8)

λe1 ,...,ek

µ(ri )

=

9

λd1 ,...,dk
.
k
i=1 µi (di )di

µ(ri ) =

Thus any choice of yr1 ,...,rk supported on r1 , . . . , rk with the product r = ki=1 ri squarefree and satisfying r < R and (r, W) = 1 will give a suitable choice of λd1 ,...,dk . We let
ymax = supr1 ,...,rk |yr1 ,...,rk |. Now, since d/ϕ(d) = e|d 1/ϕ(e) for square-free d, we find by
taking r′ = ki=1 ri /di that
k

k

λmax ≤

sup
k
i=1

di

ymax

d1 ,...,dk
di square-free

k

≤ ymax

sup
k
i=1

d1 ,...,dk
i=1
di square-free

≤ ymax sup
d1 ,...,dk

≤ ymax

(5.9)

u<R

d|

r1 ,...,rk
i=1
di |ri ∀i
k
r
<R
i
i=1
k
i=1 ri square-free

i=1

k
i=1

di

di
ϕ(di )

µ(d)2
ϕ(d)

r′ <R/ ki=1 di
(r′ , ki=1 di )=1

r′ <R/ ki=1 di
(r′ , ki=1 di )=1

µ(ri )2
ϕ(ri )

µ(r′ )2 τk (r′ )
ϕ(r′ )

µ(r′ )2 τk (r′ )
ϕ(r′ )

µ(u)2 τk (u)
≪ ymax (log R)k .
ϕ(u)

In the last line we have taken u = dr′ , and used the fact τk (dr′ ) ≥ τk (r′ ). Hence the error
term O(λ2max R2 (log N)2k ) is of size O(y2max R2 (log N)4k ).
Substituting our change of variables (5.7) into the main term (5.6), and using the above
estimate for the error term, we obtain
S1 =

N
W

k
u1 ,...,uk i=1

k

∗

ϕ(ui )

µ(si, j )

s1,2 ,...,sk,k−1 1≤i, j≤k
i j

i=1

µ(ai )µ(bi )
ya ,...,a yb ,...,b
ϕ(bi )ϕ(ai ) 1 k 1 k

+ O y2max R2 (log R)4k ,

(5.10)

where a j = u j i j s j,i and b j = u j i j si, j . In these expressions we have used the fact
that we have restricted si, j to be coprime to the other terms in the expression for ai and
b j . Since there is no contribution from terms when a j or b j are not square-free, we may
rewrite µ(a j ) as µ(u j ) i j µ(si, j ), and similarly for ϕ(a j ), µ(b j ) and ϕ(b j ). This gives us
(5.11)
S1 =

N
W

k
u1 ,...,uk i=1

µ(ui )2
ϕ(ui )

∗
s1,2 ,...,sk,k−1 1≤i, j≤k
i j

µ(si, j )
ya ,...,a yb ,...,b + O y2max R2 (log R)4k .
ϕ(si, j )2 1 k 1 k

10

JAMES MAYNARD

We see that there is no contribution from si, j with (si, j , W) 1 because of the restricted
support of y. Thus we only need to consider si, j = 1 or si, j > D0 . The contribution when
si, j > D0 is
(5.12)
≪

y2max N
W

u<R
(u,W)=1

µ(u)2
ϕ(u)

µ(si, j )2
ϕ(si, j )2

k
si, j >D0

s≥1

µ(s)2
ϕ(s)2

k2 −k−1

≪

Thus we may restrict our attention to the case when si, j = 1 ∀i
(5.13)

S1 =

N
W

y2u1 ,...,uk
k
i=1

u1 ,...,uk

ϕ(ui )

y2max ϕ(W)k N(log R)k
.
W k+1 D0
j. This gives

y2max ϕ(W)k N(log R)k
+ y2max R2 (log R)4k .
W k+1 D0

+O

We recall that R2 = N θ−2δ ≤ N 1−2δ and W ≪ N δ , and so the first error term dominates.
This gives the result.
We now consider S 2 . We write S 2 =
S 2(m) =

(5.14)

k
m=1

S 2(m) , where
2

λd1 ,...,dk .

χP (n + hm )
N≤n<2N
n≡v0 (mod W)

d1 ,...,dk
di |n+hi ∀i

We now estimate S 2(m) in a similar way to our treatment of S 1 .
Lemma 5.2. Let
k

y(m)
r1 ,...,rk =

λd1 ,...,dk

µ(ri )g(ri )
d1 ,...,dk
ri |di ∀i
dm =1

i=1

k
i=1

ϕ(di )

,

where g is the totally multiplicative function defined on primes by g(p) = p − 2. Let
(m)
y(m)
max = supr1 ,...,rk |yr1 ,...,rk |. Then for any fixed A > 0 we have
S 2(m) =

N
ϕ(W) log N

2
(y(m)
r1 ,...,rk )
r1 ,...,rk

k
i=1

g(ri )

+O

2
k−2
y2 N
(y(m)
N(log N)k−2
max ) ϕ(W)
+ O max A .
k−1
(log N)
W D0

Proof. We first expand out the square and swap the order of summation to give
(5.15)

S 2(m) =

λd1 ,...,dk λe1 ,...,ek
d1 ,...,dk
e1 ,...,ek

χP (n + hm ).
N≤n<2N
n≡v0 (mod W)
[di ,ei ]|n+hi ∀i

As with S 1 , the inner sum can be written as a sum over a single residue class modulo
q = W ki=1 [di , ei ] provided that W, [d1 , e1 ], . . . , [dk , ek ] are pairwise coprime. The integer
n + hm will lie in a residue class coprime to the modulus if and only if d j = e j = 1. In this
case the inner sum will contribute XN /ϕ(q) + O(E(N, q)) where
(5.16)

(a,q)=1

(5.17)

χP (n) −

E(N, q) = 1 + sup
N≤n<2N
n≡a (mod q)

χP (n).

XN =
N≤n<2N

1
χP (n) ,
ϕ(q) N≤n<2N

SMALL GAPS BETWEEN PRIMES

11

If either one pair of W, [d1 , e1 ], . . . , [dk , ek ] share a common factor, or if either dm or em are
not 1, then the contribution of the inner sum is zero. Thus we obtain
′ λd1 ,...,dk λe1 ,...,ek
XN
+O
|λd1 ,...,dk λe1 ,...,ek |E(N, q) ,
(5.18)
S 2(m) =
k
ϕ(W) d ,...,d
i=1 ϕ([di , ei ])
d ,...,d
1

1

k

k

e1 ,...,ek

e1 ,...,ek
em =dm =1

where we have written q = W ki=1 [di , ei ].
We first deal with the contribution from the error terms. From the support of λd1 ,...,dk we
see that we only need to consider square-free q with q < R2 W. Given a square-free integer
r, there are at most τ3k (r) choices of d1 , . . . , dk , e1 , . . . , ek for which W ki=1 [di , ei ] = r. We
also recall from (5.9) that λmax ≪ ymax (log R)k . Thus the error term contributes
≪ y2max (log R)2k

(5.19)

µ(r)2 τ3k (r)E(N, r).
r<R2 W

By Cauchy-Schwarz, the trivial bound E(N, q) ≪ N/ϕ(q), and our hypothesis that the
primes have level of distribution θ, this contributes for any fixed A > 0
(5.20)

µ(r)2 τ23k (r)

≪ y2max (log R)2k
r<R2 W

N
ϕ(r)

1/2

µ(r)2 E(N, r)

1/2

≪

r<R2 W

y2max N
.
(log N)A

We now concentrate on the main sum. As in the treatment of S 1 in the proof of Lemma
5.1, we rewrite the conditions (di , e j ) = 1 by multiplying our expression by si, j |di ,e j µ(si, j ).
Again we may restrict si, j to be coprime to ui , u j , si,a and sb, j for all a i and b j. We
denote the summation subject to these restrictions by ∗ . We also split the ϕ([di , ei ]) terms
by using the equation (valid for square-free di , ei )
1
1
=
g(ui ),
(5.21)
ϕ([di , ei ]) ϕ(di )ϕ(ei ) u |d ,e
i

i

i

where g is the totally multiplicative function defined on primes by g(p) = p − 2. This gives
us a main term of
(5.22)

k

XN
ϕ(W) u

∗

g(ui )

1 ,...,uk

s1,2 ,...,sk,k−1 1≤i, j≤k

i=1

λd1 ,...,dk λe1 ,...,ek

µ(si, j )
d1 ,...,dk
e1 ,...,ek
ui |di ,ei ∀i
si, j |di ,e j ∀i j
dm =em =1

k
i=1

ϕ(di )ϕ(ei )

.

We have now separated the dependencies between the e and d variables, so again we make
a substitution. We let
k

y(m)
r1 ,...,rk =

(5.23)

λd1 ,...,dk

µ(ri )g(ri )
d1 ,...,dk
ri |di ∀i
dm =1

i=1

k
i=1

ϕ(di )

.

We note y(m)
r1 ,...,rk = 0 unless rm = 1. Substituting this into (5.22), we obtain a main term of
(5.24)

XN
ϕ(W) u

1 ,...,uk

k
i=1

µ(ui )2
g(ui )

s1,2 ,...,sk,k−1

µ(si, j ) (m)
y
y(m) ,
2 a1 ,...,ak b1 ,...,bk
g(s
)
i, j
1≤i, j≤k
i j

where a j = u j i j s j,i and b j = u j i j si, j for each 1 ≤ j ≤ k. As before, we have
replaced µ(a j ) with µ(u j ) i j µ(s j,i ) (and similarly for g(a j ), µ(b j ) and g(b j)). This is
valid since terms with a j or b j not square-free make no contribution.

12

JAMES MAYNARD

We see the contribution from si, j
≪

≪

(5.25)

2
(y(m)
max ) N
ϕ(W) log N

u<R
(u,W)=1

1 is of size
µ(u)2
g(u)

µ(s)2
g(s)2

k−1
s

k(k−1)−1
si, j >D0

µ(si1 ,i2 )2
g(si, j )2

2
k−2
(y(m)
N(log R)k−1
max ) ϕ(W)
.
W k−1 D0 log N

Thus we find that
(5.26)

S 2(m)

2
(y(m)
u1 ,...,uk )

XN
=
ϕ(W) u

k
i=1

1 ,...,uk

g(ui )

2
k−2
y2max N
(y(m)
N(log R)k−2
max ) ϕ(W)
.
+
O
(log N)A
D0 W k−1

+O

Finally, by the prime number theorem, XN = N/ log N + O(N/(log N)2 ). This error term
contributes
(5.27)

≪

2
(y(m)
max ) N
ϕ(W)(log N)2

u<R
(u,W)=1

µ(u)2
g(u)

k−1

≪

2
k−2
(y(m)
N(log R)k−3
max ) ϕ(W)
,
W k−1

which can be absorbed into the first error term of (5.26). This completes the proof.
Remark. In our proof of Lemma 5.2 we only really require λd1 ,...,dk to be supported on
d1 , . . . , dk satisfying i j di < R for all j instead of ki=1 di < R. For k ≥ 3, the numerical
benefit of this extension is very small and so we do not consider it further.
We now relate our new variables y(m)
r1 ,...,rk to the yr1 ,...,rk variables from S 1 .
Lemma 5.3. If rm = 1 then
yr1 ,...,rm−1 ,am ,rm+1 ,...,rk
ymax ϕ(W) log R
+O
.
ϕ(am )
WD0

y(m)
r1 ,...,rk =
am

Proof. We assume throughout the proof that rm = 1. We first substitute our expression
(5.8) into the definition (5.23). This gives
k

k

(5.28)

y(m)
r1 ,...,rk =

µ(ri )g(ri )
d1 ,...,dk i=1
ri |di ∀i
dm =1

i=1

µ(di )di
ϕ(di )

ya1 ,...,ak
k
i=1

a1 ,...,ak
di |ai ∀i

ϕ(ai )

.

We swap the summation of the d and a variables to give
k

(5.29)

y(m)
r1 ,...,rk =

a1 ,...,ak
ri |ai ∀i

i=1

k

ya1 ,...,ak

µ(ri )g(ri )

k
i=1

ϕ(ai )

d1 ,...,dk i=1
di |ai ,ri |di ∀i
dm =1

µ(di )di
.
ϕ(di )

We can now evaluate the sum over d1 , . . . , dk explicitly. This gives
k

(5.30)

y(m)
r1 ,...,rk =

ya1 ,...,ak

µ(ri )g(ri )
i=1

a1 ,...,ak
ri |ai ∀i

k
i=1

ϕ(ai )

i m

µ(ai )ri
.
ϕ(ai )

We see that from the support of ya1 ,...,ak that we may restrict the summation over a j to
(a j , W) = 1. Thus either a j = r j or a j > D0 r j . For j
m, the total contribution from

SMALL GAPS BETWEEN PRIMES

aj

13

r j is
k

≪ ymax

a j >D0 r j

i=1
k

(5.31)

≪
i=1

µ(a j )2
ϕ(a j )2

g(ri )ri

am <R
(am ,W)=1

µ(am )2
ϕ(am )

ymax ϕ(W) log R
g(ri )ri ymax ϕ(W) log R
≪
.
WD0
WD0
ϕ(ri )2

Thus we find that the main contribution is when a j = r j for all j
k

(5.32)

1≤i≤k ri |ai
i j,m

µ(ai )2
ϕ(ai )2

y(m)
r1 ,...,rk =
i=1

g(ri )ri
ϕ(ri )2

m. We have

yr1 ,...,rm−1 ,am ,rm+1 ,...,rk
ymax ϕ(W) log R
+O
.
ϕ(am )
WD0

am

We note that g(p)p/ϕ(p) = 1 + O(p ). Thus, since the contribution is zero unless ki=1 ri
is coprime to W, we see that the product in the above expression may be replaced by
1 + O(D−1
0 ). This gives the result.
−2

2

6. Smooth choice of y
We now choose suitable values for our y variables, and complete the proof of Proposition 4.1.
We first give some comments to motivate our choice of the y variables. We do not aim
for full rigor, but wish to give the reader some explanation for our choice. We wish to
choose y so as to maximize the ratio of the main terms of S 2 and S 1 . If we use Lagrangian
multipliers to maximize this ratio (treating all error terms as zero) we arrive at the condition
that
k

(6.1)

λyr1 ,...,rk =
i=1

k

ϕ(ri )
g(ri )

m=1

g(rm ) (m)
y
ϕ(rm ) r1 ,...,rm−1 ,1,rm+1 ,...,rk

for some fixed constant λ. The y terms are supported on integers free of small prime factors,
and for most integers r free of small prime factors we have g(r) ≈ ϕ(r) ≈ r, and so the
above condition reduces to
k

(6.2)

y(m)
r1 ,...,rm−1 ,1,rm+1 ,...,rk .

λyr1 ,...,rk ≈
m=1

This condition looks smooth (it has no dependence on the prime factorization of the ri ) and
should be able to be satisfied if yr1 ,...,rk is a smooth function of the ri variables. Motivated
by the above, when the product r = ki=1 ri satisfies (r, W) = 1 and µ(r)2 = 1 we choose
(6.3)

yr1 ,...,rk = F

log rk
log r1
,
,...,
log R
log R

for some piecewise differentiable function F : Rk → R, supported on Rk = {(x1 , . . . , xk ) ∈
[0, 1]k : ki=1 xi ≤ 1}. As previously required, we set yr1 ,...,rk = 0 if the product r is either not
coprime to W or is not square-free. With this choice of y, we can suitable obtain asymptotic
estimates for S 1 and S 2 .
We will use the following Lemma to estimate our sums S 1 and S 2 with this choice of y.
Lemma 6.1. Let κ, A1 , A2 , L > 0. Let γ be a multiplicative function satisfying
γ(p)
0≤
≤ 1 − A1 ,
p

14

JAMES MAYNARD

and
γ(p) log p
− κ log z/w ≤ A2
p
w≤p≤z

−L ≤

for any 2 ≤ w ≤ z. Let g be the totally multiplicative function defined on primes by
g(p) = γ(p)/(p − γ(p)). Finally, let G : [0, 1] → R be a piecewise differentiable function
and let Gmax = supt∈[0,1] (|G(t)| + |G′ (t)|). Then
µ(d)2 g(d)G
d<z

1

log d
(log z)κ
=S
log z
Γ(κ)

G(x)xκ−1 dx + OA1 ,A2 ,κ (SLGmax (log z)κ−1 ),
0

where
1−

S=
p

γ(p)
p

−1

1−

1 κ
.
p

Here the constant implied by the ‘O’ term is independent of G and L.
Proof. This is [3, Lemma 4], with slight changes to the notation.
We now finish our estimations of S 1 and S 2(m) , completing the proof of Proposition 4.1.
We first estimate S 1 .
Lemma 6.2. Let yr1 ,...,rk be given in terms of a piecewise differentiable function F supported
on Rk = {(x1 , . . . , xk ) ∈ [0, 1]k : ki=1 xi ≤ 1} by (6.3). Let
k

Fmax =

|F(t1 , . . . , tk )| +

sup
(t1 ,...,tk

)∈[0,1]k

|
i=1

∂F
(t1 , . . . , tk )|.
∂ti

Then we have
S1 =

2
Fmax
ϕ(W)k N(log R)k
ϕ(W)k N(log R)k
I
(F)
+
O
,
k
W k+1
W k+1 D0

where
1

1

F(t1 , . . . , tk )2 dt1 . . . dtk .

···

Ik (F) =

0

0

Proof. We substitute our choice (6.3) of y into our expression of S 1 in terms of yr1 ,...,rk
given by Lemma 5.1. This gives
(6.4) S 1 =

N
W

k
u1 ,...,uk
i=1
(ui ,u j )=1∀i j
(ui ,W)=1∀i

log u1
µ(ui )2
log rk
F
,...,
ϕ(ui )
log R
log R

2

+O

2
Fmax
ϕ(W)k N(log R)k
.
W k+1 D0

We note that two integers a and b with (a, W) = (b, W) = 1 but (a, b) 1 must have a
common prime factor which is greater than D0 . Thus we can drop the requirement that
(ui , u j ) = 1, at the cost of an error of size
≪

(6.5)

≪

2
Fmax
N
W

2
Fmax
N
W

k
p>D0 u1 ,...,uk <R i=1
p|ui ,u j
(u1 ,W)=1∀i

p>D0

1
(p − 1)2

µ(ri )2
ϕ(ui )

u<R
(u,W)=1

µ(u)2
ϕ(u)

k

≪

2
Fmax
ϕ(W)k N(log R)k
.
W k+1 D0

SMALL GAPS BETWEEN PRIMES

15

Thus we are left to evaluate the sum
k

(6.6)
u1 ,...,uk
i=1
(ui ,W)=1∀i

log u1
log uk 2
µ(ui )2
F
.
,...,
ϕ(ui )
log R
log R

We can now estimate this sum by k applications of Lemma 6.1, dealing with the sum over
each ui in turn. For each application we take κ = 1 and



1, p ∤ W,
γ(p) = 
(6.7)

0, otherwise,
L≪1+

(6.8)

p|W

log p
≪ log D0 ,
p

and A1 and A2 fixed constants of suitable size. This gives
k
u1 ,...,uk
i=1
(ui ,W)=1∀i

µ(ui )2
log u1
log uk
F
,...,
ϕ(ui )
log R
log R

2

=

ϕ(W)k (log R)k
Ik (F)
Wk

2
Fmax
ϕ(W)k (log D0 )(log R)k−1
.
Wk
We now combine (6.9) with (6.4) and (6.5) to obtain the result.

(6.9)

+O

Lemma 6.3. Let yr1 ,...,rk , F and Fmax be as described in Lemma 6.2. Then we have
S 2(m) =

F 2 ϕ(W)k N(log R)k
ϕ(W)k N(log R)k+1 (m)
,
Jk (F) + O max
k+1
W log N
W k+1 D0

where
1

1

Jk(m) (F) =

1

···
0

2

F(t1 , . . . , tk )dtm dt1 . . . dtm−1 dtm+1 . . . dtk .
0

0

Proof. The estimation of S 2(m) is similar to the estimation of S 1 . We first estimate y(m)
r1 ,...,rk .
k
2
We recall that y(m)
=
0
unless
r
=
1
and
r
=
r
satisfies
(r,
W)
=
1
and
µ(r)
= 1,
m
r1 ,...,rk
i=1 i
(m)
in which case yr1 ,...,rk is given in terms of yr1 ,...,rk by Lemma 5.3. We first concentrate on this
0. We substitute our choice (6.3) of y into our expression from Lemma
case when y(m)
r1 ,...,rk
5.3. This gives
y(m)
r1 ,...,rk =
(u,W

(6.10)

k
i=1 ri )=1

+O

µ(u)2 log r1
log rm−1 log u log rm+1
log rk
F
,...,
,
,
,...,
ϕ(u)
log R
log R log R log R
log R

Fmax ϕ(W) log R
.
WD0

We can see from this that y(m)
max ≪ ϕ(W)F max (log R)/W. We now estimate the sum over u in
(6.10). We apply Lemma 6.1 with κ = 1 and

k


1, p ∤ W i=1 ri ,
(6.11)
γ(p) = 

0, otherwise,
(6.12)

L≪1+

p|W

k
i=1 ri

log p
≪
p

log p
+
p
p<log R

p|W ki=1 ri
p>log R

log log R
≪ log log N,
log R

16

JAMES MAYNARD

and with A1 , A2 suitable fixed constants. This gives us
y(m)
r1 ,...,rk = (log R)

(6.13)

ϕ(W)
W

k
i=1

ϕ(ri ) (m)
Fmax ϕ(W) log R
Fr1 ,...,rk + O
,
ri
WD0

where
1

Fr(m)
=
1 ,...,rk

(6.14)

F
0

log r1
log rm−1
log rm+1
log rk
dtm .
,...,
, tm ,
,...,
log R
log R
log R
log R

Thus we have shown that if rm = 1 and r = ki=1 ri satisfies (r, W) = 1 and µ(r)2 = 1
then yr1 ,...,rk is given by (6.13), and otherwise y(m)
r1 ,...,rk = 0. We now substitute this into our
expression
(6.15)
2
2
k−2
(y(m)
y2max N
(y(m)
N(log N)k−2
N
r1 ,...,rk )
max ) ϕ(W)
+
O
.
S 2(m) =
+
O
ϕ(W) log N r ,...,r ki=1 g(ri )
(log N)A
W k−1 D0
1

k

from Lemma 5.2. We obtain
(6.16)
S 2(m) =

ϕ(W)N(log R)2
W 2 log N

k
r1 ,...,rk
i=1
(ri ,W)=1∀i
(ri ,r j )=1∀i j
rm =1

F 2 ϕ(W)k N(log R)k
µ(ri )2 ϕ(ri )
(Fr(m)
)2 + O max
.
1 ,...,rk
g(ri )ri
W k+1 D0

We remove the condition that (ri , r j ) = 1 in the same way we did when considering S 1 .
Instead of (6.5), this introduces an error which is of size
(6.17)
2
2
Fmax
ϕ(W)k N(log N)k
ϕ(W)N(log R)2 Fmax
ϕ(p)2
µ(r)2 ϕ(r) k−1
≪
.
≪
g(r)r
W 2 log N
g(p)2 p2 r<R
W k+1 D0
p>D
0

(r,W)=1

Thus we are left to evaluate the sum
(6.18)
r1 ,...,rm−1 ,rm+1 ,...,rk 1≤i≤k
(ri ,W)=1∀i
i j

µ(ri )2 ϕ(ri )
(Fr(m)
)2 .
1 ,...,rk
g(ri )ri

We estimate this by applying Lemma 6.1 to each summation variable in turn. In each case
we take κ = 1 and

1


1 + p2 −p−1 , p ∤ W
γ(p) = 
(6.19)

0,
otherwise,
L≪1+

(6.20)

p|W

log p
≪ log D0 ,
p

and A1 , A2 suitable fixed constants. This gives
(6.21)

S 2(m) =

F 2 ϕ(W)k N(log N)k
ϕ(W)k N(log R)k+1 (m)
Jk + O max
,
k+1
W log N
W k+1 D0

where
(6.22)
as required.

Jk(m) =

1

1

1

···
0

2

F(t1 , . . . , tk )dtm dt1 . . . tm−1 dtm+1 . . . dtk ,
0

0

SMALL GAPS BETWEEN PRIMES

17

(m)
k
i=1 ti ) for some function G, then Ik (F) and Jk (F) simplify
1
1
1
G(t)2 tk−1 dt/(k − 1)! and Jk(m) (F) = 0 ( t G(v)dv)2 tk−2 dt/(k − 2)! for each m,
0

Remark. If F(t1 , . . . , tk ) = G(

to Ik (F) =
which is equivalent to the results obtained using the original GPY method using weights
given by (2.3).
Remark. Tao gives an alternative approach to arrive at his equivalent of Proposition 4.1.
His approach is to define λd1 ,...,dk in terms of a suitable smooth function f (t1 , . . . , tk ) as in
(2.5). He then estimates the corresponding sums directly using Fourier integrals. This is
somewhat similar to the original paper of Goldston, Pintz and Yıldırım [5]. Our function
F corresponds to f (t1 , . . . , tk ) differentiated with respect to each coordinate.
7. Choice of weight for small k
We let Sk denote the set of piecewise differentiable functions F : [0, 1]k → R supported
on Rk = {(x1 , . . . , xk ) : ki=1 xi ≤ 1} with Ik (F) 0 and Jk(m) (F) 0 for each m. We would
like to obtain a lower bound for
(m)
k
m=1 Jk (F)
.
(7.1)
Mk = sup
Ik (F)
F∈Sk
Remark. Let Lk denote the integral linear operator defined by
k

(7.2)

1−

i m

Lk F(u1 , . . . , uk ) =

ui

F(u1 , . . . , um−1 , tm , um+1 , . . . , uk )dtm
m=1

0

whenever (u1 , . . . , uk ) ∈ Rk , and zero otherwise. By standard calculus of variations arguments, we find that if F maximizes the ratio km=1 Jk(m) (F)/Ik (F) then F is an eigenfunction
for Lk , and the corresponding eigenvalue is the value of ratio at F. Unfortunately the
author has not been able to solve the eigenvalue equation for Lk when k > 2.
In order to get a suitable lower bound for Mk when k is small, we will consider approximations to the optimal function F of the form



P(t1 , . . . , tk ), if (t1 , . . . , tk ) ∈ Rk
(7.3)
F(t1 , . . . , tk ) = 

0,
otherwise,

for polynomials P. By the symmetry of km=1 Jk(m) (F) and Ik (F), without loss of generality
we can restrict our attention to polynomials which are symmetric functions of t1 , . . . , tk .
(If F satisfies Lk F = λF then Fσ = F(σ(t1 ), . . . , σ(tk )) also satisfies this for any permutation σ of t1 , . . . , tk . Thus the symmetric function which is the average of Fσ over all
such permutations would satisfy this eigenfunction equation, and so there must be an optimal function which is symmetric.) Any such polynomial can be written as a polynomial
expression in the power sum polynomials P j = ki=1 tij .
Lemma 7.1. Let P j =
have

j
k
i=1 ti

denote the jth symmetric power sum polynomial. Then we

(1 − P1 )a Pbj dt1 . . . dtk =

a!
Gb, j (k),
(k + jb + a)!

Rk

where

b

Gb, j (x) = b!
r=1

x
r

r
b1 ,...,br ≥1 i=1
r
i=1 bi =b

( jbi )!
bi !

is a polynomial of degree b which depends only on b and j.

18

JAMES MAYNARD

Proof. We first show by induction on k that
k

1−

(7.4)

ti

k

a!

tiai dt1 . . . dtk =

(k + a

i=1

i=1

Rk

a

k
i=1 ai !
.
+ ki=1 ai )!

We consider the integration with respect to t1 . The limits of integration are 0 and 1 −
for (t2 , . . . , tk ) ∈ Rk−1 . By substituting v = t1 /(1 − ki=2 ti ) we find
1−

k
i=2 ti

k

1−
0

ti
i=1

a

k

k

i=2

i=1

(7.5)

Here we used the beta function identity
We now see (7.4) follows by induction.
By the binomial theorem,

ti

1 a
t (1
0

k
i=1

b1 ,...,bk
k
i=1 bi =b

(1 − v)a va1 dv
0

k

k

tiai 1 −

ti

i=2

a+a1 +1

.

i=2

− t)b dt = a!b!/(a + b + 1)! in the last line.

k

b!

Pbj =

1

a+a1 +1

i=2

a!a1 !
(a + a1 + 1)!

=

(7.6)

k

tiai 1 −

tiai dt1 =

k
i=2 ti

bi !

tijbi .
i=1

Thus, applying (7.4), we obtain
(1 − P1 )a Pbj dt1 . . . dtk =

(7.7)

k

b!a!
(k + a + jb)!

b1 ,...,bk i=1
k
i=1 bi =b

Rk

( jbi )!
.
bi !

For computations b will be small, and so we find it convenient to split the summation
depending on how many of the bi are non-zero. Given an integer r, there are kr ways of
choosing r of b1 , . . . , bk to be non-zero. Thus
k

(7.8)
b1 ,...,bk i=1
k
i=1 bi =b

( jbi )!
=
bi !

b
r=1

k
r

r
b1 ,...,br ≥1 i=1
r
i=1 bi =b

( jbi )!
.
bi !

This gives the result.
It is straightforward to extend Lemma 7.1 to more general combinations of the symmetric power polynomials. In this paper we will concentrate on the case when P is a
polynomial expression in only P1 and P2 for simplicity. We comment the polynomials Gb, j
are not problematic to calculate numerically for small values of b. We now use Lemma 7.1
to obtain a manageable expression for Ik (F) and Jk(m) (F) with this choice of P.
Lemma 7.2. Let F be given in terms of a polynomial P by (7.3). Let P be given in terms of
a polynomial expression in the symmetric power polynomials P1 = ki=1 ti and P2 = ki=1 ti2
by P = di=1 ai (1 − P1 )bi Pc2i for constants ai ∈ R and non-negative integers bi , ci . Then for

SMALL GAPS BETWEEN PRIMES

19

each 1 ≤ m ≤ k we have
Ik (F) =

ai a j
1≤i, j≤d

(bi + b j )!Gci +c j ,2 (k)
,
(k + bi + b j + 2ci + 2c j )!
cj

ci

Jk(m) (F) =

ai a j
c′1 =0 c′2 =0

1≤i, j≤d

ci c j γbi ,b j ,ci ,c j ,c′1 ,c′2 Gc′1 +c′2 ,2 (k − 1)
,
c′1 c′2 (k + bi + b j + 2ci + 2c j + 1)!

where
γbi ,b j ,ci ,c j ,c′1 ,c′2 =

bi !b j !(2ci − 2c′1 )!(2c j − 2c′2 )!(bi + b j + 2ci + 2c j − 2c′1 − 2c′2 + 2)!
(bi + 2ci − 2c′1 + 1)!(b j + 2c j − 2c′2 + 1)!,

and where G is the polynomial given by Lemma 7.1.
Proof. We first consider Ik (F). We have, using Lemma 7.1,
P2 dt1 . . . dtk =

Ik (F) =

c +c j

(1 − P1 )bi +b j P2i

ai a j
1≤i, j≤d

Rk

dt1 . . . dtk

Rk

(bi + b j )!Gci+c j ,2 (k)
=
ai a j
.
(k + bi + b j + 2ci + 2c j )!
1≤i, j≤d

(7.9)

We now consider Jk(m) (F). Since F is symmetric in t1 , . . . , tk we see that Jk(m) (F) is independent of m, and so it suffices to only consider Jk(1) (F). We have
k
i=2 ti

1−
0

c

c
c′

(1 − P1 )b Pc2 dt1 =
c′ =0
c
c′ =0
c
c′ =0

k
i=2 ti

1

Fdt1

2

k
2
i=2 ti .

and P′2 =
d

=

0

k
j=2 t j

1−

ai
0

i=1

=
×

(7.11)

k

0

i=2

b

′

ti t12c−2c dt1

1−

(1 − P1 )bi Pc2i

ai a j
1≤i, j≤d

k
i=2 ti

i=1
1
0

c′1 =0 c′2 =0

2

ci c j ′ c′ +c′
′
′
(P2 ) 1 2 (1 − P′1 )bi +b j +2ci +2c j −2c1 −2c2 +2
′
′
c1 c2

bi !b j !(2ci − 2c′1 )!(2c j − 2c′2 )!
.
(bi + 2ci − 2c′1 + 1)!(b j + 2c j − 2c′2 + 1)!

Applying Lemma 7.1 again, we see that
′

(1 − P′1 )b (P′2 )c dt2 . . . dtk =

(7.12)

′

(1 − u)b u2c−2c du

Thus

cj

ci

1−

c′

b!(2c − 2c′ )!
c ′ c′
′
,
(P2 ) (1 − P′1 )b+2c−2c +1
′
(b + 2c − 2c′ + 1)!
c

=

where P′1 =

ti2

c ′ c′
′
(P2 ) (1 − P′1 )b+2c−2c +1
′
c

=
(7.10)

k

Rk−1

Combining (7.11) and (7.12) gives the result.

b!
Gc,2 (k − 1).
(k + b + c − 1)!

20

JAMES MAYNARD

We see from Lemma 7.2 that Ik (F) and km=1 Jk(m) (F) can both be expressed as quadratic
forms in the coefficients a = (a1 , . . . , ad ) of P. Moreover, these will be positive definite
real quadratic forms. Thus in particular we find that
Jk(m) (F) aT M2 a
= T
,
Ik (F)
a M1 a
for two rational symmetric positive definite matrices M1 , M2 , which can be calculated explicitly in terms of k for any choice of the exponents bi , ci . Maximizing expressions of this
form has a well-known solution.

(7.13)

k
m=1

Lemma 7.3. Let M1 , M2 be real, symmetric positive definite matrices. Then
aT M2 a
aT M1 a
is maximized when a is an eigenvector of M1−1 M2 corresponding to the largest eigenvalue
of M1−1 M2 . The value of the ratio at its maximum is this largest eigenvalue.
Proof. We see that multiplying a by a non-zero scalar doesn’t change the ratio, so we may
assume without loss of generality that aT M1 a = 1. By the theory of Lagrangian multipliers,
aT M2 a is maximized subject to aT M1 a = 1 when
(7.14)

L(a, λ) = aT M2 a − λ(aT M1 a − 1)

is stationary. This occurs when (using the symmetricity of M1 , M2 )
∂L
= ((2M2 − 2λM1 )a)i ,
(7.15)
0=
∂ai
for each i. This implies that (recalling that M1 is positive definite so invertible)
(7.16)

M1−1 M2 a = λa.

It then is clear that aT M1 a = λ−1 aT M2 a.
Proof of parts (i) and (ii) of Proposition 4.3. To establish Proposition 4.3 we rely on some
computer calculation to calculate a lower bound for Mk . We let F be given in terms of a
polynomial P by (7.3). We let P be given by a polynomial expression in P1 = ki=1 ti and
P2 = ki=1 ti2 which is a linear combination of all monomials (1 − P1 )b Pc2 with b + 2c ≤ 11.
There are 42 such monomials, and with k = 105 we can calculate the 42 × 42 rational
symmetric matrices M1 and M2 corresponding to the coefficients of the quadratic forms
Ik (F) and km=1 Jk (F). We then find3 that the largest eigenvalue of M1−1 M2 is
(7.17)

λ ≈ 4.0020697 . . . > 4.

Thus M105 > 4. This verifies part (i) of Proposition 4.3. We comment that by taking a
rational approximation to the corresponding eigenvector, we can verify this lower bound
by calculating the ratio km=1 Jk (F)/Ik (F) using only exact arithmetic.
For part (ii) of Proposition 4.3, we take k = 5 and
7
1
3
(7.18)
P = (1 − P1 )P2 + (1 − P1 )2 + P2 − (1 − P1 ).
10
14
14
With this choice we find that
(m)
k
1 417 255
m=1 Jk (F)
=
> 2.
(7.19)
M5 ≥
I j (F)
708 216
3An ancillary Mathematica R file detailing these computations is available alongside this paper at
www.arxiv.org.

SMALL GAPS BETWEEN PRIMES

21

8. Choice of smooth weight for large k
In this section we establish part (iii) of Proposition 4.3. Our argument here is closely
related to that of Tao, who uses a probability theory proof.
We obtain a lower bound for Mk by constructing a function F which makes the ratio
(m)
k
m=1 Jk (F)/Ik (F) large for all large k. We choose F to be of the form

k
k


 i=1 g(kti ), if i=1 ti ≤ 1,
(8.1)
F(t1 , . . . , tk ) = 

0,
otherwise,

for some piecewise differentiable function g : [0, ∞] → R, supported on [0, T ]. We see
that with this choice F is symmetric, and so Jk(m) (F) is independent of m. Thus we only
need to consider Jk = Jk(1) (F). Similarly we write Ik = Ik (F).
∞
∞
The key observation is that if the center of mass 0 ug(u)2du/ 0 g(u)2 du of g2 is
strictly less that 1, then for large k we expect that the constraints ki=1 ti ≤ 1 to be able to
be dropped at the cost of only a small error. This is because (by concentration of measure)
∞
∞
k
2
the main contribution to the unrestricted integrals Ik′ = 0 · · · 0
i=1 g(kti ) dt1 . . . dtk and
∞
∞
∞
k
k
2
Jk′ = 0 · · · 0 ( 0
i=1 g(kti )dt1 ) dt2 . . . dtk should come primarily from when
i=1 ti is
k
close to the center of mass. Therefore we would expect the contribution when i=1 ti > 1
to be small if the center of mass is less than 1, and so Ik and Jk are well approximated by
Ik′ and Jk′ in this case.
To ease notation we let γ = t≥0 g(t)2 dt, and restrict our attention to g such that γ > 0.
We have
∞

(8.2)

F(t1 , . . . , tk )2 dt1 . . . dtk ≤

Ik =

g(kt)2 dt

k

= k−k γk .

0

Rk

We now consider Jk . Since squares are non-negative, we obtain a lower bound for Jk if we
restrict the outer integral to ki=2 ti < 1 − T/k. This has the advantage that, by the support
of g, there are no further restrictions on the inner integral. Thus
T/k

k

2

Jk ≥

(8.3)

g(kti ) dt1 dt2 . . . dtk .
0

t2 ,...,tk ≥0
k
i=2 ti ≤1−T/k

i=1

We write the right hand side of (8.3) as Jk′ − Ek , where
k

T/k

Jk′ =

0

t2 ,...,tk ≥0
∞

(8.4)

2

g(kti ) dt1 dt2 . . . dtk

=

i=1

g(kt1 )dt1

∞

2

0
T/k

g(kt)2 dt
0
k

∞

= k−k−1 γk−1
0

g(kti ) dt1 dt2 . . . dtk
t2 ,...,tk ≥0
k
i=2 ti >1−T/k

0

∞

= k−k−1

g(u)du
0

i=1

2

k

g(ui )2 du2 . . . duk .
u2 ,...,uk ≥0 i=2
k
i=2 ui >k−T

2

g(u)du ,

2

Ek =

(8.5)

k−1

22

JAMES MAYNARD

First we wish to show the error integral Ek is small. We do this by comparison with a
second moment. We expect the bound (8.11) for Ek to be small if the center of mass of g2
is strictly less than (k − T )/(k − 1). Therefore we introduce the restriction on g that
∞
ug(u)2du
0
∞
g(u)2 du
0

µ=

(8.6)

<1−

T
.
k

To simplify notation, we put η = (k − T )/(k − 1) − µ > 0. If
k
i=2 ui > (k − 1)µ and so we have
1 ≤ η−2

(8.7)

1
k−1

k

k
i=2

ui > k − T then

2

ui − µ .
i=2

Since the right hand side of (8.7) is non-negative for all ui , we obtain an upper bound for
Ek if we multiply the integrand by η−2 ( ki=2 ui /(k − 1) − µ)2, and then drop the requirement
that ki=1 ui > k − T . This gives us
∞

(8.8)

Ek ≤ η−2 k−k−1

g(u)du
0

∞

∞

2

···
0

0

k
i=2

ui
−µ
k−1

2

k

g(ui )2 du2 . . . duk .
i=2

We expand out the inner square. All the terms which are not of the form u2j we can calculate
explicitly in as an expression in µ and γ. We find
∞

∞

···

(8.9)

2

ui u j

(k − 1)2

0

0

2≤i< j≤k

−

2µ ki=2 ui
−µ2 γk−1
+ µ2 du2 . . . duk =
.
k−1
k−1

For the u2j terms we see that u2j g(u j)2 ≤ T u j g(u j)2 from the support of g. Thus
k

∞

∞
0

0

∞

g(ui)2 du2 . . . duk ≤ T γk−2

u2j

···

(8.10)

u j g(u j )2 du j = µT γk−1 .
0

i=2

This gives
(8.11)
∞

Ek ≤ η−2 k−k−1

g(u)du

η−2 µT k−k−1 γk−1
µT γk−1 µ2 γk−1
≤
−
k−1
k−1
k−1

2

0

∞

2

g(u)du .
0

Since (k − 1)η2 ≥ k(1 − T/k − µ)2 and µ ≤ 1, we find that putting together (8.2), (8.3), (8.4)
and (8.11) we obtain
(
kJk
≥
Ik

(8.12)

∞
g(u)du)2
0
∞
g(u)2 du
0

1−

T
.
k(1 − T/k − µ)2

To maximize our lower bound (8.12), we wish to maximize
straints that
sion

T
0

2

ug(u) du = µ and

T
0

T
0

g(u)du subject to the con-

2

g(u) du = γ. Thus we wish to maximize the expres-

T

T

g(u)2du − γ − β

g(u)du − α

(8.13)

T
0

0

ug(u)2du − µ
0

with respect to α, β and the function g. By the Euler-Lagrange equation, this occurs when
∂
2
2
∂g (g(t) − αg(t) − βtg(t) ) = 0 for all t ∈ [0, T ]. Thus we see that
(8.14)

g(t) =

1
2α + 2βt

for 0 ≤ t ≤ T .

SMALL GAPS BETWEEN PRIMES

23

Since the ratio we wish to maximize is unaffected if we multiply g by a positive constant,
we restrict our attention to functions g is of the form 1/(1 + At) for t ∈ [0, T ] and for some
constant A > 0. With this choice of g we find that
T
1
1
log(1 + AT )
1−
,
g(u)2du =
,
A
A
1
+
AT
0
0
T
1
1
ug(u)2du = 2 log(1 + AT ) − 1 +
.
1
+
AT
A
0
T

(8.15)
(8.16)

g(u)du =

We choose T such that 1 + AT = eA (which is close to optimal). With this choice we find
that µ = 1/(1 − e−A ) − A−1 and T ≤ eA /A. Thus 1 − T/k − µ ≥ A−1 (1 − A/(eA − 1) − eA /k).
Substituting (8.15) into (8.12) and then using these expressions, we find that
kJk
A
T
AeA
≥
1
−
≥
A
1
−
,
Ik
1 − e−A
k(1 − T/k − µ)2
k(1 − A/(eA − 1) − eA /k)2
provided the right hand side is positive. Finally, we choose A = log k − 2 log log k > 0. For
k sufficiently large we have
(8.17)

k
(log k)3
1
> 0,
− µ ≥ A−1 1 −
−
T
k
(log k)2
and so µ < 1 − T/k, as required by our constraint (8.6). This choice of A gives
log k
kJk
≥ (log k − 2 log log k) 1 −
≥ log k − 2 log log k − 2
(8.19) Mk ≥
Ik
(log k)2 + O(1)
when k is sufficiently large. This completes the proof of Proposition 4.3.
(8.18)

1−

9. Acknowledgements
The author would like to thank Andrew Granville, Roger Heath-Brown, Dimitris Koukoulopoulos and Terence Tao for many useful conversations and suggestions.
The work leading to this paper was started whilst the author was a D.Phil student at Oxford and funded by the EPSRC (Doctoral Training Grant EP/P505216/1), and was finished
when the author was a CRM-ISM postdoctoral fellow at the Universit´e de Montr´eal.
References
[1] P. D. T. A. Elliott and H. Halberstam. A conjecture in prime number theory. In Symposia Mathematica, Vol.
IV (INDAM, Rome, 1968/69), pages 59–72. Academic Press, London, 1970.
[2] J. Friedlander and A. Granville. Limitations to the equi-distribution of primes. I. Ann. of Math. (2),
129(2):363–382, 1989.
[3] D. A. Goldston, S. W. Graham, J. Pintz, and C. Y. Yıldırım. Small gaps between products of two primes.
Proc. Lond. Math. Soc. (3), 98(3):741–774, 2009.
[4] D. A. Goldston, J. Pintz, and C. Y. Yıldırım. Primes in tuples. III. On the difference pn+ν − pn . Funct. Approx.
Comment. Math., 35:79–89, 2006.
[5] D. A. Goldston, J. Pintz, and C. Y. Yıldırım. Primes in tuples. I. Ann. of Math. (2), 170(2):819–862, 2009.
[6] D. A. Goldston and C. Y. Yıldırım. Higher correlations of divisor sums related to primes. III. Small gaps
between primes. Proc. Lond. Math. Soc. (3), 95(3):653–686, 2007.
[7] D. H. J. Polymath. A new bound for gaps between primes. Preprint.
[8] A. Selberg. Collected papers. Vol. II. Springer-Verlag, Berlin, 1991. With a foreword by K. Chandrasekharan.
[9] Y. Zhang. Bounded gaps between primes. Ann. of Math.(2), to appear.
Centre de recherches math´ematiques, Universit´e de Montr´eal, Pavillon Andr´e-Aisenstadt, 2920 Chemin de
la tour, Room 5357, Montr´eal (Qu´ebec) H3T 1J4
E-mail address: maynardj@dms.umontreal.ca

