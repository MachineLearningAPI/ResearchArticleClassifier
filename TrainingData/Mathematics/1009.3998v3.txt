arXiv:1009.3998v3 [math.CO] 27 Mar 2011

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM
BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER
Abstract. We prove the inverse conjecture for the Gowers U s+1 [N ]-norm
for all s
1; this is new for s
4. More precisely, we establish that if
f : [N ] → [−1, 1] is a function with f U s+1 [N]
δ then there is a boundedcomplexity s-step nilsequence F (g(n)Γ) which correlates with f , where the
bounds on the complexity and correlation depend only on s and δ. From
previous results, this conjecture implies the Hardy-Littlewood prime tuples
conjecture for any linear system of finite complexity.

Contents
1. Introduction
2. Strategy of the proof
3. Basic notation
4. The polynomial formulation of GI(s)
5. Taking ultralimits
6. Nilcharacters and symbols in one and several variables
7. A more detailed outline of the argument
8. A variant of Gowers’s Cauchy-Schwarz argument
9. Frequencies and representations
10. Linear independence and the sunﬂower lemma
11. Obtaining bracket-linear behaviour
12. Building a nilobject
13. The symmetry argument
Appendix A. Basic theory of ultralimits
Appendix B. Polynomial algebra
Appendix C. Lifting linear nilsequences to polynomial ones
Appendix D. Equidistribution theory
Appendix E. Some basic properties of nilcharacters and symbols
Appendix F. A linearisation result from additive combinatorics
References

1
4
8
11
14
18
31
35
39
48
58
64
71
77
83
90
92
99
113
114

1. Introduction
The purpose of this paper is to establish the general case of a conjecture named
the Inverse Conjecture for the Gowers norms by the ﬁrst two authors in [23, Conjecture 8.3]. If N is a (typically large) positive integer then we write [N ] := {1, . . . , N }.
For each integer s
1 the inverse conjecture GI(s), whose statement we recall
shortly, describes the structure of 1-bounded functions f : [N ] → C whose (s + 1)st
1991 Mathematics Subject Classification. 11B30.
1

2

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Gowers norm f U s+1[N ] is large. These conjectures together with a good deal of
motivation and background to them are discussed in [19, 21, 23]. The conjectures
GI(1) and GI(2) have been known for some time, the former being a straightforward
application of Fourier analysis, and the latter being the main result of [21] (see also
[51] for the characteristic 2 analogue). The case GI(3) was also recently established
by the authors in [28]. The aim of the present paper is to establish the remaining
cases GI(s) for s 3, in particular reestablishing the results in [28].
We begin by recalling the deﬁnition of the Gowers norms. If G is a ﬁnite abelian
group, d 1 is an integer, and f : G → C is a function then we deﬁne
f

d

U d (G)

:= (Ex,h1 ,...,hd ∈G ∆h1 . . . ∆hd f (x))1/2 ,

(1.1)

where ∆h f is the multiplicative derivative
∆h f (x) := f (x + h)f (x)
1
and Ex∈X f (x) := |X|
x∈X f (x) denotes the average of a function f : X → C on
a ﬁnite set X. Thus for instance we have

f

U 2 (G)

:= Ex,h1 ,h2 ∈G f (x)f (x + h1 )f (x + h2 )f (x + h1 + h2 )

1/4

.

One can show that U d (G) is indeed a norm on the functions f : G → C for any
d 2, though we will not need this fact here.
In this paper we will be concerned with functions on [N ], which is not quite a
˜Z
group. To deﬁne the Gowers norms of a function f : [N ] → C, set G := Z/N
˜
for some integer N
2d N , deﬁne a function f˜ : G → C by f˜(x) = f (x) for
x = 1, . . . , N and f˜(x) = 0 otherwise, and set
f

U d [N ]

:= f˜

U d (G) /

1[N ]

U d (G) ,

where 1[N ] is the indicator function of [N ]. It is easy to see that this deﬁnition
˜ . One could take N
˜ := 2d N for deﬁniteness if
is independent of the choice of N
desired.
The Inverse conjecture for the Gowers U s+1 [N ]-norm, abbreviated as GI(s),
posits an answer to the following question.
Question 1.1. Suppose that f : [N ] → C is a function bounded in magnitude by
1, and let δ > 0 be a positive real number. What can be said if f U s+1 [N ] δ?
Note that in the extreme case δ = 1 one can easily show that f is a phase polynomial, namely f (n) = e(P (n)) for some polynomial P of degree at most s. Furthermore, if f correlates with a phase polynomial, that is to say if |En∈[N ] f (n)e(P (n))|
δ, then it is easy to show that f U s+1 [N ] c(δ). It is natural to ask whether the
converse is also true - does a large Gowers norm imply correlation with a polynomial
phase function? Surprisingly, the answer is no, as was observed by Gowers [16] and,
in the related context of multiple recurrence, somewhat earlier by Furstenberg and
Weiss [13, 14]. The work of Furstenberg-Weiss and Conze-Lesigne [10] draws attention to the role of homogeneous spaces G/Γ of nilpotent Lie groups, and subsequent
work of Host and Kra [36] provides a link, in an ergodic-theoretic context, between
these spaces and certain seminorms with a formal similarity to the Gowers norms
under discussion here. Later work of Bergelson, Host and Kra [4] highlights the role
of a class of functions arising from these spaces G/Γ called nilsequences. The inverse
conjecture for the Gowers norms, ﬁrst formulated precisely in [23, §8], postulates

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

3

that this class of functions (which contains the polynomial phases) represents the
full set of obstructions to having large Gowers norm.
We now recall that precise formulation. Recall that an s-step nilmanifold is a
manifold of the form G/Γ, where G is a connected, simply-connected nilpotent Lie
group of step at most s (i.e. all s + 1-fold commutators of G are trivial), and Γ is
a discrete, cocompact1 subgroup of G.
Conjecture 1.2 (GI(s)). Let s 0 be an integer, and let 0 < δ 1. Then there
exists a finite collection Ms,δ of s-step nilmanifolds G/Γ, each equipped with some
smooth Riemannian metric dG/Γ as well as constants C(s, δ), c(s, δ) > 0 with the
following property. Whenever N
1 and f : [N ] → C is a function bounded in
magnitude by 1 such that f U s+1 [N ] δ, there exists a nilmanifold G/Γ ∈ Ms,δ ,
some g ∈ G and a function F : G/Γ → C bounded in magnitude by 1 and with
Lipschitz constant at most C(s, δ) with respect to the metric dG/Γ such that
|En∈[N ] f (n)F (g n x)|

c(s, δ).

We remark that there are many equivalent ways to reformulate this conjecture.
For instance, instead of working with a ﬁnite family Ms,δ of nilmanifolds, one could
work with a single nilmanifold G/Γ = Gs,δ /Γs,δ , by taking the Cartesian product
of all the nilmanifolds in the family. Other reformulations include an equivalent
formulation using polynomial nilsequences rather than linear ones (see Conjecture
4.5) and an ultralimit formulation (see Conjecture 5.3). One can also formulate the
conjecture using bracket polynomials, or local polynomials; see [21] for a discussion
of these equivalences in the s = 2 case.
Let us brieﬂy review the known partial results on this conjecture:
(i) GI(0) is trivial.
(ii) GI(1) follows from a short Fourier-analytic computation.
(iii) GI(2) was established about ﬁve years ago in [21], building on work of
Gowers [16].
(iv) GI(3) was established, quite recently, in [28].
(v) In the extreme case δ = 1 one can easily show that f (n) = e(P (n)) for
some polynomial P of degree at most s, and every such function is an
s-step nilsequence by a direct construction. See, for example, [21] for the
case s = 2.
(vi) In the almost extremal case δ 1 − εs , for some εs > 0, one may see that
f correlates with a phase e(P (n)) by adapting arguments ﬁrst used in the
theoretical computer-science literature [1].
(vii) The analogue of GI(s) in ergodic theory (which, roughly speaking, corresponds to the asymptotic limit N → ∞ of the theory here; see [37] for
further discussion) was formulated and established in [36], work done independently of the work of Gowers (see also the earlier paper [35]). This work
was the ﬁrst place in the literature to link objects of Gowers-norm type
(associated to functions on a measure-preserving system (X, T, µ)) with
ﬂows on nilmanifolds, and the subsequent paper [4] was the ﬁrst work to
underline the importance of nilsequences. The formulation of GI(s) by
the ﬁrst two authors in [23] was very strongly inﬂuenced by these works.
For the closely related problem of analysing multiple ergodic averages, the
1A subgroup Γ of a topological group G is cocompact if the quotient space G/Γ is compact.

4

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

relevance of ﬂows on nilmanifolds was earlier pointed out in [13, 14, 47],
building upon earlier work in [10]. See also [34, 60] for related work on
multiple averages and nilmanifolds in ergodic theory.
(viii) The analogue of GI(s) in ﬁnite ﬁelds of large characteristic was established
by ergodic-theoretic methods in [5, 56].
(ix) A weaker “local” version of the inverse theorem (in which correlation takes
place on a subprogression of [N ] of size ∼ N cs ) was established by Gowers
[17]. This paper provided a good deal of inspiration for our work here.
(x) The converse statement to GI(s), namely that correlation with a function
of the form n → F (g n x) implies that f has large U s+1 [N ]-norm, is also
known. This was ﬁrst established in [21, Proposition 12.6], following arguments of Host and Kra [36] rather closely. A rather simple proof of this
result is given in [28, Appendix G].
The main result of this paper is a proof of Conjecture 1.2:
Theorem 1.3. For any s
is true.

3, the inverse conjecture for the U s+1 [N ]-norm, GI(s),

By combining this result with the previous results in [23, 26] we obtain a quantitative Hardy-Littlewood prime tuples conjecture for all linear systems of ﬁnite
complexity; in particular, we now have the expected asymptotic for the number of
primes p1 < . . . < pk X in arithmetic progression, for every ﬁxed positive integer
k. We refer to [23] for further discussion, as we have nothing new to add here
regarding these applications. Several further applications of the GI(s) conjectures
are given in [11, 27].
2. Strategy of the proof
The proof of Theorem 1.3 is long and complicated, but broadly speaking it
follows the strategy laid out in previous works [16, 17, 21, 28, 51]. We induct on
s, assuming that GI(s − 1) has already been established and using this to prove
GI(s). To explain the argument, let us ﬁrst summarise the main steps taken in
[28] in order to deduce GI(3), the inverse theorem for the U 4 -norm, from GI(2),
the inverse theorem for the U 3 norm (established in [21]). Once this is done we
will explain some of the extra diﬃculties involved in handling the general case. For
a more extensive (but informal) discussion of the proof strategy, see [29]. Once
we set up some technical machinery, we will also be able to give a more detailed
description of the strategy in §7.
Here, then, is an overview of the argument in [28].
(i) (Apply induction) If f U 4 [N ] ≫ 1 then, for many h, ∆h f U 3 [N ] ≫ 1 and
so ∆h f correlates with a 2-step nilsequence χh .
(ii) (Nilcharacter decomposition) χh may be decomposed as a sum of a special
type of nilsequence called a nilcharacter, essentially by a Fourier decomposition. For the sake of illustration, these 2-step nilcharacters may be
supposed to have the form
χh (n) = e({αh n}βh n),
although these are not quite nilcharacters due to the discontinuous nature
of the fractional part function x → {x}, and in any event a general 2step nilcharacter will be modeled by a linear combination of such “bracket

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

5

quadratic monomials”, rather than by a single such monomial (see [21] for
further discussion).
(iii) (Rough linearity) The fact that ∆h f correlates with χh forces χh to behave
weakly linearly in h. To get a feel for why this is so, suppose that |f | ≡ 1;
then we have the cocycle identity
∆h+k f (n) = ∆h f (n + k)∆k f (n).
To capture something like the same behaviour in the much weaker setting
where ∆h f correlates with χh , we use an extraordinary argument of Gowers [16] relying on the Cauchy-Schwarz inequality. Roughly speaking, the
information obtained is of the form
χh 1 χh 2 ∼ χh 3 χh 4

modulo lower order terms

(2.1)

for many h1 , h2 , h3 , h4 with h1 + h2 = h3 + h4 .
(iv) (Furstenberg-Weiss) An argument of Furstenberg and Weiss [14] is adapted
in order to study (2.1). The quantitative distribution theory of nilsequences developed in [24] is a major input here. It is concluded that we
may assume that the frequency βh does not actually depend on h. Note
that this step appeared for the ﬁrst time in the proof of GI(3); it did not
feature in the proof of GI(2) in [21].
(v) (Linearisation) A similar argument allows one to then assert that
αh1 + αh2 ≈ αh3 + αh4

(mod 1)

(2.2)

for many h1 , h2 , h3 , h4 with h1 + h2 = h3 + h4 .
(vi) (Additive Combinatorics) By arguments from additive combinatorics related to the Balog-Szemer´edi-Gowers theorem [2, 16] and Freiman’s theorem, as well as some geometry of numbers, we may then assume that αh
varies “bracket-linearly” in h, thus
αh = γ1 {η1 h} + · · · + γd {ηd h}.

(2.3)

Up to top order, then, the nilcharacter χh (n) can now be assumed to take
the form e(ψ(h, n, n)), where ψ is “bracket-multilinear”; it is a sum of
terms such as {γ{ηh}n}βn.
(vii) (Symmetry argument) The bracket multilinear form ψ obeys an additional
symmetry property. This is a reﬂection of the identity ∆h ∆k f = ∆k ∆h f ,
but transferring this to the much weaker setting in which we merely have
correlation of ∆h f with χh requires another appeal to Gowers’ CauchySchwarz argument from (iii). In fact, the key point is to look at the second
order terms in (2.1).
(viii) (Integration) Assuming this symmetry, one is able to express
χh (n) ∼ Θ(n + h)Θ′ (n)
for some bracket cubic functions Θ, Θ′ , which morally take the form
Θ(n), Θ′ (n) ∼ e(ψ(n, n, n)/3)
(for much the same reason that x3 /3 is an antiderivative of x2 ). Thus we
morally have
∆h f (n) ∼ Θ(n + h)Θ′ (n)

6

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

(ix) (Construction of a nilsequence) Any bracket cubic form like e(ψ(n, n, n))
“comes from” a 3-step nilmanifold; this construction is accomplished in
[28] in a rather ad hoc manner.
(x) From here, one can analyse lower order terms by the induction hypothesis
GI(2). This is a relatively easy matter.
Let us now discuss the argument of this paper in the light of each point of this
outline. A more detailed outline is given in §7. Assume that GI(s − 1) has been
established.
(i) (Apply induction) If f U s+1 [N ] ≫ 1 then, for many h, ∆h f U s [N ] ≫
1 and so ∆h f correlates with an (s − 1)-step nilsequence χh . This is
straightforward (see §7).
(ii) (Nilcharacter decomposition) χh may be decomposed into nilcharacters;
this is fairly straightforward as well. It is somewhat reassuring to think
of χh (n) as having the form e(ψh (n)), where ψh (n) is a bracket polynomial “of degree s − 1”, but we will not be working explicitly with bracket
polynomials much in this paper, except as motivation and as a source of
examples. One of the main challenges one is faced with during an attempt
to prove GI(4) by a direct generalisation of our arguments from [28] is the
fact that already bracket cubic polynomials are rather complicated to deal
with and can take diﬀerent forms such as {αn}{βn}γn and {{αn}βn}γn.
Instead of objects such as e(αn{βn}), then, we will work with the rather
more abstract notion of a symbol. This notion, which is fairly central to
our paper, is deﬁned and discussed in §6. One additional technical point
is worth mentioning here. This is the fact that e(αn{βn}) (say) cannot
be realised as a nilsequence F (g n Γ) with F continuous, and therefore the
distributional results of [24] do not directly apply. In [28] these discontinuities could be understood quite explicitly, but here we take a diﬀerent
approach: we decompose G/Γ into D pieces using a smooth partition of
unity for some D = O(1), and then work instead with the (smooth) CD valued nilsequence consisting of these pieces.
We discuss this device more fully in §6, but we emphasise that this is a
technical device and the reader is advised not to give this particular aspect
of the proof too much attention.
(iii) (Rough linearity) χh varies roughly linearly in h; this is another fairly
straightforward modiﬁcation of the arguments of Gowers, already employed in [28], which is performed in §8.
(iv) (Furstenberg-Weiss) This proceeds along similar lines to the corresponding
argument in [28] but is, in a sense, rather easier once one has developed
the device of CD -valued nilsequences, which allow one to remain in the
smooth category; this is accomplised in §11, after a substantial amount of
preparatory material in §9, §10 and Appendix D.
(v) (Linearisation) This is also quite similar to the corresponding argument in
[28], and is performed in §11. In both of parts (iv) and (v), the “bracket
calculus” from [28] is replaced by the more conceptual “symbol calculus”
developed in Appendix E.
(vi) (Additive Combinatorics) The additive combinatorial input is much the
same as in [28]. For the convenience of the reader we sketch it in Appendix
F.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

7

(vii) (Construction of a nilsequence) Our argument diﬀers quite substantially
from that in [28] at this point. The s-step nilobject, which is now a twovariable object χ(h, n), is constructed before the symmetry argument and
in a more conceptual manner. This may be compared with the rather ad
hoc approach taken in [21, 28], where various bracket polynomials were
merely exhibited as arising from nilsequences. We perform this construction in §12.
(viii) (Symmetry argument) We replace χ(h, n) with an equivalent nilcharacter
χ(h,
˜ n, . . . , n) where χ
˜ is a nilcharacter in s variables, that is symmetric
in the last s − 1 variables. The symmetry argument given in §13 shows
that χ(h,
˜ n, . . . , n) is equivalent to χ(n,
˜ h, . . . , n). Again the key idea in
the analysis is to look at the second order terms in (2.1).
(ix) (Integration) With the symmetry in hand, we can use the calculus of multilinear nilcharacters essentially express χ(h,
˜ n, . . . , n) as the derivative of an
expression which is roughly of the form χ(n,
˜ . . . , n)/s; see §13 for details.
(x) The ﬁnal step of the argument is relatively straightforward, as before; see
§7.
In our previous paper [28] it was already rather painful to keep proper track
of such notions as “many” and “correlates with”. Here matters are even worse,
and so to organise the above tasks it turns out to be quite convenient to ﬁrst
take an ultralimit of all objects being studied, eﬀectively placing one in the setting
of nonstandard analysis. This allows one to easily import results from inﬁnitary
mathematics, notably the theory of Lie groups and basic linear algebra, into the
ﬁnitary setting of functions on [N ]. In §5 and Appendix A we review the basic
machinery of ultralimits that we will need here; we will not be exploiting any
particularly advanced aspects of this framework. The reader does not really need
to understand the ultraﬁlter language in order to comprehend the basic structure
of the paper, provided that he/she is happy to deal with concepts like “dense” and
“correlates with” in a somewhat informal way, resembling the way in which analysts
actually talk about ideas with one another (and, in fact, analogous to the way we
wrote this paper). It is possible to go through the paper and properly quantify all
of these notions using appropriate parameters δ and (many) growth functions F .
This would have the advantage of making the paper on some level comprehensible
to the reader with an absolute distrust of ultraﬁlters, and it would also remove the
dependence on the axiom of choice and in principle provide explicit but very poor
bounds. However it would cause the argument to be signiﬁcantly longer, and the
notation would be much bulkier.
Our exposition will be as follows. We will begin by spending some time introducing the ultraﬁlter language and then, motivated by examples, the notions of
nilsequence, nilcharacter and symbol. Once that is done we will, in §7, give the
high-level argument for Theorem 1.3; this consist of detailing points (i), (ii) and
(x) of the outline above and giving proper statements of the other main points.
The discussion above concerning points (iii), (iv), (v) and (vi) has been simpliﬁed
for the sake of exposition. In actual fact, these points are dealt with together by
a kind of iterative loop, in which more and more bracket-linear structure is placed
on the nilcharacters χh (n) by cycling from (iii) to (vi) repeatedly.
We remark that a quite diﬀerent approach using ultraﬁlters to the structural
theory of the Gowers norms is in the process of being carried out in [52, 53, 54];

8

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

this seems related to the work of Host and Kra, whereas our work ultimately derives
from the work of Gowers.
We also make the minor remark that our proof of GI(s) is restricted to the case
s
3 case for minor technical reasons. In particular, we take advantage of the
non-trivial nature of the degree s − 2 “lower order terms” in the Gowers CauchySchwarz argument (Proposition 7.3) in the symmetry argument step; and we will
also observe that the various “smooth” and “periodic” error terms arising from the
equidistribution theory in Appendix D are of degree 1 and thus negligible compared
with the main terms in the analysis, which are of degree s − 1. The arguments can
be modiﬁed to give a proof of GI(2), although this proof would basically be a
notationally intensive repackaging of the arguments in [21].
Acknowledgements. BG was, for some of the period during which this work was
carried out, a fellow of the Radcliﬀe Institute at Harvard. He is very grateful to
the Radcliﬀe Institute for providing excellent working conditions. TT is supported
by NSF Research Award DMS-0649473, the NSF Waterman award and a grant
from the MacArthur Foundation. TZ is supported by ISF grant 557/08, an Alon
fellowship and a Landau fellowship of the Taub foundation. All three authors are
very grateful to the University of Verona for allowing them to use classrooms at
Canazei during a week in July 2009. This work was largely completed during that
week.
3. Basic notation
We write N := {0, 1, 2, . . .} for the natural numbers, and N+ := {1, 2, . . .} for
the positive natural numbers. Given two integers N, M , we write [N, M ] for the
discrete interval [N, M ] := {n : N
n
M }. We also make the abbreviations
[N ] := [1, N ], and , and [[N ]] := [−N, N ]. If x is a real number, we write x mod 1
for the associated residue class in the unit circle T := R/Z, and write x = y mod 1
if x and y diﬀer by an integer.
We will rely frequently on the following two elementary functions: the fundamental character e : R → C (or e : T → C) deﬁned by
e(x) := e2πix ,
and the signed fractional part function 2 {} : R → I0 , where I0 is the fundamental
domain
I0 := {x ∈ R : −1/2 < x 1/2}
and {x} is the unique real number in I0 such that x = {x} mod 1. We will often
rely on the identity
e(x) = e({x}) = e(x mod 1)
without further comment.
For technical reasons, we will need to manipulate vector-valued complex quantities in a manner analogous to scalar complex quantities. If v = (vi )D
i=1 and
D
D′
D′
w = (wi )i=1 are vectors in C and C respectively then we form the tensor prod′
uct v ⊗ w ∈ CDD by the formula
v ⊗ w := (v1 w1 , . . . , vD wD′ )
2The signed fractional part will be slightly more convenient to work with than the unsigned
fractional part, as it is equal to the identity near the origin.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

9

and the complex conjugate v ∈ CD by the formula
v := (v1 , . . . , vD ).
′

Similarly, if X is some set and f : X → CD and g : X → CD are functions then
′
we write f ⊗ g : X → CDD for the function deﬁned by (f ⊗ g)(x) := f (x) ⊗ g(x),
and similarly deﬁne f : X → CD .
If G = (G, +) is an additive group, k ∈ N, g = (g1 , . . . , gk ) ∈ Gk , and a =
(a1 , . . . , ak ) ∈ Zk , we deﬁne the dot product
a · g := a1 g1 + . . . + ak gk .
Given a set H in an additive group, deﬁne an additive quadruple in H to be a
quadruple (h1 , h2 , h3 , h4 ) ∈ H with h1 + h2 = h3 + h4 . The number of additive
quadruples in H is known as the additive energy of H and is denoted E(H).
A map φ : H → G from H to another additive group G is said to be a Freiman
homomorphism if it preserves additive quadruples, i.e. if φ(h1 ) + φ(h2 ) = φ(h3 ) +
φ(h4 ) for all additive quadruples (h1 , h2 , h3 , h4 ) in H.
Given a multi-index d = (d1 , . . . , dk ) ∈ Nk , we write |d| := d1 + . . . + dk .
We now brieﬂy review and clarify some standard notation from group theory.
When we do not assume a group G to be abelian, we will always write G multiplicatively: G = (G, ·). However, when dealing with abelian groups, we reserve the
right to use additive notation instead.
We view an n-tuple (a1 , . . . , an ) of labels as a ﬁnite ordered set with the ordering
a1 < . . . < an . If A = (a1 , . . . , an ) is a ﬁnite ordered set and (ga )a∈A are a collection
of group elements in a multiplicative group G, we deﬁne the ordered products
1

n
a∈A

gi := gn . . . g1

gi := g1 . . . gn and

ga := ga1 . . . gan ,
i=1

i=n

for any n
0, with the convention that the empty product is the identity. We
extend this notation to inﬁnite products under the assumption that all but ﬁnitely
many of the factors are equal to the identity.
Given a subset A of a group G, we let A denote the subgroup of G generated
by A. Given a family (Hi )i∈I of subgroups of G, we write i∈I Hi for the smallest
subgroup of G that contains all of the Hi .
Given two elements g, h of a multiplicative group G, we deﬁne the commutator
[g, h] := g −1 h−1 gh.
We write H G to denote the statement that H is a subgroup of G. If H, K G,
we let [H, K] be the subgroup generated by the commutators [h, k] with h ∈ H and
k ∈ K, thus [H, K] = {[h, k] : h ∈ H, k ∈ K} .
If r
1 is an integer and g1 , . . . , gr ∈ G, we deﬁne an (r − 1)-fold iterated
commutator of g1 , . . . , gr inductively by declaring g1 to be the only 0-fold iterated
commutator of g1 , and for r > 1 deﬁning an (r − 1)-fold iterated commutator to be
any expression of the form [w, w′ ], where w and w′ are (s − 1)-fold and (s′ − 1)-fold
commutators of gi1 , . . . , gis and gi′1 , . . . , gi′s′ respectively, where s, s′
1 are such
that s+s′ = r, and {i1 , . . . , is }∪{i′1 , . . . , i′s′ } = {1, . . . , r} is a partition of {1, . . . , r}
into two classes. Thus for instance [[g3 , g1 ], [g2 , g4 ]] and [g2 , [g1 , [g3 , g4 ]]] are 3-fold
iterated commutators of g1 , . . . , g4 .
The following lemma will be useful for computing commutator groups.

10

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Lemma 3.1. Let H = A , K = B be normal subgroups of a nilpotent group G
that are generated by sets A ⊂ H, B ⊂ K respectively. Then [H, K] is normal,
and is also the subgroup generated by the i + j − 1-fold iterated commutators of
a1 , . . . , ai , b1 , . . . , bj with a1 , . . . , ai ∈ A, b1 , . . . , bj ∈ B and i, j 1.
Proof. The normality of [H, K] is follows from the identity
g[H, K]g −1 = [gHg −1 , gKg −1 ].
It is then clear that [H, K] contains the group generated by the iterated commutators of elements in A, B that involve at least one element from each. The converse
follows inductively using the identities
[x, y] = [y, x]−1 , [xy, z] = [x, z][[x, z], y][y, z] and [x, y −1 ] = [y, x][[y, x], y −1 ].
(3.1)
This concludes the proof.
As a corollary of the above lemma, we have the distributive law




Hi ,

i∈I

j∈J

Kj  =

[Hi , Kj ]

i∈I,j∈J

whenever (Hi )i∈I , (Kj )j∈J are families of normal subgroups of a nilpotent group
G.
If H ⊳ G is a normal subgroup of G, and g ∈ G, we use g mod H to denote the
coset representative gH of g in G/H. For instance, g = g ′ mod H if gH = g ′ H.
At various stages in the paper we will need the (discrete) Baker-CampbellHausdorff formula in the following weak form:
g1n1 g2n2 = g2n2 g1n1

gaPa (n1 ,n2 )

(3.2)

a

for all g1 , g2 in a nilpotent group G and all integers n1 , n2 , where ga ranges over
all iterated commutators of g1 , g2 that involve at least one copy of each (note from
nilpotency that there are only ﬁnitely many non-trivial ga ), with the a ordered in
some arbitrary fashion, and Pa : Z × Z → Z are polynomials. Furthermore, if ga
involves d1 copies of g1 and d2 copies of g2 , then Pa has degree at most d1 in the
n1 variable and d2 in the n2 variable.
Let G be a connected, simply connected, nilpotent Lie group (or nilpotent Lie
group for short). Then we denote the Lie algebra of G as log G. As is well known
(see e.g. [7]), the exponential map exp : log G → G is a homeomorphism, inverted
by the logarithm map log : G → log G, and we can then deﬁne the exponentiation
operation g t for any g ∈ G and t ∈ R by the formula
g t := exp(t log g).
There is a continuous version of the Baker-Campbell-Hausdorﬀ formula:
g1t1 g2t2 = g2t2 g1t1

gaPa (t1 ,t2 )

(3.3)

a

for all t1 , t2 ∈ R and g1 , g2 ∈ G, where Pa are the polynomials occurring in (3.2).
We also observe the variant formulae
(g1 g2 )t = g1t g2t

gaQa (t)
a

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

11

for some polynomials Qa and all t ∈ R, g1 , g2 ∈ G, and
exp(t1 log g1 + t2 log g2 ) = g1t1 g2t2

gaRa (t1 ,t2 )
a

for some further polynomials Ra and all t1 , t2 ∈ R, g1 , g2 ∈ G. We refer to all of
these formulæ collectively as the Baker-Campbell-Hausdorff formula.
If A is a subset of a nilpotent Lie group G, we let A R be the smallest connected
Lie subgroup of G containing A, or more explicitly
A

R

:= {at : a ∈ A; t ∈ R} .

Equivalently, log A R is the Lie algebra generated by log A.
A lattice of a nilpotent Lie group G is a discrete cocompact subgroup Γ of G.
Thus for instance, we see from (3.2) that for any ﬁnite set A in G, A will be a
cocompact subgroup of A R , and will thus be a lattice if A is discrete.
A connected Lie subgroup H of G is said to be rational with respect to Γ if
Γ ∩ H is cocompact in H. For instance, if G = R2 , Γ is the standard lattice Z2 ,
and α ∈ R, then the connected Lie subgroup H := {(x, αx) : x ∈ R} is rational if
and only if α is rational.
Further notation. Here is a list of further notation used in the paper for
reference, together with the place in the paper where each piece is deﬁned and
discussed.
poly(HN → GN )
polynomial maps from one ﬁltered group HN to GN
6.18
poly(ZN → GN )
polynomial maps with the degree ﬁltration
6.18
poly(ZkNk → GNk )
polynomial maps with the multidegree ﬁltration
6.18
poly(ZDR → GDR ) polynomial maps with the degree-rank ﬁltration
6.18
D
∗ d
∞
bounded limit functions to C
(A.1)
L (Ω → C )
w
bounded limit functions (also L∞ (Ω))
(A.1)
L∞ (Ω → C )
D
∗
5.1
Lip( (G/Γ) → C ) bd’d limit functions with bounded Lipschitz constant
Nild ([N ])
nilsequences of degree ≤ d on [N ]
5.2
Nil⊂J (Ω)
nilsequences of degree ⊂ J
6.19
Ξd ([N ])
space of degree d nilcharacters on [N ]
6.1
(d1 ,...,dk )
ΞMulti
(Ω)
multidegree nilcharacters
6.19
(d,r)
ΞDR (Ω)
degree-rank nilcharacters
6.19
Symbd ([N ])
equiv. classes of degree d nicharacters in Ξd ([N ])
6.6
(d1 ,...,dk )
SymbMulti
(Ω)
equiv. classes of multidegree nicharacters
6.22
(d,r)
equiv. classes of degree-rank nicharacters
6.22
SymbDR (Ω)
D
D, (s−1,r∗ )
G ,G
universal nilpotent Lie group of degree-rank (s − 1, r∗ ) 9.1
Horizi (G)
i’th horizontal space of G
9.6
Taylori (g)
i′ th horizontal Taylor coeﬃcient of a polynomial map 9.6
(D, η, F )
total frequency representation of a nilcharacter
9.11
4. The polynomial formulation of GI(s)
The inverse conjecture GI(s), Conjecture 1.2, has been formulated using linear
nilsequences F (g n xΓ). This is largely for compatibility with the earlier paper [23] of
the ﬁrst two authors on linear equations in primes, where this form of the conjecture
was stated in precisely this form as Conjecture 8.3. Subsequently, however, it was

12

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

discovered that it is more natural to deal with a somewhat more general class
of object called a polynomial nilsequence F (g(n)Γ). This is particularly so when
it comes to discussing the distributional properties of nilsequences, as was done
in [24]. Thus, we shall now recast the inverse conjecture in terms of polynomial
nilsequences, which is the formulation we will work with throughout the rest of the
paper.
Let us ﬁrst recall the deﬁnition of a polynomial nilsequence of degree d.
Definition 4.1 (Polynomial nilsequence). Let G be a (connected, simply-connected)
nilpotent Lie group. By a filtration GN = (Gi )i∈N of degree d we mean a nested
sequence G ⊇ G0 ⊇ G1 ⊇ G2 ⊇ · · · ⊇ Gd+1 = {id} with the property that
[Gi , Gj ] ⊆ Gi+j for all i, j
0, adopting the convention that Gi = {id} for all
i > d. By a polynomial sequence adapted to GN we mean a map g : Z → G such that
∂hi . . . ∂h1 g ∈ Gi for all i 0 and h1 , . . . , hi ∈ Z, where ∂h g(n) := g(n + h)g(n)−1 .
Write poly(ZN → GN ) for the collection of all such polynomial sequences.
Let Γ G be a lattice in G (i.e. a discrete and cocompact subgroup), so that
the quotient G/Γ is a nilmanifold, and assume that each of the Gi are rational
subgroups (i.e. Γi := Γ ∩ Gi is a cocompact subgroup of Gi ). We refer to the
pair G/Γ = (G/Γ, GN ) as a filtered nilmanifold. A polynomial orbit O : Z → G/Γ
is a sequence of the form O(n) := g(n)Γ, where g ∈ poly(ZN → GN ); we let
poly(ZN → (G/Γ)N ) denote the space of all such polynomial orbits. If F : G/Γ → C
is a 1-bounded, Lipschitz function then the sequence F ◦O = (F (g(n)Γ))n∈Z is called
a polynomial nilsequence of degree d.
The subscripts N will become more relevant later in this paper, when we start
ﬁltering nilpotent groups and nilmanifolds by other index sets I than the natural
numbers N. Note that we do not require G0 or G1 to equal G; this freedom will be
convenient for some minor technical reasons, although ultimately it will not enlarge
the space of polynomial nilsequences.
Let us give the basic examples of nilsequences and polynomials:
Example 4.2 (Linear nilsequences are polynomial nilsequences). Let G be a d-step
nilpotent Lie group, and let Γ be a lattice of G. Then, as is well known (see e.g.
[7]), the lower central series filtration deﬁned by G0 = G1 := G, G2 := [G, G1 ],
G3 := [G, G2 ], . . . , Gd+1 := [G, Gd ] = {id} is a ﬁltration on G. Using the BakerCampbell-Hausdorﬀ formula (3.3) it is not diﬃcult to show that the lower central
series ﬁltration is rational with respect to Γ, so the nilmanifold G/Γ becomes a
ﬁltered nilmanifold. If g(n) := g1n g0 for some g0 , g1 ∈ G, then ∂h1 g(n) = g1h1
2: therefore g is a polynomial sequence, and
and ∂hi . . . ∂h1 g(n) = id for i
so every linear orbit n → g n x with g ∈ G and x ∈ G/Γ is a polynomial orbit
also. As a consequence we see that every d-step linear nilsequence n → F (g n x) is
automatically a polynomial nilsequence of degree d.
Example 4.3 (Polynomial phases are polynomial nilsequences). Let d 0 be an
integer. Then we can give the unit circle T the structure of a degree d ﬁltered
nilmanifold by setting G := R and Γ := Z, with Gi := R for i d and Gi := {0}
for i > d. This is clearly a ﬁltered nilmanifold. If α0 , . . . , αd are real numbers,
then the polynomial P (n) := α0 + . . . + αd nd is then polynomial with respect to
this ﬁltration, with n → P (n) mod 1 being a polynomial orbit in T. Thus, for
any Lipschitz function F : T → C, the sequence n → F (P (n)) is a polynomial

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

13

nilsequence of degree
d; in particular, the polynomial phase n → e(P (n)) is a
polynomial nilsequence.
Example 4.4 (Combinations of monomials are polynomials). By Corollary B.4,
we see that if G = (G, (Gi )i∈N ) is a ﬁltered group of degree d, then any sequence
of the form
k
P (n)

gj j

n→

,

j=1

in which gj ∈ Gdj for some dj ∈ N, and Pj : Z → R is a polynomial of degree
will be a polynomial map. Thus for instance

dj ,

(n)
(n)
n → gd d . . . g2 2 g1n g0
is a polynomial map whenever gj ∈ Gj for j = 0, . . . , d. In fact, all polynomial
maps can be expressed in such a fashion via a Taylor expansion; see Lemma B.9.
We will give several further examples and properties of polynomial maps and
polynomial nilsequences in §6.
As a consequence of Example 4.2, the following variant of the inverse conjecture
GI(s) is ostensibly weaker than that stated in the introduction.
Conjecture 4.5 (GI(s), polynomial formulation). Let s
0 be an integer, and
let 0 < δ
1. Then there exists a finite collection Ms,δ of filtered nilmanifolds
G/Γ = (G/Γ, GN ), each equipped with some smooth Riemannian metric dG/Γ as
well as constants C(s, δ), c(s, δ) > 0 with the following property. Whenever N 1
and f : [N ] → C is a function bounded in magnitude by 1 such that f U s+1 [N ] δ,
there exists a filtered nilmanifold G/Γ ∈ Ms,δ , some g ∈ poly(ZN → GN ) and a
function F : G/Γ → C bounded in magnitude by 1 and with Lipschitz constant at
most C(s, δ) with respect to the metric dG/Γ such that
|En∈[N ] f (n)F (g(n)Γ)|

c(s, δ).

It turns out that this conjecture is actually equivalent to Conjecture 1.2; we
shall prove this equivalence in Appendix C. We remark that, though it might seem
odd to put a non-trivial part of the proof of our main theorem in an appendix,
we would rather encourage the reader to regard the proof of Conjecture 4.5 as our
main theorem. The rationale behind this is that everything that is done with linear
nilsequences F (g n xΓ) in [23] could have been done equally well, and perhaps more
naturally, with polynomial nilsequences F (g(n)Γ). Further remarks along these
lines were made in the introduction to our earlier paper [28], where the polynomial
formulation was emphasised from the outset. Here, however, we have felt a sense
of duty to formally complete the programme outlined in [23].
Henceforth we shall refer simply to a nilsequence, rather than a polynomial
nilsequence.
In §6 we will need to generalise the notion of a (polynomial) nilsequence by
allowing more exotic ﬁltrations GI on the group G, indexed by more complicated
index sets I than the natural numbers N. In particular, we shall introduce the
multidegree filtration, which allows us to deﬁne nilsequences of several variables, as
well as the degree-rank ﬁltration which provides a ﬁner classiﬁcation of polynomial
sequences than merely the degree. We will discuss these using examples, and then
develop a more uniﬁed theory that contains all three.

14

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

5. Taking ultralimits
The inverse conjecture, Conjecture 4.5, is a purely ﬁnitary statement, involving
functions on a ﬁnite set [N ] = {1, . . . , N } of integers. As such, it is natural to look
for proofs of this conjecture which are also purely ﬁnitary, and much of the previous
literature on these types of problems is indeed of this nature.
However there is a very notable exception, namely the portion of the literature that exploits the Furstenberg correspondence principle between combinatorial
problems and ergodic theory. See [12] for the original application to Szemer´edi’s
theorem, or [56] for a more recent application to Gowers norms over ﬁnite ﬁelds.
Here we use a somewhat diﬀerent type of limit object, namely an ultralimit. We
are certainly not the ﬁrst to employ ultralimits (a.k.a. nonstandard analysis) in
additive number theory; see for example [40].
The ultralimit formalism allows us to convert a “ﬁnitary” or “standard” statement such as Conjecture 4.5 into an equivalent statement concerning limit objects,
constructed as ultralimits of standard objects. This procedure is closely related to
the use of the transfer principle in nonstandard analysis, but we have elected to
eschew the language of nonstandard analysis in order to reduce confusion, instead
focusing on the machinery of ultralimits.
Here is a brief and somewhat vague list of the advantages of using the ultralimit
approach.
• Pigeonholing arguments are straightforward (due to the fact that a limit
function taking ﬁnitely many values is constant);
• Book-keeping of constants: one can talk rigorously about such concepts as
“bounded” functions without a need to quantify the bounds;
• One may make rigorous sense of such statements as “the function f :
[N ] → C and the function g : [N ] → C are equivalent modulo degree s
nilsequences”.
• In the inﬁnitary context one may easily perform rank reduction arguments
in which one seeks to ﬁnd the “minimal bounded-complexity” representation of a given system.
There are also some drawbacks of the approach:
• It becomes quite diﬃcult to extract any quantitative bounds from our
results, in particular we do not give explicit bounds on the constant c(s, δ)
or on the complexity of the nilsequence in Conjecture 1.2 or Conjecture 4.5.
It is in principle possible to expand the ultralimit proof into a standard
proof, but the bounds are quite poor (of Ackermann type) due to the
repeated use of “rank reduction arguments” and other highly iterative
schemes that arise in the conversion of ultralimit arguments to standard
ones. For further discussion of the relation of ultralimit analysis to ﬁnitary
analysis see [55, §1.3, §1.5].
• The language of ultraﬁlters adds one more layer of notational complexity
to an already notationally-intensive paper; however, there are gains to be
made elsewhere, most notably in eliminating many quantitative constants
(e.g. ε, N ) and growth functions (e.g. F ).
Limit formulation of GI(s). The basic notation and theory of ultralimits
are reviewed in Appendix A. We now use this formalism to convert the inverse
conjecture, GI(s), into an equivalent statement formulated in the framework of

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

15

ultralimits. We ﬁrst consider a limit version of the concept of a Lipschitz function
on a nilmanifold. For technical reasons we will need to consider vector-valued
D
functions, taking values in CD or C rather than C or C.
Definition 5.1 (Lipschitz functions). Let G/Γ be a standard nilmanifold, and let
D ∈ N+ be standard.
• We let Lip(G/Γ → CD ) be the space of standard Lipschitz functions F :
G/Γ → CD . (Here we endow the compact manifold G/Γ with a smooth
metric in an arbitrary fashion; the exact choice of metric is not relevant.)
D
• We let Lip(∗ (G/Γ) → C ) be the space of bounded limit functions F :
D
∗
(G/Γ) → C whose Lipschitz constant is bounded (or equivalently, F
is an ultralimit of uniformly bounded functions Fn : G/Γ → CD with
uniformly bounded Lipschitz constant).
D
• We let Lip(∗ (G/Γ) → S 2D−1 ) be the functions in Lip(∗ (G/Γ) → C ) that
take values in the (limit) complex sphere
S 2D−1 := {z ∈ C

D

: |z| = 1}.

• We write
ω

D

Lip(∗ (G/Γ) → C )

Lip(∗ (G/Γ) → C ) :=
D∈N+

and
Lip(∗ (G/Γ) → S 2D−1 ).

Lip(∗ (G/Γ) → S ω ) :=
D∈N+

We will often abbreviate these spaces as Lip(G/Γ) or Lip(∗ (G/Γ)) when the range
of the functions involved is not relevant to the discussion.
Remark. As G/Γ is compact, we see from the Arzel`
a-Ascoli theorem that
Lip(G/Γ → CD ) is locally compact in the L∞ (G/Γ → CD ) topology. As a conD
sequence, if we embed Lip(G/Γ → CD ) into Lip(∗ (G/Γ) → C ) in the obvious
manner, then the former is a dense subspace of the latter in the (standard) uniform
D
topology, in the sense that for every F ∈ Lip(∗ (G/Γ) → C ) and every standard
ε > 0 there exists F ′ ∈ Lip(G/Γ → CD ) such that |F (x) − F ′ (x)|
ε for all
x ∈ ∗ (G/Γ).
D
ω
Remark. Observe that the spaces Lip(∗ (G/Γ) → C ) and Lip(∗ (G/Γ) → C )
ω
are vector spaces over C. The spaces Lip(∗ (G/Γ) → C ) and Lip(∗ (G/Γ) → S ω )
are also closed under tensor product (as deﬁned in §3). All the spaces deﬁned in
Deﬁnition 5.1 are closed under complex conjugation.
Using the above notion, we can deﬁne the limit version of a (polynomial) nilsequence.
Definition 5.2 (Nilsequence). Let s
0 be standard. A nilsequence of degree
s is any limit function ψ : ∗ Z → ∗ C of the form ψ(n) := F (g(n)Γ), where
G/Γ = (G/Γ, GN ) is a standard ﬁltered nilmanifold of degree s, g : ∗ Z → ∗ G is a
limit polynomial sequence (i.e. an ultralimit of polynomial sequences gn : Z → G),
and F ∈ Lip(∗ (G/Γ) → C).
Given any limit subset Ω of ∗ Z, we denote the space of degree d nilsequences,
ω
ω
restricted to Ω, as Nild (Ω) = Nild (Ω → C ); this is a subset of L∞ (Ω → C ). We

16

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER
D

D

write Nild (Ω → C ) for the nilsequences that take values in C ; this is a subspace
D
(over C) of L∞ (Ω → C ). We make the technical remark that Nild (Ω) is a σlimit set, since one can express this space as the union, over all standard M and
D
dimensions D, of the nilsequences taking values in C arising from a nilmanifold of
“complexity” M and a Lipschitz function of constant at most M , where one deﬁnes
the complexity of a nilmanifold in some suitable fashion. In particular, the limit
selection lemma in Corollary A.12 can be applied to this set.
We also deﬁne the Gowers uniformity norm f U s+1 [N ] of an ultralimit f =
limn→p fn of standard functions fn : [Nn ] → C in the usual limit fashion
f

U s+1 [N ]

:= lim fn
n→p

U s+1 [Nn ] .

If f is vector-valued instead of scalar valued, say f = (f1 , . . . , fd ), then we deﬁne
the uniformity norm by the formula
d

f

U s+1 [N ]

fi

:= (

2s+1
1/2s+1
.
U s+1 [N ] )

i=1
s+1

(The exponent 2
is not important here, but has some very slight aesthetic advantages over other equivalent formulations of the vector-valued norm.)
The ultralimit formulation of GI(s) can then be given as follows:
Conjecture 5.3 (Ultralimit formulation of GI(s)). Let s
0 be standard and
N
1 be a limit natural number. Suppose that f ∈ L∞ ([N ] → C) is such that
f U s+1 [N ] ≫ 1. Then f correlates with a degree s nilsequence on [N ].
See Deﬁnition A.7 for the deﬁnition of correlation in this context.
We now show why, for any ﬁxed standard s, Conjecture 5.3 is equivalent to its
more traditional counterpart, Conjecture 4.5.
Proof of Conjecture 5.3 assuming Conjecture 4.5. Let f be as in Conjecture 5.3.
We may normalise the bounded function f to be bounded by 1 in magnitude
throughout. By hypothesis, there exists a standard δ > 0 such that f U s+1 [N ] δ.
Writing N and f as the ultralimits of Nn , fn respectively for some fn : [Nn ] → C
bounded in magnitude by 1, and applying Conjecture 4.5, we conclude that for n
suﬃciently close to p, we have the correlation bound
|Enn ∈[Nn ] fn (nn )Fn (gn (nn )Γn )|

c(s, δ) > 0

where Gn /Γn , gn , xn , Fn are as in Conjecture 1.2. Writing G/Γ, g, x, F for the
ultralimits of Gn /Γn , gn , xn , Fn respectively, we thus have
|En∈[N ] f (n)F (g(n)∗ Γ)| ≫ 1.
By the pigeonhole principle (cf. Appendix A), we see that G/Γ is a standard degree
s nilmanifold, while g : ∗ Z → ∗ G and x ∈ G/Γ remain limit objects. The limit
function F lies in Lip(∗ (G/Γ) → C) by construction, and the claim follows.
Proof of Conjecture 4.5 assuming Conjecture 5.3. Observe (from the theory of
Mal’cev bases [48]) that there are only countably many degree
s nilmanifolds
G/Γ up to isomorphism, which we may enumerate as Gn /Γn . We endow each of
these nilmanifolds arbitrarily with some smooth Riemannian metric dGn /Γn .
Suppose for contradiction that Conjecture 4.5 failed. Carefully negating all the
quantiﬁers, we may thus ﬁnd a δ > 0, a sequence Nn of standard integers, and a

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

17

function fn : [Nn ] → C bounded in magnitude by 1 with fn U s+1 [N ]
δ, such
that
(5.1)
|Enn ∈[Nn ] fn (nn )F (g(nn )Γn′ ))| 1/n
′
′
′
′
whenever n
n, g ∈ poly(ZN → (Gn )N ), and F : Gn /Γn → C is bounded in
magnitude by 1 and has a Lipschitz constant of at most n with respect to dGn /Γn .
On the other hand, viewing f as a bounded limit function, we can apply Conjecture 5.3 and conclude that there exists a standard ﬁltered nilmanifold G/Γ with
some smooth Riemannian metric dG/Γ , a limit polynomial g : ∗ Z → ∗ G, and some
ultralimit F ∈ Lip(∗ (G/Γ) → C) of functions Fn : G/Γ → C with uniformly
bounded Lipschitz norm, such that
|En∈[N ] f (n)F (g(n)∗ Γ)|

ε

for some standard ε > 0.
By construction, G/Γ is isomorphic to Gn0 /Γn0 for some n0 , so we may assume without loss of generality that G/Γ = Gn0 /Γn0 ; since all smooth Riemannian
metrics on a compact manifold are equivalent, we can also assume that dG/Γ =
dGn0 /Γn0 . We may also normalise F to be bounded in magnitude by 1. But this
contradicts (5.1) for n suﬃciently large, and the claim follows.
Thus, to establish Theorem 1.3, it will suﬃce to establish Conjecture 5.3 for
s 3. This is the objective of the remainder of the paper.
Remark. We transformed the ﬁnitary linear inverse conjecture, Conjecture 1.2,
into a nonstandard polynomial formulation, Conjecture 5.3, via the ﬁnitary polynomial inverse conjecture, Conjecture 4.5. One can also swap the order of these
equivalences, transforming the ﬁnitary linear inverse conjecture into a nonstandard
linear formulation by arguing as above, and then transforming the latter into a
nonstandard polynomial formulation by using Proposition C.2. Of course the two
arguments are essentially equivalent.
Conjecture 5.3 is trivial when N is bounded, since every function in L∞ [N ] is
then a nilsequence of degree at most s. For the remainder of the paper we shall
thus adopt the convention that N denotes a ﬁxed unbounded limit integer.
To conclude this section we reformulate Conjecture 4.5 by introducing the important notion of bias.
Definition 5.4 (Bias and correlation). Let Ω be a limit ﬁnite subset of Z, and let
ω
d ∈ N. We say that f, g ∈ L∞ (Ω → C ) d-correlate if we have
|En∈Ω f (n) ⊗ g(n) ⊗ ψ(n)| ≫ 1
ω

for some degree d nilsequence ψ ∈ Nild (Ω → C ). We say that f is d-biased if f
d-correlates with the constant function 1, and d-unbiased otherwise.
With this deﬁnition, Conjecture 5.3 can be reformulated in the following manner.
Conjecture 5.5 (Limit formulation of GI(s), II). Let s 0 be standard. Suppose
that f ∈ L∞ ([N ] → C) is such that f U s+1 [N ] ≫ 1. Then f is s-biased.
From previous literature, we see that Conjecture 5.5 has already been proven for
s 2; we need to establish it for all s 3. We also make the basic remark that
while the conjecture is only phrased for scalar-valued functions f ∈ L∞ ([N ] → C),
ω
it automatically generalises to vector-valued functions f ∈ L∞ ([N ] → C ), since
if a vector-valued function f has large U s+1 [N ] norm, then so does one of its
components.

18

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Finally we remark that the converse implication is known.
Proposition 5.6 (Converse GI(s), ultralimit formulation). Let s 0 be standard.
Suppose that f ∈ L∞ ([N ] → C) is s-biased. Then f U s+1 [N ] ≫ 1.
Proof. This follows from [21, Proposition 12.6], [23, §11], or [28, Proposition 1.4],
transferred to the ultralimit setting in the usual fashion.
6. Nilcharacters and symbols in one and several variables
Conjecture 5.3 asserts that a function in L∞ ([N ] → C) on an unbounded interval
[N ] correlates with a degree
s nilsequence. For inductive reasons, it is useful
to observe that this conclusion implies a strengthened version if itself, in which
f correlates with a special type of degree
s nilsequence, namely a degree s
nilcharacter. A nilcharacter is a special type of nilsequence and should be thought
of, very roughly speaking, as a generalisation of characters e(αn) in the degree 1
setting, or objects such as e(αn{βn}) in the degree 2 setting; these were crucial in
our paper on GI(3) [28], although the notation there was slightly diﬀerent in some
minor ways. See [29] for further informal discussion of nilcharacters.
In the s = 1 case, a nilcharacter is essentially (ignoring constants) the same
thing as a linear phase function n → e(ξn), and the frequency ξ can be viewed
as living in the Pontryagin dual of ∗ Z (or, in some sense, of [N ], even though the
latter set is not quite a locally compact abelian group). It will turn out that more
generally, a degree s nilcharacter will have a “symbol” (analogous to the frequency
ξ) that takes values in a “higher order Pontryagin dual” Symbs ([N ]) of [N ]; this
symbol can be interpreted as the “top order term” of a nilcharacter, for instance
the symbol of the degree 3 nilcharacter n → e(αn3 + βn2 + γn + δ) is basically3
α. This higher order dual obeys a number of pleasant algebraic properties, and the
primary purpose of this section is to develop those properties.
There are various additional complications to be taken into account:
• We will require multidimensional generalisations of these concepts (think
of the two-dimensional sequence (n1 , n2 ) → e(αn1 {βn2 })) together with
appropriate notions of multidegree in order to make sense of “top-order”
and “lower-order terms”;
• We will be dealing with CD -valued (or, rather, S 2D−1 -valued) nilsequences
rather than merely scalar ones. This is so that we may continue to work
in the smooth category, as discussed in the introduction;
• The language of ultraﬁlters will be used.
Our main focus here will be on the ﬁrst of these points. The second is largely
a technicality, whilst the third is actually helpful in that the notion of symbol (for
example) is rather clean and does not require discussion of complexity bounds.
Motivation and one-dimensional definitions. We now give the deﬁnitions
of a (one-dimensional) nilcharacter and its symbol, and give a few examples. However, we will hold oﬀ for now on actually proving too much about these concepts,
because we will shortly need to generalise these notions to a more abstract setting
in which one also allows multidimensional nilcharacters, and nilcharacters that are
atuned not just to a speciﬁc degree, but also to a speciﬁc “rank” inside that degree.
3This is an oversimplification; it would be more accurate to say that the symbol is given by α
modulo ∗ Z + Q + O(N −3 ).

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

19

Definition 6.1 (Nilcharacter). Let d 0 be a standard integer. A nilcharacter χ
of degree d on [N ] is a nilsequence χ(n) = F (O(n)) = F (g(n)∗ Γ) on [N ] of degree
ω
d, where the function F ∈ Lip(∗ (G/Γ) → C ) obeys two additional properties:
• F ∈ Lip(∗ (G/Γ) → S ω ) (thus |F | = 1 pointwise, and hence |χ| = 1
pointwise also); and
• F (gd x) = e(η(gd ))F (x) for all x ∈ G/Γ and gd ∈ Gd , where η : Gd → R is
a continuous standard homomorphism which maps Γd to the integers (or
equivalently, η is an element of the Pontryagin dual of the torus Gd /Γd ).
We call η the vertical frequency of F .
The space of all nilcharacters of degree d on [N ] is denoted Ξd ([N ]).
Example 6.2. When d = 1, the only examples of nilcharacters are the linear
phases n → e(αn + β) for α, β ∈ ∗ R.
Example 6.3. For any α0 , . . . , αd ∈ ∗ R, the function n → e(α0 + . . . + αd nd ) is a
nilcharacter of degree d. To see this, we set G/Γ to be the unit circle T with the
ﬁltration Gi := R for i d and Gi := {0} for i > d (thus G/Γ is of degree d), let
g(n) := α0 + . . . + αd nd , and let F (x) := e(x). The vertical frequency η : R → R is
then just the identity function.
Now we give an instructive near -example of a nilcharacter. Let G be the free
2-step nilpotent Lie group on two generators e1 , e2 , thus
G := e1 , e2

R

= {et11 et22 [e1 , e2 ]t12 : t1 , t2 , t12 ∈ R}

(6.1)

with the element [e1 , e2 ] being central, but with no other relations between e1 , e2
and [e1 , e2 ]. This is a degree 2 nilpotent group if we set G0 , G1 := G and
G2 := [e1 , e2 ]

R

= {[e1 , e2 ]t12 : t12 ∈ R}.

We let
Γ := e1 , e2 = {en1 1 en2 2 [e1 , e2 ]n12 : n1 , n2 , n12 ∈ Z}
be the discrete subgroup of G generated by e1 , e2 , then G/Γ is a degree 2 ﬁltered
nilmanifold, known as the Heisenberg nilmanifold, and elements of G/Γ can be
uniquely expressed using the fundamental domain
G/Γ = {et11 et22 [e1 , e2 ]t12 Γ : t1 , t2 , t12 ∈ I0 := (−1/2, 1/2]}.
αn
If we then set g : ∗ Z → ∗ G to be the limit polynomial sequence g(n) := eβn
2 e1
∗
for some ﬁxed α, β ∈ R, and let F : G/Γ → C be the function deﬁned on the
fundamental domain by the formula

F (et11 et22 [e1 , e2 ]t12 Γ) := e(−t12 )

(6.2)

for t1 , t2 , t12 ∈ I0 , then one easily computes that
F (g(n)∗ Γ) = e({αn}βn)
where {} : R → I0 is the signed fractional part function. The function n →
e({αn}βn) is then almost a nilcharacter of degree 2, with vertical frequency given by
the function η : [e1 , e2 ]t12 → −t12 . All the properties required to give a nilcharacter
in Deﬁnition 6.1 are satisﬁed, save for one: the function F is not Lipschitz on
all of G/Γ, but is instead merely piecewise Lipschitz, being discontinuous at some
portions of the boundary of the fundamental domain. To put it another way, one
can view n → e({αn}βn) as a piecewise nilcharacter of degree 2.

20

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Indeed, a topological obstruction prevents one from constructing any scalar function F ∈ Lip(∗ (G/Γ) → S 1 ) of unit magnitude on the Heisenberg nilmanifold with
the above vertical frequency. By taking standard parts, we may assume that F
comes from a standard Lipschitz function F : G/Γ → S 1 with the same vertical frequency. For any standard t ∈ [−1/2, 1/2], consider the loop γt := {et1 es2 Γ : s ∈ I0 }.
The image F (γt ) of this loop lives on the unit circle and thus has a well-deﬁned
winding number (or degree). As this degree must vary continuously in t while remaining an integer, it is constant in t; in particular, F (γ−1/2 ) and F (γ1/2 ) must
have the same winding number. On the other hand, from the Baker-CampbellHausdorﬀ formula (3.2) we see that
1/2

−1/2 s
e2 e1 [e1 , e2 ]s Γ)

F (e1 es2 Γ) = F (e1

−1/2 s
e2 Γ)

= e(s)F (e1

and so the winding number of F (γ1/2 ) is one larger than the winding number of
F (γ−1/2 ), a contradiction.
If however we allow ourselves to work with higher dimensions D, then this
topological obstruction disappears. Indeed, let us take a smooth partition of
D
2
2
+
and each ϕk is supported in
unity 1 =
k=1 ϕk (t, s) on T , where D ∈ N
2
Bk mod Z , where Bk is a ball of radius 1/100 (say) in R2 . Then if we deﬁne
F := (F1 , F2 , . . . , FD ), where
Fk (et1 es2 [e1 , e2 ]u∗ Γ) := ϕk (t, s)e(u)

(6.3)

whenever (t, s) ∈ ∗ Bk and u ∈ ∗ R, with Fk = 0 if no such representation of the
above form exists, then one easily veriﬁes that F lies in Lip(∗ (G/Γ) → S 2D−1 ) with
the vertical frequency η, and so the vector-valued sequence χ : n → F (g(n)∗ Γ) is
a nilcharacter of degree 2. A computation shows that each component χk of this
nilcharacter χ = (χ1 , . . . , χD ) takes the form
χk (n) = e({αn − θk }βn)ψk (n)
for some oﬀset θk ∈ ∗ R and some degree 1 nilsequence ψk . Thus we see that χ is
in some sense “equivalent modulo lower order terms” with the bracket polynomial
phase n → e({αn}βn). We refer to the vector-valued nilsequence χ as a vectorvalued smoothing of the piecewise nilsequence n → e({αn}βn); we will informally
refer to this smoothing operation several times in the sequel when discussing further
examples of nilsequences that are associated with bracket polynomials.
Similar computations can be made in higher degree. For instance, bracket cubic
phases such as n → e({{αn}βn}γn) or n → e({αn2 }βn) with α, β, γ ∈ ∗ R can be
viewed as near-examples of degree 3 nilcharacters (with the problem again being
that F is discontinuous on the boundary of the fundamental domain), but there exist
vector-valued smoothings of these phases which are genuine degree 3 nilcharacters.
We will not detail these computations here, but they can essentially be found in
[28, Appendix E]. More generally, one can view bracket polynomial phases of degree
d as near-examples of nilcharacters of degree d that can be converted to genuine
examples using vector-valued smoothings; this fact can be made precise using the
machinery from [46], but we will not need this machinery here.
Remark. The above topological obstruction is quite annoying; it is the sole
reason that we are forced to work with vector-valued functions. There are two
other approaches to avoid this topological obstruction that we know of. One is
to work with piecewise Lipschitz functions rather than Lipschitz functions. This

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

21

allows one in particular to build (piecewise) nilcharacters out of bracket polynomials. This is the approach taken in [28]; however, it requires one to develop a
certain amount of “bracket calculus” to manipulate these polynomials, and some
additional arguments are also needed to deal with the discontinuities at the edges
of the piecewise components of the nilmanifold. Another approach is to work with
randomly selected fundamental domains of the nilmanifold (cf. [20]) which eliminates topological obstructions, with the randomness being used to “average out”
the eﬀects of the boundary of the domain. While all three methods will eventually
work for the purposes of establishing the inverse conjecture, we believe that the
vector-valued approach introduces the least amount of artiﬁcial technicality.
By deﬁnition, every nilcharacter of degree d is a nilsequence of degree d. The
converse is far from being true; however, one can approximate nilsequences of degree
d as bounded linear combinations of nilcharacters of degree d. More precisely,
we have the following lemma.
Lemma 6.4. Let ψ ∈ Nild ([N ] → C) be a scalar nilsequence of degree d, and let
ε > 0 be standard. Then one can approximate ψ uniformly to error ε by a bounded
linear combination (over C) of the components of nilcharacters in Ξd ([N ]).
Proof. Unpacking the deﬁnitions, it suﬃces to show that for every degree d ﬁltered
nilmanifold G/Γ, every F ∈ Lip(∗ (G/Γ) → C), and every standard ε > 0, one can
approximate F uniformly to error ε by a bounded linear combination of functions in
the class F (G/Γ) of components of standard Lipschitz functions F ′ ∈ Lip(G/Γ →
S ω ) that have a vertical frequency in the sense of Deﬁnition 6.1.
By taking standard parts, we may assume that F is a standard Lipschitz function.
Observe that F (G/Γ) is closed under multiplication and complex conjugation. By
the Stone-Weierstrass theorem, it thus suﬃces to show that F (G/Γ) separates any
two distinct points x, y ∈ G/Γ. If x, y do not lie in the same orbit of the Gd ,
then this is clear from a partition of unity (taking η = 0). If instead x = gd y
for some gd ∈ Gd , then the distinctness of x, y forces gd ∈ Γd , and hence by
Pontryagin duality there exists a vertical frequency η with η(gd ) = 0. If one then
builds a nilcharacter with this frequency (by adapting the vector-valued smoothing
construction (6.3)) we obtain the claim.
We remark that this lemma can also be proven, with better quantitative bounds,
by Fourier-analytic methods: see [24, Lemma 3.7]. As a corollary of the lemma, we
have the following.
ω

Corollary 6.5. Suppose that f ∈ L∞ ([N ] → C ). Then f is d-biased if and only
if f correlates with a nilcharacter χ ∈ Ξd ([N ]).
It is easy to see that if χ, χ′ are two nilcharacters of degree d, then the tensor
product χ ⊗ χ′ and complex conjugate χ are also nilcharacters. If all nilcharacters
were scalar, this would mean that the space Ξd ([N ]) of degree d nilcharacters form
a multiplicative abelian group. Unfortunately, nilcharacters can be vector-valued,
and so this statement is not quite true. However, it becomes true if one only focuses
on the “top order” behaviour of a nilcharacter. To isolate this behaviour, we adopt
the following key deﬁnition.
Definition 6.6 (Symbol). Let d 0. Two nilcharacters χ, χ′ ∈ Ξd ([N ]) of degree
d are equivalent if χ⊗ χ′ is equal on [N ] to a nilsequence of degree d− 1. This can
be shown to be an equivalence relation (see Lemma E.7); the equivalence class of a

22

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

nilcharacter χ will be called the symbol of χ and is denoted [χ]Symbd ([N ]) . The space
of all such symbols will be denoted Symbd ([N ]); we will show later (see Lemma E.8)
that this is an abelian multiplicative group.
When d = 1, two nilcharacters n → e(αn+β) and n → e(α′ n+β ′ ) are equivalent
if and only if α − α′ is a limit integer, and Symb1 ([N ]) is just ∗ T in this case.
However, the situation is more complicated in higher degree. To get some feel for
this, consider two polynomial phases
χ : n → e(α0 + . . . + αd nd )
and
χ′ : n → e(α′0 + . . . + α′d nd )
with
∈ R, and consider the problem of determining when χ and
χ′ are equivalent nilcharacters of degree d. Certainly this is the case if αd and α′d
are equal, or diﬀer by a limit integer. When d 2, there are two further important
cases in which equivalence occurs. The ﬁrst is when α′d = αd + O(N −d ), because
in this case the top degree component e((αd − α′d )nd ) of χχ′ can be viewed as a
Lipschitz function of n/2N mod 1 (say) on [N ] and is thus a 1-step nilsequence.
The second is when α′d = αd + a/q for some standard rational q, since in this case
the top degree component e((αd − α′d )nd ) of χχ′ is periodic with period q and can
thus be viewed as a Lipschitz function of n/q mod 1 and is therefore again a 1-step
nilsequence. We can combine all these cases together, and observe that χ and χ′ are
equivalent when α′d = αd + a/q + O(N −d ) mod 1 for some standard rational a/q. It
is possible to use the quantitative equidistribution theory of nilmanifolds (see [24])
to show that these are in fact the only cases in which χ and χ′ are equivalent; this
is a variant of the classical theorem of Weyl that a polynomial sequence is (totally)
equidistributed modulo 1 if and only if at least one non-constant coeﬃcients is
irrational. In view of this, we see that Symbd ([N ]) contains ∗ R/(∗ Z + Q + N −d R)
as a subgroup, and the symbol of n → e(α0 + . . . + αd nd ) can be identiﬁed with
α0 , . . . , αd , α′0 , α′d

∗

αd mod 1, Q, O(N −d ) := α + ∗ Z + Q + N −d R.
However, the presence of bracket polynomials (suitably modiﬁed to avoid the
topological obstruction mentioned earlier) means that when d 2, that Symbd ([N ])
is somewhat larger than the above mentioned subgroup. We illustrate this with
the following (non-rigorous) discussion. Take d = 2 and consider two degree 2
nilcharacters χ, χ′ of the form
χ(n) ≈ e({αn}βn + γn2 )
and
χ′ (n) ≈ e({α′ n}β ′ n + γ ′ n2 )
for some α, β, γ, α′ , β ′ , γ ′ ∈ ∗ R, where we interpet the symbol ≈ loosely to mean
that χ, χ′ are suitable vector-valued smoothings of the indicated bracket phases, of
the type discussed earlier in this section. These may also involve some lower order
nilsequences of degree 1.
As before, we consider the question of determining those values of α, β, γ, α′ , β ′ , γ ′
for which χ and χ′ are equivalent. There are a number of fairly obvious ways in
which equivalence can occur. For instance, by modifying the previous arguments,
one can show that equivalence holds when α = α′ , β = β ′ , and γ − γ ′ is equal to
a limit integer, a standard rational, or is equal to O(N −2 ). Similarly, equivalence

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

23

occurs when β = β ′ , γ = γ ′ , and α − α′ is equal to a limit integer, a standard
rational, or is equal to O(N −1 ).
However, there are also some slightly less obvious ways in which equivalence
can occur. Observe that the expression e({αn}{βn}) is a Lipschitz function of the
fractional parts of αn and βn and is thus a (piecewise) nilsequence of degree 1 (and
will become a genuine nilsequence after one performs an appropriate vector-valued
smoothing). On the other hand, we have the obvious identity
e((αn − {αn})(βn − {βn})) = 1
since the exponent is the product of two (limit) integers. Expanding this out and
rearranging, we obtain the (slightly imprecise) relation
e({αn}βn) ≈ e(−{βn}αn + αβn2 )

(6.4)

where we again interpret ≈ loosely to mean “after a suitable vector-valued smoothing, and ignoring lower order factors”. This gives an additional route for χ and χ′
to be equivalent. A similar argument also gives the variant
1
e({αn}βn) ≈ e( αβn2 )
2
whenever α, β are commensurate in the sense that α/β is a standard rational. We
thus see that the notion of equivalence is in fact already somewhat complicated in
degree 2, and the situation only becomes worse in higher degree. One can describe
equivalence of bracket polynomials explicitly using bracket calculus, as developed
in [46] (see also the earlier works [3, 30, 31, 32]), but this requires a fair amount
of notation and machinery. Fortunately, in this paper we will be able to treat the
notion of a symbol abstractly, without requiring an explicit description of the space
Symbd ([N ]).
More general types of filtration. The notion of a one-dimensional polynomial n → α0 + . . . + αd nd of degree d can of course be generalised to higher
dimensions. For instance, we have the notion of a multidimensional polynomial
αi1 ,...,ik ni11 . . . nikd

(n1 , . . . , nk ) →
i1 ,...,ik 0:i1 +...+ik d

of degree
d. We also have the slightly diﬀerent notion of a multidimensional
polynomial
αi1 ,...,ik ni11 . . . nikd

(n1 , . . . , nk ) →
i1 ,...,ik 0:ij

dj

for

1 j k

of multidegree
(d1 , . . . , dk ) for some integers d1 , . . . , dk 0. We can unify these
two concepts into the notion of a multi-dimensional polynomial
αi1 ,...,ik ni11 . . . nikd

(n1 , . . . , nk ) →

(6.5)

(i1 ,...,ik )∈J

of multidegree ⊂ J for some ﬁnite downset J ⊂ Nk , i.e. a ﬁnite set of tuples
with the property that (i1 , . . . , ik ) ∈ J whenever (i1 , . . . , ik ) ∈ Nk and ij
i′j for
′
′
all j = 1, . . . , k for some (i1 , . . . , ik ) ∈ J. Thus for instance the two-dimensional
polynomial
(h, n) → αhn + βhn2 + γn3

24

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

for α, β, γ ∈ ∗ R is of multidegree ⊂ J for
J := {(0, 0), (0, 1), (0, 2), (0, 3), (1, 0), (1, 1), (1, 2)},
and is also of multidegree (1, 3) and of degree 3. (One can view the downset
J as a variant of the Newton polytope of the polynomial.)
In our subsequent arguments, we will need to similarly generalise the notion of a
one-dimensional nilcharacter n → χ(n) of degree d to a multidimensional nilcharacter (n1 , . . . , nk ) → χ(n1 , . . . , nk ) of degree d, of multidegree (d1 , . . . , dk ), or
of multidegree ⊂ J. We will deﬁne these concepts precisely in a short while, but
we mention for now that the polynomial phase
(h, n) → e(αhn + βhn2 + γn3 )
will be a two-dimensional nilcharacter of multidegree ⊂ J, multi-degree
(1, 3),
and degree 3 where J is as above. Moreover, variants of this phase, such as (a
suitable vector-valued smoothing of)
(h, n) → e({α1 h}α2 n + {{β1 n}β2 h}β3 n + {γ1 n2 }γ2 n),
will also have the same multidegree and degree as the preceding example.
The multidegree of a nilcharacter χ(n1 , . . . , nk ) is a more precise measurement
of the complexity of χ than the degree, because it separates the behaviour of the
diﬀerent variables n1 , . . . , nk . We will also need a diﬀerent reﬁnement of the notion of degree, this time for a one-dimensional nilcharacter n → χ(n), which now
separates the behaviour of diﬀerent top degree components of χ, according to their
“rank”. Heuristically, the rank of such a component is the number of fractional
part operations x → {x} that are needed to construct that component, plus one;
thus for instance
n → e(αn3 )
has degree 3 and rank 1,
n → e({αn2 }βn)
has degree 3 and rank 2 (after vector-valued smoothing),
n → e({{αn}βn}γn)
has degree 3 and rank 3 (after vector-valued smoothing), and so forth. We will then
need a notion of a nilcharacter χ of degree-rank
(d, r), which roughly speaking
means that all the components used to build χ either are of degree < d, or else are
of degree exactly d but rank at most r. Thus for instance,
n → e({αn}βn + γn3 )
has degree-rank

(3, 1) (after vector-valued smoothing), while
n → e({αn}βn + γn3 + {δn2 }ǫn)

has degree-rank

(3, 2) (after vector-valued smoothing), and
n → e({αn}βn + γn3 + {δn2 }ǫn + {{µn}νn}ρn)

has degree-rank (3, 3) (after vector-valued smoothing).
In order to make precise the notions of multidegree and degree-rank for nilcharacters, it is convenient to adopt an abstract formalism that uniﬁes degree, multidegree,
and degree-rank into a single theory. We need the following abstract deﬁnition.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

25

Definition 6.7 (Ordering). An ordering I = (I, ≺, +, 0) is a set I equipped with
a partial ordering ≺, a binary operation + : I × I → I, and a distinguished element
0 ∈ I with the following properties:
(i) The operation + is commutative and associative, and has 0 as the identity
element.
(ii) The partial ordering ≺ has 0 as the minimal element.
(iii) If i, j ∈ I are such that i ≺ j, then i + k ≺ j + k for all k ∈ I.
(iv) For every d ∈ I, the initial segment {i ∈ I : i ≺ d} is ﬁnite.
A finite downset in I is a ﬁnite subset J of I with the property that j ∈ J whenever
j ∈ I and j ≺ i for some i ∈ J.
In this paper, we will only need the following three speciﬁc orderings (with k a
standard positive integer):
(i) The degree ordering, in which I = N with the usual ordering, addition,
and zero element.
(ii) The multidegree ordering, in which I = Nk with the usual addition and
zero element, and with the product ordering, thus (i′1 , . . . , i′k ) (i1 , . . . , ik )
if i′j ij for all 1 j k.
(iii) The degree-rank ordering, in which I is the sector DR := {(d, r) ∈ N2 : 0
r d} with the usual addition and zero element, and the lexicographical
ordering, that is to say (d′ , r′ ) ≺ (d, r) if d′ < d or if d′ = d and r′ < r.
It is easy to verify that each of these three explicit orderings obeys the abstract
axioms in Deﬁnition 6.7. In the case of the degree or degree-rank orderings, I is
totally ordered (for instance, the ﬁrst few degree-ranks are (0, 0), (1, 0), (1, 1), (2, 0),
(2, 1), (2, 2), (3, 0), . . .), and so the only ﬁnite downsets are the initial segments.
For the multidegree ordering, however, the initial segments are not the only ﬁnite
downsets that can occur.
The one-dimensional notions of a ﬁltration, nilsequence, nilcharacter, and symbol can be easily generalised to arbitrary orderings. We give the bare deﬁnitions
here, and defer the more thorough treatment of these concepts to Appendix B and
Appendix E. We will however remark that when I is the degree ordering, then all
of the notions deﬁned below simplify to the one-dimensional counterparts deﬁned
earlier.
Definition 6.8 (Filtered group). Let I be an ordering and let G be a group. By
an I-filtration on G we mean a collection GI = (Gi )i∈I of subgroups indexed by I,
with the following properties:
(i) (Nesting) If i, j ∈ I are such that i ≺ j, then Gi ⊇ Gj .
(ii) (Commutators) For every i, j ∈ I, we have [Gi , Gj ] ⊆ Gi+j .
If d ∈ I, we say that G has degree
d if Gi is trivial whenever i
d. More
generally, if J is a downset in I, we say that G has degree ⊆ J if Gi is trivial
whenever i ∈ J.
Let us explicitly adapt the above abstract deﬁnitions to the three speciﬁc orderings mentioned earlier.
Definition 6.9. If (d1 , . . . , dk ) ∈ Nk , we deﬁne a nilpotent Lie group of multi-degree
(d1 , . . . , dk ) to be a nilpotent I-ﬁltered Lie group of degree (d1 , . . . , dk ), where
I = Nk is the multidegree ordering. Similarly, if J is a downset, deﬁne the notion
of a nilpotent Lie group of multidegree ⊆ J.

26

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

If (d, r) ∈ DR, deﬁne a nilpotent Lie group of degree-rank
(d, r) to be a
nilpotent DR-ﬁltered Lie group G of degree
(d, r), with the additional axioms
G(0,0) = G and G(d,0) = G(d,1) for all d 1.
We deﬁne the notion of a ﬁltered nilmanifold of multidegree
(d1 , . . . , dk ),
multidegree ⊆ J, or degree-rank (d, r) similarly.
Note that the degree-rank ﬁltration needs to obey some additional axioms, which
are needed in order for the rank r to play a non-trivial role. As such, the uniﬁcation
here of degree, multidegree, and degree-rank, is not quite perfect; however this
wrinkle is only of minor technical importance and should be largely ignored on a
ﬁrst reading.
Example 6.10. If G is a ﬁltered nilpotent group of multidegree (1, 1), then the
groups G(1,0) and G(0,1) must be abelian normal subgroups of G(0,0) , and their commutator [G(1,0) , G(0,1) ] must lie inside the group G(1,1) , which is a central subgroup
of G(0,0) .
If G is a ﬁltered nilpotent group of degree-rank
(d, d), then (G(i,0) )i 0 is a
N-ﬁltration of degree
d. But if we reduce the rank r to be strictly less than
d, then we obtain some additional relations between the G(i,0) that do not come
from the ﬁltration property. For instance, if G has degree-rank (3, 2), then the
group [G(1,0) , [G(1,0) , G(1,0) ]] must now be trivial; if G has degree-rank
(3, 1),
then the group [G(1,0) , G(2,0) ] must also be trivial. More generally, if G has degreerank
(d, r), then any iterated commutator of gi1 , . . . , gim with gj ∈ G(ij ,0) for
j = 1, . . . , m will be trivial whenever i1 + . . . + im > d, or if i1 + . . . + im = d and
m > r.
Example 6.11. If (Gi )i∈N is an N-ﬁltration of G of degree
k

d, then (G|i| )i∈Nk

k

is an N -ﬁltration of G of multidegree ⊂ {i ∈ N : |i|
d}, where we recall the
notational convention |(i1 , . . . , ik )| = i1 +. . .+ik . Conversely, if J is a ﬁnite downset
of Nk and (Gi )i∈Nk is a Nk -ﬁltration of G of multidegree ⊂ J, then




i:|i| i

Gi 

i∈N

is easily veriﬁed (using Lemma 3.1) to be an N-ﬁltration of degree
maxi∈J |i|,
where a∈A Ga is the group generated by a∈A Ga . In particular, any multidegree
(d1 , . . . , dk ) ﬁltration induces a degree d1 + . . . + dk ﬁltration.
In a similar spirit, every degree-rank
(d, r) ﬁltration (G(d′ ,r′ ) )(d′ ,r′ )∈DR of a
group G induces a degree
d ﬁltration (G(i,0) )i∈N . In the converse direction, if
(Gi )i∈N is a degree d ﬁltration of G with G = G0 , then we can create a degree-rank
(d, d) ﬁltration (G(d′ ,r′ ) )(d′ ,r′ )∈DR by setting G(d′ ,r′ ) to be the space generated
by all the iterated commutators of gi1 , . . . , gim with gj ∈ G(ij ,0) for j = 1, . . . , m
for which either i1 + . . . + im > d′ , or i1 + . . . + im = d and m max(r′ , 1); this
can easily be veriﬁed to indeed be a ﬁltration, thanks to Lemma 3.1.
Example 6.12. Let d
1 be a standard integer. We can give the unit circle
T the structure of a degree-rank ﬁltered nilmanifold of degree-rank
(d, 1) by
setting G = R and Γ = Z with G(d′ ,r′ ) := R for (d′ , r′ ) (d, 1) and G(d′ ,r′ ) := {0}
otherwise. This is also the ﬁltration obtained from the degree
d ﬁltration (see
Example 4.3) using the construction in Example 6.11.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

27

Example 6.13 (Products). If GI and G′I are I-ﬁltrations on groups G, G′ then we
can give the product G×G′ an I-ﬁltration in an obvious way by setting (G×G′ )i :=
Gi × G′i . The degree of G× G′ is the union of the degrees of G and G′ . Similarly the
product G1 /Γ1 × G2 /Γ2 of two I-ﬁltered nilmanifolds is an I-ﬁltered nilmanifold.
Example 6.14 (Pushforward and pullback). Let φ : G → H be a homomorphism
of groups. Then any any I-ﬁltration HI = (Hi )i∈I of H induces a pullback Ifiltration φ∗ HI := (φ−1 (Hi ))i∈I . Similarly, any I-ﬁltration GI = (Gi )i∈I on G
induces a pushforward I-filtration φ∗ GI := (φ(Gi ))i∈I on H. In particular, if Γ
is a subgroup of G, then we can pullback a ﬁltration GI = (Gi )i∈I of G by the
inclusion map ι : Γ ֒→ G to create the restriction ΓI := (Γi )i∈I of that ﬁltration.
It is a trivial matter to check that the subgroups of this ﬁltration are given by
Γi := Γ ∩ Gi .
Definition 6.15 (Filtered quotient space). A I-filtered quotient space is a quotient
G/Γ, where G is an I-ﬁltered group and Γ is a subgroup of G (with the induced
ﬁltration, see Example 6.14).
A I-filtered homomorphism φ : G/Γ → G′ /Γ′ between I-ﬁltered quotient spaces
is a group homomorphism φ : G → G′ which maps Γ to Γ′ , and also maps Gi to
G′i for all i ∈ I. Note that such a homomorphism descends to a map from G/Γ to
G′ /Γ′ .
If G is a nilpotent I-ﬁltered Lie group, and Γ is a discrete cocompact subgroup
of G which is rational with respect to GI (thus Γi := Γ ∩ Gi is cocompact in Gi for
each i ∈ I), we call G/Γ = (G/Γ, GI ) an I-filtered nilmanifold. We say that G/Γ
has degree d or ⊆ J of G has degree d or ⊆ J.
Example 6.16 (Subnilmanifolds). Let G/Γ be an I-ﬁltered nilmanifold of degree
⊂ J. If H is a rational subgroup of G, then H/(H ∩ Γ) is also a ﬁltered nilmanifold
degree ⊂ J (using Example 6.14), with an inclusion homomorphism from H/(H ∩Γ)
to G/Γ; we refer to H/(H ∩ Γ) as a subnilmanifold of G/Γ.
We isolate three important examples of a ﬁltered group, in which G is the additive
group Z or Zk .
Definition 6.17 (Basic ﬁltrations). We deﬁne the following ﬁltrations:
• The degree filtration ZkN on G = Zk , in which I = N is the degree ordering
and Gi = G for i 1 and Gi = {0} otherwise. In many cases k will equal
1 or 2.
• The multidegree filtration ZkNk on G = Zk , in which I = Nk is the multidegree ordering and G0 = Zk , Gei = ei , i = 1, . . . , k, and Gv = {0}
otherwise, with e1 , . . . , ek being the standard basis for Zk ;
• The degree-rank filtration ZDR on G = Z, in which I = DR is the degreerank ordering and G(0,0) = G(1,0) = Z and G(d,r) = {0} otherwise.
Definition 6.18 (Polynomial map). Suppose that H and G are I-ﬁltered groups
with H = (H, +) abelian4. Then for any map g : H → G we deﬁne the derivative
∂h g(n) := g(n + h)g(n)−1 .

(6.6)

We say that g : H → G is polynomial if
∂h1 . . . ∂hm g(n) ∈ Gi1 +···+im

(6.7)

4This is not actually a necessary assumption; see Appendix B. However, in the main body of
the paper we will only be concerned with polynomial maps on additive domains.

28

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

for all m
0, all i1 , . . . , im ∈ I and all hj ∈ Hij for j = 1, . . . , m, and for all
n ∈ H0 .
We denote by poly(HI → GI ) the space of all polynomial maps from HI to GI .
As usual, we use ∗ poly(HI → GI ) to denote the space of all limit polynomial maps
from ∗ HI to ∗ GI (i.e. ultralimits of polynomial maps in poly(HI → GI )).
Many facts about these spaces (in some generality) are established in Appendix
B where, in particular, a remarkable result essentially due to Lazard and Leibman
[42, 43, 44] is established: poly(HI → GI ) is a group. The material in Appendix B
is formulated in the general setting of abstract orderings I and for arbitrary (and
possibly non-abelian) groups HI , but for our applications we are only interested in
the special case when HI is Z or Zk with the degree, multidegree, or degree-rank
ﬁltration as deﬁned above.
Before moving on let us be quite explicit about what the notion of a polynomial
map is in each of the three cases, since the deﬁnitions take a certain amount of
unravelling.
• (Degree ﬁltration) If H = Zk with the degree ﬁltration ZkN , then poly(ZkN →
GN ) consists of maps g : Zk → G with the property that
∂h1 . . . ∂hm g(n) ∈ Gm
for all m 0, h1 , . . . , hm ∈ Z and all n ∈ G0 . This space is precisely the
same space as the one considered in [24, §6]. The space ∗ poly(Zk → GN )
is deﬁned similarly, except that g : ∗ Zk → ∗ G is now a limit map, and
all spaces such as Z and Gm need to be replaced by their ultrapowers.
(Similarly for the other two examples in this list.)
• (Multidegree ﬁltration) If H = Zk with the multidegree ﬁltration ZkNk ,
then poly(ZkNk → GNk ) consists of maps g : Zk → G with the property
that
∂ei1 . . . ∂eim g(n) ∈ Gei1 +···+eim
for all k ≥ 0, all i1 , . . . , im and all n ∈ Zk . To relate this space to the
analogous spaces for the degree ordering, observe (using Example 6.11)
that
poly(ZkN → (Gi )i∈N ) = poly(ZkNk → (G|i| )i∈Nk )
for any N-ﬁltration (Gi )i∈N , and conversely one has

poly(ZkNk
k

→ (Gi )i∈Nk ) ⊂

poly ZkN

→(

|i|=i



Gi )i∈N 

for any N -ﬁltration (Gi )i∈Nk . This is of course related to the obvious fact
that a polynomial of multidegree (d1 , . . . , dk ) is automatically of degree
d1 + . . . + dk .
• (Degree-rank ﬁltration) If H = Z with the degree-rank ﬁltration ZDR ,
poly(ZDR → GDR ) consists of maps g : Z → G with the property that
∂h1 . . . ∂hm g(n) ∈ G(m,0)
whenever m 0, h1 , . . . , hm ∈ Z and n ∈ G0 . We observe (using Example
6.11) the obvious equality
poly(ZDR → (G(d,r) )(d,r)∈DR ) = poly(ZN → (G(i,0) )i∈N )

(6.8)

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

29

for any DR-ﬁltration (G(d,r) )(d,r)∈DR . Thus, a degree-rank ﬁltration GDR
on G does not change the notion of a polynomial sequence, but instead
gives some ﬁner information on the group G (and in particular, it indicates
that certain iterated commutators of the G(d,r) vanish, which is information that cannot be discerned just from the knowledge that (G(i,0) )i∈N is
a N-ﬁltration).
Definition 6.19 (Nilsequences and nilcharacters). Let I be an ordering, and let
J be a ﬁnite downset in I. Let H be an abelian I-ﬁltered group. A (polynomial)
nilsequence of degree ⊂ J is any function of the form
χ(n) = F (g(n)∗ Γ),
where
• G/Γ = (G/Γ, GI ) is an I-ﬁltered nilpotent manifold of degree ⊂ J;
• g ∈ ∗ poly(HI → GI ) is a limit polynomial map from ∗ HI to ∗ GI ; and
ω
• F ∈ Lip(∗ (G/Γ) → C ).
The space of all such nilsequences will be denoted Nil⊂J (∗ H). We deﬁne the notion
of a nilsequence of degree d for some d ∈ I, and the space Nil d (∗ H), similarly.
If Ω is a limit subset of ∗ H, the restriction of the nilsequences in Nil⊂J (∗ H) to Ω
will be denoted Nil⊂J (Ω), and we deﬁne Nil d (Ω) similarly.
We refer to the map n → g(n)∗ Γ as a limit polynomial orbit in G/Γ, and denote
the space of such orbits as ∗ poly(HI → (G/Γ)I ).
Suppose that d ∈ I. Then χ is said to be a degree d nilcharacter if χ is a degree
d nilsequence with the following additional properties:
• F ∈ Lip(∗ (G/Γ) → S ω ) (thus |F | = 1) and
• F (gd x) = e(η(gd ))F (x) for all x ∈ G/Γ and gd ∈ Gd , where η : Gd → R is
a continuous standard homomorphism which maps Γd to the integers. We
call η the vertical frequency of F .
The space of all degree d nilcharacters on ∗ H will be denoted Ξd (∗ H). If Ω is a limit
subset of ∗ H, the restriction of the nilcharacters in Ξd (∗ H) to Ω will be denoted
Ξd (Ω).
With the multidegree ordering, a degree (d1 , . . . , dk ) nilcharacter will be referred to as a multidegree (d1 , . . . , dk ) nilcharacter, and the space of such charac(d1 ,...,dk )
ters on Ω denoted ΞMulti
(Ω); we similarly write Nil⊂J (Ω) or Nil (d1 ,...,dk ) (Ω) as
(d1 ,...,dk )
Nil⊂J
(Ω) for emphasis.
Multi (Ω) or Nil
Similarly, with the degree-rank ordering, and assuming G/Γ is a ﬁltered nilmanifold of degree-rank
(d, r) (so in particular, we enforce the axioms G(0,0) = G
and G(d,0) = G(d,1) ), a degree (d, r) nilcharacter will be referred to as a degreerank (d, r) nilcharacter. The space of nilcharacters on Ω of degree-rank (d, r) will
(d1 ,d2 )
(d,r)
(Ω) of twobe denoted ΞDR (Ω) (note that this is distinct from the space ΞMulti
dimensional nilcharacters of multidegree (d1 , d2 )), and the nilsequences on Ω of
(d,r)
degree-rank (d, r) will similarly be denoted NilDR (Ω).
Example 6.20. Let J ⊂ Nk be a ﬁnite downset. Then any sequence of the form


(n1 , . . . , nk ) → F 

(i1 ,...,ik )∈J

αi1 ,...,ik ni11 . . . nikk mod 1 ,

30

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER
ω

where αi1 ,...,ik ∈ ∗ R and F ∈ Lip(∗ T → C ), is a nilsequence on Zk of multidegree
⊆ J, as can easily be seen by giving G := R the Zk -ﬁltration Gi := R for i ∈ J and
Gi := {0} otherwise, and setting Γ := Z and g ∈ ∗ poly(Zk → R) to be the limit
polynomial n → (i1 ,...,ik )∈J αi1 ,...,ik ni11 . . . nikk .
For similar reasons, any sequence of the form


(n1 , . . . , nk ) → e 

(i1 ,...,ik )∈Nk :i1 +...+ik d

αi1 ,...,ik ni11 . . . nikk mod 1 ,

is a degree d nilcharacter on Zk of degree d, and any sequence of the form


(n1 , . . . , nk ) → e 

(i1 ,...,ik )∈Nk :ij

dj

for

j=1,...,k

is a multidegree (d1 , . . . , dk ) nilcharacter on Zk .

αi1 ,...,ik ni11 . . . nikk mod 1 ,

Example 6.21. Any degree 2 nilsequence of magnitude 1 is automatically a degreerank
(3, 0) nilcharacter, since every degree
2 nilmanifold is automatically a
degree-rank (2, 2) nilmanifold, which can then converted trivially to a degree-rank
(3, 0) nilmanifold (with a trivial group G(3,0) ). Thus for instance for α, β ∈ R,
n → e({αn}βn)
is nearly a degree-rank (3, 0) nilcharacter, and becomes a genuine degree-rank (3, 0)
nilcharacter after vector-valued smoothing.
If α ∈ ∗ R, then the sequence
n → e(αn3 )
is a degree-rank (3, 1) nilcharacter. Indeed, we can give G = R a degree-rank
(3, 1) ﬁltration GDR by setting G(d,r) := R for (d, r) (3, 1), and G(d,r) := {0}
otherwise.
Next, if α, β ∈ ∗ R, then the sequence
n → e({αn2 }βn)

(6.9)

is nearly a degree-rank (3, 2) nilcharacter (and becomes a genuinely so after vectorvalued smoothing). To see this, let G be the Heisenberg nilpotent group (6.1),
which we give the following degree-rank ﬁltration:
G(0,0) = G(1,0) = G(1,1) := G
G(2,0) = G(2,1) := e1 , [e1 , e2 ]
G(2,2) = G(3,0) = G(3,1) = G(3,2) := [e1 , e2 ]

R

R

= {et11 [e1 , e2 ]t12 : t1 , t12 ∈ R}

= {[e1 , e2 ]t12 : t12 ∈ R}

G(d,r) := {id} for all other (d, r) ∈ DR.
One easily veriﬁes that this is a degree-rank
(3, 2) ﬁltration. If we then set
βn αn2
∗
∗
g : Z → G to be the limit sequence g(n) := e2 e1 , one easily veriﬁes that g is
a limit polynomial with respect to this degree-rank ﬁltration. If one then lets F be
the piecewise Lipschitz function (6.2), then we see that
F (g(n)∗ Γ) = e({αn2 }βn)
and so we see that n → e({αn2 }βn) is a indeed piecewise degree-rank (3, 2) nilcharacter.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

31

A similar argument (using the free 3-step nilpotent manifold on three generators,
which has degree 3 and hence degree-rank (3, 3)) shows that
n → e({{αn}βn}γn)
is nearly a degree-rank (3, 3) nilcharacter, and becomes a genuine degree-rank (3, 3)
nilcharacter after applying vector-valued smoothing; see [28, Appendix E] for the
relevant calculations.
These examples should help illustrate the heuristic that a degree-rank (d, r)
nilcharacter is built up using (suitable vector-valued smoothings of) bracket monomials which either have degree less than d, or have degree exactly d and involve at
most r − 1 applications of the fractional part operation.
We observe (using Example 6.11) the following obvious inclusions:
(i) A multidegree (d1 , . . . , dk ) nilsequence on Zk is automatically a degree
d1 + . . . + dk nilsequence.
(ii) A multidegree (d1 , . . . , dk ) nilcharacter on Zk is automatically a degree
d1 + . . . + dk nilcharacter.
(iii) A multidegree (d1 , . . . , dk−1 , 0) nilsequence on Zk is constant in the nk
variable, and descends to a multidegree (d1 , . . . , dk−1 ) nilsequence on Zk−1 .
(iv) A degree-rank
(d, r) nilsequence on Z is automatically a degree
d
nilsequence.
(v) A degree
d nilsequence on Z is automatically a degree-rank
(d, d)
nilsequence.
(vi) A degree d nilcharacter on Z is automatically a degree-rank
(d, d)
nilcharacter.
It is not quite true, though, that a degree-rank (d, r) nilcharacter is a degree d
nilcharacter if r > 1, because the former need not exhibit vertical frequency behaviour for degree-ranks (d, r′ ) with r′ < r.
Definition 6.22 (Equivalence and symbols). Let H be an I-ﬁltered group, let
d ∈ I, and let Ω be a limit subset of ∗ H. Two nilcharacters χ, χ′ ∈ Ξd (Ω) are
said to be equivalent if χ ⊗ χ′ is a nilsequence of degree strictly less than d. Write
[χ]Symbd (Ω) for the equivalence class of χ with respect to this relation; this we shall
refer to as the symbol of χ. Write Symbd (Ω) for the space of all such equivalence
classes.
(d ,...,d )

(d ,...,d )

1
1
k
k
We write SymbMulti
(Ω) for the symbols of nilcharacters χ ∈ ΞMulti
(Ω)
(d,r)
of multidegree (d1 , . . . , dk ), and SymbDR (Ω) for the symbols of nilcharacters χ ∈
(d,r)
ΞDR (Ω) of degree-rank (d, r). The basic properties of such symbols are set out in
Appendix E.

7. A more detailed outline of the argument
Now that we have set up the notation to describe nilcharacters and their symbols,
we are ready to give a high-level proof of Conjecture 5.5 (and hence Theorem 1.3),
contingent on some key sub-theorems which will be proven in later sections. This
corresponds to the realisation of points (i), (ii) and (ix) from the overview in §2.
As the cases s = 1, 2 of this conjecture are already known, we assume that s 3.
We also assume inductively that the claim has already been proven for smaller
values of s. Henceforth s is ﬁxed.

32

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Let f ∈ L∞ [N ] be such that
f

U s+1 [N ]

≫ 1.

(7.1)

Deﬁne f to be zero outside of [N ]. Raising (7.1) to the power 2
Eh∈[[N ]] ∆h f

2s
U s [N ]

s+1

, we see that

≫1

and thus
∆h f U s [N ] ≫ 1
for all h in a dense subset H of [[N ]]. Applying the inductive hypothesis, we thus
see that ∆h f is (s − 1)-biased for all h ∈ H.
By deﬁnition, we now know that ∆h f correlates with a nilsequence of degree (s−
1). By Lemma 6.5, we see that for each h ∈ H, ∆h f correlates with a nilcharacter
χh ∈ Ξs−1 ([N ]). It is not hard to see that the space of such nilcharacters is a
σ-limit set (see Deﬁnition A.10), so by Lemma A.12 we can ensure that χh depends
in a limit fashion on h.
The aim at this point is to obtain, in several stages, information about the
dependence of χh on h. A key milestone in this analysis is a linearisation of χh on
h. In the case s = 2, treated in [16, 21], the χh (n) were essentially just linear phases
e(ξh n), and the outcome of the linearisation analysis was that the frequencies ξh
may be assumed to vary in a bracket-linear fashion with h. In the case s = 3
(treated in [28] but also dealt with in our present work), a model special case
occurs when χh (n) ≈ e({αh n}βh n) (interpreting ≈ loosely). The outcome of the
linearisation analysis in that case was that at most one of αh , βh really depends on
h, and furthermore that this dependence on h is bracket-linear in nature.
Now we formally set out the general case of this linearisation process.
Theorem 7.1 (Linearisation). Let f ∈ L∞ [N ], let H be a dense subset of [[N ]],
and let (χh )h∈H be a family of nilcharacters in Ξs−1 ([N ]) depending in a limit
fashion on h, such that ∆h f correlates with χh for all h ∈ H. Then there exists a
(1,s−1)
multidegree (1, s−1)-nilcharacter χ ∈ ΞMulti (∗ Z2 ) such that ∆h f (s−2)-correlates
with χ(h, ·) for many h ∈ H.
This statement represents the outcome of points (iii) to (vii) of the outline in §2
and must therefore address the following points:
• For some suitable notion of “frequency”, the symbol of χh (n) contains only
one frequency that genuinely depends on h;
• That frequency depends on h in a bracket-linear manner;
• Once this is known, it follows that, for many h, ∆h f (s− 2)-correlates with
χ(h, n), where χ is a certain 2-variable nilsequence.
These three tasks are, in fact, established together and in an incremental fashion.
The nilcharacter χh (n) is gradually replaced by objects of the form χ′ (h, n) ⊗ χ′h (n)
where χ′ (h, n) is a 2-dimensional nilcharacter of multidegree (1, s − 1) and, at each
stage, the nilcharacter χ′h (n) (which has so far not been shown to vary in any
nice way with h) is “simpler” than χh (n). The notion of simpler in this context
is measured by the degree-rank ﬁltration, a concept that was introduced in the
previous section. Thus the result of a single pass over the three points listed above
is the following subclaim.
Theorem 7.2 (Linearisation, inductive step). Let 1 r∗ s − 1, let f ∈ L∞ [N ],
(1,s−1)
let H be a dense subset of [[N ]], let χ ∈ ΞMulti (∗ Z2 ), let (χh )h∈H be a family of

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

33

nilcharacters of degree-rank (s − 1, r∗ ) depending in a limit fashion on h, such that
∆h f (s − 2)-correlates with χ(h, ·) ⊗ χh for all h ∈ H. Then there exists a dense
(1,s−1)
subset H ′ of H, a multidegree (1, s−1)-nilcharacter χ′ ∈ ΞMulti (∗ Z2 ) and a family
(χ′h )h∈H of nilcharacters of degree-rank (s − 1, r∗ − 1) depending in a limit fashion
on h, such that ∆h f (s − 2)-correlates with χ′ (h, ·) ⊗ χ′h for all h ∈ H ′ .
Theorem 7.1 follows easily by inductive use of this statement, starting with r∗
equal to s − 1 and using Theorem 7.2 iteratively to decrease r∗ all the way to zero.
To prove Theorem 7.2, we follow steps (iii) to (vii) in the outline quite closely.
The ﬁrst step, which is the realisation of (iii), is a Gowers-style Cauchy-Schwarz
inequality to eliminate the function f as well as the 2-dimensional nilcharacter
χ(h, n) and therefore obtain a statement concerning only the (so far) unstructuredin-h object χh (n). Here is a precise statement of the outcome of this procedure;
the proof of this proposition is the main business of §8.
Proposition 7.3 (Gowers Cauchy-Schwarz argument). Let f, H, χ, (χh )h∈H be as
in Theorem 7.2. Then the sequence
n → χh1 (n) ⊗ χh2 (n + h1 − h4 ) ⊗ χh3 (n) ⊗ χh4 (n + h1 − h4 )

(7.2)

is (s − 2)-biased for many additive quadruples (h1 , h2 , h3 , h4 ) in H.
With this in hand, we reach the most complicated part of the argument. This
is the use of Proposition 7.3 to study the “frequencies” of the nilcharacters χh and
the way they depend on h. Roughly speaking, the aim is to interpret the tensor
product (7.2) as a nilsequence itself (depending on h1 , h2 , h3 , h4 ) and use results
from [24] to analyse its equidistribution and bias properties.
To make proper sense of this one must ﬁrst ﬁnd a suitable “representation”
of the χh (n) in which the frequencies are either independent of h, depend in a
bracket-linear fashion on h, or are appropriately dissociated in h, in the sense that
the frequencies associated to (7.2) are “linearly independent” for most additive
quadruples h1 + h2 = h3 + h4 . This task is one of the more technical part of the
papers and is performed in in §10; it incorporates the additive combinatorial step
(vi) of the outline from §2. The precise statement of what we prove is Lemma 10.10,
the “sunﬂower decomposition”.
The representation of the χh (and hence of (7.2)) involves constructing a suit˜ this
able polynomial orbit on something resembling a free nilpotent Lie group G;
device also featured in [28, §5]. Once this is done, one applies the results from [24]
to examine the orbit of this polynomial sequence on the corresponding nilmanifold
˜ Γ.
˜ The results of [24] assert (roughly speaking) that this orbit is close to the
G/
˜ Γ,
˜ where H
˜ is some closed subuniform measure on a subnilmanifold H Γ/
G
group. In §11, we then crucially apply a commutator argument of Furstenberg and
Weiss that exploits some equidistribution information on projections of H to say
something about this group H. The upshot of this critical phase of the argument is
that the h-dependence of the frequencies of χh cannot be dissociated in nature, and
must instead be completely bracket-linear; the precise statement here is Theorem
11.1.
At this point in the argument, we have basically shown that the top-order behaviour (in the degree-rank order) of the nilcharacters χh (n) is bracket-linear in
h. To complete the proof of Theorem 7.2 (and hence of Theorem 7.1) it remains
to carry out part (vii) of the outline, that is to say to interpret this bracket-linear

34

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

part of χh (n) as a multidegree (1, s − 1) nilcharacter χ′ (h, n). This is the ﬁrst part
of the argument where some sort of “degree s nil-object” is actually constructed,
and is thus a key milestone in the inductive derivation of GI(s) from GI(s − 1).
As remarked previously, our construction here is a little more conceptual (and abstractly algebraic) than in previous works, which have been somewhat ad hoc. The
construction is given in §12. At the end of that section we wrap up the proof of
Theorem 7.1: by this point, all the hard work has been done.
With Theorem 7.1 in hand, we have completed the ﬁrst seven steps of the outline.
The only remaining substantial step is step (viii), the symmetry argument. Here is
a formal statement of it:
Theorem 7.4 (Symmetrisation). Let f ∈ L∞ [N ], let H be a dense subset of [[N ]],
(1,s−1)
and let χ ∈ ΞMulti (∗ Z2 ) be such that ∆h f < s − 2-correlates with χ(h, ·) for all
h ∈ H. Then there exists a nilcharacter Θ ∈ Ξs (∗ Z) (with the degree filtration) and
∗ 2
2
a nilsequence Ψ ∈ Nil⊂J
Multi ( Z ), with J ⊂ N given by the downset
J := {(i, j) ∈ N2 : i + j

s − 1} ∪ {(i, s − i) : 2

i

s},

(7.3)

such that χ(h, n) is a bounded linear combination of Θ(n + h) ⊗ Θ(n) ⊗ Ψ(h, n).
The proof is given in §13. Informally, this theorem asserts that the multidimensional degree (1, s − 1) nilcharacter χ(h, n) can be expressed as a derivative
Θ(n + h) ⊗ Θ(n) of a degree s nilcharacter Θ, modulo “lower order terms”, which
in this context means multidimensional nilsequences Ψ(h, n) that either have total
degree s − 1, or are of degree at most s − 2 in the n variable.
The remaining task for this section is to show how to complete the proof of
Conjecture 5.3 (and Theorem 1.3) from this point. From the discussion at the
beginning of this section, we have already arrived at a situation in which the given
function f ∈ L∞ [N ] has the property that ∆h f correlates with χh for all h in a
dense subset H of [[N ]], where (χh )h∈H be a family of nilcharacters in Ξs−1 ([N ])
depending in a limit fashion on h.
From Theorem 7.1 and Theorem 7.4 we see that for many h ∈ [[N ]], ∆h f s−2correlates with the sequence
n → Θ(n + h) ⊗ Θ(n) ⊗ Ψ(h, n).
The next step is to break up J and Ψ into simpler components, and our tool for this
purpose shall be Lemma E.4. Applying this lemma for ε suﬃciently small, followed
by the pigeonhole principle, one can thus ﬁnd scalar-valued nilsequences ψ, ψ ′ on
∗ 2
Z (with the multidegree ﬁltration) of multidegree
⊂ {(i, 0) ∈ N2 : i

s − 1}

and
⊂ {(i, j) ∈ N2 : i s − 2; i + j s}
respectively, such that for many h ∈ [[N ]], ∆h f (s − 2)-correlates with
n → Θ(n + h) ⊗ Θ(n)ψ(h, n)ψ ′ (h, n).
For ﬁxed h, the nilsequence ψ ′ (h, n) has degree s − 2 and can thus be ignored.
Also, ψ(h, n) = ψ(n) is of multidegree
(s − 1, 0) and is thus independent of h,
with n → ψ(n) being a degree s − 1 nilsequence. Thus, for many h ∈ [[N ]], ∆h f
s − 2-correlates with
n → Θ(n + h) ⊗ Θ(n)ψ(n).

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

35

Applying the pigeonhole principle again, we can thus ﬁnd scalar nilsequences θ, θ′ ∈
Nil s (∗ Z) such that for many h ∈ [[N ]], ∆h f (s − 2)-correlates with
n → θ(n + h)θ′ (n)
(indeed one takes θ, θ′ to be coeﬃcients of Θ and Θψ respectively). Applying the
converse to GI(s) (Proposition 5.6), we conclude
f θ(· + h)f θ′ (·)

U s−1 [N ]

≫1

for many h ∈ H. Averaging over h (using Corollary A.6 to obtain the required
uniformity), we conclude that
Eh∈[[N ]] f θ(· + h)f θ′ (·)

2s−1
U s−1 [N ]

≫ 1.

Applying the Cauchy-Schwarz-Gowers inequality (see e.g. [57, Equation (11.6)]) we
conclude that
f θ U s [N ] ≫ 1
and hence by the inductive hypothesis (Conjecture 5.5 for s − 1), f θ is (s − 1)biased. Since θ is a degree
s nilsequence, we conclude that f is
s-biased, as
required. This concludes the proof of Conjecture 5.5, Conjecture 5.3, and hence
Theorem 1.3, contingent on Theorem 7.1 and Theorem 7.4.
8. A variant of Gowers’s Cauchy-Schwarz argument
The aim of this section is prove Proposition 7.3. Thus, we have standard integers
1 r∗ s − 1, a function f ∈ L∞ [N ], a dense subset H of [[N ]], a two-dimensional
(1,s−1)
nilcharacter χ ∈ ΞMulti (∗ Z2 ) of multidegree (1, s − 1), and a family (χh )h∈H of
nilcharacters of degree-rank (s − 1, r∗ ) depending in a limit fashion on h. We are
given that ∆h f (s − 2)-correlates with χ(h, ·) ⊗ χh for all h ∈ H. Our objective is
to show that, for many additive quadruples (h1 , h2 , h3 , h4 ) in H, the expression
n → χh1 (n) ⊗ χh2 (n + h1 − h4 ) ⊗ χh3 (n) ⊗ χh4 (n + h1 − h4 )

(8.1)

(where we extend the χh by zero outside of [N ]) is (s − 2)-biased.
The strategy, following the work of Gowers [16], is to start with the
s − 2correlation between ∆h f and χ(h, ·)χh and then apply the Cauchy-Schwarz inequality repeatedly to eliminate all terms involving f , χ(h, ·), ﬁnally arriving at a
correlation statement that only involves χh (and lower order terms).
Unfortunately, there is a technical issue that prevents one from doing this directly, namely that the behaviour of χ(h, ·) in h is not quite linear enough to ensure
that these terms are completely eliminated by a Cauchy-Schwarz procedure. In
order to overcome this issue, one must ﬁrst prepare χ into a better form, as follows. We need the following technical notion (which will not be used outside of this
section):
ω

Definition 8.1. A linearised (1, s − 1)-function is a limit function χ : (h, n) → C
which has a factorisation
χ(h, n) = c(n)h ψ(n)
(8.2)
ω

where ψ ∈ L∞ (Z → C ) and c ∈ L∞ (Z → S 1 ) are such that, for every h, l ∈ Z, the
sequence
n → c(n − l)h c(n)
is a degree

s − 2 nilsequence.

h

36

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Remark 8.2. Heuristically, one should think of a linearised (1, s − 1)-function as
(a vector-valued smoothing of) a function of the form
(h, n) → e(P (n) + hQ(n))
where P, Q are bracket polynomials of degree s − 1; for instance,
(h, n) → e({αn}βn + {γn}δnh)
is morally a linearised (1, 2) function. This should be compared with more general
multidegree (1, 2) nilcharacters, such as
(h, n) → e({{αh}βn}γn)
which are not quite linear in h because the dependence on h is buried inside one or
more fractional part operations. Intuitively, the point is that one can use the laws
of bracket algebra (such as (6.4)) to move the h outside of all the fractional part
expressions (modulo lower order terms). While one can indeed develop enough of
the machinery of bracket calculus to realise this intuition concretely, we will instead
proceed by the more abstract machinery of nilmanifolds in order to avoid having
to set up the bracket calculus.
The key preparation for this is the following.
(1,s−1)

Proposition 8.3. Let χ ∈ ΞMulti (∗ Z2 ) be a two-dimensional nilcharacter of multidegree (1, s − 1), and let ε > 0 be standard. Then one can approximate χ to within
ε in the uniform norm by a bounded linear combination of linearised (1, s − 1)functions.
Proof. From Deﬁnition 6.1, we can express
χ(h, n) = F (g(h, n)∗ Γ)
where G/Γ is a N2 -ﬁltered nilmanifold of multidegree (1, s − 1), g ∈ ∗ poly(Z2N2 →
GN2 ) (with Z2 being given the multidegree ﬁltration Z2N2 ), and F ∈ Lip(∗ (G/Γ) →
S ω ) has a vertical frequency η : G(1,s−1) → R.
We consider the quotient map π : G/Γ → G/(G(1,0) Γ) from G/Γ onto the nilmanifold G/(G(1,0) Γ), which can be viewed as an N-ﬁltered nilmanifold of degree
s − 1 (where we N-ﬁlter G/G(1,0) using the subgroups G(0,i) G(1,0) /G(1,0) ). The
ﬁbers of this map are isomorphic to T := G(1,0) /Γ(1,0) . Observe that G(1,0) is
abelian, and so T is a torus; thus G/Γ is a torus bundle over G/(G(1,0) Γ) with
structure group T . The idea is to perform Fourier analysis on this large torus T ,
as opposed to the smaller torus G(1,s−1) /Γ(1,s−1) , to improve the behaviour of the
nilcharacter χ.
We pick a metric on the base nilmanifold G/(G(1,0) Γ) and a small standard
K
radius δ > 0, and form a smooth partition of unity 1 = k=1 ϕk on G/(G(1,0) Γ),
where each ϕk ∈ Lip(G/(G(1,0) Γ) → C) is supported on an open ball Bk of radius
r. This induces a partition χ = K
˜k , where
k=1 χ
χ
˜k (h, n) = F (g(h, n)∗ Γ)ϕk (π(g(h, n)∗ Γ)).
Now ﬁx one of the k. Then we have
χ
˜k (h, n) = F˜k (g(h, n)∗ Γ)
where F˜k is compactly supported in the cylinder π −1 (Bk ).

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

37

If r is small enough, we have a smooth section ι : Bk → G that partially inverts
the projection from G to G/(G(1,0) Γ), and so we can parameterise any element x
of π −1 (Bk ) uniquely as ι(x0 )tΓ for some x0 ∈ Bk and t ∈ T (noting that tΓ is
well-deﬁned as an element of G/Γ). Similarly, we can parameterise any element of
∗ −1
π (Bk ) uniquely as ι(x0 )tΓ for x0 ∈ ∗ Bk and t ∈ ∗ T .
We can now view the Lipschitz function Fk ∈ Lip(∗ (G/Γ)) as a compactly
supported Lipschitz function in Lip(∗ (Bk × T )). Applying a Fourier (or StoneWeierstrass) decomposition in the T directions (cf. Lemma E.5), we thus see that
for any standard ε > 0 we can approximate F˜k uniformly to error ε/K by a sum
K′
∗
′
˜
k′ =1 Fk,k′ , where K is standard and each Fk,k′ ∈ Lip( (Bk × T )) is compactly
supported and has a character ξk′ : T → T such that
F˜k,k′ (ι(x0 )tΓ) = e(ξk′ (t))F˜k,k′ (ι(x0 )Γ)

(8.3)

for all x0 ∈ ∗ (2Bk ) and t ∈ ∗ T . It thus suﬃces to show that for each k, k ′ , the
sequence
χ
˜k,k′ : (h, n) → F˜k,k′ (g(h, n)∗ Γ)
is a linearised (1, s − 1)-function.
Fix k, k ′ . Performing a Taylor expansion (Lemma B.9) of the polynomial sequence g ∈ ∗ poly(Z2N2 → GN2 ), we may write
g(h, n) = g0 (n)g1 (n)h
where g0 ∈ ∗ poly(ZN → GN ) is a one-dimensional polynomial map (giving G
the N-ﬁltration GN := (G(i,0) )i∈N ), and g1 ∈ ∗ poly(Z → (G(1,0) )N ) is another
one-dimensional polynomial map (giving the abelian group G(1,0) the N-ﬁltration
(G(1,0) )N := (G(1,i) )i∈N ). In particular, we see that χ
˜k,k′ (h, n) is only non-vanishing
when π(g0 (n)∗ Γ) ∈ B. Furthermore, in that case we see from (8.3) that
χ
˜k,k′ (h, n) = e(hξ(g1 (n) mod Γ(1,0) ))F˜k,k′ (g0 (n)∗ Γ),

(8.4)

which gives the required factorisation (8.2) with c(n) := e(ξ(g1 (n) mod Γ(1,0) )) and
ψ(n) := F˜k,k′ (g0 (n)∗ Γ).
The only remaining task is to establish that for any given h, l, the sequence
h
n → c(n − l)h c(n) is a degree s − 2 nilsequence. We expand this sequence as
n → e(h(ξ(g1 (n − l) mod Γ(1,0) ) − ξ(g1 (n) mod Γ(1,0) )))
But from the abelian nature of G(1,0) , the map n → ξ(g1 (n) mod Γ(1,0) ) is a polynomial map from ∗ Z to ∗ T of degree at most s − 1, and the claim follows.
We now return to the proof of Theorem 7.3. With this multiplicative structure,
we can now begin the Cauchy-Schwarz argument. By hypothesis, for each h ∈ H
we can ﬁnd a scalar nilsequence ψh of degree s − 2 such that
|En∈[N ] ∆h f (n)χ(h, n) ⊗ χh (n)ψh (n)| ≫ 1.
By Corollary A.12, we may ensure that ψh varies in a limit fashion on h. Applying
Corollary A.6, this lower bound is uniform in h.
Applying Proposition 8.3 (with a suﬃciently small ε) and using the pigeonhole
principle, we may then ﬁnd a linearised (1, s − 1)-function (h, n) → c(n)h ψ(n) such
that
|En∈[N ] ∆h f (n)c(n)−h ψ(n) ⊗ χh (n)ψh (n)| ≫ 1.

38

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

By Corollary A.6 again, the lower bound is still uniform in h. We may then average
in h (extending ψh , χh by zero for h outside of H) and conclude that
Eh∈[[N ]] |En∈[N ] ∆h f (n)c(n)−h ψ(n) ⊗ χh (n)ψh (n)| ≫ 1,
thus there exists a scalar function b ∈ L∞ [[N ]] such that
|Eh∈[[N ]] En∈[N ] b(h)f (n + h)f (n)c(n)−h ψ(n) ⊗ χh (n)ψh (n)| ≫ 1.
By absorbing b(h) into the ψh factor, we may now drop the b(h) factor. We write
n + h = m and obtain
|Em∈[N ] f (m)Eh∈[[N ]] c(m − h)−h f ′ (m − h) ⊗ χh (m − h)ψh (m − h)| ≫ 1
where f ′ := f ψ (recall that f is extended by zero outside of [N ]), which by CauchySchwarz implies that
′

|Em∈[N ] Eh,h′ ∈[[N ]] c(m − h)−h c(m − h′ )h f ′ (m − h) ⊗ f (m − h′ )
⊗χh (m − h) ⊗ χh′ (m − h′ )ψh (m − h)ψh′ (m − h′ )| ≫ 1.
Making the change of variables h′ = h + l, n = m − h, we obtain
|Eh,l∈[[2N ]];n∈[N ]c(n)−h c(n − l)h+l f ′ (n) ⊗ f ′ (n − l)
⊗χh (n) ⊗ χh+l (n − l)ψh (n)ψh+l (n − l)| ≫ 1.
We then simplify this as
|Eh,l∈[[2N ]];n∈[N ]c2 (l, n) ⊗ χh (n) ⊗ χh+l (n − l)ψh,l (n)| ≫ 1

(8.5)

where
c2 (l, n) := c(n − l)l f ′ (n) ⊗ f ′ (n − l)
ψh,l (n) = c(n − l)h c(n)−h ψh (n)ψh+l (n − l)
Clearly c2 is bounded. As for ψh,l , we see from Deﬁnition 8.1 and Corollary E.2
that ψh,l is a nilsequence of degree s − 2 for each h, l.
Returning to (8.5), we use the pigeonhole principle to conclude that for many
k ∈ [[2N ]], we have
|Eh∈[[2N ]];n∈[N ]c2 (k, n) ⊗ χh (n) ⊗ χh+k (n − k)ψh,k (n)| ≫ 1.
Let k be such that the above estimate holds. Applying Cauchy-Schwarz in the n
variable to eliminate the c2 (k, n) term, we have
|Eh,h′ ∈[[2N ]];n∈[N ]χh (n) ⊗ χh+k (n − k) ⊗ χh′ (n) ⊗ χh′ +k (n − k)ψh,k (n)| ≫ 1
and thus for many k, h, h′ ∈ [[2N ]], we have
|En∈[N ] χh (n) ⊗ χh+k (n − k) ⊗ χh′ (n) ⊗ χh′ +k (n − k)ψh,k (n)| ≫ 1,
which implies that
n → χh (n) ⊗ χh+k (n − k) ⊗ χh′ (n) ⊗ χh′ +k (n − k)
is (s − 2)-biased on [N ]. Note that this forces h, h + k, h′ , h′ + k to be an additive quadruple in H, as otherwise the expression vanishes. Applying a change of
variables, we obtain Proposition 7.3.
For future reference we observe that a simpler version of the same argument (in
which the χ and ψh factors are not present) gives

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

39

Proposition 8.4 (Cauchy-Schwarz). Let f ∈ L∞ [N ], let H be a dense subset of
[[N ]], and suppose that one has a family of functions χh ∈ L∞ (∗ Z) depending in a
limit fashion on h, such that ∆h f correlates with χh on [N ] for all h ∈ H. Then
for many (i.e. for ≫ N 3 ) additive quadruples (h1 , h2 , h3 , h4 ) in H, the sequence
n → χh1 (n) ⊗ χh2 (n + h1 − h4 ) ⊗ χh3 (n) ⊗ χh4 (n + h1 − h4 )

(8.6)

is biased.
This proposition in fact has quite a simple proof; see [29]. Note how we can
conclude (8.6) to be biased and not merely (s − 2)-biased. As such, Proposition 8.4
saves some “lower order” information that was not present in Proposition 7.3; this
lower order information will be crucial later in the argument, when we establish the
symmetry property in Theorem 7.4.
9. Frequencies and representations
We will use Proposition 7.3 to analyse the “frequency” of the nilcharacters
(χh )h∈H appearing in Theorem 7.2. To motivate the discussion, let us ﬁrst suppose that we are in the (signiﬁcantly simpler) s = 2 case, rather than the actual case s
3 of interest. When s = 2, we can represent χh as a linear phase
χh (n) = e(ξh n+ θh ) for some ξh , θh ∈ ∗ T; one can then interpret ξh as the frequency
of h.
In order to describe how this frequency ξh behaves in h, it will be convenient to
represent ξh as a linear combination
ξh = a1,h ξ1,h + . . . + aD,h ξD,h

(9.1)

of other frequencies ξ1,h , . . . , ξD,h ∈ ∗ T, where the ai,h ∈ Z are (standard) integer
coeﬃcients, and the (ξi,h )h∈H are families of frequencies which have better properties with regards to their dependence on h; for instance, they might be “core
frequencies” ξi,h = ξ∗,i that are independent of h, or they might be “bracket-linear
petal” frequencies that depend in a bracket-linear fashion on h, or they might be
“regular petal” frequencies which behave in a suitably “dissociated” manner in h.
We can schematically depict the relationship (9.1) as
[χh ] ≈ ηh (Fh )
where [χh ] is some sort of “symbol” of χh (which, in the linear case s = 2, is just
ξh mod 1), Fh ∈ ∗ TD is the frequency vector Fh = (ξ1,h , . . . , ξD,h ), and ηh : ∗ TD →
∗
T is the vertical frequency
ηh (x1 , . . . , xD ) := a1,h x1 + . . . + aD,h xD .

(9.2)

We will need to ﬁnd analogues of the above type of representation in higher
degree s 3. Heuristically, we will wish to represent the symbol [χ]Ξ(s−1,r∗ ) ([N ]) of
DR
a nilcharacter χ on [N ] of degree-rank (s − 1, r∗ ) (which will ultimately depend on
a parameter h, though we will not need this parameter in the current discussion)
heuristically as
[χ]Ξ(s−1,r∗ ) ([N ]) ≈ η(F )
(9.3)
DR

where F = (ξi,j )1 i s−1;1 j Di is a horizontal frequency vector of frequencies
ξi,j ∈ ∗ T associated to a dimension vector D = (D1 , . . . , Ds−1 ), and η is a vertical frequency that generalises (9.2), but whose precise form we are not yet ready

40

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

to describe precisely. We then say that the triple (D, η, F ) forms a total frequency
representation of χ.
In the previous paper [28] that treated the s = 3 case, such a representation
was implicitly used via the description of degree-rank (2, 2) nilcharacters χh as
essentially being bracket quadratic phases e( Jj=1 {αh,j n}βh,j n) modulo lower order
terms (and ignoring the issue of vector-valued smoothing for now). In our current
language, this would correspond to a dimension vector D = (2J, 0) and a horizontal
frequency vector of the form (αh,1 , . . . , αh,J , βh,1 , . . . , βh,J ), and a certain vertical
frequency η depending only on J that we are not yet ready to describe explicitly
here. Bracket-calculus identities such as (6.4) could then be used to manipulate
such a universal frequency representation into a suitably “regularised” form.
In principle, one could also use bracket calculus to extract the symbol of χh in
terms of frequencies such as αh,j and βh,j for higher values of s. However, as we are
avoiding the use of bracket calculus machinery here, we will proceed instead using
the language of nilmanifolds, and in particular by lifting the nilmanifold Gh /Γh up
to a universal nilmanifold in order to obtain a suitable space (independent of h) in
which to detect relationships between frequencies such as αh,j , βh,j . In some sense,
this universal nilmanifold will play the role that the unit circle T plays in Fourier
analysis.
We ﬁrst deﬁne the notion of universal nilmanifold that we need.
Definition 9.1 (Universal nilmanifold). A dimension vector is a tuple
D = (D1 , . . . , Ds−1 ) ∈ Ns−1
of standard natural numbers. Given a dimension vector, we deﬁne the universal
nilpotent group GD = GD, (s−1,r∗ ) of degree-rank (s − 1, r∗ ) to be the Lie group
generated by formal generators ei,j for 1 i s − 1 and 1 j
Di , subject to
the following constraints:
• Any (m − 1)-fold iterated commutator of ei1 ,j1 , . . . , eim ,jm with i1 + . . . +
im s is trivial.
• Any (m − 1)-fold iterated commutator of ei1 ,j1 , . . . , eim ,jm with i1 + . . . +
im = s − 1 and m r + 1 is trivial.
D
We give this group a degree-rank ﬁltration (GD
(d,r) )(d,r)∈DR by deﬁning G(d,r) to be
the Lie group generated by (m − 1)-fold iterated commutators of ei1 ,j1 , . . . , eim ,jm
with 1 il s−1 and 1 jl Dil for all 1 l n for which either i1 +. . .+im > d,
or i1 + . . .+ im = d and m r. It is not hard to verify that this is indeed a ﬁltration
of degree-rank
(s − 1, r∗ ). We then let ΓD be the discrete group generated by
the ei,j with 1 i s − 1 and 1 j Di , and refer to GD /ΓD as the universal
nilmanifold with dimension vector D.
A universal vertical frequency at dimension vector D is a continuous homomorD
phism η : GD
(s−1,r∗ ) → R which sends Γ(s−1,r∗ ) to the integers (i.e. a ﬁltered
D
homomorphism from GD
(s−1,r∗ ) /Γ(s−1,r∗ ) to T).

Remark. One can give an explicit basis for this nilmanifold in terms of certain
iterated commutators of the ei,j , following [46, 49]. This can then be used to
relate nilcharacters to bracket polynomials, as in [46], and it is then possible to
develop enough of a “bracket calculus” to substitute for some of the nilpotent
algebra performed in this paper. However, we will not proceed by such a route here

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

41

(as it would make the paper even longer than it currently is), and in fact will not
need an explicit basis for universal nilmanifolds at all.
Example 9.2. The unit circle with the degree d ﬁltration (see Example 4.3) is
isomorphic to the universal nilmanifold G(0,...,0,1), (d,1) , thus for instance the unit
circle with the lower central series ﬁltration is isomorphic to G(1), (1,1) . A universal
vertical frequency for any of these nilmanifolds is essentially just a map of the form
η : x → nx for some integer n.
Example 9.3. The Heisenberg group (6.1) (with the lower central series ﬁltration) is the universal nilpotent group G(2,0) = G(2,0), (2,2) of degree-rank (2, 2)
(after identifying e1 , e2 with e1,1 and e1,2 respectively), and the Heisenberg nilmanifold G/Γ is the corresponding universal nilmanifold G(2,0) /Γ(2,0) . If we reduce
the degree-rank from (2, 2) to (2, 1), then the commutator [e1 , e2 ] now trivialises,
and G(2,0), (2,1) collapses to the abelian Lie group R2 ≡ G2, (1,1) , with universal
nilmanifold T2 .
If, instead of the lower central series ﬁltration, one gives the Heisenberg group
(6.1) the ﬁltration used in Example 6.21 to model the sequence (6.9), then this
group is isomorphic to the universal nilpotent group G(1,1), (3,2) , with the two
generators e1 , e2 of the Heisenberg group now being interpreted as e1,1 and e2,1
respectively.
Example 9.4. Consider the universal nilpotent group G(D1 ,D2 ,D3 ), (3,3) . This
group is generated by “degree 1” generators e1,1 , . . . , e1,D1 , “degree 2” generators
e2,1 , . . . , e2,D2 , and “degree 3” generators e3,1 , . . . , e3,D3 , with any iterated commutator of total degree exceeding three vanishing (thus for instance the degree 3
generators are central, and the degree 2 generators commute with each other). If
one drops the degree-rank from (3, 3) to (3, 2), then all triple commutators of degree 1-generators, such as [[e1,i , e1,j ], e1,k ] now vanish, reducing the dimension of the
nilpotent group. Dropping the degree-rank further to (3, 1) also eliminates the commutators of degree 1 and degree 2 generators (thus making the degree 2 generators
central). Finally, dropping the degree-rank to (3, 0) eliminates the degree 3 generators completely, and indeed G(D1 ,D2 ,D3 ), (3,0) is isomorphic to G(D1 ,D2 ), (2,2) .
Example 9.5. The free s-step nilpotent group on D generators, in our notation, becomes G(D,0,...,0), (s,s) . We may thus view the universal nilpotent groups GD, (d,r)
as generalisations of the free nilpotent groups, in which some of the generators are
allowed to be weighted to have degrees greater than 1, and there is an additional
rank parameter to cut down some of the top-order behaviour.
It will be an easy matter to lift a nilcharacter χ from a general degree-rank
(s−1, r∗ ) nilmanifold G/Γ to a universal nilmanifold GD /ΓD for some suﬃciently
large dimension vector D (see Lemma 9.12 below). Once one does so, we will need
to extract the various “top order frequencies” present in that nilcharacter. For
instance, if s = 4 and χ is (some vector-valued smoothing of) the degree 3 phase
n → e({αn}βn2 + γn3 + δn2 + {ǫn}µn + νn + θ)
then we will need to extract out the “degree 3” frequency γ, the “degree 2” frequency
β, and the “degree 1” frequency α. (The remaining parameters δ, ǫ, µ, ν, θ only
contribute to terms of degree strictly less than 3, and will not need to be extracted.)

42

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

As it turns out, the degree i frequencies will most naturally live in the ith horizontal torus of the relevant universal nilmanifold; we now pause to deﬁne these
torii precisely. (These torii also implicitly appeared in [27, Appendix A].)
Definition 9.6 (Horizontal Taylor coeﬃcients). Let G = (G, (G(d,r) )(d,r)∈DR ) be
a degree-rank-ﬁltered nilpotent group. For every i
0, deﬁne the ith horizontal
space Horizi (G) to be the abelian group
Horizi (G) := G(i,1) /G(i,2) ,
with the convention that G(d,r) := G(d+1,0) if r > d (so in particular, G(1,2) =
G(2,0) ).
For any polynomial map g ∈ poly(ZN → GN ), we deﬁne the ith horizontal Taylor
coefficient Taylori (g) ∈ Horizi (G) to be the quantity
Taylori (g) := ∂1 . . . ∂1 g(n) mod G(i,2)
for any n ∈ Z. Note that this map is well-deﬁned since ∂1 . . . ∂1 g takes values in
G(i,1) and has ﬁrst derivatives in G(i+1,1) and hence in G(i,2) .
If Γ is a subgroup of G, we deﬁne
Horizi (G/Γ) := Horizi (G)/Horizi (Γ)
and for a polynomial orbit O ∈ poly(ZN → (G/Γ)N ) := poly(ZN → GN )/poly(ZN →
ΓN ), we deﬁne the ith horizontal Taylor coefficient Taylori (O) ∈ Horizi (G/Γ) to be
the quantity deﬁned by
Taylori (gΓ) := Taylori (g) mod Horizi (Γ)
for any g ∈ poly(ZN → GN ); it is easy to see that this quantity is well-deﬁned.
These concepts extend to the ultralimit setting in the obvious manner; thus
for instance, if O ∈ ∗ poly(HN → (G/Γ)N ), then Taylori (O) is an element to
∗
Horizi (G/Γ).
If G/Γ is a degree-rank ﬁltered nilmanifold, it is easy to see that the horizontal spaces Horizi (G) are abelian Lie groups, and that Horizi (Γ) is a sublattice of
Horizi (G), so Horizi (G/Γ) is a torus, which we call the ith horizontal torus of G/Γ.
Remark. The above deﬁnition can be generalised by replacing the domain Z
with an arbitrary additive group H = (H, +). In that case, the Taylor coeﬃcient
Taylori (g) is not a single element of Horizi (G), but is instead a map Taylori (g) :
H i → Horizi (G) deﬁned by the formula
Taylori (g)(h1 , . . . , hk ) := ∂h1 . . . ∂hk g(n) mod G(i,2)
for h1 , . . . , hk ∈ H. Using Corollary B.7 we easily see that this map is symmetric
and multilinear; thus for instance when H = Z we have
Taylori (g)(h1 , . . . , hk ) = h1 . . . hk Taylori (g).
However, we will not need this generalisation here.
A further application of Corollary B.7 shows that the map g → Taylori (g) is a
homomorphism. As a corollary, we see that any translate g(· + h) = (∂h g)g of g
will have the same Taylor coeﬃcients as g: Taylori (g(· + h)) = Taylori (g).

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

43

Example 9.7. Consider the unit circle G/Γ = T with the degree
d ﬁltration
(see Example 4.3). Then the dth horizontal torus is T, and all other horizontal tori
are trivial. If α0 , . . . , αd ∈ ∗ R, then the map O : n → α0 + . . . + αd nd mod 1 is
a polynomial orbit in ∗ poly(ZN → TN ), and the dth horizontal Taylor coeﬃcient is
the quantity d!αd mod 1 from ∗ Zd to ∗ T. (All other horizontal Taylor coeﬃcients
are of course trivial.) Thus we see that the horizontal coeﬃcient captures most of
the top order coeﬃcient αd , but totally ignores all lower order terms.
Example 9.8. Let G = G(2,1) = G(2,1), (2,2) be the universal nilpotent group of
degree-rank (2, 2). Thus G is generated by e1,1 , e1,2 , e2,1 , with relations
[[e1,1 , e1,2 ], e1,i ] = [e1,i , e2,1 ] = 1

for i = 1, 2.

and with the degree-rank ﬁltration
G(0,0) = G(1,0) = G(1,1) = G
G(2,0) = G(2,1) = [e1,1 , e1,2 ], e2,1
G(2,2) = [e1,1 , e1,2 ]

R

R

and the lattice
Γ = Γ(2,2) = Γ(2,2), (2,1) := e1,1 , e1,2 , e2,1 .
Let α, β, γ ∈ ∗ R, and consider the orbit O ∈ ∗ poly(ZN → (G/Γ)N ) deﬁned by the
formula
nβ n2 γ
O(n) := enα
1,1 e1,2 e2,1 ;
this is polynomial by Example 4.4. Then
β
∗
Taylor1 (g) = ∂1 g(n) mod ∗ G(2,0) = eα
1,1 e1,2 mod G(2,0) ,

and
∗
Taylor2 (g) = e2γ
2,1 mod G(2,2) .

Then Taylor0 (g(n)∗ Γ) = g(n)∗ Γ,
β
∗
Taylor1 (g ∗ Γ) = eα
1,1 e1,2 mod G(2,0) Γ

and
∗
Taylor2 (g ∗ Γ) = e2γ
2,1 mod G(2,2) Γ(2,0) .

Example 9.9. Let G/Γ be the Heisenberg nilmanifold (6.1) with the lower central series ﬁltration. Thus G/Γ is a degree
2 nilmanifold, which can then be
viewed as a degree-rank (2, 2) nilmanifold by Example 6.11. The ﬁrst horizontal torus Horiz1 (G/Γ) is isomorphic to the 2-torus T2 , with generators given by
e1 , e2 mod G2 Γ. The second horizontal torus Horiz2 (G/Γ) is trivial, since G(2,1) =
[G, G] is equal to G(2,0) = G2 . If O ∈ ∗ poly(ZN → (G/Γ)N ) is the polynomial orbit
αn ∗
O : n → eβn
Γ, then the ﬁrst Taylor coeﬃcient is the quantity (α, β). Note also
2 e1
2
that if one modiﬁed the polynomial orbit by a further factor of [e1 , e2 ]γn +δn+ǫ ,
this would not impact the Taylor coeﬃcients at all. Thus we see that the Taylor
coeﬃcients only capture the frequencies associated to raw generators such as e1 and
e2 , and not to commutators such as [e1 , e2 ].
Example 9.10. Now consider the Heisenberg group (6.1) with the ﬁltration used
in Example 6.21 to model the sequence (6.9). This is now a degree 3 nilmanifold,
whose ﬁrst horizontal torus Horiz1 (G/Γ) is isomorphic to the one-torus T with
generator e2 mod G(2,0) Γ, whose second horizontal torus Horiz2 (G/Γ) is isomorphic

44

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

to the one-torus T with generator e1 mod G(2,2) Γ(2,1) , and whose third horizontal
torus Horiz3 (G/Γ) is trivial. If O ∈ ∗ poly(ZN → (G/Γ)N ) is the polynomial orbit
αn2 ∗
O : n → eβn
Γ, then the ﬁrst Taylor coeﬃcient is the linear limit map n →
2 e1
βn mod 1, and the second Taylor coeﬃcient is the quantity 2!α mod 1.
We now have enough notation to be able to formally assign frequencies to a
nilcharacter, by means of a package of data which we shall call a representation.
Definition 9.11 (Representation). Let χ ∈ L∞ [N ] be a nilcharacter of degree-rank
(s − 1, r∗ ). A representation of χ is a collection of the following data:
(i)
(ii)
(iii)
(iv)

A ﬁltered nilmanifold G/Γ of degree-rank (s − 1, r∗ );
A ﬁltered nilmanifold G0 /Γ0 of degree-rank (s − 1, r∗ − 1);
A function F ∈ Lip(∗ (G/Γ × G0 /Γ0 ) → S ω );
Polynomial orbits O ∈ ∗ poly(ZN → (G/Γ)N ) and O0 ∈ ∗ poly(ZN →
(G0 /Γ0 )N );
(v) A dimension vector D = (D1 , . . . , Ds−1 ) ∈ Ns−1 ;
(vi) A universal vertical frequency η : GD
(s−1,r∗ ) → R at dimension D on the

universal nilmanifold GD /ΓD of degree-rank (s − 1, r∗ );
(vii) A ﬁltered homomorphism φ : GD /ΓD → G/Γ (see Deﬁnition 6.15);
(viii) A horizontal frequency vector F = (ξi,j )1 i s−1;1 j Di of frequencies
ξi,j ∈ ∗ T.
which obeys the following properties:
(i) For all n ∈ [N ], one has
χ(n) = F (O(n), O0 (n)).

(9.4)

(ii) For every t ∈ GD
(s−1,r∗ ) , all x ∈ G/Γ, and x0 ∈ G0 /Γ0 , one has
F (φ(t)x, x0 ) = e(η(t))F (x, x0 ).
(iii) For every 1

i

(9.5)

s − 1, one has


Di

Taylori (O) = πHorizi (G/Γ) φ(

j=1

ξ



ei,ji,j ) ,

(9.6)

where πHorizi (G/Γ) : Gi → Horizi (G/Γ) is the projection map; observe that
the right-hand side is well-deﬁned even though ξi,j is only deﬁned modulo
1.
We call the triplet (D, F , η) a total frequency representation of the nilcharacter χ.
This is a rather complicated deﬁnition, and we now illustrate it with a number
of examples. We begin with the s = 2, r∗ = 1 case, taking χ to be the degree-rank
(1, 1) nilcharacter
χ(n) := e(ξn + θ)
for some ξ, θ ∈ ∗ R. Let D1 1 be an integer, let F = (ξ1,1 , . . . , ξ1,D1 ) ∈ ∗ TD1 be
a collection of frequencies, and let η : RD1 → R be the universal vertical frequency
η(x1 , . . . , xD1 ) := a1 x1 + . . . + aD1 xD1 for some integers a1 , . . . , aD1 ∈ Z. Then
((D1 ), F , η) will be a total frequency representation of χ if ξ = a1 ξ1,1 +. . .+aD1 ξ1,D1 .
Indeed, in that case, one can take G/Γ = T (with the degree-rank (1, 1) ﬁltration,

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

45

see Example 6.12), G0 /Γ0 to be trivial, F equal to the exponential function (x, ()) →
e(x), φ : TD1 → T to be the ﬁltered homomorphism
φ(x1 , . . . , xD1 ) := a1 x1 + . . . + aD1 xD1 ,
∗

and O ∈ poly(ZN → TN ) to be the orbit n → ξn + θ mod 1. This should be
compared with (9.3) and the discussion at the start of the section.
For a slightly more complicated example, we take s = 3, r∗ = 1, and let χ be the
degree-rank (2, 1) nilcharacter
χ(n) := e(αn2 + βn + γ).
We let D2
1 be an integer, set D1 := 0, let F = ((), (ξ2,1 , . . . , ξ2,D2 )) ∈ ∗ T0 ×
D2
T be a collection of frequencies, and let η : RD2 → R be the universal vertical
frequency η(x1 , . . . , xD2 ) := a1 x1 + . . . + aD2 xD2 for some integers a1 , . . . , aD2 ∈ Z.
Then ((0, D2 ), F , η) will be a total frequency representation of χ if ξ = a1 ξ2,1 +. . .+
aD2 ξ2,D2 (cf. (9.3)). Indeed, we can take G/Γ = T with the degree-rank (2, 1)
ﬁltration (see Example 6.12), G0 /Γ0 = T with the degree-rank (1, 1) ﬁltration,
the orbit
O(n) := (αn2 mod 1, βn + γ mod 1)
and F : G/Γ × G0 /Γ0 → S 1 to be the function
∗

F (x, y) := e(x)e(y),
D2

and φ : T

→ T to be the ﬁltered homomorphism
φ(x1 , . . . , xD1 ) := a1 x1 + . . . + aD1 xD1 .

Note how the lower order terms βn + γ in the phase of χ are shunted oﬀ to the lower
degree-rank nilmanifold G0 /Γ0 and thus do not interact at all with the data F , η.
In this particular case, this shunting oﬀ was unnecessary, and one could have easily
folded these lower order terms into the dynamics of the primary nilmanifold G/Γ;
but in the next example we give, the lower order behaviour does genuinely need to
be separated from the top order behaviour by placing it in a separate nilmanifold.
We now turn to a genuinely non-abelian example of a universal representation.
For this, we take s = 3, r∗ = 2, and let χ be a degree-rank (2, 2) nilcharacter that
is a suitable vector-valued smoothing of the bracket polynomial phase
n → e({αn}βn + γn2 ).
We can express this nilcharacter as
χ(n) = F (O(n), O0 (n)),
∗

where O ∈ poly(ZN → (G/Γ)N ) is the orbit
αn
O(n) := eβn
2 e1 Γ

into the Heisenberg nilmanifold (6.1) (which we give the degree-rank
tion), O0 ∈ ∗ poly(ZN → (G/Γ)N ) is the orbit

(2, 2) ﬁltra-

O0 (n) := γn2 mod 1
into the unit circle G0 /Γ0 = T (which we give the degree-rank (2, 1) ﬁltration,
see Example 6.12), and F is a suitable vector-valued smoothing of the map
(et11 et22 [e1 , e2 ]t12 Γ, y) → e(t12 )e(y)
for t1 , t2 , t12 ∈ I0 . By Example 9.9, we have Taylor1 (O) = (α mod 1, β mod 1) and
Taylor2 (O) is trivial.

46

∗

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Now let D1
1 be an integer, set D2 := 0, let F = ((ξ1,1 , . . . , ξ1,D1 ), ()) ∈
(D1 ,0)
∗ 0
of the universal
T × T be a collection of frequencies. The subgroup G(2,2)
D1

nilmanifold G(D1 ,0) = G(D1 ,0), (2,2) is then the abelian Lie group generated by the
commutators [e1,i , e1,j ] for 1
i < j
D1 . We let a1 , . . . , aD1 , b1 , . . . , bD1 ∈ Z
be integers, and let φ : G(D1 ,0) /Γ(D1 ,0) → G/Γ be the ﬁltered homomorphism that
maps e1,i to ea1 i eb2i for i = 1, . . . , D1 , thus
D1
i
et1,i

φ(
i=1

[e1,i , e1,j ]ti,j Γ(D1 ,0) )
1 i<j D1

D1

a

i=1

= e1

b

[ea1 i eb2i , e1 j e2j ]ti,j Γ

(ea1 1 eb2i )ti

=

1 i<j D1
D1
i=1

ai ti

e2

D1
i=1

bi ti

[e1 , e2 ]−

D1
i=1

ai bi (t2i )−

1

i<j

d

bi aj ti tj +

1

i<j

d (ai bj −aj bi )ti,j

Let us now see what conditions are required for ((D1 , 0), η, F ) to be a total frequency
representation of χ. The condition (9.6) becomes the constraints
D1

ai ξ1,i

α=
i=1
D1

bi ξ1,i ,

β=
i=1

while the condition (9.5) becomes
η([e1,i , e1,j ]) = ai bj − aj bi
for all 1

i<j

(9.7)

D1 , or equivalently

η(
1 i<j D1

[e1,i , e1,j ]ti,j ) =

(ai bj − aj bi )ti,j
1 i<j D1

Conversely, with these constraints we obtain a total frequency representation of χ
by ((D1 , 0), η, F ). This should be compared with the heuristic (9.3). (Note from
(6.4) that the top order component {αn}βn of χ is morally anti-symmetric in α, β
modulo lower order terms, which is consistent with the anti-symmetry observed in
(9.7).) Note also that the term γn2 , which has lesser degree-rank than the top order
term {αn}βn, plays no role, due to it being shunted oﬀ to the lower degree-rank
nilmanifold G0 /Γ0 . If instead we placed this term as part of the principal nilmanifold, then this would create a non-trivial second Taylor coeﬃcient Taylor2 (O) which
would then require a non-zero value of D2 in order to recover a total frequency representation. Thus we see that in order to neglect terms of lesser degree-rank (but
equal degree) it is necessary to create the secondary nilmanifold G0 /Γ0 as a sort of
“junk nilmanifold” to hold all such terms.
We make the easy remark that every nilcharacter χ of degree-rank (s − 1, r∗ )
has at least one representation.
Lemma 9.12 (Existence of representation). Let χ be a nilcharacter of degree-rank
(s − 1, r∗ ) on [N ]. Then there exists at least one total frequency representation
(D, F , η) of χ.

Γ.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

47

Proof. By deﬁnition, χ = F ◦ O for some degree-rank
(s − 1, r∗ ) nilmanifold
G/Γ, some O ∈ ∗ poly(ZN → (G/Γ)N ), and some F ∈ Lip(∗ (G/Γ)) with a vertical
frequency. For each 1 i s − 1, let fi,1 , . . . , fi,Di be a basis of generators for Γi ,
and let D := (D1 , . . . , Ds−1 ) be the associated dimension vector. Then we have a
ﬁltered homomorphism φ : GD → G which maps ei,j to fi,j for all 1 i s − 1
and 1 j Di . It is easy to see that φ is surjective from GD
i to Gi for each i, and
D
so the map πHorizi (G/Γ) ◦ φ is surjective from Gi to Horizi (G/Γ). It is now an easy
matter to locate frequencies ξi,j obeying (9.6), and the vertical frequency property
of F can be pulled back via φ to give (9.5). Setting G0 /Γ0 to be trivial, we obtain
the claim.
To conclude this section, we now give some basic facts about total frequency
representations. These facts will not actually be used in this paper, but may serve
to consolidate one’s intuition about the nature of these representations. We ﬁrst
observe some linearity in the vertical frequency η.
Lemma 9.13 (Linearity). Suppose that χ, χ′ are two nilcharacters of degree-rank
(s − 1, r∗ ) on [N ] that have total frequency representations (D, F , η) and (D, F , η ′ )
respectively. Then χ has a total frequency representation (D, F , −η), and χ ⊗ χ′
has a total frequency representation (D, F , η + η ′ ).
Proof. This is a routine matter of chasing down the deﬁnitions, and noting that
nilmanifolds, polynomial orbits, etc. behave well with respect to direct sums.
Lemma 9.14 (Triviality). Suppose that χ is a nilcharacter of degree-rank (s−1, r∗ )
on [N ] that has a total frequency representation (D, F , 0). Then χ is a nilsequence
of degree-rank (s − 1, r∗ − 1) (i.e. [χ]Symb(s−1,r∗ ) ([N ]) = 0).
DR

Proof. By construction, we have
χ(n) = F (O(n), O0 (n))
for some limit polynomial orbits O ∈ ∗ poly(ZN → (G/Γ)N ), O0 ∈ ∗ poly(ZN →
(G0 /Γ0 )N ) into ﬁltered nilmanifolds G/Γ, G0 /Γ0 of degree-rank
(s − 1, r∗ ) and
(s − 1, r∗ − 1) respectively, where F ∈ Lip(∗ (G/Γ × G0 /Γ0 ) → S ω ). Furthermore,
there exists a ﬁltered homomorphism φ : GD /ΓD → G/Γ such that (9.6) holds, and
such that
F (φ(t)x, x0 ) = F (x, x0 ).
(9.8)
for all t ∈ GD
(s−1,r∗ ) .
Let T be the closure of the set {φ(t) mod Γ(s−1,r∗ ) : t ∈ GD
(s−1,r∗ ) }; this is a
subtorus of the torus G(s−1,r∗ ) /Γ(s−1,r∗ ) , and thus acts on G/Γ. As F is continuous
and obeys the invariance (9.8), we see that F is T -invariant; we may thus quotient
out by T and assume that T is trivial. In particular, φ now annihilates GD
(s−1,r∗ ) .
We give G a new degree-rank ﬁltration (G′(d,r) )(d,r)∈DR (smaller than the existing
ﬁltration (G(d,r) )(d,r)∈DR ), by deﬁning G′(d,r) to be the connected subgroup of G
generated by G(d,r+1) (recalling the convention G(d,r) := G(d+1,0) when r > d)
D
together with the image φ(GD
(d,r) ) of G(d,r) . It is easy to see that this is still a
ﬁltration, and that G/Γ remains a ﬁltered nilmanifold with this ﬁltration, but now
the degree-rank is
(s − 1, r∗ − 1) rather than
(s − 1, r∗ ). Furthermore, from

48

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

(9.6) we see that O is still a polynomial orbit with respect to this new ﬁltration.
As such, χ is a nilsequence of degree-rank (s − 1, r∗ − 1) as required.
Combining the above two lemmas we obtain the following corollary.
Corollary 9.15 (Representation determines symbol). Suppose that χ, χ′ are two
nilcharacters of degree-rank (s − 1, r∗ ) on [N ] that have a common total frequency
representation (D, F , η). Then χ, χ′ are equivalent. In other words, the symbol
[χ]Ξ(s−1,r∗ )([N ]) depends only on (D, F , η).
Note that the above results are consistent with the heuristic (9.3).
10. Linear independence and the sunflower lemma
A basic fact of linear algebra is that every ﬁnitely generated vector space is ﬁnitedimensional. In particular, if v1 , . . . , vl are a ﬁnite collection of vectors in a vector
space V over a ﬁeld k, then there exists a ﬁnite linearly independent set of vectors
v1′ , . . . , vl′′ in V such that each of the vectors v1 , . . . , vl is a linear combination (over
k) of the v1′ , . . . , vl′′ . Indeed, one can take v1′ , . . . , vl′′ to be a set of vectors generating
v1 , . . . , vl for which l′ is minimal, since any linear relation amongst the v1′ , . . . , vl′′
can be used to decrease5 the “rank” l′ , contradicting minimality (cf. the proof of
classical Steinitz exchange lemma in linear algebra).
We will need analogues of this type of fact for frequencies ξ1 , . . . , ξl in the limit
unit circle ∗ T. However, this space is not a vector space over a ﬁeld, but is merely
a module over a commutative ring Z. As such, the direct analogue of the above
statement fails; indeed, any standard rational in ∗ T, such as 21 mod 1, clearly cannot
be represented as a linear combination (over Z) of a ﬁnite collection of frequencies
in ∗ T that are linearly independent over Z.
However, the standard rationals are the only obstruction to the above statement
being true. More precisely, we have
Lemma 10.1 (Baby regularity lemma). Let l ∈ N, and let ξ1 , . . . , ξl ∈ ∗ T. Then
there exists l′ , l′′ ∈ N and ξ1′ , . . . , ξl′′ , ξ1′′ , . . . , ξl′′′′ ∈ ∗ T such that ξ1′ , . . . , ξl′′ are linearly independent over Z (i.e. there exist no standard integers a1 , . . . , al′ , not all
zero, such that a1 ξ1′ + . . . + al′ ξl′′ = 0), each of the ξi′′ are rational (i.e. they live
in Q mod 1), and each of the ξ1 , . . . , ξl are linear combinations (over Z) of the
ξ1′ , . . . , ξl′′ , ξ1′′ , . . . , ξl′′′′ .
Proof. Fix l, ξ1 , . . . , ξl . Deﬁne a partial solution to be a collection of objects l′ , l′′ ,
ξ1′ , . . . , ξl′′ , ξ1′′ , . . . , ξl′′′′ satisfying all of the required properties, except possibly for
the linear independence of the ξ1′ , . . . , ξl′′ . Clearly at least one partial solution
exists, since one can take l′ := l, l′′ := 0, and ξi′ := ξi for all 1 i
l. Now let
l′ , l′′ , ξ1′ , . . . , ξl′′ , ξ1′′ , . . . , ξl′′′′ be a partial solution for which l′ is minimal. We claim
that ξ1′ , . . . , ξl′′ is linearly independent over Z, which will give the lemma. To see
this, suppose for contradiction that there existed a1 , . . . , al′ ∈ Z, not all zero, such
5Indeed, one can recast this argument as a rank reduction argument instead of a minimal rank

argument, for the same reason that the principle of infinite descent is logically equivalent to the
well-ordering principle. In this infinitary (ultralimit) setting, there is very little distinction between
the two approaches, although the minimality approach allows for slightly more compact notation
and proofs. But in the finitary setting, it becomes significantly more difficult to implement the
minimality approach, and the rank reduction approach becomes preferable. See [28] for finitary
“rank reduction” style arguments analogous to those given here.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

49

that a1 ξ1′ + . . . + al′ ξl′′ = 0. Without loss of generality we may assume that a1 is
non-zero. For each 2 j l′ , let ξ˜j′ ∈ ∗ T be such that a1 ξ˜j′ = ξj′ . We then have
l′

ξ1′

=−
j=2

aj ′
ξ + q mod 1
a1 j

for some standard rational q ∈ Q. If we then replace ξ1′ , . . . , ξl′′ by ξ˜2′ , . . . , ξ˜l′′ (decrementing l′ to l′ − 1) and append q to ξ1′′ , . . . , ξl′′′′ , then we obtain a new partial
solution with a smaller value of l′ , contradicting minimality. The claim follows.
This lemma is too simplistic for our applications, and we will need to modify it
in a number of ways. The ﬁrst is to introduce an error term.
Definition 10.2 (Linear independence). Let ε > 0 be a limit real, and let l ∈ N. A
set of frequencies ξ1 , . . . , ξl ∈ ∗ T is said to be independent modulo O(ε) if there do
not exist any collection a1 , . . . , al ∈ Z of standard integers, not all zero, for which
a1 ξ1 + . . . + al ξl = O(ε) mod 1
(Thus, for instance, the empty set (with k = 0) is trivially independent modulo
O(ε).) Equivalently, ξ1 , . . . , ξl are linearly independent over Z after quotienting out
by the subgroup εR mod 1.
This deﬁnition is only non-trivial when ε is an inﬁnitesimal (i.e. ε = o(1)). In
practice, ε will be a negative power of the unbounded integer N .
We have the following variant of Lemma 10.1.
Lemma 10.3 (Regularising one collection of frequencies). Let l ∈ N, let ξ1 , . . . , ξl ∈
∗
T, and let ε > 0 be a limit real. Then there exist l′ , l′′ , l′′′ ∈ N and
ξ1′ , . . . , ξl′′ , ξ1′′ , . . . , ξl′′′′ , ξ1′′′ , . . . , ξl′′′′′′ ∈ ∗ T
such that ξ1′ , . . . , ξl′′ are linearly independent modulo O(ε), each of the ξi′′ are rational, each of the ξi′′′ are O(ε), and each of the ξ1 , . . . , ξl are linear combinations
(over Z) of the ξ1′ , . . . , ξl′′ , ξ1′′ , . . . , ξl′′′′ , ξ1′′′ , . . . , ξl′′′′′′ .
One can view Lemma 10.1 as the degenerate case ε = 0 of the above lemma.
Proof. We repeat the proof of Lemma 10.1. Deﬁne a partial solution to be a collection of objects l′ , l′′ , l′′ , ξ1′ , . . . , ξl′′ , ξ1′′ , . . . , ξl′′′′ , ξ1′′′ , . . . , ξl′′′′′′ obeying all the required
properties except possibly for the linear independence property. Again it is clear
that at least one partial solution exists, so we may ﬁnd a partial solution for which
l′ is minimal. We claim that this is a complete solution. For if this is not the case,
we have
a1 ξ1′ + . . . + al′ ξl′′ = O(ε) mod 1
for some a1 , . . . , al′ ∈ Z, not all zero. Again, we may assume that a1 = 0. We again
select ξ˜2′ , . . . , ξ˜l′′ ∈ ∗ T with a1 ξ˜j′ = ξj′ for all 2 j l′ , and observe that
l′

ξ1′

=−
j=2

aj ′
ξ + q + s mod 1
a1 j

for some standard rational q ∈ Q and some s = O(ε). If we then replace ξ1′ , . . . , ξl′′
by ξ˜2′ , . . . , ξ˜l′′ , and append q and s to ξ1′′ , . . . , ξl′′′′ and ξ1′′′ , . . . , ξl′′′′′′ respectively, we
contradict minimality, and the claim follows.

50

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

This lemma is still far too simplistic for our needs, because we will not be needing to regularise just one collection ξ1 , . . . , ξl of frequencies, but a whole family
ξh,1 , . . . , ξh,l of frequencies, where h ranges over a parameter set H. Such frequencies can exhibit a range of behaviour in h; at one extreme, they might be completely
independent of h, while at the other extreme, the frequencies may vary substantially as h does. It turns out that in some sense, the general case is a combination
of these extreme cases.
In this direction we have the following stronger version of Lemma 10.3.
Lemma 10.4 (Regularising many collections of frequencies). Let l ∈ N, let ε > 0
be a limit real, let H be a limit finite set, and for each h ∈ H, let ξh,1 , . . . , ξh,l be
frequencies in ∗ T that depend in a limit fashion on h. Then there exists a dense
subset H ′ of H, standard natural numbers, l∗ , l′ , l∗′′ , l′′′ ∈ N, “core” frequencies
′′
, . . . , ξl′′′′∗ ∈ ∗ T, and “petal” frequencies
ξ∗,1 , . . . , ξ∗,l∗ , ξ∗,1
′
′
′′′
′′′
∗
ξh,1
, . . . , ξh,l
′ , ξh,1 , . . . , ξh,l′′′ ∈ T

for each h ∈ H ′ depending in a limit fashion on h, and obeying the following
properties:
(i) (Independence) For almost all triples (h1 , h2 , h3 ) ∈ (H ′ )3 (i.e. for all but
o(|H ′ |3 ) such triples), the frequencies
ξ∗,1 , . . . , ξ∗,l∗ , ξh′ 1 ,1 , . . . , ξh′ 1 ,l′ , ξh′ 2 ,1 , . . . , ξh′ 2 ,l′ , ξh′ 3 ,1 , . . . , ξh′ 3 ,l′
are linearly independent modulo O(ε).
′′
(ii) (Rationality) For each 1 j l′′ , ξ∗,j
is a standard rational.
′
′′′
(iii) (Smallness) For each h ∈ H and 1 j l′′′ , ξh,j
= O(ε).
′
(iv) (Representation) For each h ∈ H , the ξh,1 , . . . , ξh,l are linear combinations over Z of the frequencies
′
′
′′
′′
′′′
′′′
, . . . , ξh,l
ξ∗,1 , . . . , ξ∗,l∗ , ξh,1
′ , ξ∗,1 , . . . , ξ∗,l′′ , ξh,1 , . . . , ξh,l′′′ .

Note that Lemma 10.4 collapses to Lemma 10.3 if H is a singleton set.
Proof. We again use the usual argument. Deﬁne a partial solution to be a collec′′′
′
′′
, ξh,j
obeying all the required properties
tion of objects H ′ , l∗ , l′ , l∗′′ , l′′′ , ξ∗,j , ξh,j
, ξ∗,j
except possibly for the independence property. Again, at least one partial solution
′
exists, since we may take H ′ := H, l∗ := l′′ := l′′′ := 0, l′ := l, and ξj,h
:= ξj,h for all
h ∈ H and 1 j l. We may thus select a partial solution for which l′ is minimal;
and among all such partial solutions with l′ minimal, we choose a solution with l∗
minimal for ﬁxed l′ (i.e. we minimise with respect to the lexicographical ordering
on l′ and l∗ ). We claim that this doubly minimal solution obeys the independence
property, which would give the claim.
Suppose the independence property fails. Carefully negating the quantiﬁers and
using Lemma A.9, we conclude that there exist standard integers a∗,j for 1 j l∗
and a′i,j for i = 1, 2, 3 and 1 j l′ , not all zero, such that one has the relation
3

l′

a′i,j ξh′ i ,j = O(ε) mod 1

a∗,1 ξ∗,1 + . . . + a∗,l∗ ξ∗,l∗ +
i=1 j=1
′ 3

for many triples (h1 , h2 , h3 ) ∈ (H ) .
Suppose ﬁrst that all of the a′i,j vanish, so that we have a linear relation
a∗,1 ξ∗,1 + . . . + a∗,l∗ ξ∗,l∗ = O(ε) mod 1

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

51

that only involves core frequencies. Then the situation is basically the same as that
of Lemma 10.3; without loss of generality we may take a∗,1 = 0, and if we then
choose ξ˜∗,2 , . . . , ξ˜∗,l∗ so that a∗,1 ξ˜∗,j = ξ∗,j , then we can rewrite
l′

a∗,j ξ˜∗,j + q + s mod 1

ξ∗,1 = −
j=2

for some q ∈ Q and s = O(ε), and one can then replace the ξ∗,1 , . . . , ξ∗,l∗ with
ξ˜∗,2 , . . . , ξ˜∗,l∗ (decrementing l∗ by 1) and append q and s to each of the collec′′
′′
′′′
′′′
tions ξh,1
, . . . , ξh,l
′′ and ξh,1 , . . . , ξh,l′′′ respectively for each h ∈ H, contradicting
minimality.
Now suppose that not all of the a′i,j vanish; without loss of generality we may
assume that a′1,1 is non-zero. By the pigeonhole principple, we can ﬁnd h2 , h3 ∈ H ′
such that
l′

3

a′i,j ξh′ 1 ,j = O(ε) mod 1

a∗,1 ξ∗,1 + . . . + a∗,l∗ ξ∗,l∗ +
i=1 j=1

′
for all h1 in a dense subset H ′′ of H ′ . Now let ξ˜∗,j ∈ ∗ T for 1 j l∗ and ξ˜h,j
∈ ∗T
′
′
= ξh,j
, then we
for h1 ∈ H ′ and 1 j l′ be such that a′1,1 ξ˜∗,j = ξ∗,j and a′1,1 ξ˜h,j
have
l′

ξh′ 1 ,1

l∗

a′1,j ξ˜h′ 1 ,j

=−
j=2

3

l′
′
+ qh1 + sh1 mod O(1)
a′i,j ξ˜i,j

a∗,j ξ˜∗,j −

−
j=1

i=2 j=1

for some standard rational qh1 and some sh1 = O(ε). Furthermore one can easily
ensure that qh1 , sh1 depend in a limit fashion on h1 . By Lemma A.9 (and reﬁning
H ′ ) we may assume that qh1 = q∗ is independent of h1 . We may thus replace
′
′
′
˜′
˜′
, . . . , ξh,l
H ′ by H ′′ and replace ξh,1
′ by ξh,2 , . . . , ξh,l′ (decrementing l by 1), while
′′
′′
′′′
′′′
appending q∗ and sh to ξ∗,1
, . . . , ξ∗,l
′′ and ξh,1 , . . . , ξh,l′′′ respectively, and replac′
′
˜
˜
˜
˜
˜
ing ξ∗,1 , . . . , ξ∗,l∗ by ξ∗,1 , . . . , ξ∗,l∗ , ξh2 ,1 , . . . , ξh2 ,l′ , ξh3 ,1 , . . . , ξ˜h3 ,l′ (incrementing l∗
as necessary). This contradicts the minimality of the partial solution, and the
claim follows.
This is still too simplistic for our applications, as the independence hypothesis
on triples (h1 , h2 , h3 ) will not quite be strong enough to give everything we need.
Ideally, (in view of Proposition 7.3) we would like to have independence of the
ξ∗,1 , . . . , ξ∗,l∗ , ξh′ 1 ,1 , . . . , ξh′ 4 ,l′ for almost all additive quadruples h1 + h2 = h3 + h4 in
H ′ . Unfortunately, this need not be the case; indeed, if the original ξh,i are linear
in h, say ξh,i = αi h for some αi ∈ ∗ T and all 1 i l′ , then we have ξh1 ,i + ξh2 ,i =
ξh3 ,i + ξh4 ,i for all additive quadruples h1 + h2 = h3 + h4 in H ′ and all 1 i l′ ,
and as a consequence it is not possible to obtain a decomposition as in Lemma 10.4
with the stronger independence property mentioned above. A similar obstruction
occurs if the ξh,i are bracket -linear in h, for instance if ξh,i = {αi h}βi mod 1 for
some αi ∈ ∗ T and βi ∈ ∗ R.
By using tools from additive combinatorics, we can show that bracket-linear
frequencies are the only obstructions to independence on additive quadruples. More
precisely, we have

52

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Lemma 10.5. Let l ∈ N, let ε > 0 be a limit real, let H be a dense limit subset
of [[N ]], and for each h ∈ H, let ξh,1 , . . . , ξh,l be frequencies in ∗ T that depend in
a limit fashion on h. Then there exists a dense subset H ′ of H, standard natural
′′
′′
∗
, . . . , ξ∗,l
numbers, l∗ , l′ , l∗′′ , l′′′ , l′′′′ ∈ N, “core” frequencies ξ∗,1 , . . . , ξ∗,l∗ , ξ∗,1
T,
′′ ∈
∗
′
′
′′′
′′′
′′′′
′′′′
∗
and “petal” frequencies ξh,1 , . . . , ξh,l′ , ξh,1 , . . . , ξh,l′′′ ξh,1 , . . . , ξh,l′′′′ ∈ T for each
h ∈ H ′ depending in a limit fashion on h, obeying the following properties:
(i) (Independence) For almost all additive quadruples h1 + h2 = h3 + h4 in
H ′ (i.e. for all but o(|H ′ |3 ) such quadruples), the frequencies ξ∗,j for
1 j
l∗ , ξh′ i ,j for i = 1, 2, 3, 4 and 1 j
l′ , and ξh′′′′i ,j for i = 1, 2, 3
′′′′
and 1 j l are jointly linearly independent modulo O(ε).
′′
(ii) (Rationality) For each 1 j l∗′′ , ξ∗,j
is a standard rational.
′′′
(iii) (Smallness) For each h ∈ H ′ and 1 j l′′′ , ξh,j
= O(ε).
′′′′
(iv) (Bracket-linearity) For each 1 j l , there exist αj ∈ ∗ T and βj ∈ ∗ R
′′′′
such that ξh,j
= {αj h}βj mod 1 for all h ∈ H ′ . Furthermore, the map
′′′′
h → ξh,j is a Freiman homomorphism on H ′ (see §3 for the definition of
a Freiman homomorphism).
(v) (Representation) For each h ∈ H ′ , the ξh,1 , . . . , ξh,l are linear combinations over Z of the frequencies
′
′
′′
′′
′′′
′′′
′′′′
′′′′
, . . . , ξh,l
ξ∗,1 , . . . , ξ∗,l∗ , ξh,1
′ , ξ∗,1 , . . . , ξ∗,l′′ , ξh,1 , . . . , ξh,l′′′ , ξh,1 , . . . , ξh,l′′′′ .

Proof. As usual, we deﬁne a partial solution to be a collection of objects H ′ ,
′′′′
l∗ , l′ , l∗′′ , l′′′ , l′′′′ , ξ∗,1 , . . . , ξh,l
′′′′ , obeying all of the required properties except possibly for the independence property. Again, there is clearly at least one partial
solution, so we select a partial solution with a minimal value of l′ , and then (for
ﬁxed l′ ) a minimal value of l′′′′ , and then (for ﬁxed l′ , l′′′′ ) a minimal value of l∗ .
We claim that this partial solution obeys the independence property, which will
give the lemma.
Suppose for contradiction that this were not the case; then by Lemma A.9, there
exist standard integers a∗,j for 1 j
l∗ , a′i,j for 1 i 4 and 1 j
l′ , and
a′′i,j for 1 i 3 and 1 j l′′′′ , not all zero, such that
l∗

4

l′

3

a′i,j ξh′ i ,j

a∗,j ξ∗,j +

′′′′
a′′′′
i,j ξhi ,j = O(ε) mod 1

+
i=1 j=1

i=1 j=1

j=1

l′′′

for many additive quadruples h1 + h2 = h3 + h4 in H ′ .
Suppose ﬁrst that all the a′i,j and a′′′′
i,j vanished. Then we have a relation
l∗

a∗,j ξ∗,j = O(ε) mod 1
j=1

that only involves core frequencies; arguing as in Lemma 10.4 we can thus ﬁnd
another partial solution with a smaller value of l∗ (and the same value of l′ , l′′′′ ),
contradicting minimality.
Next, suppose that the a′i,j all vanished, but the a′′′′
i,j did not all vanish. Then
we have a relation
3

l∗

l′′′′
′′′′
a′′′′
i,j ξhi ,j = O(ε) mod 1

a∗,j ξ∗,j +
j=1

i=1 j=1

(10.1)

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

53

for many triples h1 , h2 , h3 in H ′ .
Without loss of generality let us suppose that a′′′′
1,1 is non-zero. By the pigeonhole
principle, we may ﬁnd h2 , h3 ∈ H ′ such that (10.1) holds for all h1 in a dense subset
˜
H ′′ of H ′ . As in previous arguments, we then ﬁnd ξ˜∗,j ∈ ∗ T such that a′′′′
1,1 ξ∗,j = ξ∗,j
∗
′′′′ ˜
˜
for each 1 j l∗ , and also ﬁnd βj ∈ R such that a1,1 βj = βj for all 1 j l′′′′ .
′′′′
′′′′
˜′′′′
If we then set ξ˜h,j
:= {αj h}β˜j for each h ∈ H ′ and 1 j l′′′′ , then a′′′′
1,1 ξh,j = ξh,j ,
and so for any h1 ∈ H ′ we have
l′′′′

l∗

ξh′′′′1 ,1

=−

3

˜′′′′
a′′′′
1,j ξh1 ,j

a∗,j ξ˜∗,j −

˜′′′′
a′′′′
i,j ξhi ,j + qh1 + sh1 mod 1

−
i=2 j=1

j=2

j=1

l′′′′

for some standard rational qh1 and some sh1 = O(ε), both depending on a limit
fashion on h1 . By reﬁning H ′ if necessary (and using the bracket-linear nature of
′′′′
′′′′
the ξ˜h,j
) we may assume that the map h → ξ˜h,j
is a Freiman homomorphism on
′
H , and by Lemma A.9 we may make qh1 = q∗ independent of h1 . If we then argue
as in the proof of Lemma 10.4, we may ﬁnd a new partial solution with a smaller
value of l′′′′ and the same value of l′ , contradicting minimality.
Finally, suppose that the a′i,j did not all vanish. Using the Freiman homomorphism property to permute the i indices if necessary, we may assume that a′4,1 does
not vanish. We then have
Ξ1 (h1 ) + Ξ2 (h2 ) + Ξ3 (h3 ) + Ξ4 (h4 ) = O(ε)
for many additive quadruples h1 + h2 = h3 + h4 in H ′ , where the limit functions
Ξi : H → ∗ T are deﬁned by
l′′′′

l′
′
a′i,j ξh,j

Ξi (h) :=

′′′′
a′′′′
i,j ξh,j mod 1

+
j=1

j=1

for i = 1, 2, 3 and h ∈ H, and
l′

l∗

′
a′4,j ξh,j
mod 1.

a∗,j ξ∗,j +

Ξ4 (h) :=

j=1

j=1

We can use this additive structure to “solve” for Ξ4 , using a result from additive
combinatorics which we present here as Lemma F.1. Applying this lemma, we
can then ﬁnd a dense limit subset H ′ of H, a standard integer K, and frequencies
′
α′1 , . . . , α′K , δ ∈ ∗ T and β1′ , . . . , βK
∈ ∗ R such that
K

{α′k h}βk′ + δ + O(ε) mod 1

Ξ4 (h) =
k=1

and thus
{α′k h}βk′

=
k=1

l′

l∗

K
′
a′4,1 ξh,1

′
a′4,j ξh,j
+ O(ε) mod 1

a∗,j ξ∗,j +

+δ−
j=1

j=2

for all h ∈ H ′ .
As usual, we now ﬁnd β˜k ∈ ∗ R for 1 k K, β˜j ∈ ∗ R for 1 j l′′′′ , δ˜ ∈ T and
˜
ξ∗,j for 1 j l∗ such that a′4,1 β˜k = βk , a′4,1 β˜j = βj , a′4,1 δ˜ = δ, and a′4,1 ξ˜∗,j = ξ∗,j .

54

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

′
We then set ξ˜h,j
:= {αj h}β˜j mod 1, and we conclude that

=

l′

l∗

K
′
ξh,1

{α′k h}β˜k′
k=1

′
+ qh + sh mod 1
a′4,j ξ˜h,j

a∗,j ξ˜∗,j +

+ δ˜ −
j=1

j=2

′

for all h ∈ H , where qh ∈ Q and sh = O(ε) depend in a limit fashion on h. By
reﬁning H ′ we may take qh = q∗ independent of h.
We can then use relation to build a new partial solution that decreases l′ by 1,
at the expense of enlarging the other dimensions l∗ , l′′ , l′′′ , l′′′′ (and also reﬁning H
to H ′ ), again contradicting minimality, and the claim follows.
We now apply the above lemma to the language of horizontal frequency vectors
introduced in the previous section. We need some deﬁnitions:
Definition 10.6 (Properties of horizontal frequency vectors). Let
F = (ξi,j )1

i s−1;1 j Di

′
and F ′ = (ξi,j
)1

i s−1;1 j Di′

be horizontal frequency vectors.
• We say that F is independent if, for each 1 i d, the tuple (ξi,j )1 j Di
is independent modulo O(N −i ).
• We say that F is rational if all the ξi,j are standard rationals.
• We say that F is small if one has ξi,j = O(N −i ) for all 1 i s − 1 and
1 j Di .
′′
)1 i s−1;1 j Di +Di′ by declaring
• We deﬁne the disjoint union F ⊎F ′ = (ξi,j
′′
′
ξi,j to equal ξi,j if j Di and ξi,j−Di if Di < j Di + Di′ . This is clearly a
′
).
horizontal frequency vector with dimensions (D1 + D1′ , . . . , Ds−1 + Ds−1
′
• We say that F is represented by F if for every 1 i s−1 and 1 j Di ,
′
ξi,j is a standard integer linear combination of the ξi,j
j ′ Di′ .
′ for 1
Lemma 10.7 (Sunﬂower lemma). Let H be a dense subset of [[N ]], and let (Fh )h∈H
be a family of horizontal frequency vectors depending in a limit fashion on h, whose
dimension vector D = Dh is independent of h. Then we can find the following
objects:
• A dense subset H ′ of H;
′
′
′
• Dimension vectors D∗ = D∗,ind + D∗,rat and D′ = Dlin
+ Dind
+ Dsml
,
s−1
s−1
which we write as D∗ = (D∗,i )i=1 , D∗,ind = (D∗,ind,i )i=1 , etc.;
• A core horizontal frequency vector F∗ = (ξ∗,i,j )1 i s−1;1 j D∗,i , which is
partitioned as F∗ = F∗,ind ⊎ F∗,rat , with the indicated dimension vectors
′
′
Dind
, Drat
;
′
)1 i s−1;1 j Di′ , which is
• A petal horizontal frequency vector Fh′ = (ξh,i,j
′
′
′
′
partitioned as Fh = Fh,lin ⊎ Fh,ind ⊎ Fh,sml , which is a limit function of h
′
′
′
and with the indicated dimension vectors Dlin
, Dind
, Dsml
which obey the following properties:
′
• For all h ∈ H ′ , Fh,sml
are small.
• F∗,rat is rational.
′
• For every 1
i
d and 1
j
Di,lin
, there exists αi,j ∈ ∗ T and
∗
βi,j ∈ R such that (10.2) holds for all h ∈ H ′ , and furthermore that the
′
map h → ξh,i,j
is a Freiman homomorphism on H ′ .
• For all h ∈ H, Fh is represented by F∗ ∪ Fh′

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

55

• (Independence property) For almost all additive quadruples (h1 , h2 , h3 , h4 )
in H,
3

4

Fh′ i ,lin

Fh′ i ,ind ⊎

F∗,ind ⊎

i=1

i=1

is independent.
i
s − 1 in turn, apply
Proof. Write Fh = (ξh,i,j )1 i s−1;1 j Di . For each 1
Lemma 10.5 to the collections (ξh,i,1 , . . . , ξh,i,Di )h∈H and ε = O(N −i ), reﬁning H
once for each i. The claim then follows by relabeling.
To apply this lemma to families of nilcharacters, we will need two additional
lemmas.
(s−1,r )

Lemma 10.8 (Change of basis). Suppose that χ ∈ ΞDR ∗ ([N ]) is a degree-rank
(s − 1, r∗ ) nilcharacter with a total frequency representation (D, F , η), and suppose
that F is represented by another horizontal frequency vector F ′ with a dimension
′
vector D′ . Then there exists a vertical frequency η ′ : GD
s−1 → R such that χ has a
total frequency representation (D′ , F ′ , η ′ ).
Proof. By hypothesis, each element ξi,j of F can be expressed as a standard linear
D′

′
′
′
combination ξi,j = j ′ i=1 ci,j,j ′ ξi,j
′ of elements ξi,j ′ of F of the same degree, where
ci,j,j ′ ∈ Z.
′
Now let ψ : GD → GD be the unique ﬁltered homomorphism that maps e′i,j ′ to
ci,j,j′
Di
(this can be viewed as an “adjoint” of the representation of F by F ′ ).
j=1 ei,j
By hypothesis, χ has a representation χ(n) = F (O(n), O0 (n)) of χ with


Di

Taylori (O) = πHorizi (G/Γ) φ(

j=1

ξ

ei,ji,j )

for some ﬁltered homomorphism φ : GD → G. A brief calculation shows that the
right-hand side can also be expressed as


′
Di

πHorizi (G/Γ) φ ◦ ψ(

j=1

′

′

(e′i,j )ξi,j ) .

′

As φ ◦ ψ : GD → G is a ﬁltered homomorphism, and η ◦ ψ : GD
(s−1,r∗ ) → R is a
vertical frequency, we obtain the claim.
Lemma 10.9. Let F be a horizontal frequency vector of dimension D of the form
F = Frat ⊎ Fsml ⊎ F ′
where Frat is rational and Fsml is small, and F ′ has dimension D′ . Suppose that
(s−1,r )
χ ∈ ΞDR ∗ ([N ]) is a nilcharacter with a total frequency representation (D, F , η).
′
Then there exists a vertical frequency η ′ : GD
s−1 → R such that χ has total frequency
(D′ , F ′ /M, η ′ ) for some standard integer M 1.
Remark. This lemma crucially relies on the hypothesis s
3, as it makes the
(degree 1) contributions of rational and small frequencies to be of lower order.
Because of this, the inverse conjecture for s > 2 is in a very slight way a little bit

56

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

simpler than the s
other ways.

2 theory, though it is of course more complicated in many

Proof. By induction we may assume that F is formed from F ′ by adding a single
frequency ξi0 ,Di0 , which is either rational or small.
Let us ﬁrst suppose that we are adding a single frequency which is not just rational, but is in fact an integer. Then if χ(n) = F (g(n)∗ Γ, g0 (n)∗ Γ0 ) is a nilcharacter
with a total frequency representation (D, F , η), then we have a ﬁltered homomorphism φ : GD /ΓD → G/Γ such that
Di

φ(ei,j )ξi,j mod G(i,1)

gi =
j=1

for all 1 i s∗ − 1, where gi are the Taylor coeﬃcients of g. Specialising to the
degree i0 and using the integer nature of ξi0 ,Di0 , we have
gi0 = gi′0 γi0
where γi0 is an element of Γi0 , and
Di −1

φ(ei,j )ξi,j mod G(i,1) .

gi′ =
j=1

From this and the Baker-Campbell-Hausdorﬀ formula (3.2), we can write g(n) =
(in )
g ′ (n)γi0 0 , where g ′ is a polynomial sequence with a horizontal frequency representation (D′ , φ′ , F ′ ), where D′ is D with Di0 decremented by one, and φ′ is the
′
′
restriction of φ to the subnilmanifold GD /ΓD . Since g(n)∗ Γ = g ′ (n)∗ Γ, we see
that χ has a total frequency representation (D′ , F ′ , η ′ ), where η ′ is the restriction
D′
of η : GD
(s−1,r∗ ) → R to G(s−1,r∗ ) . This gives the claim in this case (with M = 1).
Now suppose that ξi0 ,Di0 is merely rational rather than integer. Then we can
argue as before, except that now γi0 is a rational element of Gi0 , so that γim0 ∈ Γi0
for some standard positive integer m. As such, there exists a standard positive
(n)
integer q such that γi0i0 mod ∗ Γ is periodic with period q. As a consequence, there
exists a bounded index subgroup Γ′ of Γ such that the point
(n)
g ′ (n)γi0i0 mod ∗ Γ
in G/Γ can be expressed as a Lipschitz function of
g ′ (n) mod ∗ Γ′
and of the quantity n/q mod 1. Repeating the previous arguments, we thus obtain
a total frequency representation (D′ , F˜ ′ , η ′ ) for some η ′ , and some F˜ ′ whose coeﬃcients are rational combinations of those of F ′ ; note that the n/q dependence can
be easily absorbed into the lower order term G0 /Γ0 since s
3. The claim then
follows from Lemma 10.8.
Finally, suppose that ξi0 ,Di0 is small rather than rational. Then we can write
gi0 = ci0 gi′0

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

57

where gi′0 is as before, and ci0 ∈ Gi0 is at a distance O(N −i0 ) from the origin. We
can thus write
(n)
g(n) = ci0i0 g ′ (n)
where g ′ is a polynomial sequence with horizontal frequency representation
(D′ , φ′ , F ′ ).
( )
is can be expressed as a bounded Lipschitz function of
On [N ], the sequence c
n/2N mod 1. As a consequence, we can thus write χ in the form
n
i0
i0

χ(n) = F ′ (g ′ (n)∗ Γ, g0 (n)∗ Γ0 , n/2N mod 1)
for some F ′ ∈ Lip(∗ (G/Γ× G0 /Γ0 × T)). As s 3, the ﬁnal term T can be absorbed
into the degree-rank (s−1, r∗ −1) nilmanifold G0 /Γ0 , and the claim follows (with
M = 1).
Finally, we can state the main result of this section.
Lemma 10.10 (Sunﬂower lemma). Let H be a dense subset of [[N ]], and let
(s−1,r )
(χh )h∈H be a family of nilcharacters χh ∈ ΞDR ∗ ([N ]) depending in a limit fashion on H. Then we can find
(i) A dense subset H ′ of H;
′
′
(ii) Dimension vectors D∗ and D′ = Dlin
+ Dind
, which we write as D∗ =
s−1
s−1
s−1
′
′ s−1
′
′
′
′
(D∗,i )i=1 , D = (Di )i=1 , Dlin = (Dlin,i )i=1 , Dind
= (Dind,i
)i=1
;
(iii) A core horizontal frequency vector F∗ = (ξ∗,i,j )1 i d;1 j D∗,i ;
′
)1 i d;1 j Di′ , which is
(iv) A petal horizontal frequency vector Fh′ = (ξh,i,j
′
′
′
partitioned as Fh = Fh,lin ⊎ Fh,ind, which is a limit function of h, where
′
′
′
′
Fh,lin
, Fh,ind
have dimensions Dlin
, Dind
respectively;
′

′
∗ +D
(v) A vertical frequency η : GD
(s−1,r∗ ) → R with dimension vector D∗ + D

which obey the following properties:
′
(i) (Fh,lin
is bracket-linear) For every 1
i
exists αi,j ∈ ∗ T and βi,j ∈ ∗ R such that

d and 1

j

′
ξh,i,j
= {αi,j h}βi,j mod 1
′

′
Di,lin
, there

(10.2)
′
ξh,i,j

for all h ∈ H , and furthermore that the map h →
is a Freiman
homomorphism on H ′ .
(ii) (Independence) For almost all additive quadruples (h1 , h2 , h3 , h4 ) in H,
3

4

Fh′ i ,ind

F∗,ind ⊎
i=1

Fh′ i ,lin

⊎
i=1

is independent.
(iii) (Representation) For all h ∈ H ′ , χh has a total frequency representation
(D∗ + D′ , F∗ ∪ Fh′ , η).
Proof. Each χh thus has a total frequency representation (Dh , Fh , ηh ). The space of
representations is a σ-limit set, so by Lemma A.11 we may assume that (Dh , Fh , ηh )
depends in a limit fashion on h.
The number of possible dimension vectors is countable. Applying Lemma A.9,
and passing from H to a dense subset, we may assume that D = Dh is independent
of h.

58

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

We then apply Lemma 10.7 to the (Fh )h∈H , obtaining a dense subset H ′ of
′
′
′
H, dimension vectors D∗ = D∗,ind + D∗,rat and D′ = Dlin
+ Dind
+ Dsml
, a core
horizontal frequency vector F∗ = F∗,ind ⊎ F∗,rat , and petal horizontal frequency
′
′
′
vectors Fh′ = Fh,lin
⊎ Fh,ind
⊎ Fh,sml
for each h ∈ H ′ with the stated properties.
Applying Lemma 10.8, we see that for each h ∈ H ′ , χh has a total frequency
representation
(D∗ + D′ , F∗ ⊎ Fh′ , ηh′ )
′
for some vertical frequency ηh . Applying Lemma 10.9, we conclude that χh has a
total frequency representation
′
′
′
′
(D∗,ind + Dlin
+ Dind
, F∗,ind ⊎ Fh,lin
⊎ Fh,ind
, ηh′′ )

for some vertical frequency ηh′ . The number of vertical frequencies ηh′′ is countable,
so by Lemma A.9 we may assume that η = ηh′′ is also independent of h. The claim
then follows.
11. Obtaining bracket-linear behaviour
We return now to the task of proving Theorem 7.2. To recall the situation thus
(1,s−1)
far, we are given a two-dimensional nilcharacter χ ∈ ΞMulti (∗ Z2 ) and a family
of degree-rank (s − 1, r∗ ) nilcharacters (χh )h∈H depending in a limit fashion on
a parameter h in a dense subset H of [[N ]], with the property that there is a
function f ∈ L∞ [N ] such that χ(h, ·) ⊗ χh (s − 2)-correlates with f for all h ∈ H.
Using Proposition 7.3 to eliminate f and χ, and reﬁning H to a dense subset if
necessary, we conclude that the nilcharacter (7.2) is (s−2)-biased for many additive
quadruples h1 + h2 = h3 + h4 in H. We make the simple but important remark that
this conclusion is “hereditary” in the sense that it continues to hold if we replace
H with an arbitrary dense subset H ′ of H, since the hypothesis of Proposition 7.3
clearly restricts from H to H ′ in this fashion.
Next, we apply Lemma 10.10 to obtain a dense reﬁnement H ′ on H for which
the χh have a frequency representation involving various types of frequencies: a
′
core set of frequencies F∗ , a bracket-linear family (Fh,lin
)h∈H ′ of petal frequencies
′
and an independent family (Fh,ind )h∈H ′ of petal frequencies.
¡¡¡¡¡¡¡ .mine The main result of this section uses the bias of (7.2), combined with
the quantitative equidistribution theory on nilmanifolds (as reviewed in Appendix
D) to obtain an important milestone towards establishing Theorem 7.2, namely
′
do not actually have any inﬂuence
that the independent petal frequencies Fh,ind
on the top-order behaviour of the nilcharacters χh , and that the bracket-linear frequencies only inﬂuence this top-order behaviour in a linear fashion. For this, we
use an argument of Furstenberg and Weiss [14], also used in the predecessor [28] to
this paper. See also [29] for another exposition of this argument. ======= The
main result of this section uses the bias of (7.2), combined with the quantitative
equidistribution theory on nilmanifolds (as reviewed in Appendix D) to obtain an
important milestone towards establishing Theorem 7.2, namely that the indepen′
dent petal frequencies Fh,ind
do not actually have any inﬂuence on the top-order
behaviour of the nilcharacters χh , and that the bracket-linear frequencies only inﬂuence this top-order behaviour in a linear fashion. For this, we use an argument of
Furstenberg and Weiss [14] that was also used in the predecessor [28] to this paper.
See [29] for another, somewhat simpliﬁed, exposition of this argument. ¿¿¿¿¿¿¿
.r207

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

59

We begin by formally stating the result we will prove in this section.
Theorem 11.1 (No petal-petal or regular terms). Let f, H, χ, (χh )h∈H be as in
′
′
′
′
Theorem 7.2 and let H ′ , D∗ , D′ , Dlin
, Dind
, F∗ , Fh′ , Fh,lin
, Fh,ind
, η be as in Lemma
′

10.10. Let w ∈ GD∗ +D be an r∗ − 1-fold commutator of ei1 ,j1 , . . . , eir∗ ,jr∗ , where
1 i1 , . . . , ir∗ s − 1, i1 + . . . + ir∗ = s − 1, and 1 jl D∗,il + Di′l for all l with
1 l r∗ .
(i) (No petal-petal terms) If jl > D∗,il for at least two values of l, then
η(w) = 0.
′
(ii) (No regular terms) If jl > D∗,il + Dlin,i
for at least one value of l, then
l
η(w) = 0.
(iii) (No petal-petal terms) If jl > D∗,il for at least two values of l then η(w) =
0.
′
(iv) (No regular terms) If jl > D∗,il + Dlin,i
for at least one value of l then
l
η(w) = 0.
The remainder of this section is devoted to the proof of Theorem 11.1.
Let the notation and assumptions be as in the above theorem. From Proposition
7.3 we know that, for many additive quadruples (h1 , h2 , h3 , h4 ) in H ′ , the sequence
(7.2) is (s − 2)-biased. Also, from Lemma 10.10, we see that for almost all of these
quadruples, the horizontal frequency vectors
4

Fhi ,ind ⊎

F∗,ind ⊎
i=1

Fhi ,lin

(11.1)

i=a,b,c

are independent for all distinct a, b, c ∈ {1, 2, 3, 4}. We may therefore ﬁnd an
additive quadruple (h1 , h2 , h3 , h4 ) for which (7.2) is (s − 2)-biased, and for which
(11.1) is independent for all choices of distinct a, b, c ∈ {1, 2, 3, 4}.
Fix (h1 , h2 , h3 , h4 ) with these properties. We convert the above information to
a non-equidistribution result concerning a polynomial orbit.
For each i = 1, 2, 3, 4, we see from Lemma 10.10 that χhi has a total frequency
representation
(D∗ + D′ , F∗ ⊎ Fh′ i , η).
We write
F∗ ⊎ Fh′ i = (ξhi ,j,k )1

j s−1;1 k Dj ,

where
Dj = D∗,j + Dj′ ;
thus the frequencies associated to F∗ , Fh′ i ,ind , Fh′ i ,lin correspond to the ranges
′
′
1 k D∗,j , D∗,j < k D∗,j + Dind,j
, and D∗,j + Dind,j
< k Dj respectively.
As (7.2) is (s − 2)-biased, we conclude that
|En∈[N ] χh1 (n) ⊗ χh2 (n + h1 − h4 ) ⊗ χh3 (n) ⊗ χh4 (n + h1 − h4 )ψh1 ,h2 ,h3 ,h4 (n)| ≫ 1
(11.2)
for some degree (s − 2) nilsequence ψh1 ,h2 ,h3 ,h4 , where χh is deﬁned to be zero
outside of [N ]. As any cutoﬀ to an interval can be approximated to arbitrary
standard accuracy by a degree 1 nilsequence, and s 3, we see that the same claim
holds if χh is instead extended to be a nilsequence on all of ∗ Z.

60

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

From Deﬁnition 6.1 and the total frequency representation of the χhi , we can
rewrite the sequence inside the expectation of (11.2) as a degree-rank (s − 1, r∗ )
nilsequence n → F (O(n)). Here G/Γ is the product nilmanifold6
4

G(i) /Γ(i)

G/Γ :=

× G(0) /Γ(0)

i=1

for some ﬁltered nilmanifold G(0) /Γ(0) of degree-rank < (s − 1, r∗ − 1) and ﬁltered
nilmanifolds G(i) /Γ(i) of degree-rank (s − 1, r∗ ) for i = 1, 2, 3, 4. The orbit O is
deﬁned by
O = (O1 , O2 , O3 , O4 , O0 ) ∈ ∗ poly(ZN → (G/Γ)N )
where, for each i, j with 1 i 4 and 1 j s − 1 we have


Taylorj (O(i) ) = πHorizj (G(i) /Γ(i) ) φ(i) (

ξh

ej,ki

,j,k

1 k Dj

)

(11.3)

where D := (D1 , . . . , Ds−1 ), φ(i) : GD /ΓD → G(i) /Γ(i) is a ﬁltered homomorphism
and πHorizj (G(i) /Γ(i) ) : (G(i) )j → Horizj (G(i) /Γ(i) ) is the projection to the j th horizontal torus. Finally F ∈ Lip(∗ (G/Γ)) is deﬁned by
F (φ(1) (t(1) )x(1) , . . . , φ(4) (t(4) )x(4) , y) =
e((η(t(1) ) + η(t(2) ) − η(t(3) ) − η(t(4) )))F (x(1) , . . . , x(4) , y)

(11.4)

for all (x(1) , . . . , x(4) , y) ∈ G/Γ and t(1) , . . . , t(4) ∈ GD
(s−1,r∗ ) . (Note that the shifts
by h1 − h4 in (11.2) do not aﬀect the Taylor coeﬃcients of O(i) , thanks to the
remarks following Deﬁnition 9.6.)
By hypothesis, we have
|En∈[N ] F (O(n))| ≫ 1.
Applying Theorem D.6, we conclude that
F (εx) dµ(x)| ≫ 1

|

(11.5)

GP /ΓP

for some bounded ε ∈ G and some rational subgroup GP of G with the property
that
πHorizj (G) (GP ∩ G(i) ) Ξ⊥
(11.6)
j
for all 1 j s − 1, where
Ξ⊥
j := {x ∈ Horizj (G) : ξj (x) = 0 for all ξj ∈ Ξj }
and Ξj
Horizj (G/Γ) is the group of all (standard) continuous homomorphisms
ξj : Horizj (G/Γ) → T such that
ξj (Taylorj (O)) = O(N −j ).
From (11.4) and (11.5) we conclude the following lemma.
6Unfortunately, there will be several types of subscripts on nilpotent Lie groups G in this
argument. Firstly one has the factor groups G(i) . Then one also has the degree filtration groups
Gd and the degree-rank filtration groups G(d,r) of G (and also the analogous subgroups (G(i) )d ,

(G(i) )(d,r) of the factor groups G(i) ), as well as the free nilpotent groups GD = GD
. Finally,
(s−1,r∗ )
a Ratner subgroup GP of G will also make an appearance later. We hope that these notations
can be kept separate from each other.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

61

Lemma 11.2. The group GP ∩ ((G(1) )(s−1,r∗ ) × {id} × {id} × {id} × {id}) is annihilated by η.
Proof. Let g = (g(1) , id, id, id, id) lie in the indicated group. Then g is central, and
so from the invariance of Haar measure we have
F (gεx) dµ(x).

F (εx) dµ(x) =
GP /ΓP

GP /ΓP

On the other hand, from (11.4) we have
F (εx) dµ(x).

F (gεx) dµ(x) = e(η(g))
GP /ΓP

GP /ΓP

Comparing these relationships with (11.5) we obtain the claim.
We now analyse the group GP further. For each 1
j
s − 1, let V123,j
denote the subgroup of Horizj (G(1) ) × Horizj (G(2) ) × Horizj (G(3) ) generated by the
diagonal elements
(φ(1) (ej,k ), φ(2) (ej,k ), φ(3) (ej,k ))
for 1 k D∗,j , and by the elements
(φ(1) (ej,k ), id, id), (id, φ(2) (ej,k ), id), (id, id, φ(3) (ej,k ))
for D∗,j < k Dj . We deﬁne the subgroup V124,j of Horizj (G(1) ) × Horizj (G(2) ) ×
Horizj (G(4) ) similarly by replacing (3) with (4) throughout.
Lemma 11.3 (Components of GP ). Let 1
j
s − 1. Then the projection of
GP ∩ Gj to Horizj (G(1) ) × Horizj (G(2) ) × Horizj (G(3) ) contains V123,j . Similarly,
the projection to Horizj (G(1) ) × Horizj (G(2) ) × Horizj (G(4) ) contains V124,j .
Proof. We shall just prove the ﬁrst claim; the second claim is similar (but uses
{a, b, c} = {1, 2, 4} instead of {a, b, c} = {1, 2, 3}).
Suppose the claim failed for some j. Using (11.6) and duality, we conclude that
there exists a ξj ∈ Ξj which annihilates the kernel of the projection to Horizj (G(1) )×
Horizj (G(2) ) × Horizj (G(3) ), and which is non-trivial on V123,j . As ξj annihilates
the kernel of the projection to Horizj (G(1) ) × Horizj (G(2) ) × Horizj (G(3) ), we have
a decomposition of the form
ξj (x(1) , x(2) , x(3) , x(4) , x(0) ) = ξ(1),j (x(1) ) + ξ(2),j (x(2) ) + ξ(3),j (x(3) )
for x(i) ∈ Horizj (G(i) ) for i = 1, 2, 3, 4, 0, where ξ(i),j : Horizj (G(i) ) → R for
i = 1, 2, 3 are characters.
By deﬁnition of Ξj , we conclude that
ξ(1),j (Taylorj (O(1) )) + ξ(2),j (Taylorj (O(2) )) + ξ(3),j (Taylorj (O(3) )) = O(N −j ).
However, from (11.3) we have
Dj

c(i),j,k ξhi ,j,k

ξ(i),j (Taylorj (O(i) )) =

(11.7)

k=1

where the c(i),j,k are standard integers, deﬁned by the formula
c(i),j,k := ξ(i),j (φ(i) (ej,k )).

(11.8)

From the independence of (11.1) with {a, b, c} = {1, 2, 3}, we conclude that the
c(i),j,k all vanish for i = 1, 2, 3 and D∗,j < k
Dj , and that the sum c(1),j,k +

62

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

c(2),j,k + c(3),j,k vanishes for 1
contradiction.

k

D∗,j . But this forces ξj to vanish on V123,j ,

We now take commutators in the spirit of an argument of Furstenberg and Weiss
[14] (see also [39, 50] for similar arguments in completely diﬀerent settings) to
conclude the following result which roughly speaking asserts that all “petal-petal
interactions” are trivial.
Corollary 11.4 (Furstenberg-Weiss commutator argument). Let w be an r∗ − 1jl
s − 1,
fold iterated commutator of generators ej1 ,k1 , . . . , ejr∗ ,kr∗ with 1
1
kl
Dl for l = 1, . . . , r∗ and j1 + . . . + jr∗ = s − 1 (thus w has “degreerank (s − 1, r∗ )” in some sense). Suppose that at least two of the generators, say
ej1 ,k1 , ej2 ,k2 , are “petal” generators in the sense that k1 > D∗,j1 and k2 > D∗,j2 .
Then (φ(1) (w), id, id, id, id) ∈ GP .
Proof. For ej1 ,k1 , we may invoke Lemma 11.3 and ﬁnd an element gj1 ,k1 of GP ∩Gj1
for which the coordinates 1, 2, 3 are equal (modulo projection to
Horizj1 (G(1) ) × Horizj1 (G(2) ) × Horizj1 (G(3) ))
to (φ1 (ej1 ,k1 ), id, id). Similarly, we may ﬁnd an element gj′ 2 ,k2 of GP ∩ Gj2 for which
the coordinates 1, 2, 4 are equal (modulo projection to
Horizj2 (G(1) ) × Horizj2 (G(2) ) × Horizj2 (G(4) ))
′′
of
to (φ1 (ej2 ,k2 ), id, id). Finally, for all of the other ej,k , we can ﬁnd elements gj,k
GP ∩ Gj for which the ﬁrst coordinate is equal (modulo projection to Horizj (G(1) ))
′′
to φ(1) (ej,k ). If one then takes iterated commutators of the gj1 ,k1 , gj′ 2 ,k2 , gj,k
in the
order indicated by w, we see (using the ﬁltration property, the homomorphism property of φ(1) , and the fact that the Gi /Γi have degree (s−1, r∗ ) for i = 1, 2, 3, 4 and
degree < (s − 1, r∗ − 1) for i = 0) that we obtain the element (φ(1) (w), id, id, id, id).
Since the iterated commutator of elements in GP stays in GP , the claim follows.

From Lemma 11.2 and Corollary 11.4 we immediately obtain the ﬁrst part (i)
of Theorem 11.1. We now turn to the second part of the theorem. For this, we
need two further variants of Lemma 11.3. For any 1 j s − 1, let Vind,j be the
subspace of Horizj (G(1) ) × Horizj (G(2) ) × Horizj (G(3) ) × Horizj (G(4) ) generated by
the elements
(φ(1) (ej,k ), φ(2) (ej,k ), φ(3) (ej,k ), φ(4) (ej,k ))
for 1 k D∗,j and the elements
(φ(1) (ej,k ), id, id, id), (id, φ(2) (ej,k ), id, id), (id, id, φ(3) (ej,k ), id), (id, id, id, φ(4) (ej,k ))
for D∗,j < k

′
D∗,j + Dind,j
.

Lemma 11.5 (Components of GP , II). Let 1
j
s − 1. Then the projection
of GP ∩ Gj to Horizj (G(1) ) × Horizj (G(2) ) × Horizj (G(3) ) × Horizj (G(4) ) contains
Vind,j .
Proof. Suppose the claim failed for some j. Using (11.6) and duality, we conclude that there exists a ξj ∈ Ξj which annihilates the kernel of the projection to
Horizj (G(1) ) × Horizj (G(2) ) × Horizj (G(3) ) × Horizj (G(4) ), and which is non-trivial
on Vind,j . In particular, we have a decomposition of the form
4

ξj (x(1) , x(2) , x(3) , x(4) , x(0) ) =

ξ(i),j (x(i) )
i=1

(11.9)

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

63

for x(i) ∈ Horizj (G(i) ) for i = 1, 2, 3, 4, 0, where ξ(i),j : Horizj (G(i) ) → R for
i = 1, 2, 3, 4 are characters.
By deﬁnition of Ξj , we conclude that
4

ξ(i),j (Taylorj (O(i) )) = O(N −j ).
i=1

Inserting (11.7), we conclude that
Dj

4

c(i),j,k ξhi ,j,k = O(N −j ).

(11.10)

k=1 i=1

The left-hand side is an integer linear combination of the degree j frequencies in
4

4

Fhi ,lin .

Fhi ,ind ⊎

F∗,ind ⊎

i=1

i=1

Using the Freiman homomorphism property from Lemma 10.10 we can eliminate
the role of Fh4 ,lin , leaving only
3

4

Fhi ,lin .

Fhi ,ind ⊎

F∗,ind ⊎
i=1

i=1

But this is just (11.1) for {a, b, c} = {1, 2, 3}. We conclude that the coeﬃcients
of the left-hand side of (11.10) in this basis vanish, which in terms of the original
coeﬃcients c(i),j,k means that
4

c(i),j,k = 0
i=1

for 1

k

D∗,j , and

for D∗,j < k

′
D∗,j + Dind,j
.

c(i),j,k = 0
But this forces ξj to vanish on Vind,j , a contradiction.

We now apply the commutator argument to show that “independent” frequencies
also ultimately have a trivial eﬀect.
Corollary 11.6 (Furstenberg-Weiss commutator argument, II). Let w be an (r∗ −
jl
s − 1,
1)-fold iterated commutator of generators ej1 ,k1 , . . . , ejr∗ ,kr∗ with 1
1
kl
Dl for l = 1, . . . , r∗ and j1 + . . . + jr∗ = s − 1. Suppose that at least
one of the generators, say ej1 ,k1 , is an “independent” generator in the sense that
′
. Then (φ(1) (w), id, id, id, id) ∈ GP .
D∗,j1 < k1 D∗,j1 + Dind,j
1
Proof. We may assume that kl D∗,jl for all 2 l r∗ , as the claim would follow
from Corollary 11.4 otherwise.
For ej1 ,k1 , we may invoke Lemma 11.5 and ﬁnd an element gj1 ,k1 of GP ∩ Gj1
for which the ﬁrst 4 coordinates are equal (modulo projection to Horizj1 (G(1) ) ×
Horizj1 (G(2) )×Horizj1 (G(3) )×Horizj1 (G(4) )) is equal to (φ(1) (ej1 ,k1 ), id, id, id). For
′
the other ej,k , we can ﬁnd elements gj,k
of GP ∩ Gj for which the ﬁrst coordinate
is equal (modulo projection to Horizj (G(1) )) to φ(1) (ej,k ). Taking commutators of
′
in the order indicated by w, we obtain the claim.
gj1 ,k1 and gj,k
Combining Corollary 11.6 with Lemma 11.2 we obtain the second part of Theorem 11.1.

64

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

12. Building a nilobject
The aim of this section is to at last build an object coming from an s-step
nilmanifold. Recall from the discussion in §7 that this object will be a multidegree
(1, s − 1)-nilcharacter χ′ (h, n), and that this completes the proof of Theorem 7.2.
This in turn was used iteratively to prove Theorem 7.1, the heart of our whole
paper. It will then remain to supply the symmetry argument, which will take us
from a 2-dimensional nilsequence to a 1-dimensional one; this will be accomplished
in the next section.
Let f, H, χ, (χh )h∈H be as in Theorem 7.2. If we apply Lemma 10.10, we obtain
the following objects:
• A dense subset H ′ of H;
′
′
′
• Dimension vectors D∗ = D∗,ind + D∗,rat and D′ = Dlin
+ Dind
+ Dsml
,
s−1
s−1
which we write as D∗ = (D∗,i )i=1 , D∗,ind = (D∗,ind,i )i=1 , etc.;
• A core horizontal frequency vector F∗ = (ξ∗,i,j )1 i s−1;1 j D∗,i , which is
partitioned as F∗ = F∗,ind ⊎ F∗,rat , with the indicated dimension vectors
′
′
Dind
, Drat
;
′
• A petal horizontal frequency vector Fh′ = (ξh,i,j
)1 i s−1;1 j Di′ , which is
′
′
′
′
partitioned as Fh = Fh,lin ⊎ Fh,ind ⊎ Fh,sml , which is a limit function of h
′
′
′
, Dind
, Dsml
;
and with the indicated dimension vectors Dlin
• Nilmanifolds Gh /Γh and G0,h /Γ0,h of degree-rank
(s − 1, r∗ ) and
(s − 1, r∗ − 1) respectively for each h ∈ H ′ , depending in a limit fashion
on h;
• Polynomial sequences gh , g0,h ∈ ∗ poly(ZN → (Gh )N ) for each h ∈ H ′ ,
depending in a limit fashion on h;
• Lipschitz functions Fh ∈ Lip(∗ (Gh /Γh ×G0,h /Γ0,h ) → S ω ) for each h ∈ H ′ ,
depending in a limit fashion on h;
′
• a ﬁltered φh : GD∗ +D → Gh for each h ∈ H ′ , depending in a limit fashion
on h; and
′
′
∗ +D
• a character ηh : GD
(s−1,r∗ ) → R for each h ∈ H , depending in a limit
fashion on h
that obey the following properties:
′
• For every 1
i
d and 1
j
Di,lin
, there exists αi,j ∈ ∗ T and
∗
′
βi,j ∈ R such that (10.2) holds, and furthermore that the map h → ξh,i,j
′
is a Freiman homomorphism on H .
• For almost all additive quadruples (h1 , h2 , h3 , h4 ) in H,
3

4

Fh′ i ,lin

Fh′ i ,ind ⊎

F∗,ind ⊎
i=1

i=1

is independent.
• We have the representation
χh (n) = Fh (gh (n)∗ Γh , g0,h (n)∗ Γ0,h )
for every h ∈ H ′ .
′
• φh : GD∗ +D → Gh is a ﬁltered homomorphism such that
Fh (φh (t)x, x0 ) = e(ηh (t))Fh (x, x0 )

(12.1)

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

65

′

∗ +D
for all t ∈ GD
(s−1,r∗ ) , x ∈ Gh /Γh , and x0 ∈ G0,h /Γ0,h ;
• One has the Taylor coeﬃcients

D∗,i +Di′

ξ

ei,jh,i,j ))

Taylori (gh Γh ) = πHorizi (Gh /Γh ) (φh (

(12.2)

j=1

for all 1

i

s − 1.

There are only countably many nilmanifolds G/Γ up to isomorphism, so by
passing from H ′ to a dense subset using Lemma A.9 we may assume that
Gh /Γh = G/Γ

and G0,h /Γ0,h = G0 /Γ0

are independent of h. Similarly we may take ηh = η and φh = φ to be independent
of h. From the Arzel`
a-Ascoli theorem, the space of possible Fh is totally bounded,
and so (shrinking ε slightly if necessary) we may also assume that Fh = F is
independent of h.
For j with 1
j
D∗,i , since ξh,i,j is independent of h, we can ensure that
′
ξh,i,j = γi,j is also independent of h. Meanwhile, for D∗,i < j D∗,i + Di,lin
, from
(10.2) we may assume that ξh,i,j takes the form
ξh,i,j = {αi,j h}βi,j mod 1
∗

for some αi,j ∈ T and βi,j ∈ ∗ R. By passing to a dense subset of H ′ using the
pigeonhole principle, we may assume for each i, j, that {αi,j h} is contained in a
subinterval ∗ Ii,j around ∗ 0 of length at most 1/10 (say).
We now wish to apply Theorem 11.1 to obtain more convenient equivalent rep(s−1,r )
˜ be the free Lie
˜h for the nilcharacters χh . Let G
resentatives (in ΞDR ∗ ([N ]) ) χ
′
group generated by the generators e˜i,j for 1 i s − 1 and 1 j D∗i + Dlin,i
subject to the following relations:
• Any (r − 1)-fold iterated commutator of e˜i1 ,j1 , . . . , e˜ir ,jr with i1 + . . .+ ir >
s − 1 vanishes;
• Any (r − 1)-fold iterated commutator of e˜i1 ,j1 , . . . , e˜ir ,jr with i1 + . . .+ ir =
s − 1 and r > r∗ vanishes;
• Any (r −1)-fold iterated commutator of e˜i1 ,j1 , . . . , e˜ir ,jr in which jl > D∗,il
for at least two values of l vanishes.
˜ DR by deﬁning G
˜ (d,r) to be the group generated
We give this group a DR-ﬁltration G
by the (r′ − 1)-fold iterated commutators of e˜i1 ,j1 , . . . , e˜ir′ ,jr′ with i1 + . . . + ir′ d
˜ be the discrete group generated by the e˜i,j ; G/
˜ Γ
˜ is then
and r′ r. We then let Γ
a nilmanifold of degree-rank (s − 1, r∗ ).
′
Let G∗ be the subgroup of GD∗ +D generated by (r−1)-fold iterated commutators
e˜i1 ,j1 , . . . , e˜ir ,jr with i1 + . . . + ir = s − 1 in which jl > D∗,il for at least two values
′
of l, or jl > D∗,il + Dlin,i
for at least one value of l. Then G∗ is a subgroup of the
l
′
′
˜ is isomorphic to the quotient of GD∗ +D′
central group GD∗ +D of GD∗ +D , and G
(s−1,r∗ )

′

˜ denote the quotient map. From Theorem 11.1,
by G∗ . We let φ˜ : GD∗ +D → G
D∗ +D′
the character η : G(s−1,r∗ ) → R annihilates G∗ , and thus descends to a vertical
˜ (s−1,r ) → R.
character η˜ : G
∗
˜ Γ
˜ → S ω ) with vertical frequency η˜; such a
We select a function F˜ ∈ Lip(G/
function can be built using the construction (6.3).

66

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

˜ N ) by the forWe then deﬁne the polynomial sequences g0 , g˜h ∈ ∗ poly(ZN → G
mulae
s−1 D∗,i

γi,j (n
i)

e˜i,j

g0 (n) :=

(12.3)

i=1 j=1
′

s−1 D∗,i +Dlin,i

{αi,j h}βi,j (n
i)

(12.4)

e˜i,j

g˜h (n) :=
i=1 j=D∗,i +1

and consider the nilcharacter
˜
χ
˜h (n) := F˜ (g0 (n)˜
gh (n)∗ Γ).
(s−1,r∗ )

These nilcharacters are equivalent to χh in SymbDR
lemma shows.

(12.5)
([N ]), as the following

Lemma 12.1. For each h ∈ H ′ , χh and χ
˜h are equivalent (as nilcharacters of
degree-rank (s − 1, r∗ )) on [N ].
Proof. Fix h. It suﬃces to show that χh ⊗ χ
˜h is a nilsequence of degree < s − 1.
We can write this sequence as
n → Fh′ (gh′ (n)∗ Γ′ ),

(12.6)

˜ Γ := Γ × Γ0 × Γ,
˜ g ′ ∈ ∗ poly(ZN → G′ ) is the sequence
where G′ := G × G0 × G,
h
N
gh′ (n) := (gh (n), g0,h (n), g0 (n)˜
gh (n))
and Fh′ ∈ Lip(∗ (G′ /Γ′ )) is the function
Fh′ (x, x0 , y) := Fh (x, x0 ) ⊗ F˜ (y).
We deﬁne a DR-ﬁltration G′DR on G′ by deﬁning G′(d,r) for (d, r) ∈ DR with r
to be the Lie group generated by the following sets:
˜ (d,r+1) ;
(i) G(d,r+1) × (G0 )(d,r) × G
′
˜
(ii) {(φ(g), id, φ(g)) : g ∈ GD∗ +D },

1

(d,r)

with the convention that (d, d + 1) = (d + 1, 0). We also set G′(d,0) := G′(d,1) for
d 1. One easily veriﬁes that this is a ﬁltration.
We claim that g ′ is polynomial with respect to this ﬁltration. Indeed, the sequence n → (id, g0,h (n), id) is already polynomial in this ﬁltration, so by Corollary
B.4 it suﬃces to verify that the sequence
n → (gh (n), id, g0 (n)˜
gh (n))
is polynomial. We use Lemma B.9 to Taylor expand gh (n) =
gh,i ∈ G(i,0) . From (12.2), one has
D∗,i +Di′

ξ

ei,jh,i,j mod G(i,2) .

gh,i = φ
j=1

By construction of the ﬁltration of G′ , this implies that
D∗,i +Di′

ξ

ei,jh,i,j mod G∗ ∈ G′(i,1) .

gh,i , id,
j=1

(12.7)
s−1
i=0

n
i

( )
gh,i where

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

67

Applying Corollary B.4, we conclude that the sequence
′
s−1 D∗,i +Di

(

n → gh (n), id,

n

ei,jh,i,j )( i ) mod G∗
ξ

j=1

i=0

is polynomial with respect to the G′ ﬁltration. Applying the Baker-CampbellHausdorﬀ formula repeatedly, and using (12.3), (12.4), we see that
′
s−1 D∗,i +Di

(

n→
i=0

n

ei,jh,i,j )( i ) mod G∗
ξ

j=1

diﬀers from the sequence n → g0 (n)˜
gh (n) by a sequence which is polynomial in
˜ (d,r+1) )(d,r)∈DR . We conclude that (12.7) is polynomial as
the shifted ﬁltration (G
required.
Next, we claim that Fh′ is invariant with respect to the action of the central
group
˜
G′
= {(φ(g), id, φ(g))
: g ∈ GD
}.
(s−1,r∗ )

(s−1,r∗ )

It suﬃces to check this for generators (φ(w), id, w mod G∗ ), where w is an (r∗ − 1)fold commutator of ei1 ,j1 , . . . , eir∗ ,jr∗ in GD with i1 + . . . + ir = s − 1. There
′
are two cases. If one has jl > D∗,il + Dlin,i
for some l, then w lies in G∗ and
l
is also annihilated by η, and the claim follows from (12.1). If instead one has
′
jl D∗,il + Dlin,i
for all l, then the claim again follows from (12.1) together with
l
the construction of η˜ and F˜ .
We may now quotient out G′(0,0) by G′(s−1,r∗ ) and obtain a representation of
(12.6) as a nilsequence of degree-rank < (s − 1, r∗ ), as desired.
From this lemma and Lemma E.8(ii) we can express χh as a bounded linear
combination of χ
˜h ⊗ ψh for some nilsequence ψh of degree-rank (s − 1, r∗ − 1).
Thus, to prove Theorem 7.2 it suﬃces to show that there is a nilcharacter χ
˜ ∈
Ξ(1,s−1) (∗ Z2 ), such that χ
˜h (n) = χ(h,
˜ n) for many h ∈ H ′ and all n ∈ [N ].
We illustrate the construction with an example. Let
G := G(2,0) = {et11 et22 [e1 , e2 ]t12 : t1 , t2 , t12 ∈ R}
be the universal degree 2 nilpotent group (6.1) generated by e1 , e2 . Let F be the
Lipschitz function in equation (6.3). Suppose
χh (n) := F (gh (n)∗ Γ)
αh n
with gh (n) := eβn
, where αh := {δh}γ, and α, β, γ ∈ ∗ R. As computed in §6,
2 e1
we have
Fk (gh (n)∗ Γ) = φk (αh n mod 1, βn mod 1)e({αh n}βn)

for some Lipschitz function φk : T2 → C. We would like to interpret the function
(1,2)
(h, n) → χh (n) as a nilcharacter in ΞMulti (∗ Z2 ). The ﬁrst task is to identify a
subgroup Gpetal of the group G representing that part of G that is “inﬂuenced by”
the petal frequency αh ; more speciﬁcally, we take Gpetal to be the subgroup of G
generated by e1 and [e1 , e2 ], that is to say
Gpetal = e1 , [e1 , e2 ]

R

= {et11 [e1 , e2 ]t12 : t1 , t12 ∈ R}.

68

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Note that Gpetal is abelian and normal in G. In particular G acts on Gpetal by
conjugation, and we may form the semidirect product
G ⋉ Gpetal := {(g, g1 ) : g ∈ G, g1 ∈ Gpetal },
deﬁning multiplication by
′

(g, g1 ) · (g ′ , g1′ ) = (gg ′ , g1g g1′ ),
where ab := b−1 ab denotes conjugation.
Now consider the action ρ of R on G ⋉ Gpetal deﬁned by
ρ(t)(g, g1 ) := (gg1t , g1 ).
We may form a further semidirect product
G′ := R ⋉ρ (G ⋉ Gpetal ),
in which the product operation is deﬁned by
(t, (g, g1 )) · (t′ , (g ′ , g1′ )) = (t + t′ , ρ(t′ )(g, g1 ) · (g ′ , g1′ )).
G′ is a Lie group; indeed, one easily veriﬁes that it is 3-step nilpotent. We give G′
a N2 -ﬁltration:
G′(0,0) := G′
G′(1,0) := {(t, (g, id)) : t ∈ R, g ∈ Gpetal }
G′(1,1) := {(0, (g, id)) : g ∈ Gpetal },
G′(1,2) := {(0, (g, id)) : g ∈ [G, G]},
G′(0,1) := {(0, (g, g1 )) : g ∈ Gpetal ; g1 ∈ Gpetal },
G′(0,2) := {(0, (g, g1 )) : g, g1 ∈ [G, G]},
with G′i,j := {id} for all other (i, j) ∈ N2 . One easily veriﬁes that this is a ﬁltration.
Inside G′ we take the lattice
Γ′ := Z ⋉ρ (Γ ⋉ Γpetal ),
where Γpetal := Γ ∩ Gpetal . Now consider the polynomial g ′ : Z2 → G′ deﬁned by
γn
g ′ (h, n) := (0, (eβn
2 , e1 )) · (δh, (id, id))

and observe that
γn
′
g ′ (h, n)Γ′ = (0, (eβn
2 , e1 )) · ({δh}, (id, id))Γ
{δh}γn

= ({δh}, (eβn
2 e1

′
, eγn
1 ))Γ .

For a dense subset H ′′ , {δh} is in a small interval I, and let ψ be a smooth cutoﬀ
function supported on 2I. Take F ′ : G′ /Γ′ → CD to be the function deﬁned by
F ′ ((t, (g, g ′ ))Γ′ ) := ψ(t)F (gΓ)
whenever t ∈ I and 0 otherwise. Then we have for h ∈ H ′′
˜ = F (eβn e{δh}γn Γ) = χh (n),
F ′ (g ′ (h, n)Γ)
2

1

giving the desired representation of (h, n) → χh (n) as an (almost) degree (1, 2)
nilcharacter.
We now turn to the general case. Our construction shall proceed by an abstract
˜ petal be the subgroup of G
˜ generated by (r − 1)-fold
algebraic construction. Let G

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

69

(r ≥ 1) iterated commutators of e˜i1 ,j1 , . . . , e˜ir ,jr in which jl > D∗,il for exactly one
˜ petal is a rational abelian normal subgroup of G.
˜ To see that
value of l. Then G
˜
Gpetal is normal, ones uses the equalities
−1
e˜−1
ei,j = [˜
e−1
ei,j , e˜−1
ei,j ] and e˜i,j
g˜
ei,j = g[g, e˜i,j ],
i,j [g, h]˜
i,j g˜
i,j h˜

the commutator identities in equation (3.1), and the fact that any iterated commutators of e˜i1 ,j1 , . . . , e˜ir ,jr in which jl > D∗,il for more than one value of l is trivial
˜
in G.
˜ acts on G
˜ petal by conjugation, leading to the semidirect product
In particular, G
˜⋉G
˜ petal of pairs (g, g1 ) with the product
G
′

(g, g1 )(g ′ , g1′ ) := (gg ′ , g1g g1′ ).
′
Next, let R be the commutative ring of tuples t = (ti,j )1 i s−1;D∗,i <j D∗,i +Dlin,i
with ti,j ∈ R, which we endow with the pointwise product. For each t ∈ R, we can
˜ which we deﬁne on generators by mapping
deﬁne an homomorphism g → g t on G,
t
′
e˜i,j to e˜i,j for D∗,i < j
D∗,i + Dlin,i
, but preserving e˜i,j for j
D∗,i . Such
˜ We
a homomorphism is well-deﬁned as it preserves the deﬁning relations of G.
observe the composition law
′
′
(g t )t = g tt
˜ and t, t′ ∈ R. Also, on the abelian subgroup G
˜ petal on G,
˜ we see that
for g ∈ G
′

′

g t g t = g t+t

(12.8)

as can be seen from the Baker-Campbell-Hausdorﬀ formula (3.2). We can thus
express
g˜h (n) = g1 (n){αh}
(12.9)
˜ petal )N ) is the polynomial sequence
where g1 ∈ ∗ poly(ZN → (G
′

s−1 D∗,i +Dlin,i

βi,j (n
i)

e˜i,j

g1 (n) :=
i=1 j=D∗,i +1

and {αh} ∈ R is the element
{αh} := ({αi,j h})1

′
.
i s−1;D∗,i <j D∗,i +Dlin,i

˜ petal , and is the identity once G
˜ petal is
The homomorphism g → g t preserves G
quotiented out. As a consequence we see that
(gg1 g −1 )t = gg1t g −1

(12.10)
˜
˜
for any g ∈ G and g1 ∈ Gpetal .
We can now deﬁne an action ρ of R (viewed now as an additive group) on
˜⋉G
˜ petal by deﬁning
G
ρ(t)(g, g1 ) := (gg1t , g1 );
the properties (12.8), (12.10) ensure that this is indeed an action. We can then
˜⋉G
˜ petal ) to be the set of pairs
deﬁne the semi-direct product G′ := R ⋉ρ (G
(t, (g, g1 )) with the product
(t, (g, g1 ))(t′ , (g ′ , g1′ )) = (t + t′ , ρ(t′ )(g, g1 )(g ′ , g1′ )).
This is a Lie group. We can give it a N2 -ﬁltration (G′(d1 ,d2 ) )(d1 ,d2 )∈N2 as follows:
(i) If d1 > 1, then G′(d1 ,d2 ) := {id}.

70

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

(ii) If d1 = 1 and d2 > 0, then G′(1,d2 ) consists of the elements (0, (g, id)) with
˜ petal .
˜ d2 ∩ G
g∈G
(iii) If d1 = 1 and d2 = 0, then G′(1,0) consists of the elements (t, (g, id)) with
˜ petal .
t ∈ R and g ∈ G
(iv) If d1 = 0 and d2 > 0, then G′(0,d2 ) consists of the elements (0, (g, g1 )) with
˜ petal ∩ G
˜ d2 .
˜ d2 and g1 ∈ G
g∈G
(v) G′(0,0) = G′ .
One easily veriﬁes that this is a ﬁltration of degree (1, s − 1) with G′(0,0) = G′ .
˜ consisting of pairs (t, (g, g1 )) with g ∈ Γ,
˜
We let Γ′ be the subgroup of G
˜ petal, and with all coeﬃcients of t integers. One easily veriﬁes that Γ′ is
g1 ∈ Γ
a cocompact subgroup of G′ , and that the above N2 -ﬁltration of G′ is rational with
respect to Γ′ , so that G′ /Γ′ has the structure of a ﬁltered nilmanifold.
We consider the orbit O′ ∈ ∗ poly(Z2N2 → (G′ /Γ′ )N2 ) deﬁned by
O′ (h, n) := (0, (g0 (n), g1 (n)))(αh, (id, id))∗ Γ′ ,
where
αh := (αi,j h)1

′
.
i s−1;D∗,i <j D∗,i +Dlin,i

As g0 , g1 were already known to be polynomial maps, and the linear map h → αh
is clearly polynomial also, we see from Corollary B.4 and the choice of ﬁltration on
G′ that O′ is a polynomial orbit.
Now we simplify the orbit. Working on the abelian group R, we see that
(αh, (id, id))∗ Γ′ = ({αh}, (id, id))∗ Γ′ ,
and then commuting this with (0, (g0 (n), g1 (n))), we obtain
O′ (h, n) = ({αh}, (g0 (n)g1 (n){αh} , g1 (n)))∗ Γ′ .

(12.11)

Recall that for many h ∈ H that each component {αi,j h} of {αh} lies in an interval
Ii,j of length at most 1/10. Let 2Ii,j be the interval of twice the length and with
the same centre as Ii,j , and let ϕi,j : R → R be a smooth cutoﬀ function supported
on Ii,j . We then deﬁne a function F ′ : G′ /Γ′ → Cω by setting
′

s−1 D∗,i +Dlin,i
′

F (((ti,j )1

˜
ϕi,j (ti,j ) F˜ (g ∗ Γ)

∗ ′

′
, (g, g1 ))
i s−1;D∗,i <j D∗,i +Dlin,i

Γ ) :=
i=1 j=D∗,i +1

˜⋉G
˜ petal and ti,j ∈ 2Ii,j for all 1 i s − 1 and D∗,i < j
whenever (g, g1 ) ∈ G
′
′
D∗,i + Dlin,i , with F set equal to zero whenever no representation of the above
form exists. One can easily verify that F ′ is well-deﬁned and Lipschitz. Since F˜
has vertical frequency η˜, F ′ has vertical frequency η ′ : G′(1,s−1) → R, deﬁned by
the formula
η ′ ((0, (g, id)) := η˜(g)
˜ s−1 . From (12.5), (12.9) and (12.11), we see that for many h ∈ H ′ we
for all g ∈ G
have
χ
˜h (n) = F ′ ◦ O′ (h, n)
(1,s−1)

for all n ∈ [N ]. By construction, F ′ ◦ O′ ∈ ΞMulti (∗ Z2 ), and Theorem 7.1 follows.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

71

13. The symmetry argument
In this, the last section of the main part of the paper, we supply the symmetry
argument, Theorem 7.4; we recall that statement now.
Theorem 7.4. Let f ∈ L∞ [N ], let H be a dense subset of [[N ]], and let χ ∈
Ξ(1,s−1) (∗ Z2 ) be such that ∆h f < (s − 2)-correlates with χ(h, ·) for all h ∈ H. Then
there exists a nilcharacter Θ ∈ Ξs (∗ Z) (with the degree filtration) and a nilsequence
Ψ ∈ Nil⊂J (∗ Z2 ) (with the multidegree filtration), with J given by the downset
J := {(i, j) ∈ N2 : i + j

s − 1} ∪ {(i, s − i) : 2

i

s},

(13.1)

such that χ(h, n) is a bounded linear combination of Θ(n + h) ⊗ Θ(n) ⊗ Ψ(h, n).
Example 13.1. Suppose that s = 2, χ(h, n) = e(P (h, n)), and P (h, n) : ∗ Z2 → ∗ R
is a symmetric bilinear form in n, h. Then observe that
χ(h, n) = Θ(n + h)Θ(n)Ψ(h, n)

(13.2)

where Θ(n) := e( 21 P (n, n)) and Ψ(h, n) := e(− 21 P (h, h)), which illustrates a special
case of Theorem 7.4. More generally, if s 2 and χ(h, n) = e(P (h, n, . . . , n)) with
P (h, n1 , . . . , ns−1 ) : ∗ Zs → ∗ R a symmetric multilinear form, then we have (13.2)
with Θ(n) := e( 1s P (n, . . . , n)), and Ψ(h, n) a polynomial phase involving terms of
multidegree (i, s − i) in h, n with 2 i s. Thus we again obtain a special case
of Theorem 7.4. Note how the symmetry of P is crucial in order to make these
examples work, which explains why we refer to Theorem 7.4 as a symmetrisation
result. Morally speaking, this type of symmetry property ultimately stems from the
identity ∆h ∆k f = ∆k ∆h f . We remark that an analogous symmetrisation result
was crucial to the analogous proof of GI(2) in [21] (see also [51]), although our
arguments here are slightly diﬀerent.
From the inclusions at the end of §6, χ(h, n) is a nilcharacter on Z2 (with the
degree ﬁltration) of degree
s. For similar reasons, any nilsequence Ψ(h, n) of
degree s − 1 (using the degree ﬁltration on Z2 ) will automatically be of the form
required for Theorem 7.4. In view of this and Lemma E.8, we see that it will suﬃce
to obtain a factorisation of the form
[χ]Ξs ([[N ]]×[N ]) = [Θ(n + h)]Ξs ([[N ]]×[N ]) − [Θ(n)]Ξs ([[N ]]×[N ]) + [Ψ(h, n)]Ξs ([[N ]]×[N ])
where Θ ∈ Ξs (∗ N) is a one-dimensional nilcharacter of degree s (which automatically makes (h, n) → Θ(n) and (h, n) → Θ(n + h) two-dimensional nilcharacters of
degree s, by Lemma E.8(vi)), and Ψ ∈ Ξs (∗ N2 ) is a two-dimensional nilcharacter
of multidegree
⊂ {(i, j) ∈ N2 : i + j s; j s − 2}.
(13.3)
The set of classes [Ψ(h, n)]Ξs ([[N ]]×[N ]), with Ψ of the above form, is a subgroup of
the space Symbs ([[N ]] × [N ]) of all symbols of degree s nilcharacters on [[N ]] × [N ].
Denoting the equivalence relation induced by these classes as ≡, our task is thus to
show that
[χ]Ξs ([[N ]]×[N ]) ≡ [Θ(n + h)]Ξs ([[N ]]×[N ]) − [Θ(n)]Ξs ([[N ]]×[N ]) .
In view of Theorem E.10 and Lemma E.8 (vii), there is a nilcharacter χ
˜ on ∗ Zs
of degree (1, . . . , 1) which is symmetric in the last s − 1 variables, and such that
[χ(h, n)]Ξs (∗ Z2 ) = s[χ(h,
˜ n, . . . , n)]Ξs (∗ Z2 ) .

(13.4)

72

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Inspired by the polynomial identity
shns−1 = (n + h)s − ns − . . .
where the terms in . . . are of degree s in h, n but of degree at most s − 2 in n, we
now choose
Θ(n) := χ(n,
˜ . . . , n).
From Lemma E.8 (vi) we see that Θ is a nilcharacter of degree
s. Our task is
now to show that
[χ(n
˜ + h, . . . , n + h)]Ξs ([[N ]]×[N ])−[χ(n,
˜ . . . , n)]Ξs ([[N ]]×[N ]) −
− s[χ(h,
˜ n . . . , n)]Ξs ([[N ]]×[N ]) ≡ 0.

(13.5)

To manipulate this, we use the following lemma.
Lemma 13.2 (Multilinearity). Let χ
˜ be a nilcharacter on Zs (with the multidegree
filtration) of degree (1, . . . , 1). Let m 1 be standard, and let L1 , . . . , Ls : Zm → Z
and L′1 : Zm → Z be homomorphisms. Then we have linearity in the first variable,
in the sense that
[χ(L
˜ 1 (n) + L′1 (n), L2 (n), . . . , Ls (n))]Ξs (∗ Zm ) = [χ(L
˜ 1 (n), L2 (n), . . . , Ls (n))]Ξs (∗ Zm )
+ [χ(L
˜ ′1 (n), L2 (n), . . . , Ls (n)]Ξs (∗ Zm ) ,
where n = (n1 , . . . , nm ) are the m independent variables of ∗ Zm , and Zm is given
the degree filtration. We similarly have linearity in the other s − 1 variables.
Proof. We prove the claim for the ﬁrst variable, as the other cases follow from
symmetry. From Lemma E.3 and Lemma E.8(vi), it will suﬃce to show that the
expression
˜ 1 , h2 , . . . , hs ) ⊗ χ(h
˜ ′1 , h2 , . . . , hs )
χ(h
˜ 1 + h′1 , h2 , . . . , hs ) ⊗ χ(h
is

(13.6)

a degree < s nilsequence in h1 , h′1 , h2 , . . . , hs (using the
Write χ(h
˜ 1 , . . . , hs ) = F (g(h1 , . . . , hs )∗ Γ), where G/Γ
∗

degree ﬁltration).
is a Ns -ﬁltered nilmanifold of degree
(1, . . . , 1), F ∈ Lip( (G/Γ)) has a vertical frequency, and g ∈
∗
poly(ZsNs → GNs ). Then the expression (13.6) takes the form
F˜ (˜
g(h1 , h′ , h2 , . . . , hs )∗ Γ3 )
1

where g˜ : ∗ Zs+1 → G3 is the map
g˜(h1 , h′1 , h2 , . . . , hs ) := (g(h1 + h′1 , h2 , . . . , hs ), g(h1 , h2 , . . . , hs ), g(h′1 , h2 , . . . , hs ))
and F˜ ∈ Lip(∗ (G/Γ)3 ) is the map
F˜ (x1 , x2 , x3 ) = F (x1 ) ⊗ F (x2 ) ⊗ F (x3 ).
By Lemma B.9, we can expand
(h11 )...(hiss )
gi1i,...,i
s

g(h1 , . . . , hs ) =
i1 ,...,is ={0,1}

for some gi1 ,...,is ∈ G(i1 ,...,is ) , where we order {0, 1}s lexicographically (say).
We now N-ﬁlter G3 by deﬁning (G3 )i to be the group generated by (G(i1 ,...,is ) )3
for all i1 , . . . , is ∈ N with i1 + . . . + is > i, together with the groups {(g1 g2 , g1 , g2 ) :
g1 , g2 ∈ G(i1 ,...,is ) } for i1 +. . .+is = i. From the Baker-Campbell-Hausdorﬀ formula
(3.2) one veriﬁes that this is a rational ﬁltration of G3 . From the Taylor expansion
we also see that g˜ is polynomial with respect to this ﬁltration (giving Zs+1 the

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

73

degree ﬁltration). Finally, as F has a vertical character, we see that F˜ is invariant
with respect to the action of (G3 )s = {(g1 g2 , g1 , g2 ) : g1 , g2 ∈ G(1,...,1) }. Restricting
G3 to (G3 )0 and quotienting out by (G3 )s we obtain the claim.
Using this lemma repeatedly, together with the symmetry of χ
˜ in the ﬁnal s − 1
variables, we see that we can expand
[χ(n
˜ + h, . . . , n + h)]Ξs (∗ Z2 ) =
s−1
j=0

s−1
j

[χ(n,
˜ h, . . . , h, n, . . . , n)]Ξs (∗ Z2 ) + [χ(h,
˜ h, . . . , h, n, . . . , n)]Ξs (∗ Z2 ) ,

where in the terms on the right-hand side, the ﬁnal j coeﬃcients are equal to n,
the ﬁrst coeﬃcient is either n or h, and the remaining coeﬃcients are h. Note that
a term with j h factors and (s − j) n factors will have degree (13.3) and thus be
negligible as long as j 2. Neglecting these terms, we obtain the simpler expression
[χ(n
˜ + h, . . . , n + h)]Ξs (∗ Z2 ) ≡[χ(n,
˜ . . . , n)]Ξs (∗ Z2 ) + [χ(h,
˜ n, . . . , n)]Ξs (∗ Z2 )
+ (s − 1)[χ(n,
˜ h, n, . . . , n)]Ξs (∗ Z2 ) .
Comparing this with (13.3), we will be done as soon as we can show the symmetry
property
(s − 1)[χ(h,
˜ n, . . . , n)]Ξs ([[N ]]×[N ]) = (s − 1)[χ(n,
˜ h, n, . . . , n)]Ξs ([[N ]]×[N ]).

(13.7)

This property does not automatically follow from the construction of χ.
˜ Instead,
we must use the correlation properties of χ, as follows.
By hypothesis and Lemma E.5, we have that for all h in a dense subset H of
[[N ]], we can ﬁnd a degree s − 2 nilcharacter ϕh such that f1 (· + h)f2 (·) correlates
with χ(h, ·, . . . , ·) ⊗ ϕh . By Corollary A.12, we may assume that the map h → ϕh
is a limit map. We set ϕh = 0 for h ∈ H.
To use this information, we return7 to Proposition 8.4. Invoking that proposition,
we see that for many additive quadruples (h1 , h2 , h3 , h4 ) in [[N ]], the sequence
n → χ(h1 , n) ⊗ χ(h2 , n + h1 − h4 ) ⊗ χ(h3 , n) ⊗ χ(h4 , n + h1 − h4 )
⊗ ϕh1 (n) ⊗ ϕh2 (n + h1 − h4 ) ⊗ ϕh3 (n) ⊗ ϕh4 (n + h1 − h4 )
is biased.
We make the change of variables (h1 , h2 , h3 , h4 ) = (h + a, h + b, h + a + b, h) and
then pigeonhole in h, to conclude the existence of an h0 for which
n → τ (a, b, n) ⊗ ϕh0 +a (n) ⊗ ϕh0 +b (n + a) ⊗ ϕh0 +a+b (n) ⊗ ϕh0 (n + a)
is biased for many pairs a, b ∈ [[2N ]], where τ = τh0 is the expression
τ (a, b, n) := χ(h0 + a, n) ⊗ χ(h0 + b, n + a) ⊗ χ(h0 + a + b, n) ⊗ χ(h0 , n + a). (13.8)
Henceforth h0 is ﬁxed, and we will suppress the dependence of various functions on
this parameter. From Lemma E.3, τ is a degree 3 nilcharacter on ∗ Z3 (with the
degree ﬁltration). We record its top order symbol:
7Here is a key place where we use the hypothesis s
3 (the other is Lemma 10.9). For s = 2
the lower order terms in Proposition 8.4 are useless; however a variant of the argument below still
works, see [21].

74

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Lemma 13.3. We have
[τ (a, b, n)]Ξs (∗ Z3 ) ≡ s(s − 1)[χ(b,
˜ a, n, . . . , n)]Ξs (∗ Z3 )
where by ≡ we are quotienting by all symbols of degree

s − 3 in n.

Proof. From (13.4), (13.8), Lemma E.3 and Lemma E.8 one has
[τ (a, b, n)]Ξs (∗ Z3 ) =s([χ(a,
˜ n, . . . , n)]Ξs (∗ Z3 ) + [χ(b,
˜ n + a, . . . , n + a)]Ξs (∗ Z3 ) −
− [χ(a
˜ + b, n, . . . , n)]Ξs (∗ Z3 ) ).
Applying Lemma 13.2 in the ﬁrst variable we simplify this as
s([χ(b,
˜ n + a, . . . , n + a)]Ξs (∗ Z3 ) − [χ(a,
˜ n, . . . , n)]Ξs (∗ Z3 ) ).
Applying Lemma 13.2 in all the other variables and gathering terms using the
symmetry of χ
˜ in those variables, we arrive at
s−2

s
j=0

s−1
[χ(b,
˜ a, . . . , a, n, . . . , n)]Ξs (∗ Z3 ) ,
j

where there are j occurrences of n and s − 1 − j occurrences of a. All the terms
with j < s − 2 are of degree s − 2 in n, and the claim follows.
From Lemma E.8, we know that ϕh0 +b (n + a) is a bounded linear combination of
ϕh0 +b (n)⊗ψa,b (n) for some degree s−3 nilsequence ψa,b . Similarly for ϕh0 (n+a).
We conclude that
n → τ (a, b, n) ⊗ ϕh0 +a (n) ⊗ ϕh0 +b (n) ⊗ ϕh0 +a+b (n) ⊗ ϕh0 (n)
is

(s − 3)-biased for many a, b ∈ [[2N ]].
We will now eliminate the ϕh terms in order to focus attention on τ . Applying
Corollary A.12, we may thus ﬁnd a scalar degree s−3 nilsequence ψa,b depending
in a limit fashion on a, b ∈ [[2N ]], such that
|Ea,b∈[[2N ]];n∈[N ]τ (a, b, n) ⊗ ϕh0 +a (n) ⊗ ϕh0 +b (n)⊗ϕh0 +a+b (n)⊗
⊗ ϕh0 ,k′ (n + a)ψa,b (n)| ≫ 1.
We pull out the b-independent factors ϕh0 +a (n) ⊗ ϕh0 (n) and Cauchy-Schwarz in
a, n to conclude that
|Ea,b,b′ ∈[[2N ]];n∈[N ]τ (a, b, n) ⊗ τ (a, b′ , n) ⊗ ϕh0 +b (n) ⊗ ϕh0 +b′ (n)
⊗ ϕh0 +a+b (n) ⊗ ϕh0 +a+b′ (n)ψa,b,b′ (n)| ≫ 1,

where (a, b, b′ ) → ψa,b,b′ is a limit map assigning a scalar degree s − 3 nilsequence
to each a, b, b′ . Next, we make the substitution c := a + b + b′ and conclude that
|Ec,b,b′ ∈[[3N ]];n∈[N ]τ (c − b − b′ , b, n) ⊗ τ (c − b − b′ , b′ , n)
′
⊗ ϕh0 +b (n) ⊗ ϕh0 +b′ (n) ⊗ ϕh0 +c−b′ (n)ϕh0 +c−b (n)ψc,b,b
′ (n)| ≫ 1
′
where (c, b, b′ ) → ψc,b,b
s − 3 nilsequence
′ is a limit map assigning a scalar degree
′
to each c, b, b . By the pigeonhole principle, we can thus ﬁnd a c0 such that

|Eb,b′ ∈[[3N ]];n∈[N ]α(b, b′ , n) ⊗ ϕ′b (n) ⊗ ϕ′b′ (n)ψc′ 0 ,b,b′ (n)| ≫ 1

(13.9)

where α = αc0 is the form
α(b, b′ , n) := τ (c0 − b − b′ , b, n) ⊗ τ (c0 − b − b′ , b′ , n)

(13.10)

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

75

and ϕ′b = ϕ′b,c0 is the quantity
ϕ′b (n) := ϕh0 +b,k (n) ⊗ ϕh0 +c0 −b (n).
We ﬁx this c0 . Again by Lemma E.3, α is a degree
s nilcharacter on ∗ Z3 , and
we pause to record its symbol in the following lemma.
Lemma 13.4. We have
[α(b, b′ , n)]Ξs (∗ Z3 ) ≡ −s(s − 1)[χ(b
˜ + b′ , b − b′ , n, . . . , n)]Ξs (∗ Z3 )
where by ≡ we are quotienting by all symbols of degree

s − 3 in n.

Proof. From (13.10) and Lemma E.8 we can write the left-hand side as
[τ (−b − b′ , b, n)]Ξs (∗ Z3 ) − [τ (−b − b′ , b′ , n)]Ξs (∗ Z3 ) .
Applying (13.3), we can write this as
s(s − 1)([χ(−b
˜
− b′ , b, n, . . . , n)]Ξs (∗ Z3 ) − [χ(−b
˜
− b′ , b′ , n, . . . , n)]Ξs (∗ Z3 ) ).
The claim then follows from some applications of Lemma 13.2.
We return now to (13.9), and Cauchy-Schwarz in b′ , n to eliminate the ϕ′b′ (n)
factor, yielding
|Eb1 ,b2 ,b′ ∈[[3N ]];n∈[N ]α(b1 , b′ , n) ⊗ α(b2 , b′ , n) ⊗ ϕ′b1 (n) ⊗ ϕ′b2 (n)ψb′′1 ,b2 ,b′ (n)| ≫ 1
where (b1 , b2 , b′ ) → ψb′′1 ,b2 ,b′ is a limit map assigning a scalar degree s − 3 nilsequence to each b1 , b2 , b′ . Finally, we Cauchy-Schwarz in b1 , b2 , n to eliminate the
ϕ′b1 (n)ϕ′b2 (n) factor, yielding
|Eb1 ,b2 ,b′1 ,b′2 ∈[[3N ]];n∈[N ]α(b1 , b′1 , n)⊗α(b2 , b′1 , n) ⊗ α(b1 , b′2 , n)⊗
⊗ α(b2 , b′2 , n)ψb′′1 ,b2 ,b′1 ,b′2 (n)| ≫ 1.
Note how the ϕ terms have now been completely eliminated. To eliminate the ψ ′′
terms, we ﬁrst use the pigeonhole principle to ﬁnd b0 , b′0 such that
′′
|Eb,b′ ∈[[3N ]];n∈[N ]α′ (b, b′ , n)ψb,b
′ ′ (n)| ≫ 1
0 ,b ,b0
′

where α =

α′b0 ,b′
0

is the expression

α′ (b, b′ , n) := α(b, b′ , n) ⊗ α(b0 , b′ , n) ⊗ α(b, b′0 , n) ⊗ α(b0 , b′0 , n).
b0 , b′0 .

(13.11)

′

∗

(13.12)

3

We ﬁx this
Again, α is a degree s nilcharacter on Z . From Lemma 13.4
and Lemma 13.2 (and using Lemma E.8 to eliminate shifts by b0 ) we conclude
[α′ (b, b′ , n)]Ξs (∗ Z3 ) ≡ s(s − 1)([χ(b,
˜ b′ , n, . . . , n)]Ξs (∗ Z3 ) − [χ(b
˜ ′ , b, n, . . . , n)]Ξs (∗ Z3 ) ).
(13.13)
Note the similarity here with (13.7).
From (13.11), we conclude that the sequence n → α′ (b, b′ , n) is
s − 3-biased
for many b, b′ ∈ [[3N ]]. Applying Proposition 5.6, we conclude that
α′ (b, b′ , n)

U s−2 [N ]

≫1

′

for many b, b ∈ [[3N ]]. We conclude (using Corollary A.6 to obtain the needed
uniformity) that
s−2
Eb,b′ ∈[[3N ]] α′ (b, b′ , n) 2U s−2 [N ] ≫ 1.
By deﬁnition of the Gowers norm, this implies that
|Eb,b′ ,h1 ,...,hs−2 ∈[[3N ]];n∈[N ]σ(b, b′ , h1 , . . . , hs−2 , n)1Ω (h1 , . . . , hs−2 , n)| ≫ 1, (13.14)

76

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

where Ω is the polytope
s−2

ωj hs−2 ∈ [N ] for all ω ∈ {0, 1}s−2 }

Ω := {(h1 , . . . , hs−2 , n) : n +
j=1

and σ is the expression
s−2

C |ω| α′ (b, b′ , n +

σ(b, b′ , h1 , . . . , hs−2 , n) :=

ωj hs−2 ),

(13.15)

j=1

ω∈{0,1}s−2

with C being the conjugation map.
From Lemma E.3, σ is a nilcharacter of degree s on ∗ Zs+1 . In the following
lemma we compute its symbol.
Lemma 13.5. We have
[σ(b, b′ , h1 , . . . , hs−2 , n)]Ξs (∗ Zs+1 ) =s!([χ(b,
˜ b′ , h1 , . . . , hs−2 )]Ξs (∗ Zs+1 )
− [χ(b
˜ ′ , b, h1 , . . . , hs−2 )]Ξs (∗ Zs+1 ) ).

(13.16)

Proof. From (13.15) and Lemma E.8 we can write the left-hand side as
s−2

(−1)|ω| [α′ (b, b′ , n +

ωj hs−2 )]Ξs (∗ Zs+1 ) ;

(13.17)

j=1

ω∈{0,1}s−2

one should think of this as an s − 2-fold “derivative” of [α′ (b, b′ , n)]Ξs (∗ Z3 ) in the n
variable.
From (13.13) we can write
[α′ (b, b′ , n)]Ξs (∗ Z3 ) = s(s − 1)([χ(b,
˜ b′ , n, . . . , n)]Ξs (∗ Z3 ) − [χ(b
˜ ′ , b, n, . . . , n)]Ξs (∗ Z3 ) )
+ [β(b, b′ , n)]Ξs (∗ Z3 )
where β is of degree at most s − 3 in n. In fact, by inspection of the derivation
of β, and heavy use of Lemma 13.2, one can express [β(b, b′ , n)]Ξs (∗ Z3 ) as a linear
combination of classes of the form
[χ(n
˜ 1 , . . . , ns )]Ξs (∗ Z3 )
where each of n1 , . . . , ns is equal to either b, b′ , or n, with at most s − 3 copies of n
occurring. If one then substitutes this expansion into (13.17) and applies Lemma
13.2 repeatedly, one obtains the claim.
On the other hand, from (13.14) and Lemma E.11, we see that on [[3N ]]s+1 , σ
is equal to a nilsequence of degree s − 1, and thus by Lemma E.8
[σ(b, b′ , h1 , . . . , hs−2 , n)]Ξs ([[3N ]]s+1 ) = 0
and thus by Lemma (13.16)
s!([χ(b,
˜ b′ , h1 , . . . , hs−2 )]Ξs ([[3N ]]s+1 ) − [χ(b
˜ ′ , b, h1 , . . . , hs−2 )]Ξs ([[3N ]]s+1 ) ) = 0.
Applying Lemma E.3 we conclude that
s!([χ(h,
˜ n, . . . , n)]Ξs ([[N ]]×[N ]) − [χ(n,
˜ h, n, . . . , n)]Ξs ([[N ]]×[N ])) = 0.
The claim (13.7) now follows from Lemma E.13. The proof of Theorem 7.4 is now
complete.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

77

Appendix A. Basic theory of ultralimits
In this appendix we review the machinery of ultralimits.
We will assume the existence of a standard universe U which contains all the
objects and spaces of interest for Theorem 1.3, such as real numbers, subsets of
real numbers, functions from [N ] to C for ﬁnite N ∈ N, nilmanifolds (or more
precisely, a representative from each equivalence class of nilmanifolds), and so forth.
The precise construction of this universe is not important, so long as it forms
a set. We refer to objects and spaces inside the standard universe as standard
objects and standard spaces, with the latter being sets whose elements are in the
former category. Thus for instance, elements of N are standard natural numbers,
1Z Z
1RR
the Heisenberg nilmanifold 0 1 R / 0 1 Z is a standard nilmanifold (consisting
0 0 1

0 0 1

entirely of standard points), and so forth.
The one technical ingredient we need is the following:
Lemma A.1 (Ultraﬁlter lemma). There exists a collection p of subsets of the
natural numbers N with the following properties:
(i) (Monotonicity) If A ∈ p and B ⊃ A, then B ∈ p.
(ii) (Closure under intersection) If A, B ∈ p, then A ∩ B ∈ p.
(iii) (Maximality) If A ⊂ N, then either A ∈ p or N\A ∈ p, but not both.
(iv) (Non-principality) If A ∈ p, and A′ is formed from A by adding or deleting
finitely many elements to or from A, then A′ ∈ p.
Proof. The collection of subsets of N which are coﬁnite (i.e. whose complement
is ﬁnite) already obeys the monotonicity, closure under intersection, and nonprincipality properties. Using Zorn’s lemma8, one can enlarge this collection to
a maximal collection, which then obeys all the required properties.
Throughout the paper, we ﬁx a non-principal ultraﬁlter p. A property P (n)
depending on a natural number n is said to hold for n sufficiently close to p if the
set of n for which P (n) holds lies in p.
Once we have ﬁxed this ultraﬁlter we can deﬁne limit objects and spaces as
follows.
Definition A.2 (Limit objects). Given a sequence (xn )n∈N of standard objects in
U, we deﬁne their ultralimit limn→p xn to be the equivalence class of all sequences
(yn )n∈N of standard objects in U such that xn = yn for n suﬃciently close to p.
Note that the ultralimit limn→p xn can also be deﬁned even if xn is only deﬁned
for n suﬃciently close to p.
An ultralimit of standard natural numbers is known as a limit natural number,
an ultralimit of standard real numbers is known as a limit real number, etc.
For any standard object x, we identify x with its own ultralimit limn→p x. Thus,
every standard natural number is a limit natural number, etc.
8By using this lemma, our results thus rely on the axiom of choice, which we will of course
assume throughout this paper. On the other hand, it is tedious but straightforward to rephrase
the inverse conjecture (Conjecture 1.2) in the language of Peano arithmetic (e.g. using Mal’cev
bases [48] to represent a nilmanifold, and approximating a Lipschitz function by a piecewise linear
one). Applying a famous theorem of G¨
odel [15], we then conclude that Conjecture 1.2 is provable
in ZFC if and only if it is provable in ZF. In fact, it is possible (with some effort) to directly
translate these ultrafilter arguments to a (lengthier) argument in which ultrafilters or the axiom
of choice is not used. We will not do so here, though, as the translation is quite tedious.

78

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Any operation or relation on standard objects can be extended to limit objects
in the obvious manner. For instance, the sum of two limit real numbers limn→p xn ,
limn→p yn is the limit real number
lim xn + lim yn = lim xn + yn ,

n→p

n→p

n→p

and the statement limn→p xn < limn→p yn means that xn < yn for all n suﬃciently
close to p.
A famous theorem of Lo´s asserts that any statement in ﬁrst-order logic which is
true for standard objects is automatically true for limit objects as well. For instance,
the standard real numbers form an ordered ﬁeld, and so the limit real numbers do
also, because the axioms of an ordered ﬁeld can be phrased in ﬁrst-order logic. We
will use this theorem in the sequel without further comment.
Definition A.3 (Limit spaces and functions). Let (Xn )n∈N be a sequence of standard spaces Xn in U indexed by the natural numbers. The ultrapower n→p Xn of
the Xn is deﬁned to be the space of all ultralimits limn→p xn , where xn ∈ Xn for
all n. Note Xn only needs to be well-deﬁned for n suﬃciently close to p in order
for the ultraproduct to be well-deﬁned. If X is a set, the set n→p X is known as
the ultrapower of X and is denoted ∗ X. Thus for instance ∗ N is the space of all
limit natural numbers, ∗ R is the space of all limit reals, etc.
We deﬁne a limit set to be an ultraproduct of sets, a limit group to be an
ultraproduct of groups, a limit finite set to be an ultraproduct of ﬁnite sets, and
so forth. A limit subset of a limit set X = n→p Xn is a limit set of the form
Y = n→p Yn , where Yn is a standard subset of Xn for all n suﬃciently close to p.
Given a sequence of standard functions fn : Xn → Yn between standard sets
Xn , Yn , we can form the ultralimit f = limn→p fn to be the function f : n→p Xn →
n→p Yn deﬁned by the formula
f ( lim xn ) := lim fn (xn ).
n→p

n→p

We refer to f as a limit function or limit map, and say that f (x) depends in a limit
fashion on x.
Remark. In the nonstandard analysis literature, limit natural numbers are known
as nonstandard natural numbers, limit sets are known as internal sets, and limit
functions are known as internal functions. We have chosen the limit terminology
instead as we believe that it is less confusing and emphasises the role of ultralimits
in the subject.
It is important to note that not every subset of a limit set is again a limit set, for
instance N is not a limit subset of ∗ N (this fact is known as the overspill principle).
Indeed, one can think of the limit subsets of a limit set as being analogous to the
measurable subsets of a measure space. In a similar vein, not every function between
two limit sets is a limit function; in this regard, limit functions are analogous to
measurable functions.
Example. (Pigeonhole principle) If X is ﬁnite, then ∗ X = X. This is ultimately
because if the natural numbers is partitioned into ﬁnitely many classes, then exactly
one of those classes lies in p. In particular, we see that every standard ﬁnite set is
a limit ﬁnite set. However, the converse is not true. For instance, if N is the limit

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

79

natural number N := limn→p n, then the limit set
[N ] := {n ∈ ∗ N : 1

n

N} =

[n]
n→p

is a limit ﬁnite set, but not a ﬁnite set.
Example. One has the identiﬁcations ∗ T = (∗ R)/(∗ Z) and ∗ (Rk ) = (∗ R)k for any
standard k, so one can talk about the limit unit circle ∗ T or the limit vector space
∗ k
R without ambiguity. We will refer to elements of ∗ T as frequencies.
Example. Every standard function f : X → Y can be identiﬁed with its ultralimit f : ∗ X → ∗ Y , thus for instance the fundamental character e is a limit function
from ∗ R (or ∗ T) to ∗ C, and the fractional part function {} is an limit function from
∗
R to ∗ I0 .
Remark. A limit ﬁnite set A = limn→p An has an limit cardinality |A|, deﬁned
by the formula
|A| := lim |An |.
n→p

Of course, |A| is a limit natural number, and not a natural number in general. Thus
for instance, if N is a limit natural number, then the limit ﬁnite set [N ] has a limit
cardinality of N (despite being uncountable in the standard sense).
Asymptotic notation. By taking ultralimits, one can formalise asymptotic
notation, such as the O() notation, in a manner that requires no additional quantiﬁers.
Definition A.4 (Asymptotic notation). A limit complex number X is said to be
bounded if one has |X|
C for some standard real number C, in which case we
also write X = O(1) or |X| ≪ 1. More generally, given a limit complex number X
and limit non-negative number Y , we write |X| ≪ Y , Y ≫ |X|, or X = O(Y ) if
one has |X| CY for some standard real number C. We write X = o(Y ) if one
has |X| εY for every standard ε > 0. Observe that for any X, Y with Y positive,
one has either |X| ≫ Y or X = o(Y ). We say that X is infinitesimal if X = o(1),
and unbounded if 1/X = o(1). Thus for instance any limit complex number X will
either be bounded or unbounded.
In a similar spirit, if x ∈ ∗ V is a limit element of a standard topological space
V , we say that x is bounded if x is a limit element of standard compact subset K
of V (i.e. x ∈ ∗ K), and unbounded otherwise. The set of all bounded elements of
∗
V will be denoted V .
Example. The limit real limn→p 1/n deﬁnes an inﬁnitesimal, but non-zero, limit
real number x; its reciprocal limn→p n is an unbounded limit real.
Example. Any bounded element of a discrete standard space is standard, by our
example on the pigeonhole principle. In particular, bounded integers are automatically standard: Z = Z. On the other hand, bounded elements in a continuous space
need not be standard, as the example limn→p 1/n shows.
From the Bolzano-Weierstrass theorem, every bounded limit real number can
be expressed uniquely as the sum of a standard real number and an inﬁnitesimal,
which may help explain the notation R. Note that R contains the limit fundamental
domain ∗ I0 . Similarly, C contains the limit unit circle ∗ S 1 = S 1 = {z ∈ C : |z| = 1},
where S 1 := {z ∈ C : |z| = 1}.
Example. For any standard D ∈ N+ , we endow CD with the Euclidean norm
|(z1 , . . . , zD )| := (|z1 |2 + . . . + |zD |2 )1/2 .

80

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER
D

Then we have CD = C : an element (z1 , . . . , zD ) ∈ ∗ CD is bounded if and only if
each component is bounded.
One modest advantage of the ultralimit framework is that one can rigorously
work with such equivalence relations as “x and y diﬀer by O(1)”, for instance
by quotienting ∗ R by the subring R; in the ﬁnitary setting, this relation is only
“morally” an equivalence relation (because of the need to quantify the constants in
the O() notation).
Suppose one has a limit function f : Ω → ∗ C on a limit set Ω. If one asserts that
f (x) = O(1) for each x ∈ Ω, one may be concerned that this statement provides
no uniformity in x. However, it turns out such uniformity is automatic for limit
functions.
Lemma A.5 (Automatic uniformity). Let D ∈ N+ , and let f : Ω → ∗ CD be a
limit function on a limit set Ω. Then the following statements are equivalent:
D

• (Pointwise boundedness) For each x ∈ Ω, one has f (x) ∈ C (i.e. f (x) =
O(1) for all x ∈ Ω).
• (Uniform boundedness) There exists a standard real C such that |f (x)| C
for all x ∈ Ω.
Intuitively, this lemma is asserting that the only types of functions that always
map unbounded sequences to bounded sequences (but with a bound possibly depending on the initial sequence) are those functions that are uniformly bounded.
The lemma can clearly fail if one considers functions f that are not limit functions;
thus it will be important to establish the limit nature of various functions in the
arguments below. This lemma is also closely related to the overspill principle in
nonstandard analysis, or the model-theoretic fact that ultraproducts are countably
saturated.
Proof. Clearly uniform boundedness implies pointwise boundedness, so we show
the converse. Suppose for contradiction that f was pointwise bounded but not
uniformly bounded. Then for every standard integer M there exists an element xM
in Ω such that |f (xM )| > M .
Write Ω as the ultralimit of standard sets Ωn , write f as an ultralimit of a
sequence fn : Ωn → CD , and write xM = xM,n ∈ Ωn . Thus for each standard M ,
the statement |fn (xM,n )| > M is true for n suﬃciently close to p.
Now we diagonalise. Set y = limn→p yn , where yn := xn,n . Then y ∈ X and one
sees that for every standard M , the statement |fn (yn )| > M holds for n suﬃciently
close to p, thus f (y) is unbounded. But this contradicts pointwise boundedness.
We observe a useful corollary to Lemma A.5.
Corollary A.6 (Automatic uniform lower bounds). Let D ∈ N+ , and let f : Ω →
CD be a limit function on a limit set Ω such that |f (x)| ≫ 1 for all x ∈ Ω. Then
there exists a standard c > 0 such that |f (x)| c for all x ∈ Ω.

∗

Proof. Apply Lemma A.5 to 1/|f |.
Inspired by Lemma A.5, we shall simply call an limit function f : Ω → ∗ CD
bounded if it is either pointwise bounded or uniformly bounded. The space of all
D
bounded limit functions from Ω to ∗ CD will be denoted L∞ (Ω → C ), and we also

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

write

ω

81

D

L∞ (Ω → C ).

L∞ (Ω) = L∞ (Ω → C ) :=

(A.1)

D∈N+

When D = 1, L∞ (Ω → C) is a ∗-algebra over the bounded complex numbers
C (i.e. it is closed under addition, pointwise multiplication, complex conjugation,
and multiplication by bounded complex numbers). It is not, however, a limit set.
For higher dimensions D > 1, we still have the operations of addition, complex
conjugation (conjugating each coeﬃcient of CD separately), and multiplication by
bounded complex numbers. However, we do not have a natural product on CD .
′
′
Instead, we will use the tensor product ⊗ : CD × CD → CDD , deﬁned in §3. This
induces a tensor product
D

⊗ : L∞ (Ω → C ) × L∞ (Ω → C

D′

) → L∞ (Ω → C
∞

DD′

)

ω

for any Ω, which is then a bilinear operation on L (Ω → C ). Strictly speaking, this tensor product is neither commutative nor associative. However, it is
“essentially” commutative and associative in the following sense. Let us say that
D
a function f ∈ L∞ (Ω → C ) is a bounded linear combination of another funcD′

′

tion f ′ ∈ L∞ (Ω → C ) if there exists a linear transformation T : ∗ CD → ∗ CD
with bounded coeﬃcients such that f = T ◦ f ′ . Then it is clear that for any
ω
f1 , f2 , f3 ∈ L∞ (Ω → C ), we have that f2 ⊗ f1 is a bounded linear combination of
f1 ⊗ f2 , and that f1 ⊗ (f2 ⊗ f3 ) is a bounded linear combinastion of (f1 ⊗ f2 ) ⊗ f3 .
This will be a satisfactory substitute for commutativity and associativity for our
purposes.
We deﬁne the spheres
S 2D−1 := {z ∈ C

D

: |z| = 1}

and

ω

S ω :=

S 2D−1 = {z ∈ C : |z| = 1}
D∈N+

Sω

and observe that
is closed under complex conjugation and tensor product, and
so L∞ (Ω → S ω ) is also. Also, observe that for any f ∈ L∞ (Ω → S ω ), 1 is a
bounded linear combination of f ⊗ f .
When Ω is a non-empty limit ﬁnite set (e.g. Ω = [N ] or Ω = [N ]k for some positive limit integer N and some standard k 1), we have some additional structures.
Definition A.7 (Bias and correlation). Let Ω be a non-empty limit ﬁnite set.
ω
ω
Given two functions f ∈ L∞ (Ω → C ), g ∈ L∞ (Ω → C ), we say that f and g
correlate if one has
|En∈Ω f (n) ⊗ g(n)| ≫ 1,
and that f is biased if one has
|En∈Ω f (n)| ≫ 1,
i.e. if f correlates with 1. We say that f is unbiased if it is not biased. We deﬁne
the Lp norms
f Lp(Ω) := (En∈Ω |f (n)|p )1/p
for 1 p < ∞, with the usual convention
f

L∞ (Ω)

:= sup |f (n)|;
n∈Ω

82

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

these are bounded limit non-negative numbers.
We will also ﬁnd the following notation useful.
Definition A.8 (Density). We say that a limit subset H of a limit ﬁnite set X is
dense if |H| ≫ |X|, and that a statement P (x) is true for many x ∈ X if it is true
for all x in a dense subset H of X. If instead |H| = o(|X|), we say that H is a
sparse subset of X, and if P (x) only holds true for x in a sparse set, we say that
P (x) only holds for few x ∈ X. If the complement of H in X is sparse, we say that
H is a co-sparse subset of X, and if P (x) holds for all x in a co-sparse subset, we
say that P (x) holds for almost all x ∈ X.
D
A function f : X → ∗ CD is said to be almost bounded if f (x) ∈ C for almost
all x ∈ X. (For instance, for an unbounded limit natural number N , the function
N
n → n+1
is almost bounded on [N ].)
Remarks. Note that the statement P does not need to be a limit statement (i.e.
the set {x ∈ X : P (x) true} need not be a limit set) for these deﬁnitions to make
sense; for instance, for P to hold for many x, it suﬃces that {x ∈ X : P (x) true}
contain an dense limit subset of X, but need not be a limit set itself. If one property
P (x) holds for almost all x ∈ X, and another property Q(x) holds for many x ∈ X,
then P (x) and Q(x) simultaneously hold for many x ∈ X. However, if P only holds
for many x rather than for almost all x, then it need not be the case that P (x) and
Q(x) simultaneously hold for any x.
From the pigeonhole principle we see that if an limit set is partitioned into a
bounded number of limit pieces, then at least one of the pieces is dense. We can
strengthen this principle as follows.
Lemma A.9 (Pigeonhole principle). Let X be a limit finite set, and let f be an
almost bounded limit function from X to ∗ N. Then there exists a dense subset of
X on which f is constant and equal to a standard natural.
Proof. By hypothesis, f is bounded on almost all of X, and hence uniformly
bounded on almost all of X by Lemma A.5. The claim now follows from the
pigeonhole principle.
We also record here a technical lemma regarding correlation.
Definition A.10 (σ-limit). A subset S of an limit set X is said to be a σ-limit
set if there is a limit sequence n → Sn from limit natural numbers n ∈ ∗ N of
limit subsets Sn of X, such that S is the union of the Sn over all standard natural
numbers.
D

Example. If Ω is a limit set and D ∈ N+ , then the space L∞ (Ω → C ), which
is an external (i.e. non-limit) subset of the limit space of all limit functions from
Ω to ∗ CD , is a σ-limit space, since one can express this space as the union, over all
standard M , of the functions bounded uniformly in magnitude by M . Similarly,
ω
L∞ (Ω → C ) is also a σ-limit set.
Lemma A.11 (Limit selection lemma). Let X, Y be limit sets, let R ⊂ X × Y be
a an limit relation between X and Y , and let S be a σ-limit subset of Y . Suppose
that for every x ∈ X there exists sx ∈ S such that (x, sx ) ∈ R. Then there exists a
limit function x → sx from X to S such that (x, sx ) ∈ R for all x ∈ X.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

83

Remark. The key point here is the limit nature of the assignment x → sx ;
for external (i.e. non-limit) assignments, the claim is immediate from the axiom
of choice. There is a similar need for such “measurable selection lemmas” in the
ergodic theory analogue of the inverse conjectures for the Gowers norms, see e.g.
[36, Appendix A] or [5, Lemma C.4].
Proof. We may assume that the sets Sn in Deﬁnition A.10 are increasing in n.
For each x ∈ X, let nx be the ﬁrst limit natural number such that (x, s) ∈ R
for some s ∈ Snx . By construction, x → nx is a limit map from X to ∗ N which
is pointwise bounded. Thus, by Lemma A.5, nx is uniformly bounded by some
standard natural number n∗ , thus for every x ∈ R the set {s ∈ Sn∗ : (x, s) ∈ R} is
non-empty. Applying a limit choice function, we may thus ﬁnd a limit map x → sx
with the stated properties.
We isolate a special case of this lemma.
Corollary A.12. Let Ω be a non-empty limit-finite set, Let S be a σ-limit subset
ω
of L∞ (Ω → C ), and let (fh )h∈H be a limit family of limit functions fh ∈ L∞ (Ω →
ω
C ) indexed by an limit set H, and suppose that for each h ∈ H, fh correlates with
an element of S. Then one can find an limit family (φh )h∈H of functions φh ∈ S
such that fh correlates with φh for all h ∈ H.
Proof. Write S as the union of limit sets Sn for standard n, and let S ′ := n∈N Sn ∪
ω
{n}. Note that this is a σ-limit subset of L∞ (Ω → C ) × ∗ N. Deﬁning a relation
R between H and S ′ by declaring (h, (φ, n)) ∈ R if |En∈Ω fh (n) ⊗ φ(n)| 1/n, and
applying Lemma A.11, we obtain the claim.
Appendix B. Polynomial algebra
In section §6 we introduced the notion of a polynomial map between I-ﬁltered
groups H and G when the group H was abelian (Deﬁnition 6.18). In this appendix
we study the more general notion of a polynomial map, no longer restricting to the
case H abelian. The concept of a polynomial map between groups was introduced
by Leibman in [43, 44], and here we adapt it to ﬁltered groups.
Recall the deﬁnitions of an ordering I and of an I-ﬁltration of a group G in
Deﬁnitions 6.7 and 6.8.
Definition B.1 (Polynomial map). Let G, H be groups with I-ﬁltrations GI , HI .
If g : H → G is a map then we deﬁne the derivative ∂h g : H → G by the formula
∂h g(n) := g(hn)g(n)−1
for all n ∈ H. We say that map g : H → G is polynomial if one has
∂h1 . . . ∂hm g(n) ∈ Gi1 +...+im
whenever m 0, i1 , . . . , im ∈ I, hj ∈ Hij for j = 1, . . . , m and n ∈ H0 . The space
of all polynomial maps is denoted poly(HI → GI ).
Remark. As mentioned in §3, if G or H are written as additive groups instead
of multiplicative ones, the deﬁnition of partial derivative is adjusted appropriately.
Example 1. If I = N, and H is abelian and is given the ﬁltration Hi = H for
i = 0, 1 and Hi = {0} for i > 0, then a map g : H → G lies in poly(HN , GN ) if and
only if
∂h1 . . . ∂hm g(n) ∈ Gm

84

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

for all m
0 and h1 , . . . , hm ∈ H. This coincides with the deﬁnition given in
[24, Deﬁnition 6.1]. Deﬁnition B.1 may be considered as a generalisation of this in
which the domain group H is allowed to have nontrivial ﬁltrations.
Example 2. Any map φ : G → H between two I-ﬁltered groups which is constant
and takes values in H0 is polynomial.
Example 3. If φ : HI → GI is a homomorphism of I-ﬁltered groups that maps
Hi to Gi for each i ∈ I, then φ is a polynomial map since, for each h ∈ H,
∂h φ is the constant map n → φ(h). We will call such homomorphisms I-filtered
homomorphisms from the I-ﬁltered group HI to the I-ﬁltered group GI .
Example 4. If G is an I-ﬁltered group, and g ∈ G, then the left translation
maps x → gx lie in poly(GI → GI ). Indeed, the derivative of this map in any
direction h ∈ Gi is simply the constant map ghg −1 , which lies in Gi , and any
further derivative of this map is trivial. This example is a special case of the
Lazard-Leibman theorem (Corollary B.4 below), since the translation map is the
product of a constant map and the identity homomorphism.
Example 5. Given three I-ﬁltered groups H, G, G′ , a map g : H → G × G′ is
polynomial (G × G′ is given the product ﬁltration) if and only if its projections to
G and G′ are polynomial. In other words, we have a canonical isomorphism
poly(HI → (G × G′ )I ) ≡ poly(HI → GI ) × poly(HI → G′I ).
Host-Kra cube groups. There is an important alternative characterisation of
polynomial maps in terms of Host-Kra cube groups, which we now deﬁne. The material in this section is a generalisation of [24], and particularly [24, Proposition 6.5],
to the context of polynomial maps poly(HI → GI ) (there matters were discussed
only in the case poly(H → GI )). The Host-Kra groups are the group-theoretic
analogue of the Host-Kra spaces X [k] of a dynamical system X introduced in [36].
If m is a natural number, we let 2[m] be the power set of [m] := {1, . . . , m}.
Definition B.2. Let G be an I-ﬁltered group, and let i1 , . . . , im ∈ I. We deﬁne
[m]
the Host-Kra cube group HKi1 ,...,im (GI ) to be the subgroup of G2 generated by
the elements of the form
ιω0 (gω0 ) := (gω )ω⊂[m] ,
where ω0 ⊂ [m], gω0 ∈ G

j∈ω0

ij ,

and gω equals gω0 when ω ⊇ ω0 and is the identity

otherwise. Thus we see that the ιω0 are embeddings of G j∈ω ij into HKi1 ,...,im (G).
0
We refer to m as the order of the Host-Kra cube groups, and refer to elements of
HKi1 ,...,im (G) as cubes of dimension m and degrees i1 , . . . , im .
Example. Let G be a k-step nilpotent group, and let Gi = [G, Gi−1 ] be the lower
[m]
central series ﬁltration. Then HK1,...,1 (G) is the subgroup of G2
generated by
i
i
i
the “side” elements (gω )ω⊂[m] where gω = g if i ∈ ω and gω = id otherwise, for
i = 1, . . . , m, and by the diagonal elements (g, . . . , g).
Theorem B.3. Let G, H be I-filtered groups, and let g : H → G be a map. Then g
is a polynomial map if and only if it preserves cubes, in the sense for every m 0
[m]
[m]
[m]
and i1 , . . . , im ∈ I, the homomorphism g 2 : H 2 → G2 defined by
[m]

g2

((hω )ω⊂[m] ) := (g(hω ))ω⊂[m]

maps HKi1 ,...,im (HI ) to HKi1 ,...,im (GI ).

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

85

Proof. For inductive reasons it is convenient to establish the following slightly
stronger result. For any m0
0, we say that a map g : H → G is polynomial
to order m0 if we have
∂h1 . . . ∂hm g(n) ∈ Gi1 +...+im
for all m with 0 m m0 , all i1 , . . . , im ∈ I, all hj ∈ Hij for j = 1, . . . , m, and all
n ∈ H0 . It will suﬃce to show that a map g : H → G is polynomial to order m0 if
and only if it preserves the cubes of dimension up to m0 .
We establish this by induction on m0 . The case m0 = 0 is easy: g is polynomial
to order 0 if it maps H0 to G0 , but these are also essentially the Host-Kra groups
of order 0, and the claim follows. Now suppose inductively that m0 1 and that
the claim has already been shown for all smaller values of m0 .
Suppose ﬁrst that g : H → G preserves all cubes of dimension up to m0 . Then
by the preceding discussion, g maps H0 to G0 . To show that g is polynomial to
order m0 , it thus suﬃces to show that for every i ∈ I and h ∈ Hi , ∂h g is polynomial
to order m0 − 1 in the shifted I-ﬁltration G+i
I deﬁned by
G+i
I := (Gj+i )j∈I .

(B.1)

By the induction hypothesis, it suﬃces to show that ∂h g preserves cubes of dimension m0 − 1. Accordingly, let h = (hω )ω⊂[m0 −1] be an element of HKi1 ,...,im0 −1 (H).
We may view (h, h · h) as an element of HKi1 ,...,im0 −1 ,i (H) of one higher order,
where h · h := (hhω )ω⊂[m0 −1] . By hypothesis on g, we have
[m0 −1]

(g 2

[m0 −1]

(h), g 2

(h · h)) ∈ HKi1 ,...,im0 −1 ,i (G).

An inspection of Deﬁnition B.2 reveals that (g1 , g2 ) lies in HKi1 ,...,im0 −1 ,i (G) if and
only if g1 lies in HKi1 ,...,im0 −1 (G) and g2 (g1 )−1 lies in HKi1 ,...,im0 −1 (G, G+i
I ) (which
is easily seen to be a normal subgroup of HKi1 ,...,im0 −1 (G)). We conclude that
[m0 −1]

g2
But

[m0 −1]

(h · h) · g 2

[m0 −1]

g2

(h)−1 ∈ HKi1 ,...,im0 −1 (G, G+i
I ).

[m0 −1]

(h · h) · g 2

[m0 −1]

(h)−1 = (∂h g)2

(h),

and the claim follows.
Next, suppose conversely that g : H → G is a polynomial map of order up to
m0 ; by the inductive hypothesis, it suﬃces to show that g preserves all the cubes of
dimension exactly m0 . Accordingly, let h be an element of HKi1 ,...,im0 (H) of this
dimension. Arguing as before, we may write
h = (h1 , h2 h1 )
+im0

where h1 ∈ HKi1 ,...,im0 −1 (H) and h2 ∈ HKi1 ,...,im0 −1 (H, HI
then to show that
[m0 ]

g2
lies in HK
show that

i1 ,...,im0

[m0 −1]

(h1 ), g 2

(G). By the decomposition of HK

[m0 −1]

g2

[m0 −1]

(h) = (g 2

[m0 −1]

(h2 h1 )g 2

(h2 h1 ))

i1 ,...,im0

(G), it thus suﬃces to
+im0

(h1 )−1 ∈ HKi1 ,...,im0 −1 (G, GI

+i
HKi1 ,...,im0 −1 (H, HI m0 )

Recall that
where ω0 ⊂ [m0 − 1] and hω0 ∈ H

). Our objective is

).

(B.2)

is generated by elements of the form ιω0 (hω0 ),
. By telescoping series, we thus see
j∈ω ij +im0
0

86

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

that to establish the above claim it suﬃces to do so under the additional assumption
that h2 is a generator
h2 = ιω0 (hω0 )
for some ω0 ⊂ [m − 1] and hω0 ∈ H j∈ω ij +im0 .
0
By relabeling we may assume that ω0 = {m′ + 1, . . . , m0 − 1} for some 0 m′
m0 − 1. The left-hand side of (B.2) then simpliﬁes to
[m′ ]

(∂hω0 g)2

(h′1 ),

′

(B.3)
[m′ ]

[m0 −1]

where h′1 is the restriction of h1 to 2[m ] , and we embed G2
into G2
by
identifying (gω )ω⊂[m′ ] with the tuple (˜
gω )ω⊂[m0 −1] , where g˜ω is equal to gω∩[m′ ]
when ω contains Ω, and is equal to the identity otherwise.
+

ij +im

0
0
). By
But by induction hypothesis, (B.3) lies in HKi1 ,...,im0 −1 (G, GI
+i
m0
i1 ,...,im0 −1
Deﬁnition B.2, this embeds into HK
), giving (B.2) as desired,
(G, GI
and the claim follows.
j∈ω

Theorem B.3 has two immediate corollaries.
Corollary B.4 (Lazard-Leibman theorem). Let G, H be I-filtered groups. Then
poly(HI → GI ) is also a group (using pointwise multiplication as a group operation).
Corollary B.5 (Composition). Let G, H, K be I-filtered groups. If g ∈ poly(HI →
GI ) and h ∈ poly(KI → HI ), then g ◦ h ∈ poly(HI → KI ).
In other words, for any ﬁxed I, the class of I-ﬁltered groups together with their
polynomial maps form a category. It is remarkably diﬃcult to establish Corollary
B.5 in full generality without the machinery of Host-Kra cube groups.
Example. If G, H are I-ﬁltered groups with H = (H, +) abelian, and g is a
polynomial map from H to G, then the translates g(· + h) and dilates g(q·) for
h ∈ H and q ∈ Z are also polynomial maps from H to G, thanks to Corollary B.5
and Examples 3 and 4 following Deﬁnition B.1. More generally, if φ : H ′ → H is a
ﬁltered homomorphism and g ∈ poly(HI → GI ), then g ◦ φ ∈ poly(HI′ → GI ).
Example. Using Corollary B.4 we can establish that any algebraic word w on k
generators deﬁnes a polynomial map from H k to H for any I-ﬁltered group H. For
instance, the map (g, h) → g 2 h−3 gh is a polynomial map from H × H to H.
We can strengthen Corollary B.4 slightly, by giving poly(HI → GI ) the structure
of an I-ﬁltered group:
Proposition B.6 (Filtered Lazard-Leibman theorem). Let (G, GI ), (H, HI ) be Ifiltered groups. Then poly(HI → GI ) is also an I-filtered group, with filtration
+i
was defined in (B.1). In
(poly(HI → G+i
I ))i∈I , where the shifted filtration GI
+i
particular, the poly(HI → GI ) are normal subgroups of poly(HI → GI ).
Proof. The only non-trivial claim to show is that if gi ∈ poly(HI → G+i
I ) and
+i+j
gj ∈ poly(HI → G+j
)
for
some
i,
j
∈
I,
then
[g
,
g
]
∈
poly(H
→
G
). It
i j
I
I
I
suﬃces to show for each m0 0 that if gi , gj are polynomial maps up to order m0
+j
from (H, HI ) to (G, G+i
I ), (G, GI ) respectively, then [gi , gj ] is a polynomial map
up to order m0 from (H, HI ) to (G, G+i+j
).
I
Again we induct on m0 . The case m0 = 0 is trivial, so suppose that m0 1 and
that the claim has already been proven for smaller values of m0 .

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

87

As gi , gj map H0 to Gi , Gj respectively, [gi , gj ] maps H0 to Gi+j . It thus suﬃces
to show that for each k ∈ I and h ∈ Hk , that ∂h [gi , gj ] is a polynomial map up to
order m0 − 1 from (H, HI ) to (G, G+i+j+k
). But a brief calculation shows that
I
∂h [gi , gj ] = gi−1 (∂h gi )−1 gj−1 (∂h gj )−1 (∂h gi )gi (∂h gj )gi−1 gj gi .

(B.4)

By induction hypothesis (and Corollary B.4), the maps that are polynomial up to
order m0 − 1 from (H, HI ) to (G, G+i+j+k
) form a normal subgroup of the maps
I
that are polynomial up to order m0 − 1 from (H, HI ) to (G, GI ). If we quotient
out by this normal subgroup, then a further application of the induction hypothesis
shows that ∂h gi commutes with gj and ∂h gj , and that gi commutes with ∂h gj . An
inspection of (B.4) then shows that the right-hand side vanishes once one quotients
out by this normal subgroup, and the claim follows.
Proposition B.6 has some useful corollaries:
Corollary B.7 (Approximate linearity and commutativity). Let G, H be I-filtered
+j
groups, let i, j, k, l ∈ I, and let gi ∈ poly(HI → G+i
I ), gj ∈ poly(HI → GI ),
hk ∈ Hk , and hl ∈ Hl . Then we have
∂hk (gi gj ) = (∂hk gi )(∂hk gj ) mod poly(HI → G+i+j+k
)
I

(B.5)

∂hk hl (gi ) = (∂hk gi )(∂hl gi ) mod poly(HI → G+i+k+l
).
I
If H is abelian, we also have

(B.6)

and

(∂hl gi )(∂hk gi ) = (∂hk gi )(∂hl gi ) mod poly(HI → G+i+k+l
).
I

(B.7)

Proof. The conclusions (B.5), (B.6) follow from Proposition B.6 and the identities
∂hk (gi gj ) = (∂hk gi )(∂hk gj )[∂hk gj , gi−1 ]
and
∂hk hl (gi ) = (∂hl ∂hk gi )(∂hk gi )(∂hl gi ).
(B.8)
The identity (B.7) then follows by swapping the roles of hk and hl in (B.6).
Next, we make the useful observation that in order to check polynomiality of a
map, it suﬃces to do so on generators.
Proposition B.8 (Checking polynomiality on generators). Let G, H be I-filtered
groups. For each i ∈ I, let Ei be a set of generators for Hi . Then a map g : H → G
is polynomial if and only if one has
∂h1 . . . ∂hm g(n) ∈ Gi1 +...+im
for all m

(B.9)

0, all i1 , . . . , im ∈ I, and all hj ∈ Eij for j = 1, . . . , m, and all n ∈ H0 .

Proof. The “only if” part is trivial, so it suﬃces to prove the “if” part. For inductive
reasons, we shall prove the following more general statement: if l, m0
0, and
g : H → G is such that ∂h1 . . . ∂hm g is a polynomial map up to order l from
1 +...+im
(H, HI ) to (G, G+i
) whenever 0 m m0 , i1 , . . . , im ∈ I and hj ∈ Eij for
I
j = 1, . . . , m, then g is a polynomial map from H to G up to order m0 + l. Indeed,
by setting l = 0 and sending m0 → ∞ we obtain the claim.
We establish the claim by induction on m. The case m0 = 0 is trivial, so suppose
that m0 1 and that the claim has already been proven for smaller values of m0 .
Fix l. Let 1
m
m0 and i1 , . . . , im ∈ I, and suppose that hj ∈ Eij for
j = 2, . . . , m, and write g˜ := ∂h2 . . . ∂hm g. By hypothesis, we have that ∂h1 g˜ is

88

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

1 +...+im
a polynomial map of order l from (H, HI ) to (G, G+i
) whenever h1 lies in
I
Ei1 . Using (B.8) and Corollary B.4, we conclude the same statement holds when
h1 lies in Hi1 . Also, by induction hypothesis g˜ is also known to be a polynomial
2 +...+im
map of order l from (H, HI ) to (G, G+i
). We conclude that g˜ is in fact
I
2 +...+im
a polynomial map of order l + 1 from (H, HI ) to (G, G+i
). Applying the
I
induction hypothesis again, we conclude that g is a polynomial map of order l + m
from H to G, as required.

Example. Let G1 , G2 , G be I-ﬁltered groups, and let B : G1 × G2 → G be a map
which is “bilinear” in the sense that the maps g1 → B(g1 , g2 ) for ﬁxed g2 ∈ G2
and g2 → B(g1 , g2 ) for ﬁxed g1 ∈ G1 are homomorphisms, and such that B maps
G1, i × G2, j to Gi+j for any i, j ∈ I. Then B is a polynomial map, as can be
seen by using Proposition B.8 with G1, i × {id} ∪ {id} × G2, i as the generating set
for (G1 × G2 )i = G1, i × G2, i . Combining this with Corollary B.5, we conclude
in particular that if H is an I-ﬁltered group and g1 ∈ poly(HI → (G1 )I ), g2 ∈
poly(HI → (G2 )I ), then B(g1 , g2 ) ∈ poly(HI → GI ); informally, this is asserting
that the product of polynomials is again a polynomial.
Example. Let G be an Nk -ﬁltered group, and let g ∈ poly(ZkNk → GNk ) be
a polynomial sequence, in which Zk is given the multidegree ﬁltration. We can
collapse the Nk -ﬁltration on G to an N-ﬁltration by deﬁning Gi to be the group
generated by G(i1 ,...,ik ) for all (i1 , . . . , ik ) ∈ Nk with i1 + . . . + ik = i. From
Proposition B.8 we thus conclude that g remains a polynomial map from Zk to G
if we now give Zk the degree ﬁltration, and give G the N-ﬁltration indicated above.
The next lemma describes a useful type of Taylor expansion for polynomial
sequences.
Lemma B.9 (Taylor expansion). Let d 1 be a natural number, let G be an Nd filtered group of degree ⊂ J for some finite downset J, and let g ∈ poly(ZdNd → GNd ),
where Zd is given the multidegree filtration. We complete the partial ordering on
J to a total ordering in some arbitrary fashion. Then there exist unique Taylor
coeﬃcients gj ∈ Gj for each j ∈ J such that
(n)
gj j .

g(n) =
j∈J

Here we adopt the notational convention
(n1 , . . . , nd )
(j1 , . . . , jd )

:=

nd
n1
.
...
jd
j1

Proof. We ﬁrst show uniqueness. Suppose that we have two Taylor expansions that
agree everywhere, that is to say
(n)
gj j =
j∈J

n
(gj′ )( j )

j∈J

d

for all n ∈ Z . Setting n = 0 we see that g0 = g0′ . Cancelling this, we see that
(n)
gj j =
j∈J:j>0

n
(gj′ )( j ) .

j∈J:j>0

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

More generally, suppose inductively that we have shown that gj = gj′ for all j
and
n
(n)
gj j =
(gj′ )( j )
j∈J:j>j0

89

j0

j∈J:j>j0

d

for all n ∈ Z some j0 ∈ J. If j0 is the maximal element of J then we are done.
Otherwise, let j1 be the next element after j0 in the total ordering of J. Setting
n = j1 we conclude that gj1 = gj1′ , and then we can continue the induction and
establish uniqueness.
Now we show existence by inducting on the cardinality of J. The claim is trivial
for J empty, so suppose that J is non-empty, and let j∗ be the maximal element of
J. The group Gj∗ is a central subgroup of G; if we quotient G by Gj∗ , we obtain
an Nd -ﬁltered group G/Gj∗ of degree ⊂ J\{j∗ }. Let π : G → Gj∗ be the quotient
map. Applying the induction hypothesis, we have a Taylor expansion
(n)
hj j

π(g(n)) =
j∈J:j=j∗

for some hj ∈ π(Gj ). Writing hj = π(gj ) for some gj ∈ Gj , and using the central
nature of Gj∗ , we conclude that
(n)
gj j )g ′ (n)

g(n) = (
j∈J:j=j∗

for some g ′ (n) taking values in Gj∗ . By Corollary B.4, g ′ is a polynomial sequence,
and therefore
∂ej11 . . . ∂ejkk g ′ (n) = id
whenever (j1 , . . . , jk ) j∗ , with e1 , . . . , ek being the basis of Zk . We can “integrate”
this diﬀerence equation repeatedly using the abelian nature of Gj∗ (and the Pascal’s
n
= nj ) and conclude that
triangle relation ∂ei j+e
i
n
(gj′ )( j )

g ′ (n) =
j j∗

for some gj′ ∈ Gj∗ . Using the central nature of Gj∗ , we conclude that
n
(gj gj′ )( j )

g(n) =
j∈J

(with the convention that gj∗ = id) and the claim follows.
Corollary B.10 (Pullback). Let d
1 be a natural number, let G be an Nd filtered group of degree ⊂ J for some finite J, and let g ∈ poly(ZdNd → GNd ).
Let φ : G′ → G be a Nd -filtered homomorphism of Nd -filtered groups such that
φ : G′j → Gj is surjective for every j. Then there exists g ′ ∈ poly(ZdNd → G′Nd )
such that g = g ′ ◦ φ.
Proof. Apply Lemma B.9 and then pull back each of the resulting Taylor coeﬃcients
gj .

90

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Appendix C. Lifting linear nilsequences to polynomial ones
The purpose of this appendix is to demonstrate the equivalence of the linear
inverse conjecture, Conjecture 1.2, with the polynomial inverse conjecture, Conjecture 4.5. We remind the reader that this is not strictly speaking necessary to
establish the results in [23], but the latter paper was written before the more general
notion of a polynomial nilsequence came to the fore.
The key observation here is that every polynomial nilsequence of degree s can
be “lifted” to an s-step linear nilsequence in a certain sense.
We begin by recording a useful lemma.
Lemma C.1 (Discrete polynomials are cocompact). Let G/Γ be an N-filtered nilmanifold. Then poly(ZN → ΓN ) is a lattice (i.e. a discrete cocompact subgroup) of
poly(ZN → GN ) (where we give Z the degree filtration).
Proof. We may assume that G/Γ has degree-rank d. It will suﬃce to show that
any polynomial sequence g ∈ poly(ZN → GN ) can be factorised as g = γg ′ where
γ ∈ poly(ZN → ΓN ) and g ′ ranges in a compact subset of poly(ZN → GN ). It is
enough to show by induction on i that for every 0
i
d + 1, there exists a
factorisation g = γi hi gi′ where γ ′ ∈ poly(ZN → ΓN ), gi′ lies in a compact subset of
poly(Z → G), and hi ∈ poly(ZN → GN ) is such that h(0) = . . . = h(i − 1) = id,
since for i = d + 1 this forces h to be trivial.
This inductive claim is trivial for i = 0 (setting γ0 = g0′ to be trivial). Now
suppose inductively that one has a factorisation g = γi hi gi′ for some 0
i
d.
Since h(0) = . . . = h(i − 1) = id, we see from Taylor expansion that h(i) ∈ Gi .
′
Since Γi := Γ ∩ Gi is cocompact in Gi , we may factorise h(i) = γ˜i+1 (i)˜
gi+1
(i) for
′
some γ˜i+1 (i) ∈ Γi and g˜i+1 (i) in a cocompact subset of Gi . By Taylor expansion
′
we may extend γ˜i+1 , g˜i+1
to elements of poly(ZN → ΓN ) and of a compact subset of
poly(ZN → GN ) respectively which are trivial on 0, . . . , i−1. Writing γi+1 := γi γ˜i+1 ,
−1
′
′
′
hi+1 := γ˜i+1
hi (˜
gi+1
)−1 , and gi+1
:= g˜i+1
gi′ we obtain the claim.
Now we establish the key lifting proposition.
Proposition C.2 (Polynomial nilsequences can be lifted to linear ones). Let G/Γ
be a filtered nilmanifold of degree s. Then there exists a standard s-step nilman˜ Γ,
˜ a standard compact subset K of G/
˜ Γ,
˜ and a standard Lipschitz map
ifold G/
π : K → G/Γ, such that for every (standard ) polynomial sequence g : Z → G, there
˜ and x
˜ Γ
˜ such that g˜n x
exists g˜ ∈ G
˜ ∈ G/
˜ ∈ K and g(n)∗ Γ = π(˜
g n x˜) for all n ∈ Z.
Indeed, with this proposition, any degree
s nilsequence n → F (g(n)∗ Γ) can
˜ and
then be lifted to an s-step linear nilsequence n → (F ◦ π)(˜
gnx
˜) with g˜ ∈ ∗ G
∗ ˜ ˜
x
˜ ∈ (G/Γ), where F ◦ π is extended from a Lipschitz function on K to a Lipschitz
˜ Γ
˜ in some arbitrary fashion. From this one easily concludes that
function on G/
Conjecture 1.2 follows from Conjecture 4.5. (The converse implication is trivial,
because every linear nilsequence is a polynomial nilsequence.)
To motivate Proposition C.2 let us present an illustrative example. We take s = 2
and G/Γ to be the unit circle R/Z with the quadratic ﬁltration (thus Gi equals R
for i
2 and {0} for i > 2). By Remark 9.6, a polynomial sequence g : Z → G
then takes the form g(n) = α0 + α1 n1 + α2 n2 for some frequencies α0 , α1 , α2 (i.e.
a non-standard classical quadratic polynomial). To lift this quadratic sequence to
˜ Γ
˜ (Example 6.1), and
a linear one, we introduce use the Heisenberg nilmanifold G/

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

91

place inside it the skew torus
K := {g1t1 [g1 , g2 ]t[1,2] Γ : t1 , t[1,2] ∈ R}.
This is easily seen to be compact (indeed, it is topologically equivalent to T2 ). We
deﬁne the map π : K → T by the formula
π(g1t1 [g1 , g2 ]t[1,2] ) := t[1,2] mod 1;
it is easy to see that π is well-deﬁned and smooth. If we set
g˜ := g1α g2 [g1 , g2 ]β ;

˜
x
˜ := [g1 , g2 ]γ Γ

for some frequencies α, β, γ ∈ R, then a brief calculation shows that for any integer
n, g˜n x
˜ lies in K and
n(n + 1)
α + nβ + γ mod 1,
2
and so one can arrange for π(˜
g n x˜) = g(n) by choosing α, β, γ appropriately in terms
of α0 , α1 , α2 .
The above construction was ad hoc in nature, requiring one to conjure up the
Heisenberg group out of thin air. However, it is possible to canonically construct a
˜ Γ
˜ in the general case. Fix G/Γ. By Remark 9.6, poly(ZN →
lifted nilmanifold G/
GN ) is a Lie group topologically isomorphic to i 0 Gi , but with a diﬀerent group
structure. Since G has degree < s + 1, we see that G is s-step nilpotent, which
implies that poly(ZN → GN ) is s-step nilpotent also.
Let ΓN be the restriction of the ﬁltration GN to Γ (Example 6.14), thus Γ is now
a ﬁltered group. By Lemma C.1, poly(ZN → ΓN ) has the structure of an s-step
˜ Γ
˜ needed for Proposition C.2, but
nilmanifold. This is not yet the nilmanifold G/
we can modify it as follows. We observe that there is a shift automorphism T acting
on both poly(ZN → GN ) and poly(ZN → ΓN ) by the formula T g(n) := g(n + 1). It
also acts on the Lie algebra log poly(ZN → GN ) of poly(ZN → GN ), which by abuse
of notation we shall call poly(ZN → log GN ). This action is unipotent; indeed, T − 1
+(i+1)
maps poly(ZN → log G+i
) for all i 0, where G+i is G
N ) to poly(ZN → log GN
+i
with the shifted ﬁltration Gd := Gd+i . The conjugation action of poly(ZN → GN )
on poly(ZN → log GN ) has the same unipotence property by the ﬁltered nature
of G. Because of this, we see that the conjugation action of semi-direct product9
poly(ZN → GN ) ⋊T Z on poly(ZN → log GN ) is s-step unipotent, which implies that
poly(ZN → GN ) ⋊T Z is s-step nilpotent.
Unfortunately, the group poly(ZN → GN ) ⋊T Z is not connected, so it is not
directly suitable for the purposes of establishing Proposition C.2. But this can be
easily remedied by using the unipotent nature of the action of T on poly(ZN →
log GN ) to express10 T = T 1 for some smooth unipotent group action t → T t of the
real line R on poly(ZN → log GN ), which can then be exponentiated to provide a
unipotent group action (which we will also call t → T t ) on poly(ZN → GN ). The
˜ := poly(ZN → GN ) ⋊T R on poly(ZN → log GN ) is then s-step
action of the group G
˜ is s-step nilpotent.
unipotent, which implies that G
π(˜
g n x˜) =

9Note that Z is viewed as an additive group, while poly(Z → G ) is viewed as a multiplicative
N
N
group; we hope that this will not cause confusion.
10This can also be done by the machinery of Mal’cev bases for both discrete and continuous
nilpotent groups, see [45].

92

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

˜ is an s-step nilpotent Lie group which is both connected and simply
The group G
˜ := poly(ZN → ΓN ) ⋊T Z. Since
connected. It contains the discrete subgroup Γ
˜ is
poly(ZN → ΓN ) is cocompact in poly(ZN → GN ) (and Z is cocompact in R), G
˜ thus G/
˜ Γ
˜ has the structure of a nilmanifold.
cocompact in G;
˜ Γ
˜ to T induced by the projections of G,
˜ Γ
˜ to
There is a canonical map θ from G/
−1
R and Z respectively. We denote the kernel θ ({0}) of this map by K, thus K is
˜ Γ.
˜ Observe that every element of K can be represented as
a compact subset of G,
˜
(g, 0)Γ for some g ∈ poly(ZN → GN ), which is unique up to multiplication on the
right by poly(ZN → ΓN ). We then deﬁne the map π : K → G/Γ by the formula
π(g) := g(0)Γ; it is clear that π is a Lipschitz continuous map.
We are now ready to establish Proposition C.2. Let g ∈ poly(ZN → GN ), then
˜ ∈ K and g˜ := (id, 1) ∈ G.
˜ One easily veriﬁes that for any integer
we set x
˜ := (g, 0)Γ
n
n
n
˜
n, g˜ x
˜ = (T g, 0)Γ ∈ K, and so π(˜
g x
˜) = g(n). Proposition C.2 follows.
Appendix D. Equidistribution theory
The purpose of this appendix develop the quantative Ratner-type equidistribution theory for nilmanifolds, which will help us determine when averages such as
En∈[N ] F (O(n))

(D.1)

are large, for various nilsequences n → F (O(n)). We will also need a multidimensional version11 of this theory, in which [N ] is replaced with [N ]k , or more generally
by the Cartesian product of k arithmetic progressions.
This theory is based on the results [24] on equidistribution in nilmanifolds, translated to the language of ultralimits. The results in this appendix will be needed in
two places. Firstly, Theorem D.6 below, which gives a criterion for when averages
such as (D.1) are large, will be used in §11 to analyse the correlation property
arising from Proposition 7.3. Secondly, Theorem D.5, which (locally) factorises
an arbitrary multidimensional polynomial orbit into equidistributed and smooth
pieces, will be used to give an important criterion for when a nilcharacter is biased
(see Lemma E.11).
We begin with some basic deﬁnitions.
Definition D.1 (Equidistribution). Let G/Γ be a standard nilmanifold, which then
admits a canonical Haar probability measure µ. Let Ω be a non-empty limit ﬁnite
set, and let O : Ω → ∗ (G/Γ) be a limit function. We say that O is equidistributed
in G/Γ if, for every F ∈ Lip(G/Γ), one has
En∈Ω F (O(n)) =

F dµ + o(1),

(D.2)

G/Γ

or equivalently if n → F (O(n)) is unbiased on Ω whenever G/Γ F dµ = 0.
Now we specialise to the case Ω = [N ]k . We say that O is totally equidistributed
on [N ]k if it is equidistributed on every product P1 × . . . × Pk of dense arithmetic
progressions P1 , . . . , Pk in [N ], thus
En∈P1 ×...×Pk F (O(n)) =

F dµ + o(1)

(D.3)

G/Γ

for every standard Lipschitz function F : G/Γ → C.
11On the other hand, we will however only need to work with the degree filtration, although
it is certain that the theory here would extend to I-filtered nilsequences for other orderings.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

93

Remark. We deﬁned equidistribution using standard Lipschitz functions F ∈
Lip(G/Γ), but the statement (D.2) for F ∈ Lip(G/Γ) automatically implies the
same claim for F ∈ Lip(∗ (G/Γ)).
This notion of equidistribution on [N ] is closely related to, but not identical with,
the more classical notion of equidistribution involving an infinite sequence g : Z →
G, in which one takes a limit as N → ∞; we refer to this latter concept as asymptotic
equidistribution in order to distinguish it from the “single-scale” equidistribution
considered here, in which one is working with a ﬁxed (but unbounded) N . While
there is a close analogy between the theory of asymptotic equidistribution and
single-scale equidistribution, there does not seem to be a soft way to automatically
transfer results from the former to the latter. Single-scale equidistribution is in fact
much closer to the notion of δ-equidistribution studied for instance in [24]; we refer
readers to that paper for further discussion of the distinction between the diﬀerent
types of equidistribution.
Example. We consider the case when G/Γ = Td is a torus. Weyl’s equidistribution criterion, in our notation, then asserts that an limit map O : [N ]k → Td is
equidistributed if and only if one has
En∈[N ]k e(ξ · O(n)) = o(1)
d

for all standard ξ ∈ Z \{0}. One can also show (using some Fourier analysis) that
O will be totally equidistributed if and only if
En∈[N ]k e(ξ · O(n))e(η · n) = o(1)
for all standard ξ ∈ Zd \{0} and η ∈ Zk . As a consequence of this and some
further Fourier analysis, we see that a one-dimensional linear orbit O : [N ] → Td
deﬁned by O(n) := αn + β for some α, β ∈ Td will be equidistributed or totally
equidistributed in Td if and only if α is not of the form q + O(N −1 ) mod 1 for some
standard rational q ∈ Q.
Given a standard ﬁltered nilmanifold G/Γ, a horizontal character is a continuous
standard homomorphism ξ : G → T which vanishes on Γ. We say that the character
is non-trivial if it is not identically zero.
We have the following basic equidistribution criterion, generalising the torus
example above.
Theorem D.2 (Leibman theorem). Let k ∈ N+ , let N be an unbounded natural
number, let G/Γ be an N-filtered nilmanifold, and let O ∈ ∗ poly(ZkN → (G/Γ)N ) be
a k-dimensional polynomial orbit, where Zk is given the degree filtration. Then on
[N ]k , the following statements are equivalent:
(i) O is totally equidistributed in the nilmanifold G/Γ;
(ii) O is equidistributed in the nilmanifold G/Γ;
(iii) O is equidistributed in in the torus G/([G, G]Γ), and
(iv) There does not exist any non-trivial horizontal character ξ such that ξ ◦ g
is Lipschitz with constant O(1/N ).
Proof. See [24, Theorems 1.19, 2.9, 8.6] (where in fact a more quantitative strengthening of this equivalence is established). The analogue of this result for asymptotic
equidistribution was established previously in [46] (and the result is classical in the
case of linear sequences). The main diﬃculty is to show that (iv) implies (ii), which
is the main content of [24, Theorem 2.9], which relies primarily on a certain van
der Corput type equidistribution lemma for nilmanifolds.

94

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Theorem D.2 implies the following weak factorisation theorem.
Theorem D.3 (Weak factorisation theorem). Let k ∈ N+ , let N be an unbounded
natural number, let G/Γ be an N-filtered nilmanifold and let g ∈ ∗ poly(ZkN → GN ).
Suppose that g is not totally equidistributed on [N ] in G/Γ. Then one can factorise
g = εg ′ γ, where ε, g ′ , γ ∈ ∗ poly(ZkN → GN ) have the following properties:
• ε is a bounded sequence on [N ]k with the ith Taylor coefficient of size
O(N −|i| ) for each i ∈ Nk ;
• g ′ takes values in a standard proper rational subgroup G′ of G (i.e. G′ is a
connected proper Lie subgroup of G, and Γ′ := G′ ∩ Γ is cocompact in G).
• γ is periodic modulo Γ with a standard period q ∈ N+ , thus γ(n + qv) =
γ(n) mod Γ for all n, v ∈ ∗ Zk . Furthermore, γ takes values in a standard
˜ of G which contains Γ as a subgroup.
subgroup Γ
Proof. See [24, Proposition 9.2]. The basic idea is to use the non-trivial horizontal
character ξ generated by Theorem D.2 to cut out the subgroup G′ . In order to keep
G′ connected, one needs to ﬁrst factorise ξ = mξ ′ where m is a standard positive
integer and ξ ′ is an irreducible horizontal nilcharacter; this integer m is responsible
for the periodic term γ.
One can iterate this to obtain a “Ratner-type” theorem.
Theorem D.4 (Factorisation theorem). Let k ∈ N+ , let N be an unbounded natural
number, let G/Γ be a (filtered ) nilmanifold, and let g ∈ ∗ poly(ZkN → GN ). Then
there exists a standard rational subgroup G′ of G (i.e. G′ is connected and G′ ∩ Γ
is cocompact in G) and a factorisation
g(n) = ε(n)g ′ (n)γ(n)
where ε, g ′ , γ ∈ ∗ poly(ZkN → GN ) have the following additional properties:
• ε is a bounded sequence with the ith Taylor coefficient of size O(N −|i| ) for
each i ∈ Nk , and has Lipschitz constant O(1/N );
• g ′ takes values in a standard proper rational subgroup G′ of G, and is
totally equidistributed in G′ /Γ′ whenever Γ′ is any standard subgroup of
G′ ∩ Γ of finite (standard ) index.
• γ is periodic modulo Γ with a standard period, and takes values in a stan˜ of G which contains Γ.
dard discrete subgroup Γ
This theorem is a close relative of [24, Theorem 1.19], and can be proven by the
same methods; for the convenience of the reader we sketch a proof here.
Proof. Let us say that g can be represented using a standard rational subgroup
G′ of G if one has a factorisation g = εg ′ γ which obeys all the conclusions of the
theorem except for the total equidistribution of g ′ . Clearly, g can be represented
using G itself, by setting ε and γ to be the identity and g ′ := g. By the principle
of inﬁnite descent12 (using the fact that G has a ﬁnite standard dimension), we
may thus ﬁnd a standard rational subgroup G′ which represents g, and is minimal
12The ability to use this principle is an advantage of the ultralimit setting. In the finitary

setting, in which one needs to quantify such concepts as total equidistribution, periodicity, etc.,
one has to instead perform an iterative “dimension reduction argument” which requires one to
manage many more parameters; see [24] for an example of this. See also the beginning of §10 for
a related discussion.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

95

in the sense that no proper standard rational subgroup of G′ represents g. Let
g = εg ′ γ be the associated factorisation. It then suﬃces to show that g ′ is totally
equidistributed in G′ /Γ′ for every standard ﬁnite index subgroup Γ′ of Γ ∩ G′ .
Suppose for contradiction that this is not the case. Applying Theorem D.3, one
can factorise g ′ = ε′′ g ′′ γ ′′ where ε′′ is a bounded sequence with Lipschitz constant
O(1/N ), γ ′′ is periodic with a standard period, and takes values in a standard
˜ ′ that contains Γ′ , and g ′′ takes values in a proper rational
discrete subgroup Γ
′′
′
˜ ′ to contain Γ, and this is easily veriﬁed to
subgroup G of G . One can enlarge Γ
still be discrete. One can then show that the factorisation g = (εε′′ )g ′′ (γ ′′ γ) is a
representation of g using G′′ (see [24, §10] for details), contradicting the minimality
of G′′ .
It will be convenient to convert the factorisation in Theorem D.4 into a more
convenient form, eliminating the periodic factor γ and the slowly varying factor ε
by passing to subprogressions.
Theorem D.5 (Factorisation theorem, II). Let k ∈ N+ , let N be an unbounded
natural number and let O ∈ ∗ poly(ZkN → (G/Γ)N ). Then one can partition [N ]k
into a bounded number of products P = P1 × . . . Pk of dense arithmetic subprogressions of [N ], such that for each P one has a polynomial ε ∈ ∗ poly(ZkN → GN ) which
is bounded with Lipschitz constant O(1/N ) on P and with the ith Taylor coefficient
of size O(N −|i| ) for each i, a standard rational subgroup GP of G, and a polynomial sequence gP ∈ ∗ poly(ZkN → (GP )N ) totally equidistributed on GP /ΓP where
(GP )N := (GP ∩ Gi )i∈N and ΓP := GP ∩ Γ, such that
O(n) = εP (n)gP (n)∗ Γ
for all n ∈ P . Furthermore, for each i ∈ Nk , the horizontal Taylor coefficients
Taylori (g) and Taylori (gP ) differ by O(N −|i| ). Finally, for two different products
P, P ′ of progressions in this partition of [N ]k , the sequences gP and gP ′ are con−1
jugate, with gP ′ = γP,P
′ gP γP,P ′ for some γP,P ′ ∈ G which is rational in the sense
m
that γP,P ′ ∈ Γ for some bounded positive integer m.
Proof. Write O(n) = g(n)∗ Γ for some g ∈ ∗ poly(ZkN → GN ). We apply Theorem
D.4 to obtain a rational standard subgroup G′ and a factorisation g = εg ′ γ with
the stated properties. The sequence γ is periodic with a standard period, so we
may partition [N ]k into a bounded number of products P = P1 × . . . × Pk of dense
arithmetic subprogressions of [N ] on which γ = γP is constant. As Γ is cocompact,
we may thus ﬁnd γP′ ∈ γP Γ which is bounded, thus γP′ = O(1). Note that γP′
˜ and is thus standard. Since Γ is cocompact, it has ﬁnite
lives in a discrete group Γ
˜ which implies that γ ′ is rational, or equivalently that γ ′ has rational
index in Γ,
P
P
coeﬃcients with respect to a Mal’cev basis [48] of G/Γ.
For n ∈ P , we can write
O(n) = ε(n)g ′ (n)γP Γ = ε(n)γP′ gP (n)∗ Γ
where gP (n) := (γP′ )−1 g ′ (n)γP′ is the conjugate of g ′ (n) by γP′ . Note that this gives
the claim about the conjugate nature of gP and gP ′ .
As γP′ is rational, the conjugate γP′ Γ(γP′ )−1 intersects Γ in a subgroup Γ′ of ﬁnite
index, which then has the property that Γ′ γP′ ⊂ γP′ Γ. From this, we see that the
conjugation operation g → (γP′ )−1 gγP′ on G descends to a continuous projection of
G/Γ′ to G/Γ, which maps g(n)∗ Γ′ to gP (n)∗ Γ. Since g(n) is totally equidistributed

96

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

on G′ /(G′ ∩ Γ′ ) by construction, we conclude that gP is totally equidistributed on
GP /(GP ∩ Γ), where GP := (γP′ )−1 G′ γP′ is the conjugate of G′ . Note that GP is
also a standard rational subgroup of G. If we now set εP := εγP′ , we obtain all the
claims except for the one about horizontalTaylor coeﬃcients. But from the remarks
following Deﬁnition 9.6 and the factorisations g = εg ′ γ, gP = (γP′ )−1 g ′ γP we have
Taylori (g) = Taylori (ε)Taylori (g ′ )Taylori (γ)
and
Taylori (gP ) = Taylori (g ′ ).
Since γ takes values in Γ, Taylori (γ) vanishes. Finally, by construction we have
Taylori (ε) = O(N −|i| ). The claim follows.
We can now give a criterion for when an average of the form En∈[N ] F (O(n)) is
large.
Theorem D.6 (Ratner-type theorem). Let G/Γ be N-filtered nilmanifold of some
degree d, let O ∈ ∗ poly(ZN → (G/Γ)N ) be a polynomial orbit, and let
F ∈ Lip(∗ (G/Γ) → Cω )
be such that
|En∈[N ] F (O(n))| ≫ 1.
Then one has
F (εx) dµ(x)| ≫ 1

|
GP /ΓP

for some bounded ε ∈ G and some rational subgroup GP of G, with the property
that
πHorizi (G) (GP ∩ Gi ) Ξ⊥
i
where the horizontal space Horizi (G) and the projection map πHorizi (G) : Gi →
Horizi (G) was defined in Definition 9.6,
Ξ⊥
i := {x ∈ Horizi (G) : ξi (x) = 0 for all ξi ∈ Ξi }
and Ξi
Horizi (G/Γ) is the group of all (standard ) continuous homomorphisms
ξi : Horizi (G/Γ) → T such that
ξi (Taylori (O)) = O(N −i ).
One could also generalise this theorem to multidimensional orbits, but we will
not need to do so in this paper. We will motivate this theorem with some examples
after the proof.
Proof. By taking components we may assume that F is scalar-valued. Write O(n) =
g(n)∗ Γ for some g ∈ ∗ poly(ZN → GN ). We partition [N ] into dense arithmetic
progressions P induced from the partition of [N ] coming from Theorem D.5 (using
the Chinese remainder theorem and passing to dense subprogressions as necessary).
By the pigeonhole principle, for at least one of these progressions P one has
|En∈P F (g(n)∗ Γ)| ≫ 1.
Now let δ > 0 be a small standard number to be chosen later. By further partitioning of P and the pigeonhole principle one can assume that P has diameter at
most δN (note that the implied constant in the ≫ notation remains independent
of δ when doing so). Then for any n0 ∈ P , εP (n) and εP (n0 ) diﬀer by O(δ), and so

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

97

(by the Lipschitz nature of F ) F (g(n)∗ Γ) diﬀers from F (εP (n0 )gP (n)∗ Γ) by O(δ).
Thus, for δ suﬃciently small, and setting ε := εP (n0 ), one has
|En∈P F (εgP (n)∗ Γ)| ≫ 1.
Using the total equidistribution of gP , we have
En∈P F (εgP (n)∗ Γ) =

F (εx) dµ(x) + o(1)
GP /ΓP

and so
F (εx) dµ(x) ≫ 1.
GP /ΓP

To ﬁnish the proof of Theorem D.6, we need to show that
πHorizi (G) (GP ∩ Gi )

Ξ⊥
i

(D.4)

for all positive standard integers i, with Ξi as in Theorem D.6.
Fix i. To show the above claim, observe that gP takes values in GP , and so
Taylori (gP ) ∈ πHorizi (G/Γ) (GP ∩ Gi ). On the other hand, Taylori (gP ) diﬀers from
Taylori (g) by O(N −i ), and so
dist(Taylori (g), πHorizi (G/Γ) (GP ∩ Gi )) = O(N −i ).

(D.5)

Suppose the inclusion (D.4) failed. Then by duality (and the rational nature of GP ),
there exists a standard continuous homomorphism ξi : Horizi (G/Γ) → T outside of
Ξi which annihilates πi (GP ∩ Gi ). From (D.5), This implies that
ξi (Taylori (g)) = O(N −i ),
and thus ξi ∈ Ξi by deﬁnition of Ξi , contradiction. The claim follows.
To get a feel for this proposition, let us ﬁrst examine a simple special case, when
G/Γ is just a two-dimensional torus T2 , and O is a linear orbit O(n) := (αn, βn)
for some α, β ∈ ∗ T. We take F to be a standard Lipschitz function from T2 to C.
Our hypothesis is then the assertion that
|En∈[N ] F (αn, βn)| ≫ 1.
The conclusion is then that
|

F (ε + x) dµT (x)| ≫ 1
T

for some subtorus T := GP /(GP ∩ Z2 ) of T2 , where ε ∈ T2 and GP is a rational
subgroup of R2 . Furthermore, GP contains the subgroup
2
Ξ⊥
1 := {x ∈ R : ξ(x) = 0 for all ξ ∈ Ξ1 }

and Ξ1 is the subgroup of Z2 deﬁned by
Ξ1 := {ξ ∈

Z2 : ξ · (α, β) = O(N −1 )}.

We investigate some subcases of this result. First consider the case when α, β are
both within O(N −1 ) of standard rationals. Then Ξ1 is a ﬁnite index subgroup
of Z2 , and so Ξ⊥
1 is trivial. The conclusion is then simply the trivial conclusion
that |F (ε)| ≫ 1 for some ε ∈ T2 , which was of course obvious from the pigeonhole
principle.
Now suppose that β is within O(N −1 ) of a standard rational p/q with p, q
coprime, but that α does not lie within O(N −1 ) of a standard rational. Then
Ξ1 = {(0, qa) : a ∈ Z}, and so Ξ⊥
1 = R × {0}. The conclusion is now that

98

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

| T F (x, ε) dx| ≫ 1 for some ε ∈ T. This can also be seen directly by observing
that on any subprogression of [N ] of spacing q and length δN for some small δ > 0,
the orbit O(n) is within O(δ) of being equidistributed on a coset T × {ε} of T × {0}
for some ε ∈ T, with the implied constant in the O(δ) notation independent of δ.
The claim then follows from the pigeonhole principle (choosing δ suﬃciently small,
but still standard) and the Lipschitz nature of F .
Finally, suppose that α, β are incommensurate in the sense that there does not
exist any non-zero ξ ∈ Z2 for which ξ · (a, b) = O(N −1 ). Then Ξ1 is trivial and so
2
Ξ⊥
1 = R . The claim is then that | T2 F (x, y) dxdy| ≫ 1, which is also apparent
from the equidistribution of O in T2 in this case.
One can also repeat the above example with the linear orbit n → (αn, βn)
replaced by a polynomial orbit such as n → (αnD , βnD ) for some standard D 1.
The discussion is identical, except that the O(N −1 ) errors must now be replaced
by O(N −D ).
Now we consider the more general non-abelian setting, in which G/Γ is not
necessarily a torus (i.e. we allow d to exceed 1). We ﬁrst remark upon the “incommensurate”, “generic”, or “equidistributed” case when all the Ξi are trivial, i.e.
there are no non-trivial relations of the form
ξi (Taylori (O)) = O(N −i ).
In this case, Ξ⊥
i = Horizi (G) and so the maps πi : GP ∩ Gi → Horiz(Gi ) are all
surjective. This implies that all the horizontal spaces of the quotient group G/GP
are trivial, which one easily sees to imply that G/GP itself must be trivial, i.e. that
GP = G. We conclude that | G/Γ F dµ| ≫ 1. Indeed, in this case it turns out that
O is totally equidistributed and
En∈P0 F (O(n)) =

F dµ + o(1).
G/Γ

This fact can also be deduced from the arithmetic counting lemma [27, Theorem
1.11].
Finally, to illustrate how we actually use Theorem D.6 in practice, we consider
a model problem in which we are given frequencies α, β, α′ , β ′ ∈ ∗ T obeying the
correlation property
|En∈[N ] e({αn}βn)e({α′ n}β ′ n)| ≫ 1,

(D.6)

and we wish to conclude some constraints between these four frequencies; informally, the problem here is to determine for which frequencies α, β, α′ , β ′ can one
have a non-trivial relationship between {αn}βn and {α′ n}β ′ n (cf. (6.4)). Strictly
speaking, for the analysis that we are about to give to apply, we must ﬁrst replace
the bracket polynomial expressions above by suitable vector-valued smoothings (or
else develop analogues of the above equidistribution theory for piecewise Lipschitz
nilsequences, as was done in the d = 2 case in [28]), but to simplify the exposition
we shall completely ignore this technical issue here.
Ignoring the technical issue alluded to above, we can express the left-hand side of
(D.6) in the form |En∈[N ] F (O(n))|, where G/Γ is the product Heisenberg nilmanifold of degree 2, generated by four generators e1 , e2 , e′1 , e′2 with [e1 , e2 ], [e′1 , e′2 ]
central (and with e1 , e2 commuting with e′1 , e′2 ),
′

′

αn ′ β n ′ α n
O(n) := eβn
(e1 ) Γ,
2 e1 (e2 )

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

99

and F is a (piecewise) Lipschitz function on G/Γ obeying the vertical frequency
property
′
(D.7)
F ([e1 , e2 ]t12 [e′1 , e′2 ]t12 x) = e(−t12 − t′12 )F (x)
for all x ∈ G/Γ and t12 , t′12 ∈ R. Note that Horiz1 (G) is isomorphic to R4 (being generated by the projections of e1 , e2 , e′1 , e′2 via πHoriz1 (G) ), while Horiz2 (G) is
trivial. Applying Theorem D.6, we conclude that
F (εx) dµ(x)| ≫ 1

|
GP /ΓP

for some bounded ε ∈ G and some rational subgroup GP of G, with the property
that
πHoriz1 (G) (GP ) Ξ⊥
(D.8)
1
where
Ξ1 := {ξ ∈ Z4 : ξ · (α, β, α′ , β ′ ) = O(N −1 )}.
′

If the vertical group GP ∩ G2 contains any element [e1 , e2 ]t12 [e′1 , e′2 ]t12 with −t12 −
t′12 = 0, then from (D.7) we see that G/P F (εx) dµ(x) = 0, a contradiction. We
conclude that
(D.9)
GP ∩ G2 ⊂ [e1 , e2 ][e′1 , e′2 ]−1 R .
This gives us some information concerning the group Ξ1 , and hence on the frequencies α, β, α′ , β ′ . Indeed, suppose that we are given two elements (a, b, a′ , b′ ) and
(c, d, c′ , d′ ) in Ξ⊥ . By (D.8), we conclude that GP contains two elements g, h such
that
′
′
g = ea1 eb2 (e′1 )a (e′2 )b mod G2
and
′

′

h = ec1 ed2 (e′1 )c (e′2 )d mod G2 .
Since g and h lie in GP , the commutator
′ ′

′ ′

[g, h] = [e1 , e2 ]ad−bc [e′1 , e′2 ]a d −b c

must also lie in GP . Comparing this with (D.9) we obtain an algebraic constraint
on Ξ that prevents it from being too small, namely that
(ad − bc) + (a′ d′ − b′ c′ ) = 0
′

′

′

′

(D.10)

4

whenever (a, b, a , b ), (c, d, c , d ) ∈ Z are both orthogonal to Ξ; thus the symplectic
form (D.10) must vanish when restricted to Ξ⊥ .
For instance, suppose that (α′ , β ′ ) = (β, α), but that α, β are otherwise in general
position (cf. (6.4)). Then Ξ is generated by (1, 0, 0, 1) and (0, 1, 1, 0), so Ξ⊥ is
generated by (1, 0, 0, −1) and (0, 1, −1, 0), and one easily veriﬁes the property. It is
in principle possible to work out what other quadruples α, β, α′ , β ′ are permitted
by Theorem D.6, but we will not compute this here.
Appendix E. Some basic properties of nilcharacters and symbols
In this appendix we establish some basic properties of nilcharacters and symbols;
this material is broadly comparable to [28, §3].
Throughout this appendix, I is understood to be an ordering (see Deﬁnition 6.7).
We ﬁrst begin with some basic closure properties of nilsequences.

100

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Lemma E.1 (Nilsequences are preserved by Lipschitz operations). Let H be an
I-filtered group, let J be a finite downset in I, and let Ω be a limit subset of ∗ H. If
Di
ψi ∈ Nil⊂J (Ω → C ) and Di ∈ N+ for i = 1, . . . , m, and F : CD1 × . . . × CDm →
CD is a locally Lipschitz standard function, then F (ψ1 , . . . , ψm ) ∈ Nil⊂J (Ω → CD ).
Proof. This follows immediately from Deﬁnition 6.19 and Example 6.13.
As an immediate corollary we have the following.
Corollary E.2 (Algebra property). Let H be an I-filtered group, let J be a finite downset of I, and let Ω be a limit subset of H. Then Nil⊂J (Ω → C) is a
sub-∗-algebra of L∞ (Ω → C), that is to say it is closed under pointwise multiplication, scalar multiplication by bounded constants, addition, and complex conjugation.
ω
Similarly, Nil⊂J (Ω → C ) is closed under complex conjugation, tensor product, and
bounded linear combinations.
Remark. From the example after Corollary B.5 we also see that if ψ ∈ L∞ (∗ H →
C ) is a nilsequence of degree ⊂ J, then so is any translate ψ(· + h) or dilate ψ(q·)
of ψ for h ∈ ∗ H and q ∈ Z.
ω

Lemma E.3 (Basic facts about nilcharacters). Let H = (H, +) be an I-filtered
abelian group for some I, let d ∈ I, and let χ, χ′ be nilcharacters in Ξd (∗ H). Then
χ ⊗ χ′ , χ(· + h), χ(q·), and χ are also nilcharacters of degree d for every h ∈ ∗ H,
and q ∈ Z.
More generally, if T : H ′ → H is a (standard ) filtered homomorphism from
another I-filtered abelian group H ′ = (H ′ , +) to H, then χ ◦ T is a nilcharacter in
Ξd (∗ H ′ ).
′
Finally, one has Ξd (∗ H) ⊂ Ξd (∗ H ′ ) whenever d′ < d.
Proof. This follows from Corollary B.5 (cf. the example after that corollary, and
Corollary E.2).
From (6.5) it is trivial that a multidimensional polynomial of multidegree ⊂ J ∪J ′
can be decomposed as the sum of a multidimensional polynomial of multidegree
⊂ J, and a multidimensional polynomial of multidegree ⊂ J ′ . There is an analogous
decomposition for nilcharacters.
Lemma E.4 (Splitting lemma). Let k ∈ N+ , and let J, J ′ be finite downsets of Nk .
′
Let ψ ∈ Nil⊂J∪J (∗ Z k → C) be a nilsequence, and let ε > 0 be standard. Then
K

ψk (n)ψk′ (n)

ψ(n) −

L ∞ (∗ Z k )

ε

k=1

where K is standard and for each 1
′
Nil⊂J (∗ Zk → C).

k

K, ψk ∈ Nil⊂J (∗ Zk → C) and ψk′ ∈

Proof. We can write ψ = F ◦ O, where F ∈ Lip(∗ (G/Γ) → C), O ∈ ∗ poly(Zk →
G/Γ), and G/Γ is an Zk -ﬁltered nilmanifold with degree ⊂ J ∪ J ′ .
For each j ∈ J ∪ J ′ , let ej,1 , . . . , ej,dj be a basis of generators for Γj . We
may then lift G to the universal nilpotent Lie group that is formally generated by
the ej,i , subject to the constraint that any r − 1-fold iterated commutator of the
ej1 ,i1 , . . . , ejr ,ir with j1 + · · · + jr ∈ J ∪ J ′ vanishes, and similarly lift Γ, F , O (using

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

101

Corollary B.10 for the latter). Thus we may assume without loss of generality that
G is universal.
The degree ⊂ J ∪J ′ nilmanifold G/Γ projects down to the degree ⊂ J nilmanifold
G/G>J Γ, where G>J is the group generated by the Gj for all j ∈ J ′ \J. Similarly we
have a projection from G/Γ to the degree ⊂ J ′ nilmanifold G/G>J ′ Γ. The algebras
Lip(∗ (G/G>J Γ) → C), Lip(∗ (G/G>J ′ Γ) → C) then pull back to subalgebras of
Lip(∗ (G/Γ) → C). By universality of G, G>J and G>J ′ are disjoint. Thus, the
union of these two algebras separate points in G/Γ. By the Stone-Weierstrass
theorem, one can thus approximate F to arbitrary accuracy by products of elements
from these algebras, and the claim follows.
Next, we show that nilsequences can be decomposed into nilcharacters.
Lemma E.5 (Fourier decomposition). Let H be an I-filtered group, and let d ∈ I.
If ψ ∈ Nil d (∗ H) and ε > 0 is standard, then one can find a standard natural
number m, and nilcharacters χj ∈ Ξd (∗ H), scalar nilsequences ψj ∈ Nil<d (∗ H),
and bounded linear transformations T : C
for each 1 j m such that

Dj

D

→C

for suitable dimensions Dj , D

m

Tj (ψj ⊗ χj )

ψ−

L∞ (∗ H)

ε.

j=1

Proof. It suﬃces to show this for scalar nilsequences ψ. Let G/Γ be an I-ﬁltered
nilmanifold of degree
d, let F ∈ Lip(∗ (G/Γ) → C), and let ε > 0. We need to
m
show that one can approximate F to uniform error at most ε by j=1 Tj (Fj ⊗ fj ),
2Dj −1
where each Fj ∈ Lip(G/Γ → S
) has a vertical frequency, fj ∈ Lip(G/Γ → C)
is invariant with respect to the Gd action (so that fj descends to the quotient
nilmanifold G/Gd Γ, which has degree < d), and the Tj : CDj → C are linear
transformations.
m
Observe that the class of functions of the form j=1 Tj (Fj ⊗ fj ) form a complex
algebra that are closed under conjugations. Thus by the Stone-Weierstrass theorem,
it suﬃces to show functions of the form F ⊗ f , where F ∈ Lip(G/Γ → S 2D−1 ) has
a vertical frequency and f ∈ Lip(G/Γ → C) and is invariant under Gd , separate
points. This is trivial for two points which descend to distinct points on G/Gd Γ,
so it suﬃces to do so for two points on a common Gd ﬁbre. For this, it suﬃces by
the deﬁnition of vertical frequency to show that for each g ∈ Gd with g ∈ Γd , there
exists a function F ∈ Lip(G/Γ → S 2D−1 ) has a vertical frequency η with η(g) ∈ Z.
The existence of a character η : Gd → R with η(g) ∈ Z is guaranteed by Pontryagin duality. Fixing such an η, we now perform the same construction used at
the start of §6 (i.e. smoothly partition the base space G/Gd Γ into balls of small
radius) to generate the desired function F .
Corollary E.6 (Correlation). Let H be an I-filtered group, let d ∈ I, and let Ω be
a limit finite subset of ∗ H. If f ∈ L∞ (Ω) is
d-biased, then f correlates with a
nilcharacter in Ξd (Ω).
Proof. We assume inductively that the claim has already been proven for all smaller
values of d. We may assume that f is scalar. Applying Lemma E.5 for ε small
m
enough, we see that f correlates with an expression of the form j=1 Tj (ψj ⊗ χj ),
and thus by the pigeonhole principle, f correlates with one of the ψj ⊗ χj , and
thus f χj correlates with ψj . We can express the downset {i ∈ I : i < d} as the

102

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

ﬁnite union of downsets {i ∈ I : i d′ } for various d′ < d. Applying Lemma E.4
repeatedly for suﬃciently small ε, we thus see that f χj correlates with d′ d ψd′ ,
where each ψd′ is a nilsequence of degree d′ . Applying the inductive hypothesis
repeatedly, we thus see that f χj correlates with d′ <d χd′ for some nilcharacters
χd′ of degree d′ , and so f correlates with χj ⊗ d′ <d χd′ . The claim now follows
from Lemma E.3.
We turn now to a discussion of the basic properties of symbols. We begin by
clearing up a small issue left over from §6: that of proving that the notion of equivalence we introduced in Deﬁnition 6.22 is indeed an equivalence relation. Recall
that nilcharacters χ and χ′ were said to be equivalent if χ ⊗ χ′ is a nilsequence of
degree strictly less than d.
Lemma E.7. Equivalence of nilcharacters, thus defined, is an equivalence relation.
Proof. The symmetry is obvious. For transitivity, suppose that χ1 ∼ χ2 and that
χ2 ∼ χ3 . Then each component of
(χ1 ⊗ χ2 ) ⊗ (χ2 ⊗ χ3 ) = χ1 ⊗ (χ2 ⊗ χ2 ) ⊗ χ3
is a nilsequence of degree strictly less than d. However the trace of χ2 ⊗ χ2 is 1, and
so χ1 ⊗ χ3 is a combination of the components of χ1 ⊗ (χ2 ⊗ χ2 ) ⊗ χ3 . In particular,
it is a nilsequence of degree strictly less than d.
To show reﬂexivity, we must conﬁrm that χ ⊗ χ is a nilsequence of degree ≺
d for any nilcharacter χ ∈ Ξd (Ω). If we write χ(n) = F (g(n)∗ Γ), where F ∈
Lip(∗ (G/Γ) → S ω ) has a vertical frequency η, we have
χ ⊗ χ(n) = (F ⊗ F )(g(n)∗ Γ).
Noting that F ⊗ F is invariant with respect to the Gd action, we may quotient out
by this central group and represent χ ⊗ χ using a nilmanifold of degree ≺ d.
The space Symbd (Ω) has many nice properties.
Lemma E.8 (Symbol calculus). Let H = (H, +) be an abelian I-filtered group, let
d ∈ I, and let Ω be a limit subset of ∗ H.
(i) If χ, χ′ ∈ Ξd (Ω) and ψ ∈ Nil<d (Ω), and the components of χ are bounded
linear combinations of those of χ′ ⊗ ψ, then χ, χ′ are equivalent on Ω and
thus [χ]Symbd (Ω) = [χ′ ]Symbd (Ω) .
(ii) Conversely, if χ, χ′ ∈ Ξd (Ω) are equivalent, then χ is a bounded linear
combination of χ′ ⊗ ψ for some ψ ∈ Nil<d (Ω).
(iii) Symbd (Ω) is an abelian group with the group operation induced from tensor
product.
(iv) If χ ∈ Ξd (∗ H) and h ∈ ∗ Hi for some i > 0, then χ and χ(· + h) are equivalent on ∗ H (and thus on Ω also). Thus, [χ(· + h)]Symbd (Ω) = [χ]Symbd (Ω) .
(v) If H = Zk with either the multidegree or degree filtration, χ ∈ Ξd (∗ H) and
|d|
q ∈ Z, then χ⊗q and χ(q·) are equivalent on ∗ H (and thus on Ω also),
thus [χ(q·)]Symbd (Ω) = q |d| [χ]Symbd (Ω) .
′
(vi) (Pullback) If T : ∗ Zk → ∗ Zk is a linear transformation, and χ is a
′
nilcharacter of degree d on ∗ Zk , then χ ◦ T is a nilcharacter of degree
d on Zk . Moreover, if χ′ is another nilcharacter of degree d on ∗ Zk with
[χ]Symbd (∗ Zk′ ) = [χ′ ]Symbd (∗ Zk′ ) , then [χ ◦ T ]Symbd (∗ Zk ) = [χ′ ◦ T ]Symbd (∗ Zk ) .

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

103

(vii) (Divisibility) If H = Zk with either the multidegree or degree filtration,
d = 0, χ ∈ Ξd (Ω) and q ∈ N+ , then there exists χ
˜ such that [χ]Symbd (Ω) =
q[χ]
˜ Symbd (Ω) .
Proof. The claim (i) follows from the same argument used to prove reﬂexivity in
Lemma E.7. For (ii), we proceed much as in the proof of transitivity in Lemma
E.7: write φ := χ ⊗ χ′ and consider χ′ ⊗ φ = (χ′ ⊗ χ′ ) ⊗ χ. Since 1 may be written
as a linear combination of the components of χ′ ⊗ χ′ , the claim follows.
The claim (iii) follows easily from (i) and (ii). Part (iv) is more substantial. It
should be compared to some of the consequences of the “bracket quadratic identities” developed in [28, Lemma 5.5].
From Deﬁnition 6.22, it suﬃces to show that the derivative ∆h χ(n) := χ(n +
h)⊗ χ(n) lies in Nil<d (∗ H). We write χ(n) = F (g(n)∗ Γ), where G/Γ is an I-ﬁltered
nilmanifold of degree d, g ∈ ∗ poly(HI → GI ), and F ∈ Lip(∗ (G/Γ)) has a vertical
frequency η : Gd → R, then we have
∆h χ(n) = F ((∂h g(n))g(n)∗ Γ) ⊗ F (g(n)∗ Γ).
As g ∈ ∗ poly(H → G) and h ∈ ∗ Hi , we have ∂h g ∈ ∗ poly(HI → G+i
I ), where
G+i
=
(G
)
is
the
shifted
ﬁltration.
j+i
j∈I
I
We now give G2 an I-ﬁltration by deﬁning (G2 )j to be the group generated by
Gj+i × id and by the diagonal group {(g, g) : g ∈ Gj }. One easily veriﬁes that
this is a ﬁltration, which is rational with respect to Γ2 . In particular, if we set
G := (G2 )0 and Γ := Γ2 ∩ G , we have that G /Γ is an I-ﬁltered nilmanifold
of degree d. Furthermore, from Corollary B.4 we see that the map
O : n → (∂h g(n)g(n), g(n))∗ Γ
lies in ∗ poly(HI → GI /ΓI ). We can thus wrote ∆h χ = F˜ ◦ O, where F˜ ∈
Lip(∗ (G /Γ )) is the function
F˜ (x, y) := F (x) ⊗ F (y).
This is still a degree d representation. But observe from the vertical character
nature of F that F˜ is invariant with respect to the action of the group Gd =
{(g, g) : g ∈ Gd }. Thus we may quotient by this map and descend to a degree < d
nilmanifold, and the claim follows.
Now we turn to (v), which is a similar claim to (iv). Writing χ = F (g(n)∗ Γ) as
before, we reduce to showing that
n → F (g(qn)∗ Γ) ⊗ F (g(n)∗ Γ)⊗q

|d|

(E.1)

can be represented as a nilsequence of degree < d, with the convention that F ⊗−q =
⊗q
F
to deal with the case of negative exponents.
We give G2 a Nk -ﬁltration by declaring G2i to be the group generated by Gj ×
|
Gj for all j > i, together with the set {(g q i| , g) : g ∈ Gi }. From the BakerCampbell-Hausdorﬀ formula one easily sees that this is a ﬁltration, which is rational
with respect to Γ2 ; and so G20 /Γ20 is a degree d nilmanifold. Also, from Taylor
expansion (Lemma B.9) and Corollary B.4 we see that the map
O : n → (g(qn), g(n))∗ Γ20

104

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

lies in ∗ poly(H → G20 /Γ20 ). We then write (E.1) as n → F˜ (O(n)), where F˜ ∈
Lip(∗ (G20 /Γ20 )) is the function
|d|

⊗q
.
F˜ (x, y) := F (x) ⊗ F

From the vertical character nature of F , we see that F˜ is invariant with the action
|d|
of G22 = {(g q , g) : g ∈ Gd }. Quotienting out by this group as in the proof of (iv)
we obtain the claim.
The claim (vi) follows easily from Corollary B.5, so we now turn to (vii). We
will prove this for the multidegree ﬁltration, as the degree ﬁltration is similar. As
usual we write χ = F (g(n)∗ Γ). Applying Taylor expansion (Lemma B.9) and the
Baker-Campbell-Hausdorﬀ formula, we may factorise
j

gjn

g(n) =
j d

for some gj ∈ Gj , where the product is over all multiindices j
d (arranged in
|j|
some arbitrary fashion). Taking roots of each of the gj , we may write gj = (gj′ )q
for each j. We then have g(n) = g ′ (qn), where g ′ is the polynomial sequence
j

g ′ (n) :=

(gj′ )n .
j d

If we write χ′ (n) := F (g ′ (n)∗ Γ), we thus see that χ′ ∈ Ξd (Ω) and χ(n) = χ′ (qn),
so by (v), [χ]Symbd (Ω) = q |d| [χ′ ]Symbd (Ω) . The claim now follows by setting χ
˜ :=
(χ′ )⊗q

|d|−1

.

If P (n) = α0 + . . . + αd nd is a polynomial of one variable n of degree d, then
P is equal (up to degree < d errors) to the multilinear form Q(n, . . . , n), where
Q(n1 , . . . , nd ) := αd n1 . . . nd . A bit more generally, if P (n1 , . . . , nk ) is a polynomial
of k variables n1 , . . . , nk of multidegree d = (d1 , . . . , dk ), then P is equal (up to
degree < d errors) to a degree (1, . . . , 1) form Q(n1 , . . . , n1 , . . . , nk , . . . , nk ), where
1 is repeated |d| times and each ni is repeated di terms. We may generalise this
observaton to nilcharacters. We begin with the simpler k = 1 case.
Proposition E.9 (Multilinearisation, k = 1 case). Let d ∈ N and χ ∈ Ξd (∗ Z).
Then there exists χ
˜ ∈ Ξ(1,...,1) (∗ Zd ) (where 1 is repeated d times) such that the
nilcharacter
χ′ : n → χ(n,
˜ . . . , n)
(where n is repeated d times) is equivalent to χ in Ξd (∗ Z) (thus [χ]Ξd (∗ Z) = [χ′ ]Ξd (∗ Z) ).
Furthermore, one can select χ(n
˜ 1 , . . . , nd ) to be symmetric with respect to permutations of n1 , . . . , nd .
To motivate this proposition, we present an “almost-example” of this proposition
in action: if d = 2 and χ is the degree 2 almost-nilcharacter
χ(n) := e({αn}βn),
(where the “almost” arises because the relevant function F is only piecewise Lipschitz rather than Lipschitz, as discussed at the start of §6) then one can take
1
1
χ(n
˜ 1 , n2 ) := e( {αn1 }βn2 + {αn2 }βn1 )
2
2

(E.2)

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

105

which is a multidegree (1, 1) almost-nilcharacter, with χ(n,
˜ n) equivalent (and in
fact exactly equal, in this case) to χ(n). More generally, if we are able to represent
a nilcharacter in terms of bracket polynomials of the correct degree and rank, then
the above proposition becomes obvious by inspection. Such a representation is in
fact possible (by extending the theory in [46]), but we will proceed here instead by
using abstract algebraic constructions.
Proof. This will be a more complicated version of the argument used to establish
claims (iv), (v) of Lemma E.8. It will be convenient for technical reasons to construct χ
˜ so that χ′ is equivalent to χ⊗d! rather than to χ itself; to recover the
original claim in the proposition, one simply appeals to Lemma E.8(vii).
We have χ(n) = F (g(n)∗ Γ) for some degree d nilmanifold G/Γ, some polynomial
sequence g ∈ ∗ poly(ZN → (G/Γ)N ), and some F ∈ Lip(∗ (G/Γ) → S ω ), obeying the
vertical frequency property
F (gd x) = e(η(gd ))F (x)
for all x ∈ G/Γ and gd ∈ Gd , where η : Gd → R is a continuous homomorphism
that maps Γd to the integers.
˜ η˜, g˜, F˜ required to construct χ.
We now build the various components G,
˜ (A
simple example of this construction will be given after the end of this proof.)
˜ We will
The ﬁrst step is build the multidegree (1, . . . , 1) nilpotent group G.
˜ As a (real) vector space,
construct this group via its nilpotent Lie algebra log G.
this Lie algebra will be given as a direct sum
˜ := ⊕J⊂{1,...,d} log G|J| .
log G
˜ be the vector space embedding
For each J ⊂ {1, . . . , d}, let ιJ : log G|J| → log G
˜ can be uniquely expressed
indicated by this direct sum, thus every element of log G
in the form J⊂{1,...,d} ιJ (xJ ) for some xJ ∈ log G|J| .
˜ with a Lie bracket structure by declaring
Next, we endow log G
[ιJ (xJ ), ιK (yK )] = 0
whenever J, K ⊂ {1, . . . , d} intersect and xJ ∈ log G|J| , yK ∈ log G|K| , and
[ιJ (xJ ), ιK (yK )] = ιJ∪K ([xJ , yK ])
whenever J, K ⊂ {1, . . . , d} are disjoint and xJ ∈ log G|J| , yK ∈ log G|K| . One
easily veriﬁes that this operation obeys the axioms of a Lie bracket (i.e. it is bilinear,
˜ is a Lie algebra.
antisymmetric, and obeys the Jacobi identity), and so log G
˜ a multidegree ﬁltration. For any (a1 , . . . , ad ) ∈ Nd , let
We now give log G
˜ (a ,...,a ) be the sub-Lie-algebra of log G
˜ generated by the ιJ (xJ ) for which
log G
1
d
1J (j)
aj for each j = 1, . . . , d, and xJ ∈ G|J| . One easily veriﬁes that this is
a multidegree ﬁltration of multidegree (1, . . . , 1), and so one can exponentiate to
˜ of multidegree (1, . . . , 1) also.
create a multidegree-ﬁltered Lie group G
˜
˜
We deﬁne a lattice Γ in G to be the group generated by exp(M !ιJ (log γj )) for
all J ⊂ {1, . . . , d} and γj ∈ Γ|J| , where M is a ﬁxed natural number (depending only on d) which we will assume to be suﬃciently large. From the Baker˜ Γ
˜ is a
Campbell-Hausdorﬀ formula we see that this is indeed a lattice, and so G/
nilmanifold. For M large enough, we see from further application of the Baker˜ (1,...,1) is contained in ι(1,...,1) (log Γd ).
Campbell-Hausdorﬀ formula that Γ

106

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

˜ (1,...,1) by setting
Next, we deﬁne a vertical frequency η˜ on G
η˜(ι(1,...,1) (log gd )) := η(gd ).
˜ (1,...,1) ⊂
One easily veriﬁes that η˜ is a vertical frequency (here we use the inclusion Γ
ι(1,...,1) (log Γd ) and the central nature of G(1,...,1) ).
˜ Γ)
˜ → S ω ) be a function with vertical frequency η˜; such a
Now let F˜ ∈ Lip(∗ (G/
function can be constructed using partitions of unity as in (6.3).
The next step is to deﬁne g˜. From Lemma B.9 and many applications of the
Baker-Campbell-Hausdorﬀ formula, we may write
d
j

gjn

g(n) =
j=0

for some coeﬃcients gj ∈ Gj . We then write
d

(

exp(j!

g˜(n1 , . . . , nd ) :=
j=0

ni )ιJ (log gj )).

J⊂{1,...,d}:|J|=j i∈J

Observe that each individual monomial
(n1 , . . . , nd ) → exp(j!(

ni )ιJ (log gj ))

i∈J

˜ Nd ), so by
with 0
j
d and |J| = j is a polynomial map in ∗ poly(ZdNd → G
Corollary B.4 and the Baker-Campbell-Hausdorﬀ formula we see that the same is
true for g˜.
Finally, we set
˜
χ(n
˜ 1 , . . . , nd ) := F˜ (˜
g (n1 , . . . , nd )∗ Γ).
By construction, χ
˜ ∈ Ξ(1,...,1) (∗ Zd ), which by Lemma E.8(vi) (and the embeddings
in Example 6.11) implies that χ′ ∈ Ξd (∗ Z). It is also clear that χ
˜ is symmetric with
respect to permutations of the n1 , . . . , nd . It remains to show that χ′ is equivalent
to χ⊗d! in Ξd (∗ Z), or in other words that the sequence
˜ . . . , n)
n → χ(n)⊗d! ⊗ χ(n,
is a nilsequence of degree < d. We expand this sequence as

d

(F ⊗d! ⊗ F˜ ) 

(gj , exp(j!

j=0

J⊂{1,...,d}:|J|=j

j



˜ .
ιJ (log gj )))n ∗ (Γ × Γ)

˜
˜ Let
The function F ⊗ F˜ is a Lipschitz function on the nilmanifold (G × G)/(Γ
× Γ).
∗
˜ deﬁned as
G be the subgroup of G × G
∗
˜ (1,...,1) .
G := {(gd , exp(d!ι(1,...,1) (log gd )) : gd ∈ Gd } Gd × G
This is a rational central subgroup. As F and F˜ have vertical frequencies η and η˜
respectively, we see that F ⊗ F˜ is invariant in the G∗ direction, and thus descends
∗
˜
to a Lipschitz function F ′ on the nilmanifold G′ /Γ′ , where G′ := (G × G)/G
and
′
′
˜
Γ is the projection of Γ × Γ to G . We thus have
d

χ(n) ⊗ χ(n,
˜ . . . , n) = F ′ (
j=1

j

(gj′ )n ∗ Γ′ )

(E.3)

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

107

where gj′ is the projection of (gj , exp(j! J⊂{1,...,d}:|J|=j ιJ (log gj ))) to G′ .
We now give G′ a degree ﬁltration by deﬁning G′j to be the group generated by
elements of the form
ιJ (log hj ))) mod G∗

(hj , exp(j!
J⊂{1,...,d}:|J|=j

for hj ∈ Gj , together with elements of the form
(hj+1 , id), (id, exp(ιJ (log hj+1 ))) mod G∗
for hj+1 ∈ Gj+1 and J ⊂ {1, . . . , d} with |J| = j + 1. By a tedious number
of applications of the Baker-Campbell-Hausdorﬀ formula, we see that this is a
ﬁltration of degree < d (here we use the fact that every set of cardinality j + k
partitions into a set J of cardinality j and a set K of cardinality k,
has (j+k)!
j!k!
which cancels the j! prefactors appearing in the deﬁnition of G′j ). By construction,
gj′ ∈ G′j . Thus the right-hand side of (E.3) is a nilsequence of degree < d, and the
claim follows.
Example. We illustrate the above proposition with the simple d = 2 example
mentioned before the proof. We consider a nilcharacter χ that is a vector-valued
smoothing of the sequence n → e({αn}βn) for some ﬁxed frequencies α, β ∈ ∗ T,
which we will write schematically as
χ(n) ∼ e({αn}βn).
As discussed in §6, such a nilcharacter arises from the Heisenberg nilmanifold (6.1)
with the polynomial sequence
αn
g(n) = eβn
2 e1

and vertical character η([e1 , e2 ]t12 ) := −t12 . We may Taylor expand g as
2

g(n) = g1n g2n

β
−αβ/2
where g1 := exp(α log e1 + β log e2 ) = eα
and g2 := [e1 , e2 ]−αβ/2 .
1 e2 [e1 , e2 ]
˜
The nilpotent Lie algebra log G is the seven-dimensional vector space

˜ = log G ⊕ log G ⊕ log G12
log G
with a basis of this space given by
ι1 (log e1 ), ι1 (log e2 ), ι1 (log[e1 , e2 ]), ι2 (log e1 ), ι2 (log e2 ), ι2 (log[e1 , e2 ]), ι12 (log[e1 , e2 ]).
(E.4)
The Lie algebra commutation relations on basis elements are given by the formulae
[ι1 (log e1 ), ι2 (log e2 )] = ι12 (log[e1 , e2 ])
[ι1 (log e2 ), ι2 (log e1 )] = −ι12 (log[e1 , e2 ])

108

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

with all other pairs of basis elements commuting. This gives a nilpotent Lie group
˜ generated (as a Lie group) by the exponentials of (E.4), which we will label as
G
a1 := exp(ι1 (log e1 ))
a2 := exp(ι1 (log e2 ))
a12 := exp(ι1 (log e12 ))
b1 := exp(ι2 (log e1 ))
b2 := exp(ι2 (log e2 ))
b12 := exp(ι2 (log e12 ))
c12 := exp(ι12 (log e12 )),
thus one has the group commutation relations
[a1 , b2 ] = c12 ;

−1
[a2 , b1 ] = c12

with all other pairs of generators commuting. The generators a12 , b12 will play no
essential role in the analysis that follows and may be ignored by the reader.
˜ is a multidegree (1, 1) ﬁltered Lie group with ﬁltration
The group G
˜ (0,0) := G;
˜
G
˜ (1,0) := a1 , a2 , a12 , c12 R ;
G
˜ (0,1) := b1 , b2 , b12 , c12 R ;
G
˜ (1,1) := c12 R .
G
˜ we may take M = 1, so that
To construct Γ,
˜ := a1 , a2 , a12 , b1 , b2 , b12 , c12 .
Γ
From the Baker-Campbell-Hausdorﬀ formula one sees that
˜ (1,1) := Γ
˜∩G
˜ (1,1) = c12 .
Γ
˜ Γ
˜ can be parameterised as
A typical element of G/
˜
ar11 ar22 ar1212 bs11 bs22 bs1212 ct1212 Γ
for r1 , r2 , r12 , s1 , s2 , s12 , t12 ∈ I0 .
The polynomial sequence g˜ is given as
g˜(n1 , n2 ) := exp(n1 ι1 (log g1 ) + n2 ι2 (log g1 )) exp(2n1 n2 ι12 (log g2 ))
= exp(αn1 log a1 + βn1 log a2 + αn2 log b1 + βn2 log b2 )×
× exp(−αβn1 n2 log c12 )
which by the Baker-Campbell-Hausdorﬀ formula expands to
1 βn1 αn2 βn2 −αβn1 n2
g˜(n1 , n2 ) = aαn
a2 b1 b2 c12
.
1

˜ (1,1) → R be the vertical
This is clearly a polynomial sequence. If we then let η˜ : G
character
η˜(exp(t12 ι12 (log[e1 , e2 ]))) := −t12
1
˜ Γ
˜ → S be the (piecewise) Lipschitz function
and let F˜ : G/
˜ := e(−t12 )
F˜ (ar11 ar22 ar1212 bs11 bs22 bs1212 ct1212 Γ)

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

109

for r1 , r2 , r12 , s1 , s2 , s12 , t12 ∈ I0 , then the sequence
˜
χ(n
˜ 1 , n2 ) := F˜ (˜
g (n1 , n2 )∗ Γ)
is almost a nilcharacter of multidegree (1, 1), if we make the usual cheat of ignoring
the fact that F˜ is only piecewise Lipschitz rather than Lipschitz.
Now let us look at the diagonal sequence
2

βn αn βn −αβn ∗ ˜
Γ).
χ(n,
˜ n) = F˜ (aαn
1 a2 b1 b2 c12

A brief computation using the Baker-Campbell-Hausdorﬀ formula shows that one
can rewrite
βn αn βn −αβn2 ∗ ˜
Γ
aαn
1 a2 b1 b2 c12
as
{αn} {βn} {αn} {βn} (αn−{αn}){βn}−(βn−{βn}){αn}−αβn2 ∗ ˜
a1 a2 b1 b2 c12
Γ.
Noting that (αn − {αn})(βn − {βn}) is an integer (cf. (6.4)), we can write the c12
exponent modulo 1 as
{αn}{βn} − 2{αn}βn mod 1
and thus
χ(n,
˜ n) = e(2{αn}βn)e(−{αn}{βn}).
The second factor e(−{αn}{βn}) is a piecewise Lipschitz function of (αn mod 1,
βn mod 1) and is thus almost a 1-step nilsequence. We thus see that χ(n,
˜ n) is
almost equivalent (as a degree 2 almost nilcharacter) to χ(n)2 . To eliminate the
exponent of 2, one can go back to the start of the argument and replace β (for
instance) by β/2. The reader may verify that once one does so, the almost nilcharacter χ
˜ is essentially equal to (E.2).
Finally, we mention that with the above example, the group G∗ takes the form
12
G∗ := {([e1 , e2 ]t12 , c2t
12 ) : t12 ∈ R}

∗
˜
and the group G′ := (G × G)/G
has the degree 1 ﬁltration

G′0 := G′
t′

t′

t′′

G′1 := {(et11 et22 [e1 , e2 ]t12 , at11 at22 a1212 bt11 bt22 b1212 c1212 : t1 , t2 , t12 , t′12 , t′′12 ∈ R} mod G∗ .
One can verify by hand that this is indeed a degree 1 ﬁltration on G′ , which explains
why χ(n)2 χ(n,
˜ n) is a degree 1 (almost) nilsequence.
This concludes the discussion of the example. Now we generalise Proposition
E.10 to higher k.
Theorem E.10 (Multilinearisation). Let Ω be a limit subset of Zk , which we give
the multidegree filtration. Let d = (d1 , . . . , dk ) ∈ Nk , and χ ∈ Ξd (Ω). Then there
exists χ
˜ ∈ Ξ(1,...,1) (∗ Z|d| ) (where 1 is repeated |d| times) such that the nilcharacter
χ′ : (n1 , . . . , nk ) → χ(n
˜ 1 , . . . , n1 , n2 , . . . , n2 , . . . , nk , . . . , nk )
(where each ni is repeated di times) is equivalent to χ in Ξd (Ω) (thus [χ]Ξd (Ω) =
[χ′ ]Ξd (Ω) ). Furthermore, one can select
χ(n
˜ 1,1 , . . . , n1,d1 , n2,1 , . . . , n2,d2 , . . . , nk,1 , . . . , nk,dk )
to be symmetric with respect to the permutation of ni,1 , . . . , ni,di for each i =
1, . . . , k.

110

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

Proof. Without loss of generality we may take Ω = ∗ Zk . The argument is exactly
the same as that used to establish Proposition E.9 except that the notation is more
complicated. Accordingly, we will focus primarily on the notational setup in this
proof.
As before, it will suﬃce to make χ′ equivalent to χ⊗d! rather than χ, where
d! := d1 ! . . . dk !. We have χ(n) = F (g(n)∗ Γ) for some multidegree d nilmanifold G/Γ, some polynomial sequence g ∈ ∗ poly(ZkNk → (G/Γ)Nk ), and some
F ∈ Lip(∗ (G/Γ) → S ω ), obeying the vertical frequency property
F (gd x) = e(η(gs ))F (x)
for all x ∈ G/Γ and gd ∈ Gd , where η : Gd → R is a vertical frequency.
˜ As a (real) vector
As before, we begin by bulding the nilpotent Lie algebra log G.
space, this Lie algebra will be given as a direct sum
˜ := ⊕J⊂{1,...,|d|} log G J
log G
where J ∈ Nk is the vector
J := (|J ∩ {d1 + . . . + di−1 + 1, . . . , d1 + . . . + di }|)1

i k.

˜ be the vector space embedding
For each J ⊂ {1, . . . , d}, let ιJ : log G J → log G
˜ with a Lie bracket structure
indicated by this direct sum. Next, we endow log G
by declaring
[ιJ (xJ ), ιK (yK )] = 0
whenever J, K ⊂ {1, . . . , d} intersect and xJ ∈ log G J , yK ∈ log G K , and
[ιJ (xJ ), ιK (yK )] = ιJ∪K ([xJ , yK ])
whenever J, K ⊂ {1, . . . , d} are disjoint and xJ ∈ log G J , yK ∈ log G K . As
before, one easily veriﬁes the Lie bracket axioms.
˜ a multidegree ﬁltration. For any (a1 , . . . , a|d| ) ∈ N|d| , let
We now give log G
˜ (a ,...,a ) be the sub-Lie-algebra of log G
˜ generated by the ιJ (xJ ) for which
log G
1
|d|
1J (j)
aj for each j = 1, . . . , |d|, and xJ ∈ G J . As before, this is a multidegree ﬁltration of multidegree (1, . . . , 1), and exponentiates to create a multidegree˜ of multidegree (1, . . . , 1) also.
ﬁltered Lie group G
˜ in G
˜ to be the group generated by exp(M !ιJ (log γj )) for
We deﬁne a lattice Γ
˜ Γ
˜ is a
all J ⊂ {1, . . . , |d|} and γj ∈ Γ J . Again, this creates a nilmanifold G/
˜
nilmanifold, and for M large enough, Γ(1,...,1) is contained in ι(1,...,1) (log Γd ).
˜ (1,...,1) by the exact same formula:
As before, we deﬁne a vertical frequency η˜ on G
η˜(ι(1,...,1) (log gd )) := η(gd ),
˜ Γ)
˜ → S ω ) with vertical frequency η˜.
and then construct F˜ ∈ Lip(∗ (G/
The next step is to deﬁne g˜. As before, we have the Taylor expansion
j

gjn

g(n) =
j d

for some coeﬃcients gj ∈ Gj , where j = (j1 , . . . , jk ) now ranges over multi-indices
less than or equal to d, arranged in some arbitrary order (e.g. lexicographical will
suﬃce). We then write
g˜(n1 , . . . , n|d| ) :=

exp(j!
j d

(
J⊂{1,...,|d|}: J =j i∈J

ni )ιJ (log gj )),

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

111

recalling that j! := j1 ! . . . jk !. As before, one veriﬁes that g˜ is a polynomial map.
Finally, we set
˜
χ(n
˜ 1 , . . . , n|d| ) := F˜ (˜
g (n1 , . . . , n|d| )∗ Γ).
The rest of the argument proceeds exactly as in Proposition E.9, the main diﬀerence
being that d is replaced with |d|, and |J| with J , whenever necessary; we omit
the details.
Now we show how nilcharacters interact with the concept of bias.
Lemma E.11 (Bias lemma). Let k, d ∈ N+ with d 2, let χ be a degree d nilcharacter on ∗ Zk (with the degree filtration), and let N be an unbounded limit natural
number. Let Ω be a convex polytope in [[N ]]k , let P1 , . . . , Pk be dense subprogressions of [N ]. Suppose that 1Ω (n)1P1 ×...×Pk χ(n) is < d-biased on [[N ]]k . Then on
[[N ]]k , χ is equal to a nilsequence of degree < d.
Remark. Note that the claim fails for d = 1, even when k = 1; if q > 1 is a
bounded integer, then the degree 1 nilcharacter n → e(n/q) is of course biased on
progression of spacing q, but not on the original interval [[N ]]. However, this is a
purely “degree 1” obstruction and vanishes for higher degree.
Proof. Write P := P1 × . . . Pk . By Corollary E.6, 1Ω (n)1P χ(n) correlates with a
nilcharacter of degree d − 1; we may absorb this nilcharacter into χ, and assume
that 1Ω (n)1P χ(n) is in fact biased.
By partitioning Ω ∩ P into the product P ′ = P1′ × . . . × Pk′ of dense progressions
of [[N ]] (using [23, Corollary A.2] to control the error), we see that there exists such
a product P ′ = P1′ × . . . × Pk′ for which
|En∈P ′ χ(n)| ≫ 1
Write χ = F ◦ O for some degree d nilmanifold G/Γ, some F ∈ Lip(∗ (G/Γ)) with
a vertical frequency η, and some O ∈ ∗ poly(Zk → G/Γ). Applying Theorem D.5
and using the pigeonhole principle to reﬁne the progressions P1′ , . . . , Pk′ if necessary,
we may assume without loss of generality that we can factorise
O(n) = εP ′ (n)gP ′ (n)∗ Γ
for all n ∈ P ′ , where gP ′ ∈ ∗ poly(Zk → GP ′ ) is totally equidistributed on GP ′ /ΓP ′
for some standard rational subgroup GP ′ of G, and εP ′ ∈ ∗ poly(Zk → G) being
bounded and having Lipschitz constant O(1/N ) on P , and with the ith Taylor
coeﬃcients of size O(N −|i| ) for each i ∈ Nk .
For any n, nP ′ ∈ P ′ , we have from the Lipschitz nature of εP ′ that
F (O(n)) = F (εP ′ (nP ′ )gP ′ (n)∗ Γ) + O(|n − n0 |/N ),
and thus by dividing P ′ into suﬃciently small (but still dense) sub-products, we
may assume that
|En∈P ′ F (εP ′ (nP ′ )gP ′ (n)∗ Γ)| ≫ 1
for some nP ′ ∈ P ′ , which by the total equidistribution of gP ′ implies that

GP ′ /ΓP ′

F (εP ′ (nP ′ )x) dµGP ′ /ΓP ′ ≫ 1.

As F has vertical frequency η, this implies that η must annihilate GP ′ , d , and so
F is invariant with respect to the action of this group. By quotienting out by this

112

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

central group we may thus assume that GP ′ ,
degree < d. We can then write

d

is trivial, thus GP ′ /ΓP ′ now has

n
mod 1)
χ(n) = F˜ (gP ′ (n)∗ ΓP ′ ,
5N
for all n ∈ [[N ]], where F˜ : ∗ (GP ′ /ΓP ′ × T) is deﬁned so that
n
F˜ (x,
) = F (εP ′ (n)x)
5N
for n ∈ [N ] and x ∈ ∗ (GP ′ /ΓP ′ ), and extended in a Lipschitz function to all of
∗
(GP ′ /ΓP ′ × T). This represents χ as a nilsequence of degree < d on P ′ . Using the
conjugate nature of the various sequences gP in Theorem D.5, we conclude that χ
can also be represented as a nilsequence of degree < d on all translates P ′ + h of P ′
J
also. On the other hand, since P ′ is dense in [[N ]]k , one can partition 1 = j=1 ψj
on [[N ]]k , where J is bounded and the ψj are degree 1 nilsequences, each of which
J
is supported on a translate P ′ + hj of P ′ . This implies that χ = j=1 ψj χ. As
d 2, the ψj have degree < d, and the claim now follows from Corollary E.2.
We have the following useful consequence of Lemma E.11.
Corollary E.12 (Extrapolation lemma). Let k, d ∈ N+ with d
2, let χ be a
degree d nilcharacter on ∗ Zk (with the degree filtration), and let N be an unbounded
limit natural number. Let P1 , . . . , Pk be dense subprogressions of [[N ]], and let
P := P1 × . . . × Pk . Then the following are equivalent:
• χ is < d-biased on [[N ]]k .
• χ is < d-biased on P .
• [χ]Ξd ([[N ]]k ) = 0.
• [χ]Ξd (P ) = 0.
Proof. We trivially have that that (iii) implies (iv). Since χ correlates with itself,
we see that (iii) implies (i) and (iv) implies (ii). Lemma E.11 gives that (i) or (ii)
both imply (iii), and the claim follows.
The Pontragyin dual T of the integers Z of course contains plenty of torsion. It
turns out however that this torsion is a purely degree 1 phenomenon, and disappears
in higher degree.
Lemma E.13 (Torsion-free lemma). Let k ∈ N+ , let N be an unbounded integer,
and let d 2 be standard. Then the abelian group Symbd ([[N ]]k ) (with the degree
filtration) is torsion-free.
Proof. Our goal is to show that if q 1 is bounded and χ is a degree s nilcharacter
such that χ⊗q is equal to a degree < s nilsequence on [N ]k , then χ is also equal to
a degree < s nilsequence.
We modify the arguments used to prove Lemma E.11. We write χ = F ◦ O where
G/Γ is a degree s nilmanifold, O ∈ ∗ poly(Zk → G/Γ), and F ∈ Lip(∗ (G/Γ)) has
a vertical frequency η, then we have
|En∈[N ]k F (O(n))⊗q F0 (O0 (n))| ≫ 1
for some degree < s nilmanifold G0 /Γ0 , some O0 ∈ ∗ poly(Zk → G0 /Γ0 ), and F0 ∈
Lip(∗ (G0 /Γ0 )). Using Theorem D.5, we may thus ﬁnd a product P = P1 × . . . × Pk
of progressions in [[N ]]k and a factorisation
(O(n), O0 (n)) = (εP (n)gP (n)∗ Γ, εP,0 (n)gP,0 (n)∗ Γ0 )

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

113

where εP ∈ ∗ poly(Zk → G), εP,0 ∈ ∗ poly(Zk → G0 ) are bounded and Lipschitz on
˜ P ) is totally
[[N ]]k with Lipschitz constant O(1/N ), and (gP , gP,0 ) ∈ ∗ poly(Zk → G
˜
˜
˜
equidistributed in GP /ΓP for some rational subgroup GP of G × G0 . Shrinking P
if necessary as in the proof of Lemma E.11, we may assume that
|

˜ P /Γ
˜P
G

F (εP (nP )x)⊗q F0 (εP,0 (nP )x0 ) dµG˜ P /Γ/P
(x, x0 )| ≫ 1
˜

for any nP ∈ P . From the vertical character nature of F , this implies that η q
˜ P )s . But η is a continuous homomorphism on the connected abelian
annihilates (G
˜
˜ P )s . If we then quotient
Lie group (GP )s , and so η itself must also annihilate (G
by this space, we can represent χ by a degree < s nilsequence on P , and the claim
now follows from Corollary E.12.
Appendix F. A linearisation result from additive combinatorics
In this appendix, we record a lemma from additive combinatorics (essentially in
[16] or [21], and in the spirit of Freiman’s inverse sumset theorem) which asserts
that functions from a large subset of [−N, N ] to T with a large amount of additive
structure are essentially bracket-linear in nature.
Lemma F.1 (Linearisation lemma). Let ε > 0 be a limit real, let N be a limit
natural number, let H be a dense subset of [[N ]], let α ∈ ∗ T be a frequency, and let
ξ1 , ξ2 , ξ3 , ξ4 : H → ∗ T be limit functions such that
ξ1 (h1 ) + ξ2 (h2 ) + ξ3 (h3 ) + ξ4 (h4 ) = α + O(ε)

(F.1)

for many additive quadruples (h1 , h2 , h3 , h4 ) ∈ H. Then there exists a standard
k 0, a frequency δ ∈ ∗ T, a dense subset H ′ of H, and a Freiman homomorphism
ξ : H ′ → ∗ T of the form
K

ξ(h) =

{αk h}βk mod 1
k=1

for all h ∈ H ′ and some αk ∈ ∗ T and βk ∈ ∗ R and some standard K, such that
ξ1 (h) = ξ(h) + δ + O(ε)

(F.2)

for many h ∈ H.
Proof. We may replace ε by 1/M for some limit integer M . By rounding each ξi (h)
to the nearest multiple of 1/M , we may assume that ξi (h) is a multiple of 1/M for
all h ∈ H and i = 1, 2, 3, 4. There are now only a bounded number of possibilities
for the right-hand side α + O(ε), so by the pigeonhole principle (and by redeﬁning
α if necessary) we may assume that
ξ1 (h1 ) + ξ2 (h2 ) + ξ3 (h3 ) + ξ4 (h4 ) = α
for many additive quadruples (h1 , h2 , h3 , h4 ) in H.
For each i = 1, 2, 3, 4, let Γ ⊂ ∗ Z×∗ T be the (limit) graph Γi := {(h, ξi (h) mod 1) :
h ∈ H}. Then by the preceding discussion, we see that (0, α) has ≫ N 3 representations of the form γ1 + γ2 + γ3 + γ4 , where γi ∈ Γi for i = 1, 2, 3, 4. On the other
hand, from several applications of the Cauchy-Schwarz inequality, the number of

114

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER
4

such quadruples is bounded by i=1 E(Γi )1/4 , where E(Γi ) is the number of additive quadruples in Γi (i.e. the additive energy of Γi ). Since we have the trivial
upper bound E(Γi ) ≪ N 3 for all i, we conclude that
E(Γ1 ) ≫ N 3 .
At this point we invoke some standard additive combinatorial machinery from
[21] (see also [16, 51]). Applying the Balog-Szemer´edi-Gowers lemma followed by
the Pl¨
unnecke-Ruzsa inequalities exactly as in [21, Proposition 5.4], we can ﬁnd a
dense subset Γ′ of Γ1 such that |9Γ′ − 8Γ′ | ≪ N . Applying [21, Lemma 9.2], we
can reﬁne to a further dense subset Γ′′ := {(h, ξ(h) mod 1) : h ∈ H ′′ } such that
4Γ′′ −4Γ′′ is a graph; thus there exists a Freiman homomorphism13 ζ : 2H ′′ −2H ′′ →
T such that
ξ1 (h1 ) + ξ1 (h2 ) − ξ1 (h3 ) − ξ1 (h4 ) = ζ(h1 + h2 − h3 − h4 )

(F.3)

′′

for all h1 , h2 , h3 , h4 ∈ H . By the Bogulybov lemma (see [21, Lemma 6.3]), 2H ′′ −
2H ′′ contains a dense regular Bohr set B of bounded rank (see [21] for deﬁnitions;
strictly speaking, one has to identify an interval such as [[10N ]] with Z/20N Z in
order to apply these tools, but this is not diﬃcult to do). Arguing as14 in [21,
Proposition 10.8], we see that we may write
k

{αj h}βj mod 1

ζ(h) =
j=1

for h ∈ B for some standard k and frequencies αj , βj . Applying (F.3) and the
pigeonhole principle, we obtain the claim, except possibly for the claim that ξ
is a Freiman homomorphism. But observe that if we restrict the fractional part
of {αj h} to a sub-interval of I0 of length at most 1/10 (say) then we obtain the
Freiman homomorphism property automatically; so the claim follows from one ﬁnal
application of the pigeonhole principle.
References
[1] N. Alon, T. Kaufman, M. Krivelevich, S. Litsyn and D. Ron, Testing low-degree polynomials
over GF(2), RANDOM-APPROX 2003, 188–199. Also: Testing Reed-Muller codes, IEEE
Transactions on Information Theory 51 (2005), 4032–4039.
[2] A. Balog and E. Szemer´
edi, A statistical theorem of set addition, Combinatorica, 14 (1994),
263–268.
[3] V. Bergelson and A. Leibman, Distribution of values of bounded generalized polynomials,
Acta Mathematica 198 (2007), 155–230.
[4] V. Bergelson, B. Host and B. Kra, Multiple recurrence and nilsequences, (with an appendix
by I. Ruzsa), Invent. Math. 160, no. 2 (2005), 261–303.
[5] V. Bergelson, T. C. Tao and T. Ziegler, An inverse theorem for uniformity seminorms associated with the action of F∞
p , Geom. Funct. Anal. 19 (2010), no. 6, 1539–1596.
[6] N. N. Bogolyubov, Sur quelques propri´
et´
es arithm´
etiques des presque-p´
eriodes, Ann. Chaire
Math. Phys. Kiev 4 (1939), 185–194.
[7] N. Bourbaki, Groupes et alg`
ebres de Lie, vol I.
[8] J. Bourgain, On arithmetic progressions in sums of sets of integers, in A tribute to Paul
Erd˝
os, CUP 1990.
, On triples in arithmetic progression, Geom. Funct. Anal. 9 (1999), no. 5, 968–984.
[9]
13The notion of a Freiman homomorphism was defined in §3.
14This proposition involved a quadratic function on a Bohr set, rather than a linear one, but

it is clear that the argument specialises to the linear case.

AN INVERSE THEOREM FOR THE GOWERS U s+1 [N ]-NORM

115

[10] J. P. Conze and E. Lesigne, Sur un th´
eor`
eme ergodique pour des mesures diagonales, C. R.
Acad. Sci. Paris 306 (1988), 491–493.
[11] N. Frantzikinakis, B. Host and B. Kra, Multiple recurrence and convergence for sequences
related to the prime numbers, J. Reine Angew. Math. 611 (2007), 131–144.
[12] H. Furstenberg, Ergodic behavior of diagonal measures and a theorem of Szemer´
edi on arithmetic progressions, J. Analyse Math. 31 (1977), 204–256.
[13] H. Furstenberg, Nonconventional ergodic averages, The legacy of John von Neumann (Hempstead, NY, 1988), 43–56, Proc. Sympos. Pure Math., 50, Amer. Math. Soc., Providence, RI,
1990.
n
n2 x). Conver[14] H. Furstenberg, B. Weiss, A mean ergodic theorem for 1/N N
n=1 f (T x)g(T
gence in ergodic theory and probability (Columbus, OH, 1993), 193-227, Ohio State Univ.
Math. Res. Inst. Publ., 5 de Gruyter, Berlin, 1996.
[15] K. G¨
odel, Consistency of the axiom of choice and of the generalized continuum-hypothesis
with the axioms of set theory, Proc. Nat. Acad. Sci. 24 (1938), 556–557.
[16] W. T. Gowers, A new proof of Szemer´
edi’s theorem for progressions of length four, GAFA 8
(1998), no. 3, 529–551
, A new proof of Szemer´
edi’s theorem, GAFA 11 (2001), 465–588.
[17]
[18] B. J. Green, Arithmetic progressions in sumsets, GAFA 12 (2002) no. 3, 584–597.
[19]
, Generalising the Hardy-Littlewood method for primes, International Congress of
Mathematicians. Vol. II, 373-399, Eur. Math. Soc., Zurich, 2006.
[20] B. J. Green and T. C. Tao, The primes contain arbitrarily long arithmetic progressions,
Annals of Math. 167 (2008), 481–547.
[21]
, An inverse theorem for the Gowers U 3 -norm, with applications, Proc. Edinburgh
Math. Soc. 51, no. 1, 71–153.
[22]
, Quadratic uniformity of the M¨
obius function, Annales de l’Institut Fourier (Grenoble) 58 (2008), no. 6, 1863–1935.
, Linear equations in primes, Ann. Math 171 (2010), no. 3, 1753–1850.
[23]
[24]
, The quantitative behaviour of polynomial orbits on nilmanifolds, preprint available
at arXiv:0709.3562.
, The distribution of polynomials over finite fields, with applications to the Gowers
[25]
norms, Contrib. Discrete Math. 4 (2009), no. 2, 1–36.
[26]
, The M¨
obius function is strongly orthogonal to nilsequences, preprint available at
arXiv:0807.1736.
[27]
, An arithmetic regularity lemma, associated counting lemma, and applications, in
An Irregular Mind (Szemer´
edi is 70), Bolyai Society Mathematical Studies 21, 261–334.
[28] B. J. Green, T. C. Tao and T. Ziegler, An inverse theorem for the Gowers U 4 [N ] norm,
Glasgow Math. J. 53 (2011), 1–50.
[29]
, An inverse theorem for the Gowers U s+1 [N ]-norm, announcement available at
arXiv:1006.0205.
[30] I. J. H˚
aland, Uniform distribution of generalized polynomials, Ph.D. Thesis, The Ohio State
University, 1992.
, Uniform distribution of generalized polynomials, J. Number Theory 45 (1993), 327–
[31]
366.
[32]
, Uniform distribution of generalized polynomials of the product type, Acta Arith. 67
(1994), 13-27.
[33] I. J. H˚
aland and D. E. Knuth, Polynomials involving the floor function, Math. Scand. 76
(1995), 194–200,
[34] B. Host and B. Kra, Convergence of Conze-Lesigne averages, Erg. Th. Dyn. Sys. 21 (2001),
493-509.
[35]
, Averaging along cubes, Dynamical Systems and related topics, Eds. Brin, Hasselblatt,
Pesin. Cambridge University Press, Cambridge (2004).
, Nonconventional ergodic averages and nilmanifolds, Ann. of Math. (2) 161 (2005),
[36]
no. 1, 397–488.
[37]
, Uniformity seminorms on ℓ∞ and applications, J. Anal. Math. 108 (2009), 219–276.
[38] B. Host, B. Kra, A. Maass, Nilsequences and a structure theorem for topological dynamical
systems, Adv. Math. 224 (2010), no. 1, 103–129.
[39] E. Hrushovski, Totally categorical structures, Trans. Amer. Math. Soc. 313 (1989), no. 1,
131–159.

116

BEN GREEN, TERENCE TAO, AND TAMAR ZIEGLER

[40] R. Jin, Freiman’s Conjecture and Nonstandard Methods, preprint.
[41] T. Kaufman, S. Lovett, Worst Case to Average Case Reductions for Polynomials, preprint.
[42] M. Lazard, Sur les groupes nilpotents et les anneaux de Lie, Ann. Sci. Ecole Norm. Sup. (3)
71 (1954), 101–190.
[43] A. Leibman, Polynomial sequences in groups, Journal of Algebra 201 (1998), 189–206.
[44] A. Leibman, Polynomial mappings of groups, Israel J. Math. 129 (2002), 29–60.
, Pointwise convergence of ergodic averages of polynomial sequences of translations
[45]
on a nilmanifold, Ergodic Theory and Dynamical Systems 25 (2005), no. 1, 201-213
[46]
, A canonical form and the distribution of values of generalised polynomials, preprint.
´
[47] E. Lesigne, Equations
fonctionnelles, couplages de produits gauches et th´
eor`
emes ergodiques
pour mesures diagonales, Bull. Soc. Math. France 121 (1993), no. 3, 315–351.
[48] A. Mal’cev, On a class of homogeneous spaces, Izvestiya Akad. Nauk SSSR, Ser Mat. 13
(1949), 9–32.
[49] W. Magnus, A. Karras, and D. Solitar, Presentations of Groups in Terms of Generators and
Relations, Dover Publications, 2004.
[50] K. Ribet, On ℓ-adic representations associated to modular forms, Inventiones math. 28(1975),
245–275.
[51] A. Samorodnitsky, Low-degree tests at large distances, STOC 2007.
[52] B. Szegedy, Higher order Fourier analysis as an algebraic theory I, preprint.
[53] B. Szegedy, Higher order Fourier analysis as an algebraic theory II, preprint.
[54] B. Szegedy, Higher order Fourier analysis as an algebraic theory III, preprint.
[55] T. C. Tao, Structure and Randomness: pages from year one of a mathematical blog, American
Mathematical Society, 2008.
[56] T. C. Tao and T. Ziegler, The inverse conjecture for the Gowers norms over finite fields via
the correspondence principle, Anal. PDE 3 (2010), no. 1, 1–20.
[57] T. C. Tao and V. Vu, Additive combinatorics, Cambridge Studies in Advanced Mathematics,
105. Cambridge University Press, Cambridge, 2006.
[58]
, John-type theorems for generalized arithmetic progressions and iterated sumsets,
Adv. in Math. 219 (2008), 428?-449.
[59] I. M. Vinogradov, The method of Trigonometrical Sums in the Theory of Numbers, translated
from the Russian, revised and annotated by K.F. Roth and A. Davenport, Interscience,
London, 1954.
[60] T. Ziegler, Universal Characteristic Factors and Furstenberg Averages, J. Amer. Math. Soc.
20 (2007), 53–97.
Centre for Mathematical Sciences, Wilberforce Road, Cambridge CB3 0WA, England
E-mail address: b.j.green@dpmms.cam.ac.uk
Department of Mathematics, UCLA, Los Angeles, CA 90095, USA
E-mail address: tao@math.ucla.edu
Department of Mathematics, Technion - Israel Institute of Technology, Haifa, Israel 32000
E-mail address: tamarzr@tx.technion.ac.il

